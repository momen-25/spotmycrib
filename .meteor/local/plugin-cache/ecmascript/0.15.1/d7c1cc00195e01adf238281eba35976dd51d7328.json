{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/momen/projects/spotmycrib-master/packages/mdg:meteor-apm-agent/lib/hijack/meteorx.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"packages/mdg:meteor-apm-agent/lib/hijack/meteorx.js","filename":"/home/momen/projects/spotmycrib-master/packages/mdg:meteor-apm-agent/lib/hijack/meteorx.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/momen/projects/spotmycrib-master","root":"/home/momen/projects/spotmycrib-master","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/momen/projects/spotmycrib-master/packages/mdg:meteor-apm-agent/lib/hijack/meteorx.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/mdg:meteor-apm-agent/lib/hijack/meteorx.js"}},"code":"module.export({\n  Server: () => Server,\n  Session: () => Session,\n  MongoCursor: () => MongoCursor,\n  Multiplexer: () => Multiplexer,\n  MongoConnection: () => MongoConnection,\n  Subscription: () => Subscription,\n  MongoOplogDriver: () => MongoOplogDriver,\n  MongoPollingDriver: () => MongoPollingDriver\n});\nlet get;\nmodule.link(\"../utils.js\", {\n  get(v) {\n    get = v;\n  }\n\n}, 0);\nconst Server = Meteor.server.constructor;\n\nfunction getSession() {\n  const fakeSocket = {\n    send() {},\n\n    close() {},\n\n    headers: []\n  };\n  const server = Meteor.server;\n\n  server._handleConnect(fakeSocket, {\n    msg: \"connect\",\n    version: \"pre1\",\n    support: [\"pre1\"]\n  });\n\n  const session = fakeSocket._meteorSession;\n\n  server._removeSession(session);\n\n  return session;\n}\n\nconst session = getSession();\nconst Session = session.constructor;\nconst collection = new Mongo.Collection(\"__dummy_coll_\" + Random.id());\ncollection.findOne();\nconst cursor = collection.find();\nconst MongoCursor = cursor.constructor;\n\nfunction getMultiplexer(cursor) {\n  const handle = cursor.observeChanges({\n    added() {}\n\n  });\n  handle.stop();\n  return handle._multiplexer;\n}\n\nconst Multiplexer = getMultiplexer(cursor).constructor;\nconst MongoConnection = MongoInternals.defaultRemoteCollectionDriver().mongo.constructor;\n\nfunction getSubscription(session) {\n  const subId = Random.id();\n\n  session._startSubscription(function () {\n    this.ready();\n  }, subId, [], \"__dummy_pub_\" + Random.id());\n\n  const subscription = get(session._namedSubs, subId);\n\n  session._stopSubscription(subId);\n\n  return subscription;\n}\n\nconst Subscription = getSubscription(session).constructor;\n\nfunction getObserverDriver(cursor) {\n  const multiplexer = getMultiplexer(cursor);\n  return multiplexer && multiplexer._observeDriver || null;\n}\n\nfunction getMongoOplogDriver() {\n  const driver = getObserverDriver(cursor);\n  let MongoOplogDriver = driver && driver.constructor || null;\n\n  if (MongoOplogDriver && typeof MongoOplogDriver.cursorSupported !== \"function\") {\n    return null;\n  }\n\n  return MongoOplogDriver;\n}\n\nconst MongoOplogDriver = getMongoOplogDriver();\n\nfunction getMongoPollingDriver() {\n  const cursor = collection.find({}, {\n    limit: 20,\n    _disableOplog: true\n  });\n  const driver = getObserverDriver(cursor); // verify observer driver is a polling driver\n\n  if (driver && typeof driver.constructor.cursorSupported === \"undefined\") {\n    return driver.constructor;\n  }\n\n  return null;\n}\n\nconst MongoPollingDriver = getMongoPollingDriver();","map":{"version":3,"sources":["packages/mdg:meteor-apm-agent/lib/hijack/meteorx.js"],"names":["module","export","Server","Session","MongoCursor","Multiplexer","MongoConnection","Subscription","MongoOplogDriver","MongoPollingDriver","get","link","v","Meteor","server","constructor","getSession","fakeSocket","send","close","headers","_handleConnect","msg","version","support","session","_meteorSession","_removeSession","collection","Mongo","Collection","Random","id","findOne","cursor","find","getMultiplexer","handle","observeChanges","added","stop","_multiplexer","MongoInternals","defaultRemoteCollectionDriver","mongo","getSubscription","subId","_startSubscription","ready","subscription","_namedSubs","_stopSubscription","getObserverDriver","multiplexer","_observeDriver","getMongoOplogDriver","driver","cursorSupported","getMongoPollingDriver","limit","_disableOplog"],"mappings":"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","sourcesContent":["// Various tricks for accessing \"private\" Meteor APIs borrowed from the\n// now-unmaintained meteorhacks:meteorx package.\n\nimport { get } from \"../utils.js\";\n\nexport const Server = Meteor.server.constructor;\n\nfunction getSession() {\n  const fakeSocket = {\n    send() {},\n    close() {},\n    headers: []\n  };\n\n  const server = Meteor.server;\n\n  server._handleConnect(fakeSocket, {\n    msg: \"connect\",\n    version: \"pre1\",\n    support: [\"pre1\"]\n  });\n\n  const session = fakeSocket._meteorSession;\n\n  server._removeSession(session);\n\n  return session;\n}\n\nconst session = getSession();\nexport const Session = session.constructor;\n\nconst collection = new Mongo.Collection(\"__dummy_coll_\" + Random.id());\ncollection.findOne();\nconst cursor = collection.find();\nexport const MongoCursor = cursor.constructor;\n\nfunction getMultiplexer(cursor) {\n  const handle = cursor.observeChanges({\n    added() {}\n  });\n  handle.stop();\n  return handle._multiplexer;\n}\n\nexport const Multiplexer = getMultiplexer(cursor).constructor;\n\nexport const MongoConnection =\n  MongoInternals.defaultRemoteCollectionDriver().mongo.constructor;\n\nfunction getSubscription(session) {\n  const subId = Random.id();\n\n  session._startSubscription(function () {\n    this.ready();\n  }, subId, [], \"__dummy_pub_\" + Random.id());\n\n  const subscription = get(session._namedSubs, subId);\n\n  session._stopSubscription(subId);\n\n  return subscription;\n}\n\nexport const Subscription = getSubscription(session).constructor;\n\nfunction getObserverDriver(cursor) {\n  const multiplexer = getMultiplexer(cursor);\n  return multiplexer && multiplexer._observeDriver || null;\n}\n\nfunction getMongoOplogDriver() {\n  const driver = getObserverDriver(cursor);\n  let MongoOplogDriver = driver && driver.constructor || null;\n  if (MongoOplogDriver &&\n      typeof MongoOplogDriver.cursorSupported !== \"function\") {\n    return null;\n  }\n  return MongoOplogDriver;\n}\n\nexport const MongoOplogDriver = getMongoOplogDriver();\n\nfunction getMongoPollingDriver() {\n  const cursor = collection.find({}, {\n    limit: 20,\n    _disableOplog: true,\n  });\n\n  const driver = getObserverDriver(cursor);\n\n  // verify observer driver is a polling driver\n  if (driver && typeof driver.constructor.cursorSupported === \"undefined\") {\n    return driver.constructor;\n  }\n\n  return null;\n}\n\nexport const MongoPollingDriver = getMongoPollingDriver();\n"]},"sourceType":"module","hash":"d7c1cc00195e01adf238281eba35976dd51d7328"}
