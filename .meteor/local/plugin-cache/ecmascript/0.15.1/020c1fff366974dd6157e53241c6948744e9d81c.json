{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/momen/projects/spotmycrib-master/imports/ui/templates/myProperties.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"imports/ui/templates/myProperties.js","filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/myProperties.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/momen/projects/spotmycrib-master","root":"/home/momen/projects/spotmycrib-master","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/myProperties.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/templates/myProperties.js"}},"code":"module.link(\"./pagination.html\");\nmodule.link(\"./imageView.html\");\nmodule.link(\"./myProperties.html\");\nmodule.link(\"./shared.js\");\nlet SimpleSchema;\nmodule.link(\"simpl-schema\", {\n  default(v) {\n    SimpleSchema = v;\n  }\n\n}, 0);\n// SimpleSchema.extendOptions(['autoform']);\nadvertiseFormSaving = '';\nfsClient = '';\nsaveAndAdvertise = false;\nvar globalFILTERS = {};\n\nfunction getFiltersFromRoute() {\n  var FILTERS = {};\n\n  if (FlowRouter.current().queryParams.home_type) {\n    var val = FlowRouter.current().queryParams.home_type;\n    FILTERS['homeType'] = val;\n  }\n\n  if (FlowRouter.current().queryParams.facing) {\n    var val = FlowRouter.current().queryParams.facing;\n    FILTERS['facing'] = val;\n  }\n\n  if (FlowRouter.current().queryParams.floor_low || FlowRouter.current().queryParams.floor_high) {\n    var val_l = FlowRouter.current().queryParams.floor_low;\n    var val_h = FlowRouter.current().queryParams.floor_high;\n\n    if (isNaN(val_l) && isNaN(val_h)) {//Both are not valid numbers\n    } else if (!isNaN(val_l) && isNaN(val_h)) {\n      //Low is valid and no upper\n      FILTERS['floor'] = [val_l, 0];\n    } else if (isNaN(val_l) && !isNaN(val_h)) {\n      //Upper is valid and no lower\n      FILTERS['floor'] = [0, val_h];\n    } else {\n      //Both are valid\n      FILTERS['floor'] = [val_l, val_h];\n    }\n  }\n\n  if (FlowRouter.current().queryParams.price_low || FlowRouter.current().queryParams.price_high) {\n    var val_l = FlowRouter.current().queryParams.price_low;\n    var val_h = FlowRouter.current().queryParams.price_high;\n\n    if (isNaN(val_l) && isNaN(val_h)) {//Both are not valid numbers\n    } else if (!isNaN(val_l) && isNaN(val_h)) {\n      //Low is valid and no upper\n      FILTERS['priceRange'] = [val_l, 0];\n    } else if (isNaN(val_l) && !isNaN(val_h)) {\n      //Upper is valid and no lower\n      FILTERS['priceRange'] = [0, val_h];\n    } else {\n      //Both are valid\n      FILTERS['priceRange'] = [val_l, val_h];\n    }\n  } //if(FILTERS.length==0){return false;}\n\n\n  return FILTERS; //{\"Home Type\":[\"2 BHK\"],\"Floor\":[\"2 to 15\"],\"Price Range\":[\"67.45 to 97.45 \"]}\n}\n\nfunction setFilters(FILTERS) {\n  Session.set('globalFILTERS', FILTERS);\n  var defaultFilters = Session.get('projectData');\n  defaultFilters = defaultFilters.filter;\n  console.log(\"In setFilters\");\n  console.log(FILTERS);\n  console.log(defaultFilters);\n  FlowRouter.query.clear();\n  var baseURL = FlowRouter.current().originalUrl.split('?')[0];\n  var route = baseURL; // debugger;\n\n  if (FILTERS['homeType']) {\n    if (FILTERS['homeType'].length != defaultFilters.homeType.length) for (var i = 0; i < FILTERS['homeType'].length; i++) {\n      // if(defaultFilters.homeType.indexOf(  FILTERS['homeType'][i]  ) == -1)\n      route = updateQueryStringParameter(route, 'home_type[]', FILTERS['homeType'][i]);\n    }\n  }\n\n  if (FILTERS['facing']) {\n    if (FILTERS['facing'].length != defaultFilters.facing.length) for (var i = 0; i < FILTERS['facing'].length; i++) {\n      // if(defaultFilters.facing.indexOf(  FILTERS['facing'][i]  ) == -1)\n      route = updateQueryStringParameter(route, 'facing[]', FILTERS['facing'][i]);\n    }\n  }\n\n  if (FILTERS['floor']) {\n    var l1 = FILTERS['floor'][0]; //if(l1 !=0 && l1 != defaultFilters.floor[0])\n\n    route = updateQueryStringParameter(route, 'floor_low', l1);\n    var l2 = FILTERS['floor'][1]; //if(l2 != defaultFilters.floor[1])\n\n    route = updateQueryStringParameter(route, 'floor_high', l2); //route = updateQueryStringParameter(route, 'floor_low', FILTERS['floor'][0]);\n    //route = updateQueryStringParameter(route, 'floor_high', FILTERS['floor'][1]);\n  }\n\n  if (FILTERS['priceRange']) {\n    var l1 = FILTERS['priceRange'][0]; //Don't uncomment below lines as they would cause another bug. It would be a flow bug, on page refresh, it shud know upper limit to compute, and its called during template create.\n    //if(l1 !=0 && l1 != defaultFilters.priceRange[0])\n\n    route = updateQueryStringParameter(route, 'price_low', l1);\n    var l2 = FILTERS['priceRange'][1]; //if(l2 != defaultFilters.priceRange[1])\n\n    route = updateQueryStringParameter(route, 'price_high', l2); //route = updateQueryStringParameter(route, 'price_low', FILTERS['priceRange'][0]);\n    //route = updateQueryStringParameter(route, 'price_high', FILTERS['priceRange'][1]);\n  }\n\n  if (FILTERS['floor']) {\n    $('.filterS1l').html(FILTERS['floor'][0]);\n    $('.filterS1h').html(FILTERS['floor'][1]);\n  }\n\n  if (FILTERS['priceRange']) {\n    $('.filterS2l').html(numDifferentiation(FILTERS['priceRange'][0]));\n    $('.filterS2h').html(numDifferentiation(FILTERS['priceRange'][1]));\n  }\n\n  console.log(\"New Route\" + route);\n  FlowRouter.go(route);\n  updateUISlider(FILTERS);\n}\n\nfunction getDefaultFilters() {\n  return {};\n}\n\nfunction getCurUsersBid(auctionId) {\n  var bid = Collections.Bids.find({\n    auctionId: auctionId,\n    userId: Meteor.userId()\n  }, {\n    limit: 1\n  }).fetch();\n  return bid[0];\n}\n\nfunction updateUISlider(FILTERS) {\n  //console.log('Updating slider values')\n  var slider = document.getElementById('range-input');\n  var slider1 = document.getElementById('range-input1');\n  if (!slider) return;\n  if (!slider.noUiSlider) return;\n  slider.noUiSlider.set(FILTERS.floor);\n  slider1.noUiSlider.set(FILTERS.priceRange);\n  var defaultFilters = Session.get('projectData');\n  defaultFilters = defaultFilters.filter;\n  if (FILTERS.homeType) if (FILTERS.homeType.length && FILTERS.homeType.length != defaultFilters.homeType.length) $('.filterUnitType').val(FILTERS.homeType[0]);else $('.filterUnitType').val('any');\n  if (FILTERS.facing) if (FILTERS.facing.length && FILTERS.facing.length != defaultFilters.facing.length) $('.filterUnitFacing').val(FILTERS.facing[0]);else $('.filterUnitFacing').val('any');\n}\n\nfunction resetUISlider(FILTERS) {\n  // console.log('reset slider values')\n  var slider = document.getElementById('range-input');\n  var slider1 = document.getElementById('range-input1');\n  slider.noUiSlider.set(FILTERS.floor);\n  slider1.noUiSlider.set(FILTERS.priceRange);\n  $('.filterUnitType, .filterUnitFacing').val('any');\n}\n\nfunction startUISlider(data) {\n  var slider = document.getElementById('range-input');\n  var slider1 = document.getElementById('range-input1'); //data = {\n  //  \"s1\":{\n  //    \"start\": [0, 25],\n  //    \"range\": [0, 25]\n  //  }, \"s2\":{\n  //    \"start\": [64, 94],\n  //    \"range\": [64, 94]\n  //  }\n  //}\n\n  noUiSlider.create(slider, {\n    start: data.s1.start,\n    connect: true,\n    step: 1,\n    range: {\n      'min': data.s1.range[0],\n      'max': data.s1.range[1]\n    },\n    format: wNumb({\n      decimals: 0\n    })\n  });\n  noUiSlider.create(slider1, {\n    start: data.s2.start,\n    connect: true,\n    step: 1000000,\n    range: {\n      'min': data.s2.range[0],\n      'max': data.s2.range[1]\n    },\n    format: wNumb({\n      decimals: 0\n    })\n  });\n  slider.noUiSlider.on('update', function () {\n    applyFilterValues();\n  });\n  slider1.noUiSlider.on('update', function () {\n    applyFilterValues();\n  });\n  slider.noUiSlider.on('change', function () {\n    applyFilters();\n  });\n  slider1.noUiSlider.on('change', function () {\n    applyFilters();\n  });\n}\n\nfunction getPaginationData(totalResultsCount, currentPageNo, urlBase, resultsPerPage) {\n  var pages = [],\n      prevPage = {},\n      nextPage = {};\n  var pgMin = currentPageNo - 4,\n      pgMax = currentPageNo + 5,\n      maxPages = Math.ceil(totalResultsCount / resultsPerPage);\n  if (pgMin < 1) pgMin = 1;\n  if (pgMax < 1) pgMax = 1;\n  if (maxPages < 1) maxPages = 1;\n  if (pgMin > maxPages) currentPageNo = maxPages;\n  var tmp = {};\n  var href = '';\n  var cRoute = FlowRouter.current(); // params: {pageno: undefined}\n  // path: \"/account/myproperies\"\n  // pathname: \"/account/myproperies\"\n  // queryParams: {}\n  // queryString: null\n  // route: Route {options: {â€¦}, name:\n\n  for (var i = pgMin; i <= maxPages; i++) {\n    cRoute.params['pageno'] = i;\n    href = FlowRouter.url(cRoute.route.name, cRoute.params, cRoute.queryParams);\n    tmp = {\n      \"href\": href,\n      \"text\": i\n    };\n\n    if (i == currentPageNo) {\n      tmp['href'] = 'javascript:void(0);';\n      tmp['current'] = true;\n    }\n\n    pages.push(tmp);\n  }\n\n  var prevPageNo = currentPageNo - 1,\n      nextPageNo = currentPageNo + 1;\n\n  if (prevPageNo < 1) {\n    prevPage['href'] = 'javascript:void(0)';\n    prevPage['text'] = 'Previous';\n    prevPage['disabled'] = 'disabled';\n  } else {\n    cRoute.params['pageno'] = prevPageNo;\n    prevPage['href'] = FlowRouter.url(cRoute.route.name, cRoute.params, cRoute.queryParams);\n    prevPage['text'] = 'Previous';\n  }\n\n  if (nextPageNo > maxPages) nextPageNo = maxPages;\n\n  if (nextPageNo == currentPageNo) {\n    nextPage['href'] = 'javascript:void(0)';\n    nextPage['text'] = 'Next';\n    nextPage['disabled'] = 'disabled';\n  } else {\n    cRoute.params['pageno'] = nextPageNo;\n    prevPage['href'] = FlowRouter.url(cRoute.route.name, cRoute.params, cRoute.queryParams);\n    nextPage['text'] = 'Next';\n  }\n\n  return {\n    \"prevPage\": prevPage,\n    \"pages\": pages,\n    \"nextPage\": nextPage\n  };\n}\n\nTemplate.registerHelper(\"objectToPairs\", function (object) {\n  return _.map(object, function (value, key) {\n    return {\n      key: key,\n      value: value\n    };\n  });\n});\nTemplate.registerHelper(\"hostname\", function () {\n  return Meteor.absoluteUrl();\n});\n\nfunction numDifferentiation(val) {\n  if (val >= 1000000000) val = (val / 1000000000).toFixed(2) + ' Billion';else if (val >= 1000000) val = (val / 1000000).toFixed(2) + ' Million';\n  return val.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction numFormat(x) {\n  //var x=12345652457.557;\n  //console.log(x)\n  if (!x) return x;\n  x = x.toString();\n  var afterPoint = '';\n  if (x.indexOf('.') > 0) afterPoint = x.substring(x.indexOf('.'), x.length);\n  afterPoint = afterPoint.substr(0, 3);\n  x = Math.floor(x);\n  x = x.toString();\n  var lastThree = x.substring(x.length - 3);\n  var otherNumbers = x.substring(0, x.length - 3);\n  if (otherNumbers != '') lastThree = ',' + lastThree;\n  var res = otherNumbers.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \",\") + lastThree + afterPoint;\n  return res;\n}\n\nTemplate.myProperties.events({\n  \"click .clearFilters\": function (event, template) {\n    //FlowRouter.query.clear();\n    console.log('in .clearFilters meteor event');\n    var defaultFilters = Session.get('projectData');\n    defaultFilters = defaultFilters.filter;\n    $('.filterUnitFacing, .filterUnitType').val('any');\n    resetUISlider(defaultFilters);\n    setFilters(defaultFilters);\n    $.fancybox.close();\n    applyClearFiltersEvent();\n  },\n  \"click .addPropertyBtn\": function (event, template) {\n    var user = Accounts.user();\n\n    if (!user.profile.mobile) {\n      var mobile = false,\n          failed = false;\n\n      while (1) {\n        //This is an un limited loop of mobile number.\n        if (failed) mobile = prompt(\"'\" + mobile + \"' is not a valid number. Please enter a valid mobile to proceed. \");else mobile = prompt(\"You don't have a mobile number attached to your profile. Please enter mobile to proceed. \");\n        if (mobile == null || /^\\d{10}$/.test(mobile)) break;else {\n          failed = true;\n        }\n      }\n\n      if (/^\\d{10}$/.test(mobile)) {\n        Meteor.call('updateMobile', mobile, function (error, result) {\n          if (error) {\n            console.log(error.error);\n            var tmp = Session.get(\"showErrorDlg\");\n            var msg = 'Mobile number update failed. Please try again. Contact us if needed.';\n            tmp.push(msg);\n            Session.set(\"showErrorDlg\", tmp);\n            return;\n          }\n        });\n      }\n    }\n\n    if (template.showAddProperty.get()) template.showAddProperty.set(false);else template.showAddProperty.set(true);\n  },\n  \"change .new-filter select\": function (event, template) {\n    console.log(\"Filters changed\");\n    applyFilters();\n  }\n});\nTemplate.myProperties.onCreated(function () {\n  this.showAddProperty = new ReactiveVar(false);\n  this.totalResultsCount = new ReactiveVar(0);\n  var globalFILTERS = getFiltersFromRoute();\n  Session.set('globalFILTERS', globalFILTERS); // Session.set('enableDelayedFunctions',false);\n\n  Blaze._allowJavascriptUrls();\n\n  var instance = this;\n  instance.isSubsLoaded = new ReactiveVar(false);\n  instance.autorun(function () {\n    // FlowRouter.watchPathChange()\n    var pageno = FlowRouter.getParam('pageno');\n    var resperpage = 20;\n    var onlyActive = false; //Show only active properties\n\n    try {\n      resperpage = FlowRouter.getQueryParam('resperpage');\n      onlyActive = FlowRouter.getQueryParam('onlyActive');\n    } catch (e) {}\n\n    instance.subscribe('Config');\n    instance.subscribe('total-MyProperties', {\n      onlyActive: onlyActive\n    });\n    instance.subscribe(\"MyProperties\", {\n      viewName: 'MyProperties.view',\n      pageno: pageno,\n      resperpage: resperpage,\n      onlyActive: onlyActive\n    }); // instance.subscribe('Areas');\n\n    instance.subscribe('userData');\n\n    if (instance.subscriptionsReady()) {\n      instance.isSubsLoaded.set(true);\n      totalResultsCount = Counts.get(\"total-MyProperties\");\n      if (!totalResultsCount) instance.showAddProperty.set(true); //if no properties, then show it\n    }\n  }); // Session.set('assistanceRequested',false)\n  // Meteor.call('getDateFromServer',[],function(error, success){\n  //     Session.set('getDateFromServer',success)\n  // })\n  // Session.set('globalConfig', Collections.Config.findOne());\n  // var ret = getProjectData();\n  // Session.set('projectData',ret);\n});\nTemplate.myProperties.helpers({\n  isSubsLoaded: function () {\n    return Template.instance().subscriptionsReady();\n  },\n  userLoggedIn: function () {\n    if (Meteor.user()) return true;\n    return false;\n  },\n  data: function () {\n    if (!Template.instance().subscriptionsReady()) return false;\n    var user = Meteor.user();\n    if (!user) return {\n      results: [],\n      totalResultsCount: 0,\n      pagination: getPaginationData(0, 1, '', 10)\n    };\n    var selector = {\n      createdByAgent: user._id,\n      isArchived: false\n    }; //let limit = 10;\n    // debugger;\n\n    var FILTERS = Session.get('globalFILTERS');\n    var defaultFilters = getDefaultFilters(); // var arr = [];\n    // if(  FILTERS['homeType'] ){\n    //     if(FILTERS['homeType'].length) {\n    //         if(FILTERS['homeType'].length != defaultFilters.homeType.length)\n    //             selector['homeType'] = FILTERS['homeType'][0]\n    //         /*\n    //          // var arr = [];\n    //          for (var i = 0; i < FILTERS['homeType'].length; i++) {\n    //          arr.push({\"homeType\": FILTERS['homeType'][i]})\n    //          console.log(\"homeType\"+ FILTERS['homeType'][i])\n    //          }*/\n    //         // selector['$or'] = arr;//BUG: this or will over write or of facing; or of homeType will collide with this and\n    //         // while logic won't work\n    //\n    //     }\n    // }\n    // if(  FILTERS['facing'] ){\n    //     if(FILTERS['facing'].length) {\n    //         if(FILTERS['facing'].length != defaultFilters.facing.length)\n    //             selector['facing'] = FILTERS['facing'][0]\n    //         /*\n    //          var arr = [];\n    //          for (var i = 0; i < FILTERS['facing'].length; i++) {\n    //          arr.push({\"facing\": FILTERS['facing'][i]})\n    //          }\n    //          // selector['$or'] = arr;//BUG: this or will over write or of homeType; or of homeType will collide with this and\n    //          // while logic won't work\n    //          */\n    //     }\n    // }\n    // if(arr.length){\n    //     selector['$or'] = arr;\n    // }\n    // if( FILTERS['floor'] ){\n    //     var val_l = FILTERS['floor'][0];\n    //     var val_h = FILTERS['floor'][1];\n    //\n    //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n    //\n    //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n    //         selector['floorLevel'] =  { $gte: parseInt(val_l) }\n    //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n    //         selector['floorLevel'] =  { $lte: parseInt(val_h) }\n    //     }else{//Both are valid\n    //         selector['floorLevel'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n    //     }\n    // }\n    // if( FILTERS['priceRange'] ){\n    //     var val_l = FILTERS['priceRange'][0];\n    //     var val_h = FILTERS['priceRange'][1];\n    //\n    //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n    //\n    //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n    //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l) }\n    //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n    //         selector['priceBreakUp.totalAllInclusive'] =  { $lt: parseInt(val_h) }\n    //     }else{//Both are valid\n    //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n    //     }\n    // }\n    /////PAGINATION\n\n    var resultsPerPage = 20;\n    var currentPageNo = FlowRouter.current().params.pageno;\n\n    if (!currentPageNo) {\n      currentPageNo = 1;\n    }\n\n    var skip = (currentPageNo - 1) * resultsPerPage;\n    var urlBase = 'account/myproperies/';\n    var totalResultsCount = Counts.get(\"total-MyProperties\");\n    Template.instance().totalResultsCount.set(totalResultsCount);\n    var ret = Collections.Properties.find(selector, {\n      transform: function (doc) {\n        doc.bedroomsCount = 0; // console.log('May be here');\n        // console.log(doc)\n\n        if (doc.bedrooms) {\n          doc.bedroomsCount = doc.bedrooms.length;\n        }\n\n        if (doc.auctionId) {\n          doc.auction = Collections.Auctions.findOne({\n            _id: doc.auctionId\n          });\n        }\n\n        return doc;\n      },\n      // limit: resultsPerPage,\n      sort: {\n        updatedAt: -1\n      } // skip: skip\n\n    });\n    return {\n      results: ret,\n      totalResultsCount: totalResultsCount,\n      pagination: getPaginationData(totalResultsCount, currentPageNo, urlBase, resultsPerPage)\n    };\n  },\n  showDemoProp: function () {\n    var currentPageNo = FlowRouter.current().params.pageno;\n\n    if (!currentPageNo || currentPageNo == 1) {\n      var count = Collections.Properties.find({\n        createdByAgent: 'demoproperty',\n        isArchived: false\n      }, {\n        limit: 1\n      }).count();\n      if (count > 0) return true;\n    }\n\n    return false;\n  },\n  demoProperty: function () {\n    return Collections.Properties.find({\n      createdByAgent: 'demoproperty',\n      isArchived: false\n    }, {\n      transform: function (doc) {\n        doc.bedroomsCount = 0;\n\n        if (doc.bedrooms) {\n          doc.bedroomsCount = doc.bedrooms.length;\n        }\n\n        if (doc.auctionId) {\n          doc.auction = Collections.Auctions.findOne({\n            _id: doc.auctionId\n          });\n        }\n\n        return doc;\n      },\n      limit: 1\n    });\n  },\n  showAddProperty: function () {\n    if (Session.get('hideAddPropertyForm')) {\n      Template.instance().showAddProperty.set(false);\n      Session.set('hideAddPropertyForm', false);\n      scrollTo('.addPropertyBtn', 50, 500);\n    } else {\n      if (!fsClient) {\n        let filestack;\n        module.link(\"filestack-js\", {\n          default(v) {\n            filestack = v;\n          }\n\n        }, 1);\n        const apikey = 'AIPACLEs7ShGwwPh6fMTxz';\n        fsClient = filestack.init(apikey, {\n          policy: 'eyJleHBpcnkiOjE4NjE5MjAwMDAsImNhbGwiOlsicGljayIsInJlYWQiLCJzdGF0Iiwid3JpdGUiLCJ3cml0ZVVybCIsInN0b3JlIiwiY29udmVydCIsInJlbW92ZSIsImV4aWYiXX0=',\n          signature: '465e8652c5cef95f44e5858e09d430abea855d98deaeb7425558f2c80d0f4f57'\n        });\n      }\n    }\n\n    return Template.instance().showAddProperty.get();\n  },\n  showFilters: function () {\n    return false;\n  },\n  projectData: function () {\n    // var ret = getProjectData();\n    var ret = {}; // Session.set('projectData',ret);\n\n    return ret;\n  },\n  filters: function () {\n    var data = {}; //{\"Home Type\":[\"2 BHK\"],\"Floor\":[\"2 to 15\"],\"Price Range\":[\"67.45 to 97.45 \"]}\n\n    var FILTERS = Session.get('globalFILTERS');\n    var defaultFilters = Session.get('projectData');\n    defaultFilters = defaultFilters.filter;\n\n    if (FILTERS['homeType']) {\n      if (FILTERS['homeType'].length) {\n        if (!isArraysEqual(defaultFilters.homeType, FILTERS['homeType'])) data['Home Type'] = FILTERS['homeType'];\n      }\n    }\n\n    if (FILTERS['facing']) {\n      if (FILTERS['facing'].length) {\n        if (!isArraysEqual(defaultFilters.facing, FILTERS['facing'])) data['Facing'] = FILTERS['facing'];\n      }\n    }\n\n    if (FILTERS['floor']) {\n      var hasLowerLimit = false,\n          hasUpperLimit = false;\n      var l1 = parseInt(FILTERS['floor'][0]);\n      if (l1 != 0 && l1 != defaultFilters.floor[0]) hasLowerLimit = true;\n      var l2 = parseInt(FILTERS['floor'][1]);\n      if (l2 != defaultFilters.floor[1]) hasUpperLimit = true;\n\n      if (hasLowerLimit && !hasUpperLimit) {\n        //Only LowerLimit\n        data['Floor'] = ['More than ' + l1];\n      } else if (!hasLowerLimit && hasUpperLimit) {\n        //Only UpperLimit\n        data['Floor'] = ['Below ' + l2];\n      } else if (hasLowerLimit && hasUpperLimit) {\n        //Both are there\n        data['Floor'] = ['Between ' + l1 + \" and \" + l2];\n      } else {} //Both are not there. So don't show filter.\n\n    }\n\n    if (FILTERS['priceRange']) {\n      var hasLowerLimit = false,\n          hasUpperLimit = false;\n      var l1 = parseInt(FILTERS['priceRange'][0]);\n      if (l1 != 0 && l1 != defaultFilters.priceRange[0]) hasLowerLimit = true;\n      var l2 = parseInt(FILTERS['priceRange'][1]);\n      if (l2 != defaultFilters.priceRange[1]) hasUpperLimit = true;\n\n      if (hasLowerLimit && !hasUpperLimit) {\n        //Only LowerLimit\n        data['Price Range'] = ['More than ' + numDifferentiation(l1)];\n      } else if (!hasLowerLimit && hasUpperLimit) {\n        //Only UpperLimit\n        data['Price Range'] = ['Below ' + numDifferentiation(l2)];\n      } else if (hasLowerLimit && hasUpperLimit) {\n        //Both are there\n        data['Price Range'] = ['Between ' + numDifferentiation(l1) + \" to \" + numDifferentiation(l2)];\n      } else {} //Both are not there. So don't show filter.\n\n    } //if( FILTERS['priceRange'] ){\n    //  data['Price Range'] =  [ numDifferentiation(FILTERS['priceRange'][0]) +\" to \"+ numDifferentiation(FILTERS['priceRange'][1]) ]\n    //}\n\n\n    applyClearFiltersEvent();\n    return {\n      data: data,\n      count: Object.keys(data).length\n    };\n  },\n  // time: function(){\n  //\n  //     var projectData = Session.get('projectData');\n  //     var timestamp = TimeSync.serverTime(null, 30000);\n  //     if(!projectData.auction.endDate || !timestamp)return;\n  //\n  //\n  //     var dend = Date.parse(projectData.auction.endDate);\n  //     var timeDiff = dend - timestamp ;\n  //     if(timeDiff<0)return false;\n  //\n  //     var day = Math.floor(timeDiff / (1000 * 3600 * 24))\n  //     var hour = Math.floor(timeDiff / (1000 * 3600 ))\n  //     var min = Math.floor(timeDiff / (1000 * 60 ) )\n  //     hour = hour - (day * 24);\n  //     min = min - (day * 24* 60) - (hour * 60);\n  //     return {\"day\":day,\"hour\":hour,\"min\":min}\n  // },\n  isAuctionClosed: function () {\n    // var timestamp = TimeSync.serverTime(null, 30000);\n    var timestamp = new Date();\n    var projectData = Session.get('projectData');\n    var dend = Date.parse(projectData.auction.endDate);\n    var timeDiff = dend - timestamp;\n\n    if (timeDiff < 0) {\n      return true;\n    }\n\n    return false;\n  },\n  numDifferentiation: function (data) {\n    return numDifferentiation(data);\n  },\n  agentStats: function () {\n    var user = Meteor.user();\n\n    if (user) {\n      if (!user.profile.activeAuctions) user.profile.activeAuctions = 0;\n      if (!user.profile.totalAuctions) user.profile.totalAuctions = 0;\n      if (!user.profile.totalBidsReceived) user.profile.totalBidsReceived = 0;\n      if (!user.profile.bidsReceivedActiveAuctions) user.profile.bidsReceivedActiveAuctions = 0;\n      if (!user.profile.bidProfitActive) user.profile.bidProfitActive = 0;\n      if (!user.profile.totalBidProfit) user.profile.totalBidProfit = 0;\n      return {\n        activeAuctions: user.profile.activeAuctions,\n        totalAuctions: user.profile.totalAuctions,\n        totalBidsReceived: user.profile.totalBidsReceived,\n        bidsReceivedActiveAuctions: user.profile.bidsReceivedActiveAuctions,\n        bidProfit: user.profile.bidProfitActive,\n        totalBidProfit: user.profile.totalBidProfit * 12\n      };\n    }\n\n    return {\n      activeAuctions: 0,\n      totalAuctions: 0,\n      totalBidsReceived: 0,\n      bidsReceivedActiveAuctions: 0,\n      bidProfit: 0,\n      totalBidProfit: 0\n    };\n  }\n});\nTemplate.propertyList.onCreated(function () {\n  this.expanded = new ReactiveVar(false);\n  this.showAddAuctionForm = new ReactiveVar(false);\n  var instance = this;\n  instance.isSubsLoaded = new ReactiveVar(false);\n  instance.isSubsLoadedAttempted = new ReactiveVar(false); //Meteor.default_connection._subscriptions //To get the list of scbscriptions\n\n  instance.autorun(function () {\n    try {\n      if (instance.data.auctionId && !instance.data.auction) {\n        instance.isSubsLoadedAttempted.set(true);\n        instance.subscribe('Advertisement', instance.data.auctionId);\n      } else if (instance.data.auction) {\n        instance.isSubsLoaded.set(true);\n        instance.isSubsLoadedAttempted.set(true);\n      }\n\n      if (instance.subscriptionsReady()) {\n        instance.isSubsLoaded.set(true);\n      }\n    } catch (e) {\n      instance.isSubsLoaded.set(true);\n    }\n  });\n});\nTemplate.propertyList.helpers({\n  isSubsLoaded: function () {\n    return Template.instance().subscriptionsReady();\n  },\n  expanded: function () {\n    return Template.instance().expanded.get();\n  },\n  showAddAuctionForm: function () {\n    return Template.instance().showAddAuctionForm.get();\n  },\n  numDifferentiation: function (data) {\n    return numDifferentiation(data);\n  },\n  auction: function () {\n    if (this.auction) return this.auction;\n\n    if (this.auctionId) {\n      let ret = Collections.Auctions.find({\n        _id: this.auctionId\n      }).fetch();\n      let attempt = Template.instance().isSubsLoadedAttempted.get();\n\n      if (this.auctionId && !ret.length && !attempt) {\n        Template.instance().subscribe('Advertisement', this.auctionId);\n        Template.instance().isSubsLoadedAttempted.set(true);\n      }\n\n      if (ret) return ret[0];\n    }\n\n    return false;\n  },\n  lettingprintviewData: function () {\n    if (!this.auction) return \"\";\n    return this.auction.lettingAuctionCode; // if(!this.auction)return {key:\"\"}\n    // return {key:this.auction.lettingAuctionCode}\n  },\n  showEditPropertyForm: function () {\n    return FlowRouter.url('account/editproperty', {\n      id: this._id\n    });\n  }\n});\nTemplate.propertyList.events({\n  \"click .see_more_btn\": function (event, template) {\n    if (template.expanded.get()) template.expanded.set(false);else template.expanded.set(true);\n  },\n  \"click .ActivateBtn\": function (event, template) {\n    if (!template.showAddAuctionForm.get()) template.showAddAuctionForm.set(true);\n  },\n  \"click .showEditPropertyForm\": function (event, template) {\n    var prevRoute = {\n      name: FlowRouter.current().route.name,\n      args: {\n        pageno: FlowRouter.current().params.pageno,\n        scrollTo: 0\n      }\n    };\n    Session.set('prevRoute', prevRoute); // FlowRouter.go('account/editproperty',{id:this._id})\n  },\n  \"click .managePropertyLink\": function (event, template) {\n    var prevRoute = {\n      name: FlowRouter.current().route.name,\n      args: {\n        pageno: FlowRouter.current().params.pageno,\n        scrollTo: 0\n      }\n    };\n    Session.set('prevRoute', prevRoute);\n    FlowRouter.go('account/propertyManage', {\n      id: this._id\n    });\n  },\n  \"click .hideAddAuctionForm\": function (event, template) {\n    if (template.showAddAuctionForm.get()) template.showAddAuctionForm.set(false);\n    propId = this._id;\n    scrollTo('#property_' + propId, 0, 700);\n  },\n  \"click .viewApplications\": function (event, template) {\n    var prevRoute = {\n      name: FlowRouter.current().route.name,\n      args: {\n        pageno: FlowRouter.current().params.pageno\n      }\n    };\n    Session.set('prevRoute', prevRoute);\n    FlowRouter.go(\"account/propertyApplications\", {\n      id: this._id\n    });\n  },\n  \"click .showCopyDlg\": function (event, template) {\n    let user = Meteor.user();\n    let sluggedName = slugifyEmailAddress(user.profile.name);\n    if (!sluggedName) sluggedName = 'rent';\n    let email = sluggedName + '-let-' + this.auction.lettingAuctionCode.toLowerCase() + \"@spotmycrib.ie\";\n    $('#agentPropertyEmailField').val(email);\n    var url = FlowRouter.url('letting', {\n      key: this.auction.lettingAuctionCode\n    });\n    $('#propertyLinkField').val(url);\n    $.fancybox({\n      'padding': 0,\n      'href': '#propertyLinkDlg',\n      afterShow: function (template) {\n        $('#agentPropertyEmailField').select();\n        $('#propertyLinkDlg .copyEmailBtn').unbind().bind('click', function () {\n          $('#agentPropertyEmailField').select();\n\n          try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful'; // console.log('Copying text command was ' + msg);\n\n            $.fancybox.close();\n          } catch (err) {\n            console.log('Oops, unable to copy');\n          }\n\n          ga('send', 'event', 'myPropertiesPage', 'copyShareEmail', 'copyShareEmail Btn Clicked');\n        });\n        $('#propertyLinkDlg .copyLinkBtn').unbind().bind('click', function () {\n          $('#propertyLinkField').select();\n\n          try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful'; // console.log('Copying text command was ' + msg);\n\n            $.fancybox.close();\n          } catch (err) {\n            console.log('Oops, unable to copy');\n          }\n\n          ga('send', 'event', 'myPropertiesPage', 'copyShareLink', 'copyShareLink Btn Clicked');\n        });\n        $('#propertyLinkDlg .cancelBtn').unbind().bind('click', function () {\n          $.fancybox.close();\n        });\n      }\n    });\n  }\n});\nTemplate.addPropertyForm.onCreated(function () {\n  if (!Session.get('addPropertyImages')) {\n    // Lets do this. Anyways we have delete button.\n    Session.set('addPropertyImages', []);\n    S3.collection.remove({});\n    var user = Meteor.user();\n\n    try {\n      if (user.profile.session.addproperty.gallery) {\n        Session.set('addPropertyImages', user.profile.session.addproperty.gallery);\n      }\n    } catch (e) {}\n  }\n\n  this.numBedRoomCount = new ReactiveVar(0);\n  this.addPropertyFormSaving = new ReactiveVar(false);\n  this.countySelected = new ReactiveVar(false);\n  saveAndAdvertise = false;\n  var instance = this;\n  instance.isSubsLoaded = new ReactiveVar(false);\n  instance.autorun(function () {\n    if (instance.countySelected.get()) {\n      instance.isSubsLoaded.set(false);\n      instance.subscribe('Areas', '', '', instance.countySelected.get(), '', '');\n    }\n\n    if (instance.subscriptionsReady()) {\n      instance.isSubsLoaded.set(true);\n    }\n  });\n});\nTemplate.addPropertyForm.helpers({\n  isSA: function () {\n    var user = Meteor.user();\n    if (user.isSA) return true;\n    return false;\n  },\n  countries: function () {\n    return [{\n      label: \"Ireland\",\n      value: \"Ireland\",\n      selected: \"selected\"\n    }]; //Both capital\n  },\n  counties: function () {\n    let staticCounties = [\"Carlow\", \"Cavan\", \"Clare\", \"Cork\", \"Donegal\", \"Dublin\", \"Galway\", \"Kerry\", \"Kildare\", \"Kilkenny\", \"Laois\", \"Leitrim\", \"Limerick\", \"Longford\", \"Louth\", \"Mayo\", \"Meath\", \"Monaghan\", \"Offaly\", \"Roscommon\", \"Sligo\", \"Tipperary\", \"Waterford\", \"Westmeath\", \"Wexford\", \"Wicklow\"];\n    let ret = [];\n\n    for (let i = 0; i < staticCounties.length; i++) {\n      if (!staticCounties[i]) continue;\n      ret.push({\n        label: titleCase(staticCounties[i]),\n        value: staticCounties[i]\n      });\n    }\n\n    return ret; // return [{label: \"Dublin\", value: \"dublin\"}];//Both capital\n    // var distinctEntries = _.uniq(Collections.Areas.find({}, {\n    //     sort: {County: 1}, fields: {County: true}\n    // }).fetch().map(function(x) {\n    //     return x.County;\n    // }), true);\n    // var ret = []\n    // for(var i=0;i< distinctEntries.length;i++){\n    //     if(!distinctEntries[i])continue;\n    //     ret.push({label: titleCase(distinctEntries[i]), value: distinctEntries[i] })\n    // }\n    // return ret;\n  },\n  areas: function () {\n    var countySelected = Template.instance().countySelected.get();\n\n    if (!countySelected) {\n      var doc = Collections.Properties.findOne();\n      if (!doc) return [];\n      Template.instance().countySelected.set(doc.address.county);\n      countySelected = doc.address.county;\n    }\n\n    var distinctEntries = _.uniq(Collections.Areas.find({\n      County: countySelected\n    }, {\n      sort: {\n        Area: 1\n      },\n      fields: {\n        Area: true\n      }\n    }).fetch().map(function (x) {\n      return x.Area;\n    }), true);\n\n    var ret = [];\n\n    for (var i = 0; i < distinctEntries.length; i++) {\n      if (!distinctEntries[i]) continue;\n      ret.push({\n        label: titleCase(distinctEntries[i]),\n        value: distinctEntries[i]\n      });\n    }\n\n    return ret;\n  },\n  propertyTypes: function () {\n    var Config = Collections.Config.find().fetch();\n    Config = Config[0];\n    var ret = [];\n\n    for (var i = 0; i < Config.propertyType.length; i++) {\n      ret.push({\n        label: titleCase(Config.propertyType[i].name),\n        value: Config.propertyType[i].value\n      });\n    }\n\n    return ret;\n  },\n  numBedRoomCount: function () {\n    var c = Template.instance().numBedRoomCount.get();\n    if (c < 100) return Template.instance().numBedRoomCount.get();else return 0;\n  },\n  addPropertyFormSaving: function () {\n    return Template.instance().addPropertyFormSaving.get();\n  },\n  ensuiteLoop: function (count) {\n    var countArr = [];\n\n    for (var i = 0; i < count; i++) {\n      countArr.push({\n        i: i + 1\n      });\n    }\n\n    return countArr;\n  }\n});\nTemplate.addPropertyForm.events({\n  \"click .openFileUploader\": function (event, template) {\n    event.preventDefault();\n    openPicker(); // filename\n    //     :\n    //     \"webcam-1/12/2018, 6:53:25 PM.png\"\n    // handle\n    //     :\n    //     \"G8lStVqHTiGnwxof6d5y\"\n    // mimetype\n    //     :\n    //     \"image/png\"\n    // originalFile\n    //     :\n    // {name: \"webcam-1/12/2018, 6:53:25 PM.png\", type: \"image/png\", size: 630585}\n    // originalPath\n    //     :\n    //     \"webcam-1/12/2018, 6:53:25 PM.png\"\n    // size\n    //     :\n    //     629612\n    // source\n    //     :\n    //     \"local_file_system\"\n    // status\n    //     :\n    //     \"Stored\"\n    // uploadId\n    //     :\n    //     \"ba2fe36e9fd182ec0cb88236d676cefad\"\n    // url\n    //     :\n    //     \"https://cdn.filestackcontent.com\n\n    return;\n  },\n  'change .selectPropertyImages': function (event, template) {\n    var files = event.target.files;\n    S3.upload({\n      files: files,\n      path: \"propertyImagesLarge\"\n    }, function (e, r) {\n      if (e) throw new Meteor.Error('Upload failed ', e);\n      var addPropertyImages = Session.get('addPropertyImages');\n      addPropertyImages.push(r);\n      Session.set('addPropertyImages', addPropertyImages);\n      console.log(r);\n    }); // for (var i = 0, ln = files.length; i < ln; i++) {\n    //     propertyImagesCollection.insert(files[i], function (err, fileObj) {\n    //         // Inserted new doc with ID fileObj._id, and kicked off the data upload using HTTP\n    //         console.log(fileObj);\n    //         var cursor = propertyImagesCollection.find(fileObj._id);\n    //\n    //         var liveQuery = cursor.observe({\n    //             changed: function(newImage, oldImage) {\n    //\n    //                 console.log(\"Inside live query \");\n    //                 console.log(newImage);\n    //                 if (newImage.isUploaded()) {\n    //                     liveQuery.stop();\n    //\n    //                     // Call your onUploaded callback here...\n    //                 }\n    //             }\n    //         });\n    //     });\n    // }\n  },\n  'change .countySelected': function (event, template) {\n    template.countySelected.set(event.target.value);\n  },\n  'change .url': function (event, template) {\n    var url = event.target.value;\n    if (!url) return false; //Empty url\n\n    Meteor.call('importPost', url, function (error, doc) {\n      if (error) {\n        console.log(error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        var msg = 'An error occurred.';\n        if (error.reason) msg += ' ' + error.reason + '.';else if (error.message) msg += ' ' + error.message + '.';\n        tmp.push(msg);\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      $(\"input[name='address.address']\").val(doc.address.address);\n      $(\"input[name='price']\").val(doc.rent);\n      $(\"select[name='address.county']\").val(doc.address.county).trigger('change');\n      setTimeout(function () {\n        $(\"select[name='address.area']\").val(doc.address.area);\n      }, 2000);\n      setTimeout(function () {\n        $(\"select[name='address.area']\").val(doc.address.area);\n      }, 4000);\n      $(\"select[name='type']\").val(doc.type.toLowerCase());\n      $(\"select[name='furnished']\").val(doc.furnished.toString());\n      $(\"input[name='baths']\").val(doc.baths);\n      $(\"input[name='numBedRoomCount']\").val(doc.numBedRoomCount).trigger('change');\n      $(\"textarea[name='about']\").val(doc.about).trigger('keyup');\n      $(\"input[name='contacts.0.name']\").val(doc.contacts[0].name);\n      var number = \"\";\n\n      try {\n        number = doc.contacts[0].phone;\n      } catch (e) {}\n\n      if (number) {\n        try {\n          number = atob(number);\n          number = number.replace(/\\s+/g, '');\n        } catch (e) {}\n\n        $(\"input[name='contacts.0.phone']\").val(number);\n      }\n\n      if (doc.amenities) {\n        for (var i = 0; i < doc.amenities.length; i++) {\n          $(\"input[value='\" + doc.amenities[i] + \"']\").prop('checked', true);\n        }\n      }\n\n      var tmp = {};\n\n      if (doc.gallery) {\n        var addPropertyImages = Session.get('addPropertyImages');\n        if (!addPropertyImages) addPropertyImages = [];\n        var galleryLen = doc.gallery.length,\n            galleryStoredLen = 0; // var galleryLen = 1,galleryStoredLen=0;\n\n        for (var i = 0; i < doc.gallery.length; i++) {\n          // if(i>0)break;\n          fsClient.storeURL(doc.gallery[i], {\n            filename: 'Image ' + i + 1\n          }).then(function (response) {\n            console.log(JSON.stringify(response)); // {\"url\":\"https://cdn.filestackcontent.com/QH10tMaGTrSgFweORrip\",\"size\":111949,\"type\":\"image/jpeg\",\"filename\":\"Image 01\",\"handle\":\"QH10tMaGTrSgFweORrip\"}\n\n            tmp = {\n              name: response.filename,\n              url: response.url,\n              handle: response.handle,\n              mimetype: response.mimetype,\n              // originalFile: doc.gallery[i],\n              // originalPath: doc.gallery[i],\n              size: response.size // source: response.source,\n              // status: response.status,\n              // uploadId: response.uploadId\n\n            };\n            console.log(tmp);\n            addPropertyImages.push(tmp);\n            galleryStoredLen++;\n\n            if (galleryStoredLen == galleryLen) {\n              //Now its fully imported\n              Session.set('addPropertyImages', addPropertyImages);\n              updateGalleriesInProfile(addPropertyImages, function (err, res) {\n                //No need to show error. Because its just a backup.\n                var addPropertyImages = Session.get('addPropertyImages');\n                console.log(\"Current Count: \" + addPropertyImages.length);\n              });\n            }\n          });\n        }\n      }\n    });\n  },\n  'keyup .autoGrowTA': function (event, template) {\n    var element = event.target;\n    element.style.height = \"5px\";\n    if (element.scrollHeight < 310) element.style.height = element.scrollHeight + \"px\";else element.style.height = \"310px\";\n  },\n  'change #numBedRoomCount': function (event, template) {\n    var numBedRoomCount = parseInt($(event.target).val());\n    if (isNaN(numBedRoomCount)) return;\n    Template.instance().numBedRoomCount.set(numBedRoomCount);\n    t1 = template;\n    setTimeout(function () {\n      t1.$('#addPropertyFormCF').validate();\n    }, 500);\n  },\n  'submit form': function (event) {\n    event.preventDefault();\n  },\n  \"click .addPropertyFormSaveAdvertiseBtn\": function (event, template) {\n    saveAndAdvertise = true;\n    $('#addPropertyFormCF').submit();\n  },\n  \"click .addPropertyFormCancelBtn\": function (event, template) {\n    Session.set('hideAddPropertyForm', true);\n  },\n  'change input[name=price]': function (event, template) {\n    if (event.target.value) {\n      var tmp = event.target.value.split('.');\n      tmp = tmp[0]; //No decimals\n\n      tmp = tmp.trim().match(/\\d+/g);\n      if (!Array.isArray(tmp)) event.target.value = '';\n      event.target.value = tmp.join('');\n    }\n  }\n});\nTemplate.addPropertyForm.onRendered(function () {\n  // this.$('#addPropertyFormCF').validate();\n  addPropertyFormSaving = this.addPropertyFormSaving;\n  var validator = this.$('#addPropertyFormCF').validate({\n    submitHandler: function (event) {\n      addPropertyFormSaving.set(true);\n      console.log(\"You just submitted the 'addPropertyForm' form.\");\n      Meteor.call('addProperty', $('#addPropertyFormCF').serializeArray(), function (error, propertyId) {\n        addPropertyFormSaving.set(false);\n\n        if (error) {\n          console.log(error); //    validator.showErrors({\n          //         email: error.reason\n          //     });\n\n          var tmp = Session.get(\"showErrorDlg\");\n          if (!tmp) tmp = [];\n          var msg = 'An error occurred.';\n          if (error.reason) msg += ' ' + error.reason + '.';else if (error.message) msg += ' ' + error.message + '.';\n          tmp.push(msg);\n          Session.set(\"showErrorDlg\", tmp);\n          return;\n        }\n\n        if (saveAndAdvertise) {\n          Meteor.call('addAdvertisement', $('#addPropertyFormCF').serializeArray(), propertyId, function (error, auctionId) {\n            if (error) {\n              console.log(error); //    validator.showErrors({\n              //         email: error.reason\n              //     });\n\n              var tmp = Session.get(\"showErrorDlg\");\n              if (!tmp) tmp = [];\n              var msg = 'An error occurred.';\n              if (error.reason) msg += ' ' + error.reason + '.';else if (error.message) msg += ' ' + error.message + '.';\n              tmp.push(msg);\n              Session.set(\"showErrorDlg\", tmp);\n              return;\n            }\n\n            console.log('addAdvertisement created successfully');\n            console.log(auctionId);\n            saveAndAdvertise = false;\n          });\n        }\n\n        var addPropertyImages = Session.get('addPropertyImages');\n        updateGalleriesInServer(addPropertyImages, propertyId, function (err, res) {\n          Meteor.call('updateGalleriesInUserProfile', [], function () {\n            console.log('Reset the profile backup');\n          }); //Reset the profile backup\n\n          if (err) {\n            console.log(err);\n          } else {\n            Session.set('addPropertyImages', []);\n            S3.collection.remove({});\n          }\n        });\n        Session.set('hideAddPropertyForm', true);\n      });\n    }\n  });\n});\nTemplate.advertiseForm.onCreated(function () {\n  this.advertiseFormSaving = new ReactiveVar(false);\n});\nTemplate.advertiseForm.helpers({\n  advertiseFormSaving: function () {\n    return Template.instance().advertiseFormSaving.get();\n  }\n});\nTemplate.advertiseForm.events({\n  'submit form': function (event) {\n    event.preventDefault();\n  },\n  'change input[name=price]': function (event, template) {\n    if (event.target.value) {\n      var tmp = event.target.value.split('.');\n      tmp = tmp[0]; //No decimals\n\n      tmp = tmp.trim().match(/\\d+/g);\n      if (!Array.isArray(tmp)) event.target.value = '';\n      event.target.value = tmp.join('');\n    }\n  },\n  \"click .advertiseFormCancelBtn\": function (event, template) {\n    parentIns = template.view.parentView.parentView.parentView.templateInstance();\n    parentIns.showAddAuctionForm.set(false);\n  }\n});\nTemplate.advertiseForm.onRendered(function () {\n  this.$('#readyFrom').datetimepicker();\n  advertiseFormSaving = this.advertiseFormSaving;\n  parentIns = this.view.parentView.parentView.parentView.templateInstance();\n  var validator = this.$('#advertiseFormCF').validate({\n    submitHandler: function (event) {\n      advertiseFormSaving.set(true); // console.log(\"You just submitted the 'advertise' form.\");\n\n      Meteor.call('addAdvertisement', $('#advertiseFormCF').serializeArray(), function (error, result) {\n        advertiseFormSaving.set(false);\n\n        if (error) {\n          console.log(error); //    validator.showErrors({\n          //         email: error.reason\n          //     });\n\n          var tmp = Session.get(\"showErrorDlg\");\n          if (!tmp) tmp = [];\n          var msg = 'An error occurred.';\n          if (error.reason) msg += ' ' + error.reason + '.';else if (error.message) msg += ' ' + error.message + '.';\n          tmp.push(msg);\n          Session.set(\"showErrorDlg\", tmp);\n          return;\n        } // console.log('addAdvertisement completed successfully')\n\n\n        console.log(result);\n        auctionId = result;\n        parentIns.showAddAuctionForm.set(false);\n        scrollTo('.property_auction_' + auctionId, -100, 700);\n      });\n    }\n  });\n});\nTemplate.imageView.helpers({\n  images: function () {\n    // return S3.collection.find();\n    return Session.get('addPropertyImages');\n  }\n});\nTemplate.imgTag.events({\n  \"click .editImgBtn\": function (event, template) {\n    var addPropertyImages = Session.get('addPropertyImages');\n    var newArr = [];\n    if (!addPropertyImages) return;\n    if (!addPropertyImages.length) return;\n    index = getIndexByHandle(addPropertyImages, this.handle);\n    newArr.push(addPropertyImages[index].url); //put it at first\n\n    const pickOptions = {\n      transformations: {\n        crop: {\n          force: true,\n          aspectRatio: 1.333\n        },\n        rotate: true\n      },\n      accept: 'image/*',\n      imageMax: [800, 600],\n      \"uploadInBackground\": false //Disabled because, bg upload causes 2 uploads towards filestack limits\n\n    };\n    fsClient.cropFiles(newArr, pickOptions).then(response => {\n      var addPropertyImages = Session.get('addPropertyImages'); //if its conversion from old amazon to new filestack, then it will create a new file, so delete the old file seperatly and insert a new file seperatly.\n\n      if (!response.filesUploaded.length) {\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(\"Edit failed: please try again, contact us if needed.\");\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      fsClient.remove(addPropertyImages[index].handle).then(function (result) {\n        if (!result.ok) {\n          console.log(result); //Not required to show error to user as this is just edit. If the image appears, he will click delete again\n        }\n\n        console.log('In fs remove result');\n        var addPropertyImages = Session.get('addPropertyImages');\n        addPropertyImages.splice(index, 1);\n        Session.set('addPropertyImages', addPropertyImages);\n        updateGalleriesInProfile(addPropertyImages, function (err, res) {\n          //No need to show error. Because its just a backup.\n          var addPropertyImages = Session.get('addPropertyImages');\n          console.log(\"Current Count: \" + addPropertyImages.length);\n        });\n      });\n      var tmp = {};\n\n      for (var i = 0; i < response.filesUploaded.length; i++) {\n        tmp = {\n          name: response.filesUploaded[i].filename,\n          url: response.filesUploaded[i].url,\n          handle: response.filesUploaded[i].handle,\n          mimetype: response.filesUploaded[i].mimetype,\n          originalFile: response.filesUploaded[i].originalFile,\n          originalPath: response.filesUploaded[i].originalPath,\n          size: response.filesUploaded[i].size,\n          source: response.filesUploaded[i].source,\n          status: response.filesUploaded[i].status,\n          uploadId: response.filesUploaded[i].uploadId\n        }; // addPropertyImages.push(tmp);\n\n        addPropertyImages.splice(index + 1, 0, tmp); //insert at the index place where its deleted.\n      } //Logic to insert new file.\n\n\n      Session.set('addPropertyImages', addPropertyImages);\n      updateGalleriesInProfile(addPropertyImages, function (err, res) {\n        //No need to show error. Because its just a backup.\n        var addPropertyImages = Session.get('addPropertyImages');\n        console.log(\"Current Count: \" + addPropertyImages.length);\n      });\n    });\n  },\n  \"click .deleteImgBtn\": function (event, template) {\n    var addPropertyImages = Session.get('addPropertyImages');\n    index = getIndexByHandle(addPropertyImages, this.handle);\n    fsClient.remove(this.handle).then(function (result) {\n      debugger;\n\n      if (!result.ok) {\n        console.log(result);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(\"Deletion failed: please check your internet connection, contact us if needed.\");\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      var addPropertyImages = Session.get('addPropertyImages');\n      addPropertyImages.splice(index, 1);\n      Session.set('addPropertyImages', addPropertyImages);\n      updateGalleriesInProfile(addPropertyImages, function (err, res) {\n        //No need to show error. Because its just a backup.\n        var addPropertyImages = Session.get('addPropertyImages');\n        console.log(\"Current Count: \" + addPropertyImages.length);\n      });\n    });\n  },\n  \"click .deleteImgBtnOld\": function (event, template) {\n    console.log(this);\n    var addPropertyImages = Session.get('addPropertyImages');\n    index = getIndex(addPropertyImages, this._id); // debugger;\n\n    S3.delete(this.relative_url, function (error, result) {\n      var addPropertyImages = Session.get('addPropertyImages');\n      S3.collection.remove(addPropertyImages[index]._id);\n      addPropertyImages.splice(index, 1);\n      Session.set('addPropertyImages', addPropertyImages);\n    });\n  }\n});\n\nfunction getIndex(myArray, fileId) {\n  for (var i = 0; i < myArray.length; i++) {\n    if (myArray[i]._id === fileId) {\n      return i;\n    }\n  }\n}\n\nTemplate.myProperties.onRendered(function () {\n  try {\n    jQuery(\"html,body\").animate({\n      scrollTop: 0\n    }, 250);\n  } catch (e) {\n    document.body.scrollTop = document.documentElement.scrollTop = 0;\n  }\n\n  var prevRoute = Session.get('prevRoute');\n\n  if (prevRoute) {\n    try {\n      if (prevRoute) if (prevRoute.instructions) if (prevRoute.instructions.openPostNewProp) {\n        Template.instance().showAddProperty.set(true);\n        setTimeout(function () {\n          jQuery(\"html,body\").animate({\n            scrollTop: 0\n          }, 250);\n        }, 500);\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  }\n});\n\nfunction updateQueryStringParameter(uri, key, value) {\n  var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\n  var separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\n\n  if (uri.match(re)) {\n    return uri.replace(re, '$1' + key + \"=\" + value + '$2');\n  } else {\n    return uri + separator + key + \"=\" + value;\n  }\n}\n\nclearFiltersEvent = function () {\n  $('.clearFilterBtn').unbind().click(function () {\n    var val = $(this).closest('span').attr('val');\n    var key = $(this).closest('h5').attr('key');\n    var FILTERS = Session.get('globalFILTERS');\n    var filterDefaults = Session.get('projectData');\n    filterDefaults = filterDefaults.filter; // console.log(FILTERS);\n\n    if (key == \"Home Type\") {\n      var array = FILTERS[\"homeType\"];\n      var index = array.indexOf(val);\n\n      if (index > -1) {\n        array.splice(index, 1);\n        FILTERS[\"homeType\"] = array;\n      }\n    } else if (key == \"Facing\") {\n      var array = FILTERS[\"facing\"];\n      var index = array.indexOf(val);\n\n      if (index > -1) {\n        array.splice(index, 1);\n        FILTERS[\"facing\"] = array;\n      }\n    } else if (key == \"Price Range\") {\n      //if(FILTERS[\"priceRange\"][0]==val ){\n      //  FILTERS[\"priceRange\"][0] = filterDefaults.priceRange[0]\n      //}else{\n      //  FILTERS[\"priceRange\"][1] = filterDefaults.priceRange[1]\n      //}\n      FILTERS[\"priceRange\"][0] = filterDefaults.priceRange[0];\n      FILTERS[\"priceRange\"][1] = filterDefaults.priceRange[1];\n    } else if (key == \"Floor\") {\n      if (FILTERS[\"floor\"][0] == val) {\n        FILTERS[\"floor\"][0] = filterDefaults.floor[0];\n      } else {\n        FILTERS[\"floor\"][1] = filterDefaults.floor[1];\n      }\n    } //Session.set('globalFILTERS', FILTERS);\n\n\n    setFilters(FILTERS);\n  });\n};\n\napplyClearFiltersEvent = function () {\n  setTimeout(clearFiltersEvent, 1000);\n  setTimeout(clearFiltersEvent, 3000);\n};\n\nfunction applyFilters() {\n  console.log('event applyFilters jquery');\n  var floorLevelDOM = document.getElementById('range-input');\n  var priceRangeDOM = document.getElementById('range-input1');\n  var tmp = $('.filterUnitType').val();\n  if (tmp == 'any') tmp = [];else tmp = [tmp];\n  globalFILTERS.homeType = tmp;\n  var tmp = $('.filterUnitFacing').val();\n  if (tmp == 'any') tmp = [];else tmp = [tmp];\n  globalFILTERS.facing = tmp;\n  globalFILTERS.floor = floorLevelDOM.noUiSlider.get();\n  globalFILTERS.priceRange = priceRangeDOM.noUiSlider.get(); // console.log(globalFILTERS);\n\n  setFilters(globalFILTERS);\n  $.fancybox.close();\n  applyClearFiltersEvent();\n}\n\nfunction applyFilterValues() {\n  // console.log('event applyFiltersValues jquery')\n  var floorLevelDOM = document.getElementById('range-input');\n  var priceRangeDOM = document.getElementById('range-input1');\n  var floor = floorLevelDOM.noUiSlider.get();\n  var priceRange = priceRangeDOM.noUiSlider.get();\n  $('.filterS1l').html(floor[0]);\n  $('.filterS1h').html(floor[1]);\n  $('.filterS2l').html(numDifferentiation(priceRange[0]));\n  $('.filterS2h').html(numDifferentiation(priceRange[1]));\n}\n\nfunction delayedCall(functionName) {\n  setTimeout(functionName, 3000);\n}\n\nfunction isArraysEqual(array1, array2) {\n  var is_same = array1.length == array2.length && array1.every(function (element, index) {\n    return element === array2[index];\n  });\n  return is_same;\n}\n\ncallDelayedFunctions = function () {\n  setTimeout(delayedFunctions, 2000);\n};\n\nfunction delayedFunctions() {\n  Session.set('enableDelayedFunctions', true);\n  $('.fullyConfirmBlgOKBtn').unbind().click(function () {\n    console.log('fullyConfirmBlgOKBtn called');\n    Session.set('showConfirmFancyBox', false);\n    FlowRouter.query.clear();\n    $.fancybox.close();\n    $('.fancybox-overlay').hide();\n    setTimeout(function () {\n      var unitid = Session.get('adjustAutoExpandToUnitID');\n\n      if (unitid) {\n        scrollTo('.has-error', 0, 500);\n        setTimeout(function () {\n          $('html,body').animate({\n            scrollTop: $('#unit_' + unitid).offset().top\n          }, 1000);\n        }, 1000);\n        Session.set('adjustAutoExpandToUnitID', '');\n      }\n    }, 2000);\n  });\n}\n\nfunction mybidsJqueryEvents() {\n  $('.payNowBtn').unbind().click(function () {\n    console.log(\"jquery event payNowBtn\");\n    var redirectURL = FlowRouter.current().originalUrl;\n\n    if (redirectURL.indexOf('http:') == -1) {\n      var redirectURL = Meteor.absoluteUrl() + FlowRouter.current().originalUrl.substring(1);\n    }\n\n    var bidId = $(this).attr('bidid');\n    Meteor.call(\"getUnitConfirmationPaymentURL\", [redirectURL, bidId], function (error, result) {\n      if (error) {\n        return;\n      }\n\n      window.location.href = result;\n    });\n  });\n  $('.withdrawConfirmBtn').unbind().click(function () {\n    console.log(\"jquery event withdrawBtn\");\n    var bidId = $(this).attr('bidid');\n    Meteor.call(\"withdrawBid\", [bidId], function (error, result) {\n      if (error) {\n        return;\n      }\n\n      $.fancybox.close();\n    });\n  });\n  $('.cancelBtn').unbind().click(function () {\n    console.log('event cancelBtn jquery');\n    $.fancybox.close();\n  });\n}\n\nfunction getPriceBreakUp(unit, ratePerSqFt) {\n  var pricing = unit.priceBreakUp;\n  var electricityMultiplier = pricing.statutoryGovtCharges.electricityMultiplier;\n  var constructionRateForVAT = pricing.statutoryGovtCharges.constructionRateForVAT;\n  if (!electricityMultiplier) electricityMultiplier = 140;\n  if (!constructionRateForVAT) constructionRateForVAT = 2100;\n  if (!pricing.landCost) pricing.landCost = 2091;\n  unit.superBuiltUpArea = parseFloat(unit.superBuiltUpArea);\n  ratePerSqFt = parseFloat(ratePerSqFt);\n  pricing.landCost = parseFloat(pricing.landCost);\n  electricityMultiplier = parseFloat(electricityMultiplier);\n  constructionRateForVAT = parseFloat(constructionRateForVAT);\n  pricing.basicUnitCost.floorRaiseCharge = parseFloat(pricing.basicUnitCost.floorRaiseCharge);\n  pricing.basicUnitCost.plcCharge = parseFloat(pricing.basicUnitCost.plcCharge);\n  pricing.basicUnitCost.floorRaiseCharge = parseFloat(pricing.basicUnitCost.floorRaiseCharge);\n  pricing.basicUnitCost.plcCharge = parseFloat(pricing.basicUnitCost.plcCharge);\n  pricing.basicUnitCost.totalBasicRatepsft = parseFloat(pricing.basicUnitCost.totalBasicRatepsft);\n  pricing.basicUnitCost.total = parseFloat(pricing.basicUnitCost.total);\n  pricing.agreementValue.infrastructureValue = parseFloat(pricing.agreementValue.infrastructureValue);\n  pricing.agreementValue.clubHouseCharges = parseFloat(pricing.agreementValue.clubHouseCharges);\n  pricing.agreementValue.total = parseFloat(pricing.agreementValue.total);\n  pricing.otherCharges.advanceMaintainence = parseFloat(pricing.otherCharges.advanceMaintainence);\n  pricing.otherCharges.generatorBackup = parseFloat(pricing.otherCharges.generatorBackup);\n  pricing.otherCharges.builderCharges = parseFloat(pricing.otherCharges.builderCharges);\n  pricing.otherCharges.total = parseFloat(pricing.otherCharges.total);\n  pricing.statutoryGovtCharges.serviceTax = parseFloat(pricing.statutoryGovtCharges.serviceTax);\n  pricing.statutoryGovtCharges.vat = parseFloat(pricing.statutoryGovtCharges.vat);\n  pricing.statutoryGovtCharges.labourCess = parseFloat(pricing.statutoryGovtCharges.labourCess);\n  pricing.statutoryGovtCharges.electricityCharges = parseFloat(pricing.statutoryGovtCharges.electricityCharges);\n  pricing.statutoryGovtCharges.stampDuty = parseFloat(pricing.statutoryGovtCharges.stampDuty);\n  pricing.statutoryGovtCharges.stampPaperCharges = parseFloat(pricing.statutoryGovtCharges.stampPaperCharges);\n  pricing.statutoryGovtCharges.legalCharges = parseFloat(pricing.statutoryGovtCharges.legalCharges);\n  pricing.statutoryGovtCharges.otherStatutoryCharges = parseFloat(pricing.statutoryGovtCharges.otherStatutoryCharges);\n  pricing.statutoryGovtCharges.total = parseFloat(pricing.statutoryGovtCharges.total);\n  pricing.totalAllInclusive = parseFloat(pricing.totalAllInclusive);\n  pricing.basicUnitCost.totalBasicRatepsft = ratePerSqFt + pricing.basicUnitCost.floorRaiseCharge + pricing.basicUnitCost.plcCharge;\n  pricing.basicUnitCost.total = unit.superBuiltUpArea * pricing.basicUnitCost.totalBasicRatepsft;\n  pricing.agreementValue.total = pricing.basicUnitCost.total + pricing.agreementValue.infrastructureValue + pricing.agreementValue.clubHouseCharges; //pricing.statutoryGovtCharges.electricityCharges = unit.superBuiltUpArea * electricityMultiplier;\n  //pricing.statutoryGovtCharges.vat = ( (constructionRateForVAT+pricing.basicUnitCost.floorRaiseCharge +\n  //  pricing.basicUnitCost.plcCharge)     +    (pricing.agreementValue.infrastructureValue + pricing.statutoryGovtCharges.electricityCharges + pricing.agreementValue.clubHouseCharges)/unit.superBuiltUpArea)*unit.superBuiltUpArea * 0.145 ;\n  //debugger;\n  // pricing.statutoryGovtCharges.labourCess = (pricing.basicUnitCost.total - (unit.superBuiltUpArea * pricing.landCost))*0.01\n  // var D30 = unit.floorLevel\n  // var E30 = D30<=5 ? 0 : D30>5 && D30<=15 ? (D30-5)*0.005 : 0.05\n  // //pricing.statutoryGovtCharges.stampDuty =  ((ratePerSqFt*2130)+(ratePerSqFt*2130*(E30+0.0525)+250000))*0.0665\n  // //pricing.statutoryGovtCharges.stampPaperCharges =  pricing.agreementValue.total*0.001+300\n  // pricing.statutoryGovtCharges.total = pricing.statutoryGovtCharges.vat +\n  //   pricing.statutoryGovtCharges.labourCess +\n  //   pricing.statutoryGovtCharges.electricityCharges +\n  //   pricing.statutoryGovtCharges.stampDuty +\n  //   pricing.statutoryGovtCharges.stampPaperCharges +\n  //   pricing.statutoryGovtCharges.legalCharges +\n  //   pricing.statutoryGovtCharges.otherStatutoryCharges\n\n  pricing.totalAllInclusive = pricing.agreementValue.total + pricing.otherCharges.total + pricing.statutoryGovtCharges.total;\n  return pricing;\n}\n\nfunction ordinal_suffix_of(i) {\n  var j = i % 10,\n      k = i % 100;\n\n  if (j == 1 && k != 11) {\n    return i + \"st\";\n  }\n\n  if (j == 2 && k != 12) {\n    return i + \"nd\";\n  }\n\n  if (j == 3 && k != 13) {\n    return i + \"rd\";\n  }\n\n  return i + \"th\";\n}\n\nfunction openPicker() {\n  fsClient.pick({\n    fromSources: [\"local_file_system\", \"webcam\", \"facebook\", \"url\", \"googledrive\", \"dropbox\", \"flickr\", \"instagram\", \"gmail\", \"picasa\", \"onedrive\", \"clouddrive\"],\n    maxFiles: 10,\n    transformations: {\n      crop: {\n        force: false,\n        aspectRatio: 1.333\n      },\n      rotate: true\n    },\n    imageMax: [800, 600],\n    accept: [\"image/*\"],\n    \"uploadInBackground\": false //Disabled because, bg upload causes 2 uploads towards filestack limits\n\n  }).then(function (response) {\n    // declare this function to handle response\n    var addPropertyImages = Session.get('addPropertyImages');\n    var tmp = {};\n    if (response.filesUploaded) for (var i = 0; i < response.filesUploaded.length; i++) {\n      tmp = {\n        name: response.filesUploaded[i].filename,\n        url: response.filesUploaded[i].url,\n        handle: response.filesUploaded[i].handle,\n        mimetype: response.filesUploaded[i].mimetype,\n        originalFile: response.filesUploaded[i].originalFile,\n        originalPath: response.filesUploaded[i].originalPath,\n        size: response.filesUploaded[i].size,\n        source: response.filesUploaded[i].source,\n        status: response.filesUploaded[i].status,\n        uploadId: response.filesUploaded[i].uploadId\n      };\n      addPropertyImages.push(tmp);\n    }\n    Session.set('addPropertyImages', addPropertyImages);\n    updateGalleriesInProfile(addPropertyImages, function (err, res) {\n      //No need to show error. Because its just a backup.\n      var addPropertyImages = Session.get('addPropertyImages');\n      console.log(\"Current Count: \" + addPropertyImages.length);\n    });\n    console.log(response);\n  });\n}\n\nfunction getIndexByHandle(myArray, fileId) {\n  for (var i = 0; i < myArray.length; i++) {\n    if (myArray[i].handle === fileId) {\n      return i;\n    }\n  }\n}\n\nfunction titleCase(str) {\n  if (!str) return;\n  return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\n\nfunction slugifyEmailAddress(text) {\n  if (!text) return '';\n  const a = 'Ã Ã¡Ã¤Ã¢Ã¨Ã©Ã«ÃªÃ¬Ã­Ã¯Ã®Ã²Ã³Ã¶Ã´Ã¹ÃºÃ¼Ã»Ã±Ã§ÃŸÃ¿Å“Ã¦Å•Å›Å„á¹•áºƒÇµÇ¹á¸¿Ç˜áºÅºá¸§/_,:;';\n  const b = 'aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------';\n  const p = new RegExp(a.split('').join('|'), 'g');\n  return text.toString().toLowerCase().replace(/\\s+/g, '.') // Replace spaces with \".\"\n  .replace(p, c => b.charAt(a.indexOf(c))) // Replace special chars\n  .replace(/&/g, '-and-') // Replace & with ''\n  // .replace(/[^\\w\\-]+/g, '')       // Remove all non-word chars\n  .replace(/\\-\\-+/g, '-') // Replace multiple - with single ''\n  .replace(/^-+/, '') // Trim - from start of text\n  .replace(/-+$/, ''); // Trim - from end of text\n}","map":{"version":3,"sources":["imports/ui/templates/myProperties.js"],"names":["module","link","SimpleSchema","default","v","advertiseFormSaving","fsClient","saveAndAdvertise","globalFILTERS","getFiltersFromRoute","FILTERS","FlowRouter","current","queryParams","home_type","val","facing","floor_low","floor_high","val_l","val_h","isNaN","price_low","price_high","setFilters","Session","set","defaultFilters","get","filter","console","log","query","clear","baseURL","originalUrl","split","route","length","homeType","i","updateQueryStringParameter","l1","l2","$","html","numDifferentiation","go","updateUISlider","getDefaultFilters","getCurUsersBid","auctionId","bid","Collections","Bids","find","userId","Meteor","limit","fetch","slider","document","getElementById","slider1","noUiSlider","floor","priceRange","resetUISlider","startUISlider","data","create","start","s1","connect","step","range","format","wNumb","decimals","s2","on","applyFilterValues","applyFilters","getPaginationData","totalResultsCount","currentPageNo","urlBase","resultsPerPage","pages","prevPage","nextPage","pgMin","pgMax","maxPages","Math","ceil","tmp","href","cRoute","params","url","name","push","prevPageNo","nextPageNo","Template","registerHelper","object","_","map","value","key","absoluteUrl","toFixed","toString","replace","numFormat","x","afterPoint","indexOf","substring","substr","lastThree","otherNumbers","res","myProperties","events","event","template","fancybox","close","applyClearFiltersEvent","user","Accounts","profile","mobile","failed","prompt","test","call","error","result","msg","showAddProperty","onCreated","ReactiveVar","Blaze","_allowJavascriptUrls","instance","isSubsLoaded","autorun","pageno","getParam","resperpage","onlyActive","getQueryParam","e","subscribe","viewName","subscriptionsReady","Counts","helpers","userLoggedIn","results","pagination","selector","createdByAgent","_id","isArchived","skip","ret","Properties","transform","doc","bedroomsCount","bedrooms","auction","Auctions","findOne","sort","updatedAt","showDemoProp","count","demoProperty","scrollTo","filestack","apikey","init","policy","signature","showFilters","projectData","filters","isArraysEqual","hasLowerLimit","hasUpperLimit","parseInt","Object","keys","isAuctionClosed","timestamp","Date","dend","parse","endDate","timeDiff","agentStats","activeAuctions","totalAuctions","totalBidsReceived","bidsReceivedActiveAuctions","bidProfitActive","totalBidProfit","bidProfit","propertyList","expanded","showAddAuctionForm","isSubsLoadedAttempted","attempt","lettingprintviewData","lettingAuctionCode","showEditPropertyForm","id","prevRoute","args","propId","sluggedName","slugifyEmailAddress","email","toLowerCase","afterShow","select","unbind","bind","successful","execCommand","err","ga","addPropertyForm","S3","collection","remove","session","addproperty","gallery","numBedRoomCount","addPropertyFormSaving","countySelected","isSA","countries","label","selected","counties","staticCounties","titleCase","areas","address","county","distinctEntries","uniq","Areas","County","Area","fields","propertyTypes","Config","propertyType","c","ensuiteLoop","countArr","preventDefault","openPicker","files","target","upload","path","r","Error","addPropertyImages","reason","message","rent","trigger","setTimeout","area","type","furnished","baths","about","contacts","number","phone","atob","amenities","prop","galleryLen","galleryStoredLen","storeURL","filename","then","response","JSON","stringify","handle","mimetype","size","updateGalleriesInProfile","element","style","height","scrollHeight","t1","validate","submit","trim","match","Array","isArray","join","onRendered","validator","submitHandler","serializeArray","propertyId","updateGalleriesInServer","advertiseForm","parentIns","view","parentView","templateInstance","datetimepicker","imageView","images","imgTag","newArr","index","getIndexByHandle","pickOptions","transformations","crop","force","aspectRatio","rotate","accept","imageMax","cropFiles","filesUploaded","ok","splice","originalFile","originalPath","source","status","uploadId","getIndex","delete","relative_url","myArray","fileId","jQuery","animate","scrollTop","body","documentElement","instructions","openPostNewProp","uri","re","RegExp","separator","clearFiltersEvent","click","closest","attr","filterDefaults","array","floorLevelDOM","priceRangeDOM","delayedCall","functionName","array1","array2","is_same","every","callDelayedFunctions","delayedFunctions","hide","unitid","offset","top","mybidsJqueryEvents","redirectURL","bidId","window","location","getPriceBreakUp","unit","ratePerSqFt","pricing","priceBreakUp","electricityMultiplier","statutoryGovtCharges","constructionRateForVAT","landCost","superBuiltUpArea","parseFloat","basicUnitCost","floorRaiseCharge","plcCharge","totalBasicRatepsft","total","agreementValue","infrastructureValue","clubHouseCharges","otherCharges","advanceMaintainence","generatorBackup","builderCharges","serviceTax","vat","labourCess","electricityCharges","stampDuty","stampPaperCharges","legalCharges","otherStatutoryCharges","totalAllInclusive","ordinal_suffix_of","j","k","pick","fromSources","maxFiles","str","charAt","toUpperCase","text","a","b","p"],"mappings":"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","sourcesContent":["import \"./pagination.html\";\nimport \"./imageView.html\";\nimport \"./myProperties.html\";\nimport './shared.js';\nimport SimpleSchema from \"simpl-schema\";\n// SimpleSchema.extendOptions(['autoform']);\nadvertiseFormSaving='';\nfsClient = '';\nsaveAndAdvertise=false;\n\nvar globalFILTERS = {};\nfunction getFiltersFromRoute(){\n    var FILTERS = {};\n    if( FlowRouter.current().queryParams.home_type ){\n        var val = FlowRouter.current().queryParams.home_type;\n        FILTERS['homeType'] = val;\n    }\n    if( FlowRouter.current().queryParams.facing ){\n        var val = FlowRouter.current().queryParams.facing;\n        FILTERS['facing'] = val;\n    }\n\n    if( FlowRouter.current().queryParams.floor_low || FlowRouter.current().queryParams.floor_high  ){\n        var val_l = FlowRouter.current().queryParams.floor_low;\n        var val_h = FlowRouter.current().queryParams.floor_high;\n\n        if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n\n        }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n            FILTERS['floor'] = [val_l,0];\n        }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n            FILTERS['floor'] = [0, val_h];\n        }else{//Both are valid\n            FILTERS['floor'] = [val_l ,val_h ];\n        }\n    }\n\n    if( FlowRouter.current().queryParams.price_low || FlowRouter.current().queryParams.price_high  ){\n        var val_l = FlowRouter.current().queryParams.price_low;\n        var val_h = FlowRouter.current().queryParams.price_high;\n\n        if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n\n        }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n            FILTERS['priceRange'] = [val_l,0];\n        }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n            FILTERS['priceRange'] = [0, val_h];\n        }else{//Both are valid\n            FILTERS['priceRange'] = [val_l ,val_h ];\n        }\n    }\n    //if(FILTERS.length==0){return false;}\n    return FILTERS;//{\"Home Type\":[\"2 BHK\"],\"Floor\":[\"2 to 15\"],\"Price Range\":[\"67.45 to 97.45 \"]}\n}\nfunction setFilters(FILTERS){\n    Session.set('globalFILTERS', FILTERS);\n    var defaultFilters = Session.get('projectData');defaultFilters = defaultFilters.filter;\n    console.log(\"In setFilters\")\n    console.log(FILTERS);\n    console.log(defaultFilters);\n    FlowRouter.query.clear();\n\n    var baseURL = FlowRouter.current().originalUrl.split('?')[0];\n    var route = baseURL;\n    // debugger;\n    if(  FILTERS['homeType']  ){\n        if(FILTERS['homeType'].length != defaultFilters.homeType.length)\n            for(var i=0;i<FILTERS['homeType'].length;i++) {\n                // if(defaultFilters.homeType.indexOf(  FILTERS['homeType'][i]  ) == -1)\n                route = updateQueryStringParameter(route, 'home_type[]', FILTERS['homeType'][i])\n            }\n    }\n    if(  FILTERS['facing']  ){\n        if(FILTERS['facing'].length != defaultFilters.facing.length)\n            for(var i=0;i<FILTERS['facing'].length;i++) {\n                // if(defaultFilters.facing.indexOf(  FILTERS['facing'][i]  ) == -1)\n                route = updateQueryStringParameter(route, 'facing[]', FILTERS['facing'][i])\n            }\n    }\n    if(  FILTERS['floor'] ){\n        var l1 = FILTERS['floor'][0];\n        //if(l1 !=0 && l1 != defaultFilters.floor[0])\n        route = updateQueryStringParameter(route, 'floor_low', l1);\n        var l2 = FILTERS['floor'][1];\n        //if(l2 != defaultFilters.floor[1])\n        route = updateQueryStringParameter(route, 'floor_high', l2);\n\n        //route = updateQueryStringParameter(route, 'floor_low', FILTERS['floor'][0]);\n        //route = updateQueryStringParameter(route, 'floor_high', FILTERS['floor'][1]);\n    }\n    if( FILTERS['priceRange'] ){\n        var l1 = FILTERS['priceRange'][0];\n\n        //Don't uncomment below lines as they would cause another bug. It would be a flow bug, on page refresh, it shud know upper limit to compute, and its called during template create.\n        //if(l1 !=0 && l1 != defaultFilters.priceRange[0])\n        route = updateQueryStringParameter(route, 'price_low', l1);\n        var l2 = FILTERS['priceRange'][1];\n        //if(l2 != defaultFilters.priceRange[1])\n        route = updateQueryStringParameter(route, 'price_high', l2);\n\n\n        //route = updateQueryStringParameter(route, 'price_low', FILTERS['priceRange'][0]);\n        //route = updateQueryStringParameter(route, 'price_high', FILTERS['priceRange'][1]);\n    }\n\n    if(FILTERS['floor']){\n        $('.filterS1l').html(FILTERS['floor'][0]);\n        $('.filterS1h').html(FILTERS['floor'][1]);\n    }\n    if(FILTERS['priceRange']){\n        $('.filterS2l').html( numDifferentiation( FILTERS['priceRange'][0]) )\n        $('.filterS2h').html( numDifferentiation( FILTERS['priceRange'][1]) )\n    }\n    console.log(\"New Route\"+route);\n    FlowRouter.go(route);\n    updateUISlider(FILTERS)\n\n}\nfunction getDefaultFilters(){\n    return {};\n}\nfunction getCurUsersBid(auctionId){\n    var bid = Collections.Bids.find({auctionId:auctionId,userId:Meteor.userId()},{limit:1}).fetch()\n    return bid[0];\n}\n\nfunction updateUISlider(FILTERS){\n    //console.log('Updating slider values')\n    var slider = document.getElementById('range-input');\n    var slider1 = document.getElementById('range-input1');\n    if(!slider)return;\n    if(!slider.noUiSlider)return;\n    slider.noUiSlider.set(FILTERS.floor);\n    slider1.noUiSlider.set(FILTERS.priceRange);\n    var defaultFilters = Session.get('projectData');defaultFilters = defaultFilters.filter;\n\n    if(FILTERS.homeType)\n        if(FILTERS.homeType.length && (FILTERS.homeType.length != defaultFilters.homeType.length) )\n            $('.filterUnitType').val(FILTERS.homeType[0])\n        else\n            $('.filterUnitType').val('any')\n    if(FILTERS.facing)\n        if(FILTERS.facing.length && (FILTERS.facing.length != defaultFilters.facing.length))\n            $('.filterUnitFacing').val(FILTERS.facing[0])\n        else\n            $('.filterUnitFacing').val('any')\n}\nfunction resetUISlider(FILTERS){\n    // console.log('reset slider values')\n    var slider = document.getElementById('range-input');\n    var slider1 = document.getElementById('range-input1');\n    slider.noUiSlider.set(FILTERS.floor);\n    slider1.noUiSlider.set(FILTERS.priceRange);\n    $('.filterUnitType, .filterUnitFacing').val('any')\n}\nfunction startUISlider(data){\n    var slider = document.getElementById('range-input');\n    var slider1 = document.getElementById('range-input1');\n    //data = {\n    //  \"s1\":{\n    //    \"start\": [0, 25],\n    //    \"range\": [0, 25]\n    //  }, \"s2\":{\n    //    \"start\": [64, 94],\n    //    \"range\": [64, 94]\n    //  }\n    //}\n    noUiSlider.create(slider, {\n\n        start: data.s1.start,\n\n        connect: true,\n\n        step: 1,\n\n        range: {\n\n            'min': data.s1.range[0],\n\n            'max': data.s1.range[1]\n\n        },\n\n        format: wNumb({\n\n            decimals: 0\n\n        })\n\n    });\n\n    noUiSlider.create(slider1, {\n\n        start: data.s2.start,\n\n        connect: true,\n\n        step: 1000000,\n\n        range: {\n\n            'min': data.s2.range[0],\n\n            'max': data.s2.range[1]\n\n        },\n\n        format: wNumb({\n\n            decimals: 0\n\n        })\n\n    });\n    slider.noUiSlider.on('update', function(){\n        applyFilterValues();\n    });\n    slider1.noUiSlider.on('update', function(){\n        applyFilterValues();\n    });\n    slider.noUiSlider.on('change', function(){\n        applyFilters();\n    });\n    slider1.noUiSlider.on('change', function(){\n        applyFilters();\n    });\n}\nfunction getPaginationData(totalResultsCount,currentPageNo,urlBase, resultsPerPage){\n    var pages = [], prevPage = {}, nextPage={};\n    var pgMin = currentPageNo-4, pgMax = currentPageNo+ 5, maxPages = Math.ceil(totalResultsCount/resultsPerPage);\n    if(pgMin<1)pgMin =1;\n    if(pgMax<1)pgMax =1;\n    if(maxPages<1)maxPages =1;\n    if(pgMin>maxPages)currentPageNo =maxPages;\n    var tmp={};\n    var href = '';\n\n    var cRoute = FlowRouter.current();\n    // params: {pageno: undefined}\n    // path: \"/account/myproperies\"\n    // pathname: \"/account/myproperies\"\n    // queryParams: {}\n    // queryString: null\n    // route: Route {options: {â€¦}, name:\n\n    for (var i=pgMin; i<=maxPages;i++){\n        cRoute.params['pageno'] = i;\n        href = FlowRouter.url(cRoute.route.name,cRoute.params,cRoute.queryParams)\n        tmp = {\n            \"href\": href,\n            \"text\": i\n        }\n        if(i== currentPageNo) {\n            tmp['href'] = 'javascript:void(0);';\n            tmp['current'] = true;\n        }\n        pages.push(tmp)\n    }\n    var prevPageNo = currentPageNo- 1, nextPageNo=currentPageNo+ 1;\n    if(prevPageNo<1){\n        prevPage['href'] = 'javascript:void(0)';\n        prevPage['text'] = 'Previous';\n        prevPage['disabled'] = 'disabled';\n    }else{\n        cRoute.params['pageno'] = prevPageNo;\n        prevPage['href'] = FlowRouter.url(cRoute.route.name,cRoute.params,cRoute.queryParams)\n        prevPage['text'] = 'Previous';\n    }\n    if(nextPageNo>maxPages)nextPageNo =maxPages;\n    if(nextPageNo == currentPageNo){\n        nextPage['href'] = 'javascript:void(0)';\n        nextPage['text'] = 'Next';\n        nextPage['disabled'] = 'disabled';\n    }else{\n        cRoute.params['pageno'] = nextPageNo;\n        prevPage['href'] = FlowRouter.url(cRoute.route.name,cRoute.params,cRoute.queryParams)\n        nextPage['text'] = 'Next';\n    }\n    return {\n        \"prevPage\":prevPage,\n        \"pages\":pages,\n        \"nextPage\": nextPage\n    }\n}\n\n\nTemplate.registerHelper(\"objectToPairs\",function(object){\n    return _.map(object, function(value, key) {\n        return {\n            key: key,\n            value: value\n        };\n    });\n});\nTemplate.registerHelper(\"hostname\",function(){\n    return Meteor.absoluteUrl();\n});\nfunction numDifferentiation(val) {\n    if(val >= 1000000000) val = (val/1000000000).toFixed(2) + ' Billion';\n    else if(val >= 1000000) val = (val/1000000).toFixed(2) + ' Million';\n    return val.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\nfunction numFormat(x) {\n    //var x=12345652457.557;\n    //console.log(x)\n    if(!x)return x;\n    x=x.toString();\n    var afterPoint = '';\n    if(x.indexOf('.') > 0)\n        afterPoint = x.substring(x.indexOf('.'),x.length);\n    afterPoint = afterPoint.substr(0,3);\n    x = Math.floor(x);\n    x=x.toString();\n    var lastThree = x.substring(x.length-3);\n    var otherNumbers = x.substring(0,x.length-3);\n    if(otherNumbers != '')\n        lastThree = ',' + lastThree;\n    var res = otherNumbers.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \",\") + lastThree + afterPoint;\n    return res;\n}\n\n\n\nTemplate.myProperties.events({\n    \"click .clearFilters\": function (event, template) {\n        //FlowRouter.query.clear();\n\n        console.log('in .clearFilters meteor event')\n        var defaultFilters = Session.get('projectData');defaultFilters = defaultFilters.filter;\n        $('.filterUnitFacing, .filterUnitType').val('any');\n        resetUISlider(defaultFilters);\n        setFilters(defaultFilters);\n        $.fancybox.close();\n        applyClearFiltersEvent();\n    },\n    \"click .addPropertyBtn\": function (event, template) {\n        var user = Accounts.user();\n        if(!user.profile.mobile){\n            var mobile = false, failed = false;\n            while(1) {//This is an un limited loop of mobile number.\n                if(failed) mobile = prompt(\"'\"+mobile+\"' is not a valid number. Please enter a valid mobile to proceed. \");\n                else mobile = prompt(\"You don't have a mobile number attached to your profile. Please enter mobile to proceed. \");\n                if( mobile == null || /^\\d{10}$/.test(mobile) ) break;\n                else{\n                    failed = true;\n                }\n            }\n            if(/^\\d{10}$/.test(mobile)) {\n                Meteor.call('updateMobile', mobile, function (error, result) {\n                    if (error) {\n                        console.log(error.error);\n                        var tmp = Session.get(\"showErrorDlg\");\n                        var msg = 'Mobile number update failed. Please try again. Contact us if needed.';\n                        tmp.push(msg);\n                        Session.set(\"showErrorDlg\", tmp)\n\n                        return;\n                    }\n                });\n            }\n        }\n        if(template.showAddProperty.get() )template.showAddProperty.set(false);\n        else template.showAddProperty.set(true);\n    },\n    \"change .new-filter select\":function(event, template){\n        console.log(\"Filters changed\");\n        applyFilters();\n    }\n})\nTemplate.myProperties.onCreated(function(){\n    this.showAddProperty = new ReactiveVar( false );\n    this.totalResultsCount = new ReactiveVar( 0 );\n\n    var globalFILTERS = getFiltersFromRoute();\n    Session.set('globalFILTERS',globalFILTERS);\n    // Session.set('enableDelayedFunctions',false);\n    Blaze._allowJavascriptUrls();\n\n    var instance = this;\n    instance.isSubsLoaded = new ReactiveVar(false);\n    instance.autorun(function(){\n        // FlowRouter.watchPathChange()\n        var pageno = FlowRouter.getParam('pageno');\n        var resperpage = 20;\n        var onlyActive = false;//Show only active properties\n        try{\n            resperpage = FlowRouter.getQueryParam('resperpage');\n            onlyActive = FlowRouter.getQueryParam('onlyActive');\n        }catch(e){}\n        instance.subscribe('Config');\n        instance.subscribe('total-MyProperties',{onlyActive:onlyActive});\n        instance.subscribe(\"MyProperties\",{viewName: 'MyProperties.view',pageno:pageno,resperpage:resperpage,onlyActive:onlyActive}) ;\n        // instance.subscribe('Areas');\n        instance.subscribe('userData');\n        if(instance.subscriptionsReady()){\n            instance.isSubsLoaded.set(true)\n            totalResultsCount = Counts.get(\"total-MyProperties\");\n            if(!totalResultsCount)instance.showAddProperty.set(true);//if no properties, then show it\n        }\n    })\n    // Session.set('assistanceRequested',false)\n    // Meteor.call('getDateFromServer',[],function(error, success){\n    //     Session.set('getDateFromServer',success)\n    // })\n    // Session.set('globalConfig', Collections.Config.findOne());\n    // var ret = getProjectData();\n    // Session.set('projectData',ret);\n})\nTemplate.myProperties.helpers({\n    isSubsLoaded:function(){\n        return Template.instance().subscriptionsReady();\n    },\n    userLoggedIn:function(){\n        if(Meteor.user())return true;\n        return false;\n    },\n    data : function () {\n        if(!Template.instance().subscriptionsReady())return false;\n        var user = Meteor.user();\n        if(!user) return {\n            results: [],\n            totalResultsCount:0,\n            pagination: getPaginationData(0,1,'',10)\n        }\n        var selector = {createdByAgent:user._id,isArchived:false};//let limit = 10;\n        // debugger;\n\n        var FILTERS = Session.get('globalFILTERS')\n        var defaultFilters = getDefaultFilters();\n\n        // var arr = [];\n        // if(  FILTERS['homeType'] ){\n        //     if(FILTERS['homeType'].length) {\n        //         if(FILTERS['homeType'].length != defaultFilters.homeType.length)\n        //             selector['homeType'] = FILTERS['homeType'][0]\n        //         /*\n        //          // var arr = [];\n        //          for (var i = 0; i < FILTERS['homeType'].length; i++) {\n        //          arr.push({\"homeType\": FILTERS['homeType'][i]})\n        //          console.log(\"homeType\"+ FILTERS['homeType'][i])\n        //          }*/\n        //         // selector['$or'] = arr;//BUG: this or will over write or of facing; or of homeType will collide with this and\n        //         // while logic won't work\n        //\n        //     }\n        // }\n        // if(  FILTERS['facing'] ){\n        //     if(FILTERS['facing'].length) {\n        //         if(FILTERS['facing'].length != defaultFilters.facing.length)\n        //             selector['facing'] = FILTERS['facing'][0]\n        //         /*\n        //          var arr = [];\n        //          for (var i = 0; i < FILTERS['facing'].length; i++) {\n        //          arr.push({\"facing\": FILTERS['facing'][i]})\n        //          }\n        //          // selector['$or'] = arr;//BUG: this or will over write or of homeType; or of homeType will collide with this and\n        //          // while logic won't work\n        //          */\n        //     }\n        // }\n        // if(arr.length){\n        //     selector['$or'] = arr;\n        // }\n        // if( FILTERS['floor'] ){\n        //     var val_l = FILTERS['floor'][0];\n        //     var val_h = FILTERS['floor'][1];\n        //\n        //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n        //\n        //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n        //         selector['floorLevel'] =  { $gte: parseInt(val_l) }\n        //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n        //         selector['floorLevel'] =  { $lte: parseInt(val_h) }\n        //     }else{//Both are valid\n        //         selector['floorLevel'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n        //     }\n        // }\n        // if( FILTERS['priceRange'] ){\n        //     var val_l = FILTERS['priceRange'][0];\n        //     var val_h = FILTERS['priceRange'][1];\n        //\n        //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n        //\n        //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n        //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l) }\n        //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n        //         selector['priceBreakUp.totalAllInclusive'] =  { $lt: parseInt(val_h) }\n        //     }else{//Both are valid\n        //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n        //     }\n        // }\n\n        /////PAGINATION\n        var resultsPerPage = 20;\n        var currentPageNo = FlowRouter.current().params.pageno;\n        if(!currentPageNo){currentPageNo = 1}\n        var skip = (currentPageNo -1) * resultsPerPage;\n        var urlBase = 'account/myproperies/';\n\n\n        var totalResultsCount = Counts.get(\"total-MyProperties\");\n        Template.instance().totalResultsCount.set(totalResultsCount)\n\n        var ret = Collections.Properties.find(selector, {\n            transform: function(doc) {\n                doc.bedroomsCount=0\n                // console.log('May be here');\n                // console.log(doc)\n                if(doc.bedrooms){\n                    doc.bedroomsCount = doc.bedrooms.length;\n                }\n                if(doc.auctionId) {\n                    doc.auction = Collections.Auctions.findOne({\n                        _id: doc.auctionId\n                    });\n                }\n                return doc;\n            },\n            // limit: resultsPerPage,\n            sort: { updatedAt : -1 },\n            // skip: skip\n        });\n\n\n\n        return {\n            results: ret,\n            totalResultsCount:totalResultsCount,\n            pagination: getPaginationData(totalResultsCount,currentPageNo,urlBase,resultsPerPage)\n        };\n    },\n    showDemoProp:function () {\n        var currentPageNo = FlowRouter.current().params.pageno;\n        if(!currentPageNo || currentPageNo==1){\n            var count = Collections.Properties.find({createdByAgent:'demoproperty',isArchived:false},{limit: 1}).count();\n            if(count>0)\n            return true;\n        }\n        return false;\n    },\n    demoProperty:function () {\n        return Collections.Properties.find({createdByAgent:'demoproperty',isArchived:false}, {\n            transform: function(doc) {\n                doc.bedroomsCount=0\n                if(doc.bedrooms){\n                    doc.bedroomsCount = doc.bedrooms.length;\n                }\n                if(doc.auctionId) {\n                    doc.auction = Collections.Auctions.findOne({\n                        _id: doc.auctionId\n                    });\n                }\n                return doc;\n            },\n            limit: 1\n        })\n    },\n    showAddProperty: function () {\n        if(Session.get('hideAddPropertyForm') ){\n            Template.instance().showAddProperty.set(false);\n            Session.set('hideAddPropertyForm',false)\n            scrollTo('.addPropertyBtn',50,500)\n        }else{\n            if(!fsClient) {\n                import filestack from 'filestack-js';\n                const apikey = 'AIPACLEs7ShGwwPh6fMTxz';\n                fsClient = filestack.init(apikey, {\n                    policy: 'eyJleHBpcnkiOjE4NjE5MjAwMDAsImNhbGwiOlsicGljayIsInJlYWQiLCJzdGF0Iiwid3JpdGUiLCJ3cml0ZVVybCIsInN0b3JlIiwiY29udmVydCIsInJlbW92ZSIsImV4aWYiXX0=',\n                    signature: '465e8652c5cef95f44e5858e09d430abea855d98deaeb7425558f2c80d0f4f57'\n                });\n            }\n        }\n\n        return Template.instance().showAddProperty.get();\n    },\n    showFilters: function(){\n        return false;\n    },\n    projectData : function () {\n        // var ret = getProjectData();\n        var ret = {};\n        // Session.set('projectData',ret);\n        return ret;\n    },\n    filters:function(){\n        var data = {}//{\"Home Type\":[\"2 BHK\"],\"Floor\":[\"2 to 15\"],\"Price Range\":[\"67.45 to 97.45 \"]}\n        var FILTERS = Session.get('globalFILTERS')\n        var defaultFilters = Session.get('projectData');defaultFilters = defaultFilters.filter;\n        if( FILTERS['homeType']  ){\n            if(FILTERS['homeType'].length) {\n                if( !isArraysEqual( defaultFilters.homeType , FILTERS['homeType']) )\n                    data['Home Type'] = FILTERS['homeType'];\n            }\n        }\n        if( FILTERS['facing']  ){\n            if(FILTERS['facing'].length) {\n                if( !isArraysEqual( defaultFilters.facing , FILTERS['facing']) )\n                    data['Facing'] = FILTERS['facing'];\n            }\n        }\n        if(  FILTERS['floor'] ){\n            var hasLowerLimit = false, hasUpperLimit = false;\n            var l1 = parseInt(FILTERS['floor'][0]);\n            if(l1 !=0 && l1 != defaultFilters.floor[0])hasLowerLimit = true;\n\n            var l2 = parseInt(FILTERS['floor'][1]);\n            if( l2 != defaultFilters.floor[1])hasUpperLimit = true;\n\n            if(hasLowerLimit && !hasUpperLimit){//Only LowerLimit\n                data['Floor'] = [ 'More than '+l1 ]\n            }else if(!hasLowerLimit && hasUpperLimit){//Only UpperLimit\n                data['Floor'] = [ 'Below '+l2 ]\n            }else if(hasLowerLimit && hasUpperLimit){//Both are there\n                data['Floor'] = [ 'Between '+l1+\" and \"+l2 ]\n            }else{}//Both are not there. So don't show filter.\n\n        }\n\n        if(  FILTERS['priceRange'] ){\n            var hasLowerLimit = false, hasUpperLimit = false;\n            var l1 = parseInt(FILTERS['priceRange'][0]);\n            if(l1 !=0 && l1 != defaultFilters.priceRange[0])hasLowerLimit = true;\n\n            var l2 = parseInt(FILTERS['priceRange'][1]);\n            if( l2 != defaultFilters.priceRange[1])hasUpperLimit = true;\n\n            if(hasLowerLimit && !hasUpperLimit){//Only LowerLimit\n                data['Price Range'] = [ 'More than '+numDifferentiation(l1) ]\n            }else if(!hasLowerLimit && hasUpperLimit){//Only UpperLimit\n                data['Price Range'] = [ 'Below '+numDifferentiation(l2) ]\n            }else if(hasLowerLimit && hasUpperLimit){//Both are there\n                data['Price Range'] = [ 'Between '+numDifferentiation(l1)+\" to \"+numDifferentiation(l2) ]\n            }else{}//Both are not there. So don't show filter.\n\n        }\n        //if( FILTERS['priceRange'] ){\n        //  data['Price Range'] =  [ numDifferentiation(FILTERS['priceRange'][0]) +\" to \"+ numDifferentiation(FILTERS['priceRange'][1]) ]\n        //}\n        applyClearFiltersEvent();\n\n        return {\n            data:data,\n            count: Object.keys(data).length\n        };\n    },\n    // time: function(){\n    //\n    //     var projectData = Session.get('projectData');\n    //     var timestamp = TimeSync.serverTime(null, 30000);\n    //     if(!projectData.auction.endDate || !timestamp)return;\n    //\n    //\n    //     var dend = Date.parse(projectData.auction.endDate);\n    //     var timeDiff = dend - timestamp ;\n    //     if(timeDiff<0)return false;\n    //\n    //     var day = Math.floor(timeDiff / (1000 * 3600 * 24))\n    //     var hour = Math.floor(timeDiff / (1000 * 3600 ))\n    //     var min = Math.floor(timeDiff / (1000 * 60 ) )\n    //     hour = hour - (day * 24);\n    //     min = min - (day * 24* 60) - (hour * 60);\n    //     return {\"day\":day,\"hour\":hour,\"min\":min}\n    // },\n    isAuctionClosed:function(){\n        // var timestamp = TimeSync.serverTime(null, 30000);\n        var timestamp = new Date();\n        var projectData = Session.get('projectData');\n        var dend = Date.parse(projectData.auction.endDate);\n        var timeDiff = dend - timestamp;\n        if(timeDiff<0){\n            return true;\n        }\n        return false;\n    },\n    numDifferentiation: function(data){\n        return numDifferentiation(data);\n    },\n    agentStats: function(){\n        var user = Meteor.user();\n        if(user) {\n            if(!user.profile.activeAuctions)user.profile.activeAuctions=0\n            if(!user.profile.totalAuctions)user.profile.totalAuctions=0\n            if(!user.profile.totalBidsReceived)user.profile.totalBidsReceived=0\n            if(!user.profile.bidsReceivedActiveAuctions)user.profile.bidsReceivedActiveAuctions=0\n            if(!user.profile.bidProfitActive)user.profile.bidProfitActive=0\n            if(!user.profile.totalBidProfit)user.profile.totalBidProfit=0\n            return {\n                activeAuctions:user.profile.activeAuctions,\n                totalAuctions:user.profile.totalAuctions,\n                totalBidsReceived:user.profile.totalBidsReceived,\n                bidsReceivedActiveAuctions:user.profile.bidsReceivedActiveAuctions,\n                bidProfit:user.profile.bidProfitActive,\n                totalBidProfit:(user.profile.totalBidProfit*12)\n            };\n        }\n        return {\n            activeAuctions:0,\n            totalAuctions:0,\n            totalBidsReceived:0,\n            bidsReceivedActiveAuctions:0,\n            bidProfit:0,\n            totalBidProfit:0\n        };\n    }\n\n})\nTemplate.propertyList.onCreated(function(){\n    this.expanded = new ReactiveVar( false );\n    this.showAddAuctionForm = new ReactiveVar( false );\n    \n    var instance = this;\n    instance.isSubsLoaded = new ReactiveVar(false);\n    instance.isSubsLoadedAttempted = new ReactiveVar(false);\n    //Meteor.default_connection._subscriptions //To get the list of scbscriptions\n    instance.autorun(function(){\n        try{\n            if(instance.data.auctionId && !instance.data.auction){\n                instance.isSubsLoadedAttempted.set(true)\n                instance.subscribe('Advertisement',instance.data.auctionId);\n            }else if(instance.data.auction){\n                instance.isSubsLoaded.set(true)\n                instance.isSubsLoadedAttempted.set(true)\n            }\n            if(instance.subscriptionsReady()){\n                instance.isSubsLoaded.set(true)\n            }\n        }catch(e){\n            instance.isSubsLoaded.set(true)\n        }\n    })\n})\nTemplate.propertyList.helpers({\n    isSubsLoaded:function(){\n        return Template.instance().subscriptionsReady();\n    },\n    expanded: function(){\n        return Template.instance().expanded.get() ;\n    },\n    showAddAuctionForm: function () {\n        return Template.instance().showAddAuctionForm.get();\n    },\n    numDifferentiation: function(data){\n        return numDifferentiation(data);\n    },\n    auction:function(){\n        if(this.auction) return this.auction;\n        if(this.auctionId){\n            let ret = Collections.Auctions.find({_id: this.auctionId}).fetch();\n            let attempt = Template.instance().isSubsLoadedAttempted.get()\n            \n            if(this.auctionId && !ret.length && !attempt){\n                Template.instance().subscribe('Advertisement',this.auctionId);\n                Template.instance().isSubsLoadedAttempted.set(true);\n            }\n    \n            if(ret) return ret[0];\n        }\n        return false;\n    },\n    lettingprintviewData:function () {\n        if(!this.auction)return \"\"\n        return this.auction.lettingAuctionCode\n        // if(!this.auction)return {key:\"\"}\n        // return {key:this.auction.lettingAuctionCode}\n    },\n    showEditPropertyForm:function(){\n        return FlowRouter.url('account/editproperty',{id:this._id})\n    }\n})\nTemplate.propertyList.events({\n    \"click .see_more_btn\": function (event, template) {\n        if(template.expanded.get() )template.expanded.set(false);\n        else template.expanded.set(true);\n    },\n    \"click .ActivateBtn\": function (event, template) {\n        if(!template.showAddAuctionForm.get() )template.showAddAuctionForm.set(true);\n    },\n    \"click .showEditPropertyForm\": function (event, template) {\n        var prevRoute = {name: FlowRouter.current().route.name,args:{pageno:FlowRouter.current().params.pageno,scrollTo:0} }\n        Session.set('prevRoute',prevRoute);\n\n        // FlowRouter.go('account/editproperty',{id:this._id})\n\n    },\n    \"click .managePropertyLink\": function (event, template) {\n        var prevRoute = {name: FlowRouter.current().route.name,args:{pageno:FlowRouter.current().params.pageno,scrollTo:0} }\n        Session.set('prevRoute',prevRoute);\n\n        FlowRouter.go('account/propertyManage',{id:this._id})\n    },\n    \"click .hideAddAuctionForm\": function (event, template) {\n        if(template.showAddAuctionForm.get() )template.showAddAuctionForm.set(false);\n        propId = this._id;\n        scrollTo('#property_'+propId,0,700)\n\n    },\n    \"click .viewApplications\": function (event, template) {\n        var prevRoute = {name: FlowRouter.current().route.name,args:{pageno:FlowRouter.current().params.pageno} }\n        Session.set('prevRoute',prevRoute);\n\n        FlowRouter.go(\"account/propertyApplications\",{id:this._id});\n    },\n    \"click .showCopyDlg\": function (event, template) {\n        let user = Meteor.user();\n        let sluggedName = slugifyEmailAddress(user.profile.name);\n        if(!sluggedName)sluggedName = 'rent'\n        let email = sluggedName+'-let-'+this.auction.lettingAuctionCode.toLowerCase()+\"@spotmycrib.ie\";\n        $('#agentPropertyEmailField').val(email);\n\n        var url = FlowRouter.url('letting',{key:this.auction.lettingAuctionCode})\n        $('#propertyLinkField').val(url);\n        $.fancybox({\n            'padding': 0,\n            'href': '#propertyLinkDlg',\n            afterShow:function(template){\n                $('#agentPropertyEmailField').select();\n                $('#propertyLinkDlg .copyEmailBtn').unbind().bind('click',function () {\n                    $('#agentPropertyEmailField').select();\n\n                    try {\n                        var successful = document.execCommand('copy');\n                        var msg = successful ? 'successful' : 'unsuccessful';\n                        // console.log('Copying text command was ' + msg);\n                        $.fancybox.close()\n                    } catch (err) {\n                        console.log('Oops, unable to copy');\n                    }\n                    ga('send', 'event', 'myPropertiesPage', 'copyShareEmail', 'copyShareEmail Btn Clicked');\n                })\n                $('#propertyLinkDlg .copyLinkBtn').unbind().bind('click',function () {\n                    $('#propertyLinkField').select();\n\n                    try {\n                        var successful = document.execCommand('copy');\n                        var msg = successful ? 'successful' : 'unsuccessful';\n                        // console.log('Copying text command was ' + msg);\n                        $.fancybox.close()\n                    } catch (err) {\n                        console.log('Oops, unable to copy');\n                    }\n                    ga('send', 'event', 'myPropertiesPage', 'copyShareLink', 'copyShareLink Btn Clicked');\n                })\n                $('#propertyLinkDlg .cancelBtn').unbind().bind('click',function () {\n                    $.fancybox.close()\n                })\n            },\n        });\n\n    },\n});\nTemplate.addPropertyForm.onCreated(function(){\n    if(!Session.get('addPropertyImages')) {// Lets do this. Anyways we have delete button.\n        Session.set('addPropertyImages', []);\n        S3.collection.remove({})\n\n        var user = Meteor.user();\n        try {\n            if (user.profile.session.addproperty.gallery){\n                Session.set('addPropertyImages', user.profile.session.addproperty.gallery);\n            }\n        }catch(e){}\n\n    }\n    this.numBedRoomCount = new ReactiveVar( 0 );\n    this.addPropertyFormSaving = new ReactiveVar( false );\n    this.countySelected = new ReactiveVar( false );\n    saveAndAdvertise=false;\n\n    var instance = this;\n    instance.isSubsLoaded = new ReactiveVar(false);\n    instance.autorun(function(){\n        if(instance.countySelected.get()){\n            instance.isSubsLoaded.set(false)\n            instance.subscribe('Areas','','',instance.countySelected.get(),'','');\n        }\n        if(instance.subscriptionsReady()){\n            instance.isSubsLoaded.set(true)\n        }\n    })\n})\nTemplate.addPropertyForm.helpers({\n    isSA:function(){\n        var user = Meteor.user();\n        if(user.isSA)return true;\n        return false;\n    },\n    countries:function(){\n        return [{label: \"Ireland\", value: \"Ireland\", selected:\"selected\"}];//Both capital\n    },\n    counties:function(){\n        let staticCounties = [\"Carlow\", \"Cavan\", \"Clare\", \"Cork\", \"Donegal\", \"Dublin\", \"Galway\", \"Kerry\", \"Kildare\", \"Kilkenny\", \"Laois\", \"Leitrim\", \"Limerick\", \"Longford\", \"Louth\", \"Mayo\", \"Meath\", \"Monaghan\", \"Offaly\", \"Roscommon\", \"Sligo\", \"Tipperary\", \"Waterford\", \"Westmeath\", \"Wexford\", \"Wicklow\"];\n        let ret = []\n        for(let i=0;i< staticCounties.length;i++){\n            if(!staticCounties[i])continue;\n            ret.push({label: titleCase(staticCounties[i]), value: staticCounties[i] })\n        }\n        return ret;\n        // return [{label: \"Dublin\", value: \"dublin\"}];//Both capital\n        // var distinctEntries = _.uniq(Collections.Areas.find({}, {\n        //     sort: {County: 1}, fields: {County: true}\n        // }).fetch().map(function(x) {\n        //     return x.County;\n        // }), true);\n        // var ret = []\n        // for(var i=0;i< distinctEntries.length;i++){\n        //     if(!distinctEntries[i])continue;\n        //     ret.push({label: titleCase(distinctEntries[i]), value: distinctEntries[i] })\n        // }\n        // return ret;\n    },\n    areas:function(){\n        var countySelected = Template.instance().countySelected.get();\n        if(!countySelected){\n            var doc = Collections.Properties.findOne(); if(!doc)return [];\n            Template.instance().countySelected.set(doc.address.county);\n            countySelected = doc.address.county;\n        }\n\n        var distinctEntries = _.uniq(Collections.Areas.find({County:countySelected}, {\n            sort: {Area: 1}, fields: {Area: true}\n        }).fetch().map(function(x) {\n            return x.Area;\n        }), true);\n        var ret = []\n        for(var i=0;i< distinctEntries.length;i++){\n            if(!distinctEntries[i])continue;\n            ret.push({label: titleCase(distinctEntries[i]), value: distinctEntries[i] })\n        }\n        return ret;\n    },\n    propertyTypes:function(){\n        var Config = Collections.Config.find().fetch();Config = Config[0];\n        var ret = []\n        for(var i=0;i< Config.propertyType.length;i++){\n            ret.push({label: titleCase(Config.propertyType[i].name), value: Config.propertyType[i].value})\n        }\n        return ret;\n    },\n    numBedRoomCount:function () {\n        var c = Template.instance().numBedRoomCount.get();\n        if(c<100)return Template.instance().numBedRoomCount.get();\n        else return 0;\n    },\n    addPropertyFormSaving:function () {\n        return Template.instance().addPropertyFormSaving.get();\n    },\n    ensuiteLoop: function(count){\n        var countArr = [];\n        for (var i=0; i<count; i++){\n            countArr.push({i:i+1});\n        }\n        return countArr;\n    }\n})\nTemplate.addPropertyForm.events({\n    \"click .openFileUploader\":function (event, template) {\n        event.preventDefault();\n        openPicker();\n        // filename\n        //     :\n        //     \"webcam-1/12/2018, 6:53:25 PM.png\"\n        // handle\n        //     :\n        //     \"G8lStVqHTiGnwxof6d5y\"\n        // mimetype\n        //     :\n        //     \"image/png\"\n        // originalFile\n        //     :\n        // {name: \"webcam-1/12/2018, 6:53:25 PM.png\", type: \"image/png\", size: 630585}\n        // originalPath\n        //     :\n        //     \"webcam-1/12/2018, 6:53:25 PM.png\"\n        // size\n        //     :\n        //     629612\n        // source\n        //     :\n        //     \"local_file_system\"\n        // status\n        //     :\n        //     \"Stored\"\n        // uploadId\n        //     :\n        //     \"ba2fe36e9fd182ec0cb88236d676cefad\"\n        // url\n        //     :\n        //     \"https://cdn.filestackcontent.com\n        return;\n    },\n    'change .selectPropertyImages': function(event, template) {\n        var files = event.target.files;\n        S3.upload({\n            files:files,\n            path:\"propertyImagesLarge\"\n        },function(e,r){\n            if(e)throw new Meteor.Error('Upload failed ', e);\n            var addPropertyImages = Session.get('addPropertyImages');\n            addPropertyImages.push(r);\n            Session.set('addPropertyImages',addPropertyImages);\n            console.log(r);\n        });\n        // for (var i = 0, ln = files.length; i < ln; i++) {\n        //     propertyImagesCollection.insert(files[i], function (err, fileObj) {\n        //         // Inserted new doc with ID fileObj._id, and kicked off the data upload using HTTP\n        //         console.log(fileObj);\n        //         var cursor = propertyImagesCollection.find(fileObj._id);\n        //\n        //         var liveQuery = cursor.observe({\n        //             changed: function(newImage, oldImage) {\n        //\n        //                 console.log(\"Inside live query \");\n        //                 console.log(newImage);\n        //                 if (newImage.isUploaded()) {\n        //                     liveQuery.stop();\n        //\n        //                     // Call your onUploaded callback here...\n        //                 }\n        //             }\n        //         });\n        //     });\n        // }\n    },\n    'change .countySelected': function(event, template) {\n        template.countySelected.set(event.target.value);\n    },\n    'change .url': function(event, template) {\n        var url = event.target.value;\n        if(!url)return false;//Empty url\n\n        Meteor.call('importPost',url,function(error,doc){\n            if(error){\n                console.log(error)\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                var msg = 'An error occurred.';\n                if(error.reason)msg += ' '+error.reason+'.'\n                else if(error.message)msg += ' '+error.message+'.'\n                tmp.push(msg);\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n\n            $( \"input[name='address.address']\" ).val(doc.address.address);\n            $( \"input[name='price']\" ).val(doc.rent);\n            $( \"select[name='address.county']\" ).val(doc.address.county).trigger('change');\n            setTimeout(function(){$( \"select[name='address.area']\" ).val(doc.address.area);},2000)\n            setTimeout(function(){$( \"select[name='address.area']\" ).val(doc.address.area);},4000)\n            $( \"select[name='type']\" ).val(doc.type.toLowerCase());\n            $( \"select[name='furnished']\" ).val(doc.furnished.toString());\n            $( \"input[name='baths']\" ).val(doc.baths);\n            $( \"input[name='numBedRoomCount']\" ).val(doc.numBedRoomCount).trigger('change');\n            $( \"textarea[name='about']\" ).val(doc.about).trigger('keyup');\n            $( \"input[name='contacts.0.name']\" ).val(doc.contacts[0].name);\n            var number = \"\";\n            try{\n                number = doc.contacts[0].phone\n            }catch(e){}\n            if(number){\n                try{\n                    number = atob(number)\n                    number = number.replace(/\\s+/g, '')\n                }catch(e){}\n                $( \"input[name='contacts.0.phone']\" ).val(number);\n            }\n            if(doc.amenities){\n                for (var i = 0; i < doc.amenities.length; i++) {\n                    $(\"input[value='\"+doc.amenities[i]+\"']\").prop('checked', true);\n                }\n            }\n            var tmp = {};\n            if(doc.gallery) {\n                var addPropertyImages = Session.get('addPropertyImages');if(!addPropertyImages)addPropertyImages=[]\n                var galleryLen = doc.gallery.length,galleryStoredLen=0;\n                // var galleryLen = 1,galleryStoredLen=0;\n                for (var i = 0; i < doc.gallery.length; i++) {\n                    // if(i>0)break;\n                    fsClient.storeURL(doc.gallery[i],{filename: 'Image '+i+1}).then(function(response) {\n                            console.log(JSON.stringify(response));\n                        // {\"url\":\"https://cdn.filestackcontent.com/QH10tMaGTrSgFweORrip\",\"size\":111949,\"type\":\"image/jpeg\",\"filename\":\"Image 01\",\"handle\":\"QH10tMaGTrSgFweORrip\"}\n                            tmp = {\n                                name: response.filename,\n                                url: response.url,\n                                handle: response.handle,\n                                mimetype: response.mimetype,\n                                // originalFile: doc.gallery[i],\n                                // originalPath: doc.gallery[i],\n                                size: response.size,\n                                // source: response.source,\n                                // status: response.status,\n                                // uploadId: response.uploadId\n                            }\n                            console.log(tmp)\n                            addPropertyImages.push(tmp);\n                            galleryStoredLen++;\n                            if(galleryStoredLen==galleryLen){//Now its fully imported\n                                Session.set('addPropertyImages', addPropertyImages);\n                                updateGalleriesInProfile(addPropertyImages, function (err, res) {//No need to show error. Because its just a backup.\n                                    var addPropertyImages = Session.get('addPropertyImages');\n                                    console.log(\"Current Count: \" + addPropertyImages.length)\n                                });\n                            }\n                        }\n                    );\n                }\n\n\n\n            }\n\n        })\n    },\n    'keyup .autoGrowTA': function(event, template) {\n        var element = event.target;\n        element.style.height = \"5px\";\n        if(element.scrollHeight<310)element.style.height = (element.scrollHeight)+\"px\";\n        else element.style.height = \"310px\";\n    },\n    'change #numBedRoomCount': function(event, template) {\n        var numBedRoomCount = parseInt($(event.target).val());\n        if(isNaN(numBedRoomCount))return;\n        Template.instance().numBedRoomCount.set(numBedRoomCount);\n        t1 = template;\n        setTimeout(function () {\n            t1.$('#addPropertyFormCF').validate();\n        },500)\n    },\n    'submit form': function(event){\n        event.preventDefault();\n    },\n    \"click .addPropertyFormSaveAdvertiseBtn\": function(event, template) {\n        saveAndAdvertise=true;\n        $('#addPropertyFormCF').submit();\n    },\n    \"click .addPropertyFormCancelBtn\": function(event, template) {\n        Session.set('hideAddPropertyForm',true)\n    },\n    'change input[name=price]':function(event, template){\n        if(event.target.value){\n            var tmp = event.target.value.split('.');tmp=tmp[0]//No decimals\n            tmp = tmp.trim().match(/\\d+/g)\n            if(!Array.isArray(tmp))event.target.value = '';\n            event.target.value = tmp.join('');\n        }\n    },\n});\nTemplate.addPropertyForm.onRendered(function () {\n    // this.$('#addPropertyFormCF').validate();\n    addPropertyFormSaving = this.addPropertyFormSaving\n    var validator = this.$('#addPropertyFormCF').validate({\n        submitHandler: function(event){\n            addPropertyFormSaving.set(true);\n            console.log(\"You just submitted the 'addPropertyForm' form.\");\n            Meteor.call('addProperty',$('#addPropertyFormCF').serializeArray(),function (error, propertyId) {\n\n                addPropertyFormSaving.set(false);\n                if(error){\n                    console.log(error)\n                    //    validator.showErrors({\n                    //         email: error.reason\n                    //     });\n                    var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                    var msg = 'An error occurred.';\n                    if(error.reason)msg += ' '+error.reason+'.'\n                    else if(error.message)msg += ' '+error.message+'.'\n                    tmp.push(msg);\n                    Session.set(\"showErrorDlg\",tmp)\n                    return;\n                }\n                if(saveAndAdvertise){\n                    Meteor.call('addAdvertisement',$('#addPropertyFormCF').serializeArray(),propertyId,function (error, auctionId) {\n\n                        if(error){\n                            console.log(error)\n                            //    validator.showErrors({\n                            //         email: error.reason\n                            //     });\n                            var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                            var msg = 'An error occurred.';\n                            if(error.reason)msg += ' '+error.reason+'.'\n                            else if(error.message)msg += ' '+error.message+'.'\n                            tmp.push(msg);\n                            Session.set(\"showErrorDlg\",tmp)\n                            return;\n                        }\n                        console.log('addAdvertisement created successfully')\n                        console.log(auctionId);\n                        saveAndAdvertise=false;\n                    })\n                }\n\n                var addPropertyImages = Session.get('addPropertyImages');\n                updateGalleriesInServer(addPropertyImages, propertyId, function (err, res) {\n                    Meteor.call('updateGalleriesInUserProfile', [], function(){console.log('Reset the profile backup');});//Reset the profile backup\n                    if (err) {\n                        console.log(err);\n                    } else {\n                        Session.set('addPropertyImages',[]);\n                        S3.collection.remove({})\n                    }\n                })\n                Session.set('hideAddPropertyForm',true)\n            })\n        }\n    });\n})\n\n\nTemplate.advertiseForm.onCreated(function(){\n    this.advertiseFormSaving = new ReactiveVar( false );\n})\nTemplate.advertiseForm.helpers({\n    advertiseFormSaving:function () {\n        return Template.instance().advertiseFormSaving.get();\n    }\n})\nTemplate.advertiseForm.events({\n    'submit form': function(event){\n        event.preventDefault();\n    },\n    'change input[name=price]':function(event, template){\n        if(event.target.value){\n            var tmp = event.target.value.split('.');tmp=tmp[0]//No decimals\n            tmp = tmp.trim().match(/\\d+/g)\n            if(!Array.isArray(tmp))event.target.value = '';\n            event.target.value = tmp.join('');\n        }\n    },\n    \"click .advertiseFormCancelBtn\": function(event, template) {\n        parentIns = template.view.parentView.parentView.parentView.templateInstance();\n        parentIns.showAddAuctionForm.set(false);\n    }\n});\n\nTemplate.advertiseForm.onRendered(function () {\n    this.$('#readyFrom').datetimepicker();\n\n    advertiseFormSaving = this.advertiseFormSaving\n    parentIns = this.view.parentView.parentView.parentView.templateInstance();\n\n    var validator = this.$('#advertiseFormCF').validate({\n        submitHandler: function(event){\n            advertiseFormSaving.set(true);\n            // console.log(\"You just submitted the 'advertise' form.\");\n            Meteor.call('addAdvertisement',$('#advertiseFormCF').serializeArray(),function (error, result) {\n\n                advertiseFormSaving.set(false);\n                if(error){\n                    console.log(error)\n                    //    validator.showErrors({\n                    //         email: error.reason\n                    //     });\n                    var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                    var msg = 'An error occurred.';\n                    if(error.reason)msg += ' '+error.reason+'.'\n                    else if(error.message)msg += ' '+error.message+'.'\n                    tmp.push(msg);\n                    Session.set(\"showErrorDlg\",tmp)\n                    return;\n                }\n                // console.log('addAdvertisement completed successfully')\n                console.log(result);\n                auctionId = result;\n                parentIns.showAddAuctionForm.set(false);\n                scrollTo('.property_auction_'+auctionId,-100,700)\n            })\n        }\n    });\n})\nTemplate.imageView.helpers({\n    images: function () {\n        // return S3.collection.find();\n        return Session.get('addPropertyImages');\n    }\n});\nTemplate.imgTag.events({\n    \"click .editImgBtn\": function (event, template) {\n\n        var addPropertyImages = Session.get('addPropertyImages');\n\n        var newArr = [];\n        if(!addPropertyImages)return;\n        if(!addPropertyImages.length)return;\n\n        index = getIndexByHandle(addPropertyImages, this.handle);\n\n        newArr.push(addPropertyImages[index].url)//put it at first\n\n        const pickOptions = {\n            transformations:{\n                crop:{      force:true,\n                    aspectRatio:1.333},\n                rotate:true},\n            accept: 'image/*',\n            imageMax:[800,600],\n            \"uploadInBackground\": false//Disabled because, bg upload causes 2 uploads towards filestack limits\n        };\n        fsClient.cropFiles(newArr,pickOptions).then( (response) => {\n            var addPropertyImages = Session.get('addPropertyImages');\n\n            //if its conversion from old amazon to new filestack, then it will create a new file, so delete the old file seperatly and insert a new file seperatly.\n\n            if(!response.filesUploaded.length){\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(\"Edit failed: please try again, contact us if needed.\");\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n\n            fsClient.remove(addPropertyImages[index].handle).then(function(result){\n                if(!result.ok){\n                    console.log(result);//Not required to show error to user as this is just edit. If the image appears, he will click delete again\n                }\n                console.log('In fs remove result');\n                var addPropertyImages = Session.get('addPropertyImages');\n                addPropertyImages.splice(index, 1);\n                Session.set('addPropertyImages',addPropertyImages);\n\n                updateGalleriesInProfile(addPropertyImages,function (err, res) {//No need to show error. Because its just a backup.\n                    var addPropertyImages = Session.get('addPropertyImages');\n                    console.log(\"Current Count: \" + addPropertyImages.length)\n                });\n            });\n\n\n\n            var tmp = {};\n            for(var i =0;i<response.filesUploaded.length;i++){\n                tmp = {\n                    name: response.filesUploaded[i].filename,\n                    url: response.filesUploaded[i].url,\n                    handle: response.filesUploaded[i].handle,\n                    mimetype: response.filesUploaded[i].mimetype,\n                    originalFile: response.filesUploaded[i].originalFile,\n                    originalPath: response.filesUploaded[i].originalPath,\n                    size: response.filesUploaded[i].size,\n                    source: response.filesUploaded[i].source,\n                    status: response.filesUploaded[i].status,\n                    uploadId: response.filesUploaded[i].uploadId\n                }\n                // addPropertyImages.push(tmp);\n                addPropertyImages.splice(index+1, 0, tmp);//insert at the index place where its deleted.\n            }\n\n            //Logic to insert new file.\n            Session.set('addPropertyImages',addPropertyImages);\n\n            updateGalleriesInProfile(addPropertyImages, function (err, res) {//No need to show error. Because its just a backup.\n                var addPropertyImages = Session.get('addPropertyImages');\n                console.log(\"Current Count: \" + addPropertyImages.length)\n            });\n        });\n\n\n    },\n    \"click .deleteImgBtn\": function (event, template) {\n\n        var addPropertyImages = Session.get('addPropertyImages');\n        index = getIndexByHandle(addPropertyImages, this.handle);\n\n        fsClient.remove(this.handle).then(function(result){\n            debugger;\n            if(!result.ok){\n                console.log(result);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(\"Deletion failed: please check your internet connection, contact us if needed.\");\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n\n            var addPropertyImages = Session.get('addPropertyImages');\n            addPropertyImages.splice(index, 1);\n            Session.set('addPropertyImages',addPropertyImages);\n\n            updateGalleriesInProfile(addPropertyImages, function (err, res) {//No need to show error. Because its just a backup.\n                var addPropertyImages = Session.get('addPropertyImages');\n                console.log(\"Current Count: \" + addPropertyImages.length)\n            });\n        });\n\n\n\n    },\n    \"click .deleteImgBtnOld\": function (event, template) {\n        console.log(this);\n        var addPropertyImages = Session.get('addPropertyImages');\n        index = getIndex(addPropertyImages, this._id);\n        // debugger;\n        S3.delete(this.relative_url,function(error, result){\n            var addPropertyImages = Session.get('addPropertyImages');\n            S3.collection.remove(addPropertyImages[index]._id);\n            addPropertyImages.splice(index, 1);\n            Session.set('addPropertyImages',addPropertyImages);\n        })\n\n    }\n});\n\n\n\nfunction getIndex(myArray, fileId){\n    for (var i=0; i < myArray.length; i++) {\n        if (myArray[i]._id === fileId) {\n            return i;\n        }\n    }\n}\n\n\n\n\n\nTemplate.myProperties.onRendered(function() {\n    try{\n        jQuery(\"html,body\").animate({scrollTop: 0}, 250);\n    }catch(e){\n        document.body.scrollTop = document.documentElement.scrollTop = 0;\n    }\n\n    var prevRoute = Session.get('prevRoute');\n    if(prevRoute){\n        try{\n        if(prevRoute)\n        if(prevRoute.instructions)\n        if(prevRoute.instructions.openPostNewProp){\n            Template.instance().showAddProperty.set(true);\n            setTimeout(function () {\n                jQuery(\"html,body\").animate({scrollTop: 0}, 250);\n            },500)\n        }}catch(e){console.log(e);}\n    }\n\n})\nfunction updateQueryStringParameter(uri, key, value) {\n    var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\n    var separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\n    if (uri.match(re)) {\n        return uri.replace(re, '$1' + key + \"=\" + value + '$2');\n    }\n    else {\n        return uri + separator + key + \"=\" + value;\n    }\n}\nclearFiltersEvent = function(){\n    $('.clearFilterBtn').unbind().click(function(){\n        var val = $(this).closest('span').attr('val');\n        var key = $(this).closest('h5').attr('key');\n        var FILTERS = Session.get('globalFILTERS');\n        var filterDefaults = Session.get('projectData');\n        filterDefaults = filterDefaults.filter;\n\n        // console.log(FILTERS);\n        if(key == \"Home Type\"){\n            var array = FILTERS[\"homeType\"]\n            var index = array.indexOf(val);\n            if (index > -1) {\n                array.splice(index, 1);\n                FILTERS[\"homeType\"]=array;\n            }\n        }\n        else if(key == \"Facing\"){\n            var array = FILTERS[\"facing\"]\n            var index = array.indexOf(val);\n            if (index > -1) {\n                array.splice(index, 1);\n                FILTERS[\"facing\"]=array;\n            }\n        }else if(key == \"Price Range\"){\n            //if(FILTERS[\"priceRange\"][0]==val ){\n            //  FILTERS[\"priceRange\"][0] = filterDefaults.priceRange[0]\n            //}else{\n            //  FILTERS[\"priceRange\"][1] = filterDefaults.priceRange[1]\n            //}\n            FILTERS[\"priceRange\"][0] = filterDefaults.priceRange[0]\n            FILTERS[\"priceRange\"][1] = filterDefaults.priceRange[1]\n\n\n        }else if(key == \"Floor\"){\n            if(FILTERS[\"floor\"][0]==val ){\n                FILTERS[\"floor\"][0] = filterDefaults.floor[0]\n            }else{\n                FILTERS[\"floor\"][1] = filterDefaults.floor[1]\n            }\n        }\n\n        //Session.set('globalFILTERS', FILTERS);\n        setFilters(FILTERS);\n    })\n}\napplyClearFiltersEvent = function(){\n    setTimeout(clearFiltersEvent, 1000);\n    setTimeout(clearFiltersEvent, 3000);\n\n}\nfunction applyFilters(){\n    console.log('event applyFilters jquery')\n    var floorLevelDOM = document.getElementById('range-input');\n    var priceRangeDOM = document.getElementById('range-input1');\n    var tmp = $('.filterUnitType').val();\n    if(tmp == 'any')tmp = [];\n    else tmp = [tmp]\n    globalFILTERS.homeType = tmp;\n    var tmp = $('.filterUnitFacing').val();\n    if(tmp == 'any')tmp = [];\n    else tmp = [tmp]\n    globalFILTERS.facing = tmp;\n    globalFILTERS.floor = floorLevelDOM.noUiSlider.get();\n    globalFILTERS.priceRange = priceRangeDOM.noUiSlider.get();\n    // console.log(globalFILTERS);\n    setFilters(globalFILTERS);\n    $.fancybox.close();\n    applyClearFiltersEvent();\n}\nfunction applyFilterValues(){\n    // console.log('event applyFiltersValues jquery')\n    var floorLevelDOM = document.getElementById('range-input');\n    var priceRangeDOM = document.getElementById('range-input1');\n    var floor = floorLevelDOM.noUiSlider.get();\n    var priceRange = priceRangeDOM.noUiSlider.get();\n    $('.filterS1l').html(floor[0])\n    $('.filterS1h').html(floor[1])\n    $('.filterS2l').html(numDifferentiation(priceRange[0] ))\n    $('.filterS2h').html(numDifferentiation(priceRange[1] ))\n\n}\nfunction delayedCall(functionName){\n    setTimeout(functionName,3000);\n}\nfunction isArraysEqual(array1,array2){\n    var is_same = (array1.length == array2.length) && array1.every(function(element, index) {\n            return element === array2[index];\n        });\n    return is_same;\n}\ncallDelayedFunctions = function(){\n    setTimeout(delayedFunctions, 2000);\n}\nfunction delayedFunctions(){\n    Session.set('enableDelayedFunctions',true)\n    $('.fullyConfirmBlgOKBtn').unbind().click(function(){\n        console.log('fullyConfirmBlgOKBtn called');\n        Session.set('showConfirmFancyBox',false)\n        FlowRouter.query.clear();\n        $.fancybox.close();\n        $('.fancybox-overlay').hide();\n\n\n        setTimeout(function(){\n            var unitid = Session.get('adjustAutoExpandToUnitID');\n            if(unitid){\n                scrollTo('.has-error',0,500)\n                setTimeout(function(){$('html,body').animate({scrollTop: $('#unit_'+unitid).offset().top }, 1000)}, 1000)\n                Session.set('adjustAutoExpandToUnitID','')\n            }\n        },2000)\n\n\n\n    })\n}\nfunction mybidsJqueryEvents(){\n    $('.payNowBtn').unbind().click(function(){\n        console.log(\"jquery event payNowBtn\")\n\n        var redirectURL = FlowRouter.current().originalUrl;\n        if(redirectURL.indexOf('http:') == -1) {\n            var redirectURL = Meteor.absoluteUrl() + FlowRouter.current().originalUrl.substring(1);\n        }\n        var bidId = $(this).attr('bidid');\n        Meteor.call(\"getUnitConfirmationPaymentURL\",[redirectURL,bidId], function(error, result){\n            if(error){\n                return;\n            }\n            window.location.href = result;\n        })\n    })\n    $('.withdrawConfirmBtn').unbind().click(function(){\n        console.log(\"jquery event withdrawBtn\")\n        var bidId = $(this).attr('bidid');\n        Meteor.call(\"withdrawBid\",[bidId], function(error, result){\n            if(error){\n                return;\n            }\n            $.fancybox.close();\n        })\n    })\n    $('.cancelBtn').unbind().click(function(){\n        console.log('event cancelBtn jquery')\n        $.fancybox.close();\n    })\n}\n\nfunction getPriceBreakUp(unit,ratePerSqFt){\n\n    var pricing = unit.priceBreakUp\n    var electricityMultiplier = pricing.statutoryGovtCharges.electricityMultiplier;\n    var constructionRateForVAT = pricing.statutoryGovtCharges.constructionRateForVAT;\n    if(!electricityMultiplier)electricityMultiplier = 140;\n    if(!constructionRateForVAT)constructionRateForVAT = 2100;\n    if(!pricing.landCost)pricing.landCost = 2091;\n\n    unit.superBuiltUpArea = parseFloat(unit.superBuiltUpArea)\n    ratePerSqFt = parseFloat(ratePerSqFt)\n    pricing.landCost = parseFloat(pricing.landCost)\n    electricityMultiplier = parseFloat(electricityMultiplier)\n    constructionRateForVAT = parseFloat(constructionRateForVAT)\n    pricing.basicUnitCost.floorRaiseCharge = parseFloat(pricing.basicUnitCost.floorRaiseCharge)\n    pricing.basicUnitCost.plcCharge = parseFloat(pricing.basicUnitCost.plcCharge)\n    pricing.basicUnitCost.floorRaiseCharge = parseFloat(pricing.basicUnitCost.floorRaiseCharge);\n    pricing.basicUnitCost.plcCharge = parseFloat(pricing.basicUnitCost.plcCharge);\n    pricing.basicUnitCost.totalBasicRatepsft = parseFloat(pricing.basicUnitCost.totalBasicRatepsft)\n    pricing.basicUnitCost.total = parseFloat(pricing.basicUnitCost.total)\n    pricing.agreementValue.infrastructureValue = parseFloat(pricing.agreementValue.infrastructureValue)\n    pricing.agreementValue.clubHouseCharges = parseFloat(pricing.agreementValue.clubHouseCharges)\n    pricing.agreementValue.total = parseFloat(pricing.agreementValue.total)\n    pricing.otherCharges.advanceMaintainence = parseFloat(pricing.otherCharges.advanceMaintainence)\n    pricing.otherCharges.generatorBackup = parseFloat(pricing.otherCharges.generatorBackup)\n    pricing.otherCharges.builderCharges = parseFloat(pricing.otherCharges.builderCharges)\n    pricing.otherCharges.total = parseFloat(pricing.otherCharges.total)\n    pricing.statutoryGovtCharges.serviceTax = parseFloat(pricing.statutoryGovtCharges.serviceTax)\n    pricing.statutoryGovtCharges.vat = parseFloat(pricing.statutoryGovtCharges.vat)\n    pricing.statutoryGovtCharges.labourCess = parseFloat(pricing.statutoryGovtCharges.labourCess)\n    pricing.statutoryGovtCharges.electricityCharges = parseFloat(pricing.statutoryGovtCharges.electricityCharges)\n    pricing.statutoryGovtCharges.stampDuty = parseFloat(pricing.statutoryGovtCharges.stampDuty)\n    pricing.statutoryGovtCharges.stampPaperCharges = parseFloat(pricing.statutoryGovtCharges.stampPaperCharges);\n    pricing.statutoryGovtCharges.legalCharges = parseFloat(pricing.statutoryGovtCharges.legalCharges);\n    pricing.statutoryGovtCharges.otherStatutoryCharges = parseFloat(pricing.statutoryGovtCharges.otherStatutoryCharges);\n    pricing.statutoryGovtCharges.total = parseFloat(pricing.statutoryGovtCharges.total);\n    pricing.totalAllInclusive = parseFloat(pricing.totalAllInclusive);\n\n    pricing.basicUnitCost.totalBasicRatepsft = ratePerSqFt + pricing.basicUnitCost.floorRaiseCharge + pricing.basicUnitCost.plcCharge;\n    pricing.basicUnitCost.total = unit.superBuiltUpArea * pricing.basicUnitCost.totalBasicRatepsft\n\n\n    pricing.agreementValue.total = pricing.basicUnitCost.total + pricing.agreementValue.infrastructureValue + pricing.agreementValue.clubHouseCharges\n\n    //pricing.statutoryGovtCharges.electricityCharges = unit.superBuiltUpArea * electricityMultiplier;\n\n    //pricing.statutoryGovtCharges.vat = ( (constructionRateForVAT+pricing.basicUnitCost.floorRaiseCharge +\n    //  pricing.basicUnitCost.plcCharge)     +    (pricing.agreementValue.infrastructureValue + pricing.statutoryGovtCharges.electricityCharges + pricing.agreementValue.clubHouseCharges)/unit.superBuiltUpArea)*unit.superBuiltUpArea * 0.145 ;\n    //debugger;\n    // pricing.statutoryGovtCharges.labourCess = (pricing.basicUnitCost.total - (unit.superBuiltUpArea * pricing.landCost))*0.01\n    // var D30 = unit.floorLevel\n    // var E30 = D30<=5 ? 0 : D30>5 && D30<=15 ? (D30-5)*0.005 : 0.05\n    // //pricing.statutoryGovtCharges.stampDuty =  ((ratePerSqFt*2130)+(ratePerSqFt*2130*(E30+0.0525)+250000))*0.0665\n    // //pricing.statutoryGovtCharges.stampPaperCharges =  pricing.agreementValue.total*0.001+300\n    // pricing.statutoryGovtCharges.total = pricing.statutoryGovtCharges.vat +\n    //   pricing.statutoryGovtCharges.labourCess +\n    //   pricing.statutoryGovtCharges.electricityCharges +\n    //   pricing.statutoryGovtCharges.stampDuty +\n    //   pricing.statutoryGovtCharges.stampPaperCharges +\n    //   pricing.statutoryGovtCharges.legalCharges +\n    //   pricing.statutoryGovtCharges.otherStatutoryCharges\n\n    pricing.totalAllInclusive = pricing.agreementValue.total +\n        pricing.otherCharges.total +\n        pricing.statutoryGovtCharges.total\n    return pricing;\n}\nfunction ordinal_suffix_of(i) {\n    var j = i % 10,\n        k = i % 100;\n    if (j == 1 && k != 11) {\n        return i + \"st\";\n    }\n    if (j == 2 && k != 12) {\n        return i + \"nd\";\n    }\n    if (j == 3 && k != 13) {\n        return i + \"rd\";\n    }\n    return i + \"th\";\n}\nfunction openPicker() {\n    fsClient.pick({\n        fromSources:[\"local_file_system\",\"webcam\",\"facebook\",\"url\",\"googledrive\",\"dropbox\",\"flickr\",\"instagram\",\"gmail\",\"picasa\",\"onedrive\",\"clouddrive\"],\n        maxFiles:10,\n        transformations:{\n            crop:{      force:false,\n                aspectRatio:1.333},\n            rotate:true},\n        imageMax:[800,600],\n        accept:[\"image/*\"],\n        \"uploadInBackground\": false//Disabled because, bg upload causes 2 uploads towards filestack limits\n    }).then(function(response) {\n        // declare this function to handle response\n        var addPropertyImages = Session.get('addPropertyImages');\n        var tmp = {};\n        if(response.filesUploaded)\n            for(var i =0;i<response.filesUploaded.length;i++){\n                tmp = {\n                    name: response.filesUploaded[i].filename,\n                    url: response.filesUploaded[i].url,\n                    handle: response.filesUploaded[i].handle,\n                    mimetype: response.filesUploaded[i].mimetype,\n                    originalFile: response.filesUploaded[i].originalFile,\n                    originalPath: response.filesUploaded[i].originalPath,\n                    size: response.filesUploaded[i].size,\n                    source: response.filesUploaded[i].source,\n                    status: response.filesUploaded[i].status,\n                    uploadId: response.filesUploaded[i].uploadId\n                }\n                addPropertyImages.push(tmp);\n            }\n        Session.set('addPropertyImages',addPropertyImages);\n\n        updateGalleriesInProfile(addPropertyImages, function (err, res) {//No need to show error. Because its just a backup.\n            var addPropertyImages = Session.get('addPropertyImages');\n            console.log(\"Current Count: \"+addPropertyImages.length )\n        });\n        console.log(response);\n    });\n}\nfunction getIndexByHandle(myArray, fileId){\n    for (var i=0; i < myArray.length; i++) {\n        if (myArray[i].handle === fileId) {\n            return i;\n        }\n    }\n}\nfunction titleCase(str){\n    if(!str)return;\n    return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\nfunction slugifyEmailAddress (text) {\n    if(!text)return '';\n    const a = 'Ã Ã¡Ã¤Ã¢Ã¨Ã©Ã«ÃªÃ¬Ã­Ã¯Ã®Ã²Ã³Ã¶Ã´Ã¹ÃºÃ¼Ã»Ã±Ã§ÃŸÃ¿Å“Ã¦Å•Å›Å„á¹•áºƒÇµÇ¹á¸¿Ç˜áºÅºá¸§/_,:;'\n    const b = 'aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------'\n    const p = new RegExp(a.split('').join('|'), 'g')\n\n    return text.toString().toLowerCase()\n        .replace(/\\s+/g, '.')           // Replace spaces with \".\"\n        .replace(p, c =>\n            b.charAt(a.indexOf(c)))     // Replace special chars\n        .replace(/&/g, '-and-')         // Replace & with ''\n        // .replace(/[^\\w\\-]+/g, '')       // Remove all non-word chars\n        .replace(/\\-\\-+/g, '-')         // Replace multiple - with single ''\n        .replace(/^-+/, '')             // Trim - from start of text\n        .replace(/-+$/, '')             // Trim - from end of text\n}"]},"sourceType":"module","hash":"020c1fff366974dd6157e53241c6948744e9d81c"}
