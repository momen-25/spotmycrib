{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/momen/projects/spotmycrib-master/server/main.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"server/main.js","filename":"/home/momen/projects/spotmycrib-master/server/main.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/momen/projects/spotmycrib-master","root":"/home/momen/projects/spotmycrib-master","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/momen/projects/spotmycrib-master/server/main.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/main.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nmodule.link(\"../imports/api/publications.js\");\n// import \"../imports/api/properties.js\";\nif (Meteor.isProduction) FlowRouter.setDeferScriptLoading(true);\nvar timeInMillis = 1000 * 300; // 300 secs\n\nString.prototype.replaceAll = function (search, replacement) {\n  var target = this;\n  return target.replace(new RegExp(search, 'g'), replacement);\n};\n\n_hijackWrite = function (res) {\n  var originalWrite = res.write;\n\n  res.write = function (chunk, encoding) {\n    //prevent hijacking other http requests\n    if (!res.iInjected && encoding === undefined && /^<!DOCTYPE html>/.test(chunk)) {\n      chunk = chunk.toString(); // console.log('chunk html '+chunk.substring(0,10))\n\n      chunk = chunk.replace(/<html>/, '<!-- HTML 5 -->\\n<html lang=\"en\">');\n      if (Meteor.isProduction) chunk = chunk.replaceAll('<script type=\"text/javascript\" src', '<script type=\"text/javascript\" async src');\n      res.iInjected = true;\n    }\n\n    originalWrite.call(res, chunk, encoding);\n  };\n};\n\nWebApp.connectHandlers.use(function (req, res, next) {\n  var path = req._parsedUrl.path; // console.log(req._parsedUrl);\n  // console.log(req.headers.host);\n  // console.log(res);\n  ///////Below logic to check if the URL ends with / and remove ending slash unless its a homepage\n\n  var pathname = req._parsedUrl.pathname;\n\n  _hijackWrite(res);\n\n  if (pathname[pathname.length - 1] == '/') {\n    //url ends with tailing /\n    if (pathname != \"/\") {\n      //Its not a home page\n      pathname = pathname.substring(0, pathname.length - 1);\n      var search = req._parsedUrl.search;\n      if (!search) search = \"\";\n      var protocol = 'https://';\n      if (Meteor.isDevelopment) protocol = 'http://';\n      res.writeHead(301, {\n        Location: protocol + req.headers.host + pathname + search\n      });\n      res.end();\n      return;\n    }\n  } // if (req.headers.host == 'localhost:3000') {\n\n\n  if (req.headers.host == 'www.spotmycrib.com') {\n    // temporary redirect - https://en.wikipedia.org/wiki/List_of_HTTP_status_codes\n    res.writeHead(301, {\n      Location: 'https://www.spotmycrib.ie' + path\n    });\n    res.end();\n  } else next.apply();\n}); // if(Meteor.isProduction)\n// WebAppInternals.setBundledJsCssUrlRewriteHook((url) => {\n//     console.log(\"CDN: \"+url)\n//     return `http://d30nklzkhaqiiz.cloudfront.net${url}&_g_app_v_=${process.env.GALAXY_APP_VERSION_ID}`;\n// });\n// if (Meteor.isProduction) {\n\nCDN.config({\n  headers: {\n    \"/\": {\n      \"cache-control\": \"public, max-age: 2592000\"\n    } //30 days in seconds\n\n  }\n}); // }\n\nfunction titleCase(str) {\n  if (!str) return;\n  return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\n\nTemplate.registerHelper(\"titleCase\", function (str) {\n  return titleCase(str);\n}); // Security.permit(['insert', 'update']).collections([Collections.Properties, Collections.Auctions]).ruleChainMethods();\n// Collections.Properties.permit(['insert', 'update']).ifLoggedIn();\n// Collections.Auctions.permit(['insert', 'update']).ifLoggedIn();//, 'remove'\n\nCollections.Properties.allow({\n  insert: function (userId, doc) {\n    var user = Meteor.user();\n\n    if (user.profile.role = 'agent') {\n      return true;\n    }\n\n    return false;\n  },\n  update: function (userId, doc, fields, modifier) {\n    var user = Meteor.user();\n\n    if (userId === doc.createdByAgent) {\n      return true;\n    }\n\n    return false;\n  }\n});\nCollections.Auctions.allow({\n  insert: function (userId, doc, fields, modifier) {\n    var user = Meteor.user();\n\n    if (user.profile.role = 'agent') {\n      return true;\n    }\n\n    return false;\n  },\n  update: function (userId, doc, fields, modifier) {\n    if (userId === doc.createdByAgent) {\n      return true;\n    }\n\n    return false;\n  }\n});\nCollections.PropertyManage.deny({\n  insert() {\n    return true;\n  },\n\n  update() {\n    return false;\n  },\n\n  remove() {\n    return true;\n  }\n\n});\nCollections.ActivityHistory.deny({\n  insert() {\n    return true;\n  },\n\n  update() {\n    return true;\n  },\n\n  remove() {\n    return true;\n  }\n\n});\nMeteor.startup(() => {\n  // code to run on server at startup\n  if (!process.env.MAIL_URL) process.env.MAIL_URL = Meteor.settings[\"galaxy.meteor.com\"]['env']['MAIL_URL'];\n});\nS3.config = {\n  key: 'AKIA5S4UA6UV3RUSZ7XK',\n  secret: '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',\n  bucket: 'spotmycrib',\n  region: 'eu-west-1' // Only needed if not \"us-east-1\" or \"us-standard\"\n\n};","map":{"version":3,"sources":["server/main.js"],"names":["Meteor","module","link","v","isProduction","FlowRouter","setDeferScriptLoading","timeInMillis","String","prototype","replaceAll","search","replacement","target","replace","RegExp","_hijackWrite","res","originalWrite","write","chunk","encoding","iInjected","undefined","test","toString","call","WebApp","connectHandlers","use","req","next","path","_parsedUrl","pathname","length","substring","protocol","isDevelopment","writeHead","Location","headers","host","end","apply","CDN","config","titleCase","str","charAt","toUpperCase","toLowerCase","Template","registerHelper","Collections","Properties","allow","insert","userId","doc","user","profile","role","update","fields","modifier","createdByAgent","Auctions","PropertyManage","deny","remove","ActivityHistory","startup","process","env","MAIL_URL","settings","S3","key","secret","bucket","region"],"mappings":"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","sourcesContent":["import {Meteor} from \"meteor/meteor\";\nimport \"../imports/api/publications.js\";\n// import \"../imports/api/properties.js\";\n\nif(Meteor.isProduction) FlowRouter.setDeferScriptLoading(true);\nvar timeInMillis = 1000 * 300; // 300 secs\n\nString.prototype.replaceAll = function(search, replacement) {\n    var target = this;\n    return target.replace(new RegExp(search, 'g'), replacement);\n};\n_hijackWrite = function(res) {\n    var originalWrite = res.write;\n    res.write = function(chunk, encoding) {\n        //prevent hijacking other http requests\n        if(!res.iInjected &&\n            encoding === undefined && /^<!DOCTYPE html>/.test(chunk)) {\n            chunk = chunk.toString();\n            // console.log('chunk html '+chunk.substring(0,10))\n            chunk = chunk.replace(/<html>/, '<!-- HTML 5 -->\\n<html lang=\"en\">');\n            if(Meteor.isProduction) chunk = chunk.replaceAll('<script type=\"text/javascript\" src', '<script type=\"text/javascript\" async src');\n\n            res.iInjected = true;\n        }\n\n        originalWrite.call(res, chunk, encoding);\n    };\n}\nWebApp.connectHandlers.use(function(req, res, next) {\n    var path = req._parsedUrl.path;\n    // console.log(req._parsedUrl);\n    // console.log(req.headers.host);\n    // console.log(res);\n    ///////Below logic to check if the URL ends with / and remove ending slash unless its a homepage\n    var pathname = req._parsedUrl.pathname\n\n    _hijackWrite(res);\n\n    if ( pathname[pathname.length-1]  == '/') {//url ends with tailing /\n        if(pathname!=\"/\"){//Its not a home page\n            pathname = pathname.substring(0, pathname.length - 1);\n            var search = req._parsedUrl.search;\n            if(!search)search=\"\"\n            var protocol = 'https://'\n            if(Meteor.isDevelopment)protocol = 'http://'\n\n            res.writeHead(301, {Location: protocol+req.headers.host+pathname+search});\n            res.end();\n            return;\n        }\n    }\n    // if (req.headers.host == 'localhost:3000') {\n    if (req.headers.host == 'www.spotmycrib.com') {\n        // temporary redirect - https://en.wikipedia.org/wiki/List_of_HTTP_status_codes\n        res.writeHead(301, {Location: 'https://www.spotmycrib.ie'+path});\n        res.end();\n    }\n    else next.apply();\n});\n\n// if(Meteor.isProduction)\n// WebAppInternals.setBundledJsCssUrlRewriteHook((url) => {\n//     console.log(\"CDN: \"+url)\n//     return `http://d30nklzkhaqiiz.cloudfront.net${url}&_g_app_v_=${process.env.GALAXY_APP_VERSION_ID}`;\n// });\n\n// if (Meteor.isProduction) {\n    CDN.config({\n        headers: {\n            \"/\": { \"cache-control\": \"public, max-age: 2592000\" }//30 days in seconds\n        }\n    });\n// }\n\nfunction titleCase(str){\n    if(!str)return;\n    return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\nTemplate.registerHelper(\"titleCase\",function(str){\n    return titleCase(str);\n});\n// Security.permit(['insert', 'update']).collections([Collections.Properties, Collections.Auctions]).ruleChainMethods();\n// Collections.Properties.permit(['insert', 'update']).ifLoggedIn();\n// Collections.Auctions.permit(['insert', 'update']).ifLoggedIn();//, 'remove'\nCollections.Properties.allow({\n    insert: function (userId, doc) {\n      var user = Meteor.user();\n      if(user.profile.role='agent'){\n          return true;\n      }\n      return false;\n    },\n    update: function (userId, doc, fields, modifier) {\n        var user = Meteor.user();\n        if( userId === doc.createdByAgent) {\n            return true;\n        }\n        return false;\n    }\n});\nCollections.Auctions.allow({\n    insert: function (userId, doc, fields, modifier) {\n        var user = Meteor.user();\n        if(user.profile.role='agent'){\n            return true;\n        }\n        return false;\n    },\n    update: function (userId, doc, fields, modifier){\n        if( userId === doc.createdByAgent) {\n            return true;\n        }\n        return false;\n    }\n});\nCollections.PropertyManage.deny({\n    insert() { return true; },\n    update() { return false; },\n    remove() { return true; },\n});\nCollections.ActivityHistory.deny({\n    insert() { return true; },\n    update() { return true; },\n    remove() { return true; },\n});\n\nMeteor.startup(() => {\n  // code to run on server at startup\n    if(!process.env.MAIL_URL)process.env.MAIL_URL = Meteor.settings[\"galaxy.meteor.com\"]['env']['MAIL_URL'];\n});\n\n\n\nS3.config = {\n    key: 'AKIA5S4UA6UV3RUSZ7XK',\n    secret: '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',\n    bucket: 'spotmycrib',\n    region: 'eu-west-1' // Only needed if not \"us-east-1\" or \"us-standard\"\n};\n\n"]},"sourceType":"module","hash":"fd5872c2caf0fb5954b773abfbd2e537bf9c3d28"}
