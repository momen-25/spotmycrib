{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/momen/projects/spotmycrib-master/imports/ui/templates/propertyApplications.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"imports/ui/templates/propertyApplications.js","filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/propertyApplications.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/momen/projects/spotmycrib-master","root":"/home/momen/projects/spotmycrib-master","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/propertyApplications.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/templates/propertyApplications.js"}},"code":"module.link(\"./pagination.html\");\nmodule.link(\"./propertyApplications.html\");\nlet SimpleSchema;\nmodule.link(\"simpl-schema\", {\n  default(v) {\n    SimpleSchema = v;\n  }\n\n}, 0);\n\n// SimpleSchema.extendOptions(['autoform']);\n// window.deactivateInProgress = '';\nfunction setFilters() {\n  var userFilters = Session.get('userFilters');\n\n  try {\n    if (userFilters.check) {\n      for (var k = 0; k < userFilters.check.length; k++) {\n        if (userFilters.check[k].val == 'all') continue;\n        if (userFilters.check[k].val == 'clearall') continue;\n\n        if (userFilters.check[k].enabled) {\n          $(\".dropdown-menu input[value='\" + userFilters.check[k].val + \"']\").prop('checked', true);\n        }\n\n        dropdownCheckbox();\n      }\n    }\n\n    if (userFilters.s1) {\n      var offerRangeVal = document.getElementById('offerRangeInput');\n      offerRangeVal.noUiSlider.set(userFilters.s1.range);\n    }\n  } catch (e) {}\n\n  dropdownCheckbox();\n}\n\nfunction applyFilters() {\n  // console.log('event applyFilters jquery')\n  var slider = document.getElementById('offerRangeInput');\n  var offerRangeVal = slider.noUiSlider.get();\n  var userFilters = Session.get('userFilters');\n  userFilters.s1.range = offerRangeVal;\n  Session.set('userFilters', userFilters);\n}\n\nfunction applyFilterValues() {\n  // console.log('event applyFiltersValues jquery')\n  var slider = document.getElementById('offerRangeInput');\n  var offerRangeVal = slider.noUiSlider.get();\n  $('.filterS1l').html(numDifferentiation(offerRangeVal[0]));\n  $('.filterS1h').html(numDifferentiation(offerRangeVal[1])); // var userFilters = Session.get('userFilters');\n  // userFilters.s1.range = offerRangeVal;\n  // Session.set('userFilters',userFilters);\n  // $('.filterS2l').html(numDifferentiation(priceRange[0] ))\n  // $('.filterS2h').html(numDifferentiation(priceRange[1] ))\n}\n\nfunction numDifferentiation(val) {\n  if (isNaN(val)) return 0;\n  val = parseInt(val);\n  if (val >= 1000000000) val = (val / 1000000000).toFixed(0) + ' Billion';else if (val >= 1000000) val = (val / 1000000).toFixed(0) + ' Million';else if (val >= 1000) val = val.toFixed(0);else val = val.toFixed(0);\n  return val.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction startUISlider(data) {\n  var slider = document.getElementById('offerRangeInput');\n  noUiSlider.create(slider, {\n    start: data.s1.start,\n    connect: true,\n    step: 1,\n    range: {\n      'min': data.s1.range[0],\n      'max': data.s1.range[1]\n    },\n    format: wNumb({\n      decimals: 0\n    })\n  });\n  slider.noUiSlider.on('update', function () {\n    applyFilterValues();\n  });\n  slider.noUiSlider.on('change', function () {\n    applyFilters();\n  });\n  setTimeout(function () {\n    setFilters();\n  }, 400);\n}\n\nfunction startFilters() {\n  try {\n    var gDefaultFilters = Session.get('gDefaultFilters');\n    var propertyData = Session.get('propertyData');\n\n    if (propertyData.auctionId) {\n      var auction = Collections.Auctions.findOne(propertyData.auctionId);\n      var min = auction.price * 0.7;\n      var max = auction.price * 1.5;\n      gDefaultFilters.s1 = {\n        \"start\": [min, max],\n        \"range\": [min, max]\n      };\n      startUISlider({\n        \"s1\": gDefaultFilters.s1\n      });\n      $('.filterS1l').html(numDifferentiation(min));\n      $('.filterS1h').html(numDifferentiation(max));\n    }\n\n    var userFilters = Session.get('userFilters');\n    var fetchPrevFilters = true;\n    var userFiltersAuctionId = Session.get('userFiltersAuctionId');\n    if (!userFiltersAuctionId) fetchPrevFilters = false;\n    if (userFiltersAuctionId != propertyData.auctionId) fetchPrevFilters = false;\n    if (!userFilters) fetchPrevFilters = false;\n    if (fetchPrevFilters) Session.set('userFilters', userFilters);else Session.set('userFilters', gDefaultFilters);\n    Session.set('userFiltersAuctionId', propertyData.auctionId);\n    dropdownCheckbox();\n    setTimeout(function () {\n      dropdownCheckbox();\n    }, 100);\n    setTimeout(function () {\n      dropdownCheckbox();\n    }, 1000);\n  } catch (e) {\n    // console.log('Catch of startFilters')\n    console.log(e);\n  }\n}\n\nfunction getPaginationData2D(totalResultsCount, resultsPerPage, dimensionNumber) {\n  // Page numbers are 2 dimensional, making it store page numbers of 2 pagination elements on the page.\n  //dimensionNumber tells you on which dimension is this method working on ; should start with 0, 1, 2 like an array numbers.\n  var currentPageNo = FlowRouter.current().params.pageno;\n  let originalPgSplit = null,\n      validOriginalPgSplit = false;\n\n  if (currentPageNo) {\n    originalPgSplit = currentPageNo.toString().split('-');\n\n    if (originalPgSplit.length == 2) {\n      if (!isNaN(originalPgSplit[dimensionNumber])) {\n        currentPageNo = parseInt(originalPgSplit[dimensionNumber]);\n        validOriginalPgSplit = true;\n      }\n    }\n  }\n\n  if (!validOriginalPgSplit) {\n    //invalid originalPgSplit; reset it\n    originalPgSplit = [1, 1];\n  }\n\n  if (!currentPageNo) {\n    currentPageNo = 1;\n  }\n\n  var pages = [],\n      prevPage = {},\n      nextPage = {};\n  var pgMin = currentPageNo - 4,\n      pgMax = currentPageNo + 5,\n      maxPages = Math.ceil(totalResultsCount / resultsPerPage);\n  if (pgMin < 1) pgMin = 1;\n  if (pgMax < 1) pgMax = 1;\n  if (maxPages < 1) maxPages = 1;\n  if (pgMin > maxPages) currentPageNo = maxPages;\n  let tmp = {};\n  var href = '';\n  var cRoute = FlowRouter.current();\n\n  for (var i = pgMin; i <= maxPages; i++) {\n    cRoute.params['pageno'] = dimensionNumber == 0 ? i + '-' + originalPgSplit[1] : originalPgSplit[0] + '-' + i;\n    href = FlowRouter.url(cRoute.route.name, cRoute.params, cRoute.queryParams);\n    tmp = {\n      \"href\": href,\n      \"text\": i\n    };\n\n    if (i == currentPageNo) {\n      tmp['href'] = 'javascript:void(0);';\n      tmp['current'] = true;\n    }\n\n    pages.push(tmp);\n  }\n\n  var prevPageNo = currentPageNo - 1,\n      nextPageNo = currentPageNo + 1;\n\n  if (prevPageNo < 1) {\n    prevPage['href'] = 'javascript:void(0)';\n    prevPage['text'] = 'Previous';\n    prevPage['disabled'] = 'disabled';\n  } else {\n    cRoute.params['pageno'] = dimensionNumber == 0 ? prevPageNo + '-' + originalPgSplit[1] : originalPgSplit[0] + '-' + prevPageNo;\n    prevPage['href'] = FlowRouter.url(cRoute.route.name, cRoute.params, cRoute.queryParams);\n    prevPage['text'] = 'Previous';\n  }\n\n  if (nextPageNo > maxPages) nextPageNo = maxPages;\n\n  if (nextPageNo == currentPageNo) {\n    nextPage['href'] = 'javascript:void(0)';\n    nextPage['text'] = 'Next';\n    nextPage['disabled'] = 'disabled';\n  } else {\n    cRoute.params['pageno'] = dimensionNumber == 0 ? nextPageNo + '-' + originalPgSplit[1] : originalPgSplit[0] + '-' + nextPageNo;\n    nextPage['href'] = FlowRouter.url(cRoute.route.name, cRoute.params, cRoute.queryParams);\n    nextPage['text'] = 'Next';\n  }\n\n  return {\n    \"prevPage\": prevPage,\n    \"pages\": pages,\n    \"nextPage\": nextPage\n  };\n}\n\nfunction numFormat(x) {\n  //var x=12345652457.557;\n  //console.log(x)\n  if (!x) return x;\n  x = x.toString();\n  var afterPoint = '';\n  if (x.indexOf('.') > 0) afterPoint = x.substring(x.indexOf('.'), x.length);\n  afterPoint = afterPoint.substr(0, 3);\n  x = Math.floor(x);\n  x = x.toString();\n  var lastThree = x.substring(x.length - 3);\n  var otherNumbers = x.substring(0, x.length - 3);\n  if (otherNumbers != '') lastThree = ',' + lastThree;\n  var res = otherNumbers.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \",\") + lastThree + afterPoint;\n  return res;\n}\n\nTemplate.propertyApplications.onCreated(function () {\n  this.deactivateInProgress = new ReactiveVar(false);\n  Session.set('propertyData', false);\n  var gDefaultFilters = {};\n  gDefaultFilters.check = [{\n    val: 'empName',\n    label: 'Employer name'\n  }, {\n    val: 'salary',\n    label: 'Salary'\n  }, {\n    val: 'workRef',\n    label: 'Work Reference'\n  }, {\n    val: 'passport',\n    label: 'Passport'\n  }, {\n    val: 'pps',\n    label: 'PPS'\n  }, {\n    val: 'landlordRef',\n    label: 'Landlord Reference'\n  }, {\n    val: 'financialRef',\n    label: 'Financial Reference'\n  }, {\n    val: 'govtID',\n    label: 'Govt. ID'\n  }, {\n    val: 'resume',\n    label: 'Resume'\n  }];\n  gDefaultFilters.s1 = {\n    \"start\": [0, 1000],\n    \"range\": [0, 1000]\n  };\n  Session.set('gDefaultFilters', gDefaultFilters);\n  var instance = this;\n  instance.isSubsLoaded = new ReactiveVar(false);\n  instance.autorun(function () {\n    var pageno = FlowRouter.getParam('pageno');\n    var PAresperpage = 20;\n    var EEresperpage = 100;\n    instance.subscribe('Config');\n    var id = FlowRouter.getParam('id');\n\n    if (id) {\n      instance.subscribe(\"PropertyApplications\", {\n        viewName: 'PropertyApplications.view',\n        pageno: pageno,\n        PAresperpage: PAresperpage,\n        EEresperpage: EEresperpage,\n        id: id\n      });\n      instance.subscribe(\"total-PropertyApplications\", {\n        viewName: 'PropertyApplications.view',\n        pageno: pageno,\n        PAresperpage: PAresperpage,\n        EEresperpage: EEresperpage,\n        id: id\n      });\n      instance.subscribe(\"total-EmailEnquiries\", {\n        viewName: 'PropertyApplications.view',\n        pageno: pageno,\n        PAresperpage: PAresperpage,\n        EEresperpage: EEresperpage,\n        id: id\n      });\n    }\n\n    instance.subscribe('userData');\n\n    if (instance.subscriptionsReady()) {\n      instance.isSubsLoaded.set(true);\n    }\n  }); // var userFilters = Session.get('userFilters');\n  // if(!userFilters)Session.set('gDefaultFilters',gDefaultFilters);\n});\nTemplate.propertyApplications.helpers({\n  isSubsLoaded: function () {\n    return Template.instance().subscriptionsReady();\n  },\n  userLoggedIn: function () {\n    if (Meteor.user()) return true;\n    return false;\n  },\n  avgOffer: function () {\n    var tmp = Collections.PA_AvgOffer.find().fetch();\n\n    if (tmp.length) {\n      var offer = tmp[0]['avgOffer'];\n      if (offer < 1) return 0;\n      return parseInt(offer);\n    } else return false;\n  },\n  dataFull: function () {\n    var propertyData = Session.get('propertyData');\n\n    try {\n      var selector = {\n        auctionId: propertyData.auctionId,\n        isArchived: false\n      }; // var totalResultsCount = Collections.Bids.find(selector).count();\n\n      var totalResultsCount = Counts.get(\"total-PropertyApplications\");\n      clearMeta();\n\n      try {\n        var title = '';\n        if (totalResultsCount > 1) title = totalResultsCount + ' applications';else if (totalResultsCount > 1) title = totalResultsCount + ' applications';else title = 'Applications';\n        title += ' for ' + propertyData.address.address + ', ' + propertyData.address.area;\n        if (propertyData.address.county) title += ', ' + propertyData.address.county;\n        DocHead.setTitle(titleCase(title) + ' | SpotMyCrib Admin');\n        DocHead.addMeta({\n          name: \"description\",\n          content: \"View applications for property \" + propertyData.type + \", choose a winning tenant, see their social profiles and much more.\"\n        });\n      } catch (err) {\n        DocHead.setTitle(' Property not found | SpotMyCrib Admin');\n        DocHead.addMeta({\n          name: \"description\",\n          content: \"\"\n        });\n      }\n\n      return {\n        totalResultsCount: totalResultsCount\n      };\n    } catch (err) {}\n  },\n  dataChosen: function () {\n    var propertyData = Session.get('propertyData');\n\n    if (!propertyData) {\n      console.log(\"Empty project data\");\n      return false;\n    }\n\n    try {\n      var selector = {\n        auctionId: propertyData.auctionId,\n        isArchived: false,\n        chosen: true\n      };\n      globlaAuctionId1 = propertyData.auctionId;\n      globalAuctionData1 = propertyData.auction;\n      var totalChosenCount = Collections.Bids.find(selector).count(); /// don't use the blow code, it doesn't have pagination.\n      // var totalChosenCount = Counts.get(\"total-PropertyApplications\");\n\n      var retChosen = Collections.Bids.find(selector, {\n        transform: function (doc) {\n          doc.auction = Collections.Auctions.findOne({\n            _id: doc.auctionId\n          }); // if (doc.auctionId != globlaAuctionId1 || !globalAuctionData1._id) {\n          //     doc.auction = Collections.Auctions.findOne({\n          //         _id: doc.auctionId\n          //     });\n          // } else {\n          //     doc.auction = globalAuctionData1;\n          // }\n          // doc.user = Meteor.users.findOne({\n          //     _id: doc.userId\n          // });\n\n          return doc;\n        },\n        limit: 100,\n        //Hardcoded logic for now, may be put a max limit of 100 chosen\n        sort: {\n          updatedAt: -1\n        }\n      });\n      return {\n        resultsChosen: retChosen,\n        totalChosenCount: totalChosenCount\n      };\n    } catch (err) {}\n  },\n  dataEmailEnquiries: function () {\n    var propertyData = Session.get('propertyData');\n\n    if (!propertyData) {\n      console.log(\"Empty project data\");\n      return false;\n    }\n\n    try {\n      var selector = {\n        propertyId: propertyData._id,\n        isArchived: false\n      }; /////PAGINATION\n\n      var resultsPerPage = 100;\n      var currentPageNo = FlowRouter.current().params.pageno;\n\n      if (currentPageNo) {\n        let tmp = currentPageNo.toString().split('-');\n\n        if (tmp.length == 2) {\n          if (!isNaN(tmp[1])) currentPageNo = parseInt(tmp[1]);\n        }\n      }\n\n      if (!currentPageNo) {\n        currentPageNo = 1;\n      }\n\n      var skip = (currentPageNo - 1) * resultsPerPage; // var totalEnquiryCount = Collections.EmailEnquiries.find(selector).count();\n\n      var totalEnquiryCount = Counts.get(\"total-EmailEnquiries\");\n      var retChosen = Collections.EmailEnquiries.find(selector, {\n        limit: resultsPerPage,\n        sort: {\n          updatedAt: -1\n        } // skip: skip//not needed as the server would do this.\n\n      });\n      let paginationNeeded = totalEnquiryCount / resultsPerPage > 1.0 ? true : false;\n      return {\n        resultsEnquiries: retChosen,\n        totalEnquiryCount: totalEnquiryCount,\n        pagination: paginationNeeded ? getPaginationData2D(totalEnquiryCount, resultsPerPage, 1) : false,\n        paginationNeede: paginationNeeded\n      };\n    } catch (err) {}\n  },\n  dataNonChosen: function () {\n    var propertyData = Session.get('propertyData');\n    var userFilters = Session.get('userFilters');\n\n    if (!propertyData) {\n      console.log(\"Empty project data\");\n      return false;\n    }\n\n    var selector = {\n      auctionId: propertyData.auctionId,\n      isArchived: false,\n      chosen: false\n    };\n\n    if (userFilters) {\n      if (userFilters.s1.range) selector.yourBid = {\n        $gt: parseInt(userFilters.s1.range[0]),\n        $lt: parseInt(userFilters.s1.range[1])\n      };\n    }\n\n    globlaAuctionId1 = propertyData.auctionId;\n    globalAuctionData1 = propertyData.auction; /////PAGINATION\n\n    var resultsPerPage = 20;\n    var currentPageNo = FlowRouter.current().params.pageno;\n\n    if (currentPageNo) {\n      let tmp = currentPageNo.toString().split('-');\n\n      if (tmp.length == 2) {\n        if (!isNaN(tmp[0])) currentPageNo = parseInt(tmp[0]);\n      }\n    }\n\n    if (!currentPageNo) {\n      currentPageNo = 1;\n    }\n\n    var skip = (currentPageNo - 1) * resultsPerPage;\n    var urlBase = 'account/propertyapplications/' + FlowRouter.current().params.id + '/'; // var totalNonChosenCount = Collections.Bids.find(selector).count();\n\n    var totalNonChosenCount = Counts.get(\"total-PropertyApplications\");\n    var resultsNonChosen = Collections.Bids.find(selector, {\n      transform: function (doc) {\n        doc.userStatic = Meteor.users.findOne({\n          _id: doc.userId\n        });\n        doc.auction = Collections.Auctions.findOne({\n          _id: doc.auctionId\n        }); // if (doc.auctionId != globlaAuctionId1 || !globalAuctionData1._id) {\n        //     doc.auction = Collections.Auctions.findOne({\n        //         _id: doc.auctionId\n        //     });\n        // } else {\n        //     doc.auction = globalAuctionData1;\n        // }\n\n        return doc;\n      },\n      limit: resultsPerPage,\n      sort: {\n        updatedAt: -1\n      } // skip: skip//not needed as the server would do this.\n\n    }).fetch();\n    if (userFilters) if (userFilters.check) {\n      var isItNeeded = true;\n      var countActiveFilters = 0;\n\n      for (var k = 0; k < userFilters.check.length; k++) {\n        if (userFilters.check[k].val == 'all') continue;\n        if (userFilters.check[k].val == 'clearall') continue;\n        if (userFilters.check[k].enabled) countActiveFilters++;\n      }\n\n      if (!countActiveFilters) isItNeeded = false; //if none sel do nothing.\n\n      if (isItNeeded) {\n        var newArr = [];\n        var selSatisfiedCount = 0;\n\n        for (var i = 0; i < resultsNonChosen.length; i++) {\n          selSatisfiedCount = 0;\n          var ele = resultsNonChosen[i];\n          var ref = ele.userStatic.profile.references;\n          if (!ref) break;\n\n          for (var j = 0; j < userFilters.check.length; j++) {\n            if (!userFilters.check[j].enabled) continue; //if not enabled , then don' consider it\n\n            if (userFilters.check[j].val == 'all') continue;\n            if (userFilters.check[j].val == 'clearall') continue;\n\n            if (userFilters.check[j].val == 'empName' && ref.employerName) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'salary' && ref.employerTakeHome) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'workRef' && ref.hasWorkRef) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'passport' && ref.hasPassport) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'pps' && ref.hasPPS) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'landlordRef' && ref.hasLandlordRef) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'financialRef' && ref.hasFinancialRef) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'govtID' && ref.hasGovtID) {\n              selSatisfiedCount++;\n              continue;\n            }\n\n            if (userFilters.check[j].val == 'resume' && ref.hasResume) {\n              selSatisfiedCount++;\n              continue;\n            } // if(userFilters.check[j].val == 'empName' && !user.profile.references.employerName){skip=true;break;}\n            // if(userFilters.check[j].val == 'salary' && !user.profile.references.employerTakeHome){skip=true;break;}\n            // if(userFilters.check[j].val == 'workRef' && !user.profile.references.hasWorkRef){skip=true;break;}\n            // if(userFilters.check[j].val == 'passport' && !user.profile.references.hasPassport){skip=true;break;}\n            // if(userFilters.check[j].val == 'pps' && !user.profile.references.hasPPS){skip=true;break;}\n            // if(userFilters.check[j].val == 'landlordRef' && !user.profile.references.hasLandlordRef){skip=true;break;}\n            // if(userFilters.check[j].val == 'financialRef' && !user.profile.references.hasFinancialRef){skip=true;break;}\n            // if(userFilters.check[j].val == 'govtID' && !user.profile.references.hasGovtID){skip=true;break;}\n            // if(userFilters.check[j].val == 'resume' && !user.profile.references.hasResume){skip=true;break;}\n\n          }\n\n          if (selSatisfiedCount == countActiveFilters) newArr.push(ele); // if (!skip)\n        }\n\n        resultsNonChosen = newArr;\n      }\n    }\n    let paginationNeeded = totalNonChosenCount / resultsPerPage > 1.0 ? true : false;\n    return {\n      resultsNonChosen: resultsNonChosen,\n      totalNonChosenCount: totalNonChosenCount,\n      pagination: paginationNeeded ? getPaginationData2D(totalNonChosenCount, resultsPerPage, 0) : false,\n      paginationNeeded: paginationNeeded\n    };\n  },\n  showFilters: function () {\n    // return true;\n    var propertyData = Session.get('propertyData');\n\n    try {\n      var selector = {\n        auctionId: propertyData.auctionId,\n        isArchived: false\n      }; // var totalResultsCount = Collections.Bids.find(selector).count();\n\n      var totalResultsCount = Counts.get(\"total-PropertyApplications\");\n      if (totalResultsCount > 5) return true;\n    } catch (e) {}\n\n    return false;\n  },\n  initFilters: function () {\n    setTimeout(startFilters, 500);\n  },\n  propertyData: function () {\n    var ret = getpropertyData(); //Now check if he has auctionId passed in query & prop has no auction ID. if yes, update your session\n\n    try {\n      if (FlowRouter.current().params.query.auctionId && !ret.auctionId) ret.auctionId = FlowRouter.current().params.query.auctionId;\n    } catch (e) {}\n\n    if (!ret.auctionId) {\n      var prevRoute = Session.get('prevRoute');\n\n      if (prevRoute) {\n        FlowRouter.go(prevRoute.name, prevRoute.args);\n        Session.set('prevRoute', false);\n      } else {\n        FlowRouter.go(\"/account/myproperies/\", {\n          pageno: 1\n        });\n      }\n    }\n\n    Session.set('propertyData', ret);\n    return ret;\n  },\n  // time: function(){\n  //\n  //     var propertyData = Session.get('propertyData');\n  //     var timestamp = TimeSync.serverTime(null, 30000);\n  //     if(!propertyData.auction.endDate || !timestamp)return;\n  //\n  //\n  //     var dend = Date.parse(propertyData.auction.endDate);\n  //     var timeDiff = dend - timestamp ;\n  //     if(timeDiff<0)return false;\n  //\n  //     var day = Math.floor(timeDiff / (1000 * 3600 * 24))\n  //     var hour = Math.floor(timeDiff / (1000 * 3600 ))\n  //     var min = Math.floor(timeDiff / (1000 * 60 ) )\n  //     hour = hour - (day * 24);\n  //     min = min - (day * 24* 60) - (hour * 60);\n  //     return {\"day\":day,\"hour\":hour,\"min\":min}\n  // },\n  isAuctionClosed: function () {\n    // var timestamp = TimeSync.serverTime(null, 30000);\n    var timestamp = new Date();\n    var propertyData = Session.get('propertyData');\n    var dend = Date.parse(propertyData.auction.endDate);\n    var timeDiff = dend - timestamp;\n\n    if (timeDiff < 0) {\n      return true;\n    }\n\n    return false;\n  },\n  assistanceAlreadyRequested: function () {\n    //Just to make this reactive\n    var user = Meteor.user();\n    if (user) if (user.profile) if (user.profile.assistanceRequested) {\n      return user.profile.assistanceRequested || Session.get('assistanceRequested');\n    }\n    return Session.get('assistanceRequested');\n  },\n  deactivateInProgress: function () {\n    deactivateInProgress = Template.instance().deactivateInProgress;\n    return Template.instance().deactivateInProgress.get();\n  },\n  userFilters: function () {\n    return Session.get('userFilters');\n  }\n});\nTemplate.propertyApplications.onRendered(function () {\n  try {\n    jQuery(\"html,body\").animate({\n      scrollTop: 0\n    }, 250);\n  } catch (e) {\n    document.body.scrollTop = document.documentElement.scrollTop = 0;\n  }\n});\nTemplate.propertyApplications.events({\n  \"click .showEditPropertyForm\": function (event, template) {\n    var prevRoute = {\n      name: FlowRouter.current().route.name,\n      args: {\n        id: FlowRouter.current().params.id,\n        pageno: FlowRouter.current().params.pageno\n      },\n      scrollTo: 'body'\n    };\n    Session.set('prevRoute', prevRoute);\n    var propertyData = Session.get('propertyData');\n    FlowRouter.go('account/editproperty', {\n      id: propertyData._id\n    });\n  },\n  \"click .deactivatePropertyBtn\": function (event, template) {\n    event.preventDefault();\n    var propertyData = Session.get('propertyData');\n\n    if (!propertyData) {\n      console.log(\"Empty project data\");\n      return false;\n    }\n\n    var user = Meteor.user();\n\n    if (!user) {\n      console.log(\"Invalid user\");\n      return;\n    }\n\n    if (propertyData.createdByAgent != user._id) {\n      console.log(\"Invalid user\");\n      return;\n    }\n\n    $.fancybox({\n      'padding': 0,\n      'href': '#conf-dactivate-pop',\n      afterShow: function (template) {\n        attachEvents();\n      },\n      afterClose: function (template) {\n        console.log(template);\n      }\n    });\n  },\n  \"click .backBtn\": function (event, template) {\n    var prevRoute = Session.get('prevRoute');\n\n    if (prevRoute) {\n      FlowRouter.go(prevRoute.name, prevRoute.args);\n      Session.set('prevRoute', false);\n    } else {\n      FlowRouter.go(\"/account/myproperies/\", {\n        pageno: 1\n      });\n    }\n  },\n  \"click .showCopyDlg\": function (event, template) {\n    var propertyData = Session.get('propertyData');\n    let user = Meteor.user();\n    let sluggedName = slugifyEmailAddress(user.profile.name);\n    if (!sluggedName) sluggedName = 'rent';\n    let email = sluggedName + '-let-' + propertyData.auction.lettingAuctionCode.toLowerCase() + \"@spotmycrib.ie\";\n    $('#agentPropertyEmailField').val(email);\n    var url = FlowRouter.url('letting', {\n      key: propertyData.auction.lettingAuctionCode\n    });\n    $('#propertyLinkField').val(url);\n    $.fancybox({\n      'padding': 0,\n      'href': '#propertyLinkDlg',\n      afterShow: function (template) {\n        $('#agentPropertyEmailField').select();\n        $('#propertyLinkDlg .copyEmailBtn').unbind().bind('click', function () {\n          $('#agentPropertyEmailField').select();\n\n          try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful'; // console.log('Copying text command was ' + msg);\n\n            $.fancybox.close();\n          } catch (err) {\n            console.log('Oops, unable to copy');\n          }\n\n          ga('send', 'event', 'propertyApplicationsPage', 'copyShareEmail', 'copyShareEmail Btn Clicked');\n        });\n        $('#propertyLinkDlg .copyLinkBtn').unbind().bind('click', function () {\n          $('#propertyLinkField').select();\n\n          try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful'; // console.log('Copying text command was ' + msg);\n\n            $.fancybox.close();\n          } catch (err) {\n            console.log('Oops, unable to copy');\n          }\n\n          ga('send', 'event', 'propertyApplicationsPage', 'copyShareLink', 'copyShareLink Btn Clicked');\n        });\n        $('#propertyLinkDlg .cancelBtn').unbind().bind('click', function () {\n          $.fancybox.close();\n        });\n      }\n    });\n  },\n  \"click .jns-dropdown-btn\": function (event, template) {\n    $('.jns-dropdown-area').toggle();\n  }\n});\nTemplate.bidList.onCreated(function () {\n  this.choosingInProgress = new ReactiveVar(false);\n  this.unChoosingInProgress = new ReactiveVar(false);\n});\nTemplate.bidList.helpers({\n  user: function () {\n    // debugger;\n    var ret = Meteor.users.find({\n      _id: this.userId\n    }).fetch();\n    return ret[0];\n  },\n  canAfford: function (salary) {\n    //This works based on the bid (not rent)\n    if (!this.yourBid) {\n      return false;\n    }\n\n    if (salary * 0.4 >= this.yourBid) {\n      return true;\n    }\n\n    return false;\n  },\n  choosingInProgress: function () {\n    return Template.instance().choosingInProgress.get();\n  },\n  numDifferentiation: function (data) {\n    return numDifferentiation(data);\n  },\n  classBidList: function () {\n    if (this.chosen) return 'active';\n    var propertyData = Session.get('propertyData');\n\n    try {\n      var a = Collections.Auctions.find({\n        _id: propertyData.auction._id\n      }).fetch();\n      propertyData.auction = a[0];\n      if (propertyData.auction.chosenBids.length) return 'archive';\n    } catch (e) {}\n\n    return 'border-top';\n  }\n});\nTemplate.bidList.events({\n  \"click .chooseTenant\": function (event, template) {\n    template.choosingInProgress.set(true);\n    choosingInProgress = template.choosingInProgress;\n    var r = confirm(\"Are you sure? This will send a confirmation mail to the applicant.\");\n\n    if (!r) {\n      template.choosingInProgress.set(false);\n      return;\n    }\n\n    Meteor.call('chooseWinning', [this.auctionId, this._id], function (error, result) {\n      choosingInProgress.set(false);\n\n      if (error) {\n        console.log(error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(error.error);\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      console.log(\"Success\");\n    });\n  },\n  \"click .unChooseTenant\": function (event, template) {\n    template.unChoosingInProgress.set(true);\n    unChoosingInProgress = template.unChoosingInProgress;\n    var r = confirm(\"Are you sure? This will send a pending mail to the applicant.\");\n\n    if (!r) {\n      template.unChoosingInProgress.set(false);\n      return;\n    }\n\n    Meteor.call('unChooseWinning', [this.auctionId, this._id], function (error, result) {\n      unChoosingInProgress.set(false);\n\n      if (error) {\n        console.log(error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(error.error);\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      console.log(\"Success\");\n    });\n  },\n  \"click .inviteForViewingBtn\": function (event, template) {\n    var propertyData = Session.get('propertyData');\n    var ret = Meteor.users.find({\n      _id: this.userId\n    }).fetch();\n    var inviteForViewing = Session.get('inviteForViewingData');\n    var today = new Date();\n    var tomorrow = new Date();\n    tomorrow.setDate(today.getDate() + 1);\n    tomorrow.setMinutes(0);\n    tomorrow.setSeconds(0);\n    var h = tomorrow.getHours();\n    if (h < 9) h = 9;else if (h > 20) h = 20;\n    tomorrow.setHours(h);\n    var inviteDate = tomorrow;\n\n    try {\n      if (inviteForViewing.inviteDate) inviteDate = inviteForViewing.inviteDate;\n    } catch (e) {}\n\n    Session.set('inviteForViewingData', {\n      user: ret[0],\n      bid: this,\n      inviteDate: inviteDate\n    });\n    $.fancybox({\n      'padding': 0,\n      'href': '#inviteForViewingDlg',\n      afterShow: function () {\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var d = inviteForViewing.inviteDate;\n        var am = ' AM';\n        var df = d.getMonth() + 1 + '/' + d.getDate() + '/' + d.getFullYear() + ' ' + d.getHours() + ':' + d.getMinutes();\n        if (d.getHours() > 12) am = ' PM';\n        df = df + am;\n        $('#inviteDate').val(df);\n      }\n    });\n  }\n});\nTemplate.emailEnquiryList.onCreated(function () {\n  this.choosingInProgress = new ReactiveVar(false);\n  this.unChoosingInProgress = new ReactiveVar(false);\n});\nTemplate.emailEnquiryList.helpers({\n  user: function () {\n    // debugger;\n    var ret = Meteor.users.find({\n      _id: this.userId\n    }).fetch();\n    return ret[0];\n  },\n  canAfford: function (salary) {\n    //This works based on the bid (not rent)\n    if (!this.yourBid) {\n      return false;\n    }\n\n    if (salary * 0.4 >= this.yourBid) {\n      return true;\n    }\n\n    return false;\n  },\n  choosingInProgress: function () {\n    return Template.instance().choosingInProgress.get();\n  },\n  numDifferentiation: function (data) {\n    return numDifferentiation(data);\n  },\n  classBidList: function () {\n    if (this.chosen) return 'active';\n    var propertyData = Session.get('propertyData');\n\n    try {\n      var a = Collections.Auctions.find({\n        _id: propertyData.auction._id\n      }).fetch();\n      propertyData.auction = a[0];\n      if (propertyData.auction.chosenBids.length) return 'archive';\n    } catch (e) {}\n\n    return 'border-top';\n  }\n});\nTemplate.emailEnquiryList.events({\n  \"click .inviteForViewingBtn\": function (event, template) {\n    var propertyData = Session.get('propertyData');\n    var ret = Meteor.users.find({\n      _id: this.userId\n    }).fetch();\n    var inviteForViewing = Session.get('inviteForViewingData');\n    var today = new Date();\n    var tomorrow = new Date();\n    tomorrow.setDate(today.getDate() + 1);\n    tomorrow.setMinutes(0);\n    tomorrow.setSeconds(0);\n    var h = tomorrow.getHours();\n    if (h < 9) h = 9;else if (h > 20) h = 20;\n    tomorrow.setHours(h);\n    var inviteDate = tomorrow;\n\n    try {\n      if (inviteForViewing.inviteDate) inviteDate = inviteForViewing.inviteDate;\n    } catch (e) {}\n\n    Session.set('inviteForViewingData', {\n      user: ret[0],\n      bid: this,\n      inviteDate: inviteDate\n    });\n    $.fancybox({\n      'padding': 0,\n      'href': '#inviteForViewingDlg',\n      afterShow: function () {\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var d = inviteForViewing.inviteDate;\n        var am = ' AM';\n        var df = d.getMonth() + 1 + '/' + d.getDate() + '/' + d.getFullYear() + ' ' + d.getHours() + ':' + d.getMinutes();\n        if (d.getHours() > 12) am = ' PM';\n        df = df + am;\n        $('#inviteDate').val(df);\n      }\n    });\n  }\n});\ninviteInProgress = '';\nTemplate.inviteForViewing.onCreated(function () {\n  this.inviteInProgress = new ReactiveVar(false);\n  inviteInProgress = this.inviteInProgress;\n});\nTemplate.inviteForViewing.helpers({\n  data: function () {\n    return Session.get('inviteForViewingData');\n  },\n  inviteInProgress: function () {\n    inviteInProgress = Template.instance().inviteInProgress;\n    return Template.instance().inviteInProgress.get();\n  },\n  inviteDateFormated: function () {\n    var inviteForViewing = Session.get('inviteForViewingData');\n    var options = {\n      weekday: \"long\",\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\"\n    };\n\n    try {\n      var d = inviteForViewing.inviteDate;\n      return d.toLocaleTimeString(\"en-us\", options);\n    } catch (e) {}\n\n    return;\n  },\n  propertyData: function () {\n    return Session.get('propertyData');\n  }\n});\nTemplate.inviteForViewing.events({\n  'change .inviteDate': function (event, template) {\n    var d = new Date($('.inviteDate').val());\n    var inviteForViewing = Session.get('inviteForViewingData');\n\n    try {\n      inviteForViewing.inviteDate = d;\n      Session.set('inviteForViewingData', inviteForViewing);\n    } catch (e) {}\n  },\n  'click .confirmInviteBtn': function () {\n    var inviteDate = $('.inviteDate').val();\n    var inviteMessage = $('.inviteMessage').val();\n    console.log(inviteDate);\n    var inviteForViewing = Session.get('inviteForViewingData');\n    inviteInProgress.set(true);\n    Meteor.call('sendInviteForViewingEmail', [inviteForViewing.bid._id, inviteDate], function (error, result) {\n      inviteInProgress.set(false);\n\n      if (error) {\n        console.log(error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(\"Failed applying. Please try again, try checking your internet connectivity. Contact us if needed.\");\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      if (result.status == 'Success') {\n        console.log(\"Success\");\n        closePopupEvent();\n      }\n    });\n  },\n  'click .closePopupBtn': function () {\n    closePopupEvent();\n  }\n});\nTemplate.inviteForViewing.onRendered(function () {\n  //Needs to be optimised, this is not the right place to put this code, might cause JS errors if Jquery isn' loaded yet.\n  try {\n    this.$('#inviteDate').datetimepicker();\n    this.$('#moveindate').datetimepicker();\n  } catch (err) {\n    console.log('dp failed');\n  }\n});\n\nfunction attachEvents() {\n  $(\".deactivateConfirmBtn\").unbind().bind(\"click\", function () {\n    deactivateConfEvent();\n  });\n  $(\".closePopupBtn\").unbind().bind(\"click\", function () {\n    closePopupEvent();\n  });\n}\n\nfunction deactivateConfEvent() {\n  var data = Session.get(\"propertyData\");\n  var auctionId = data.auctionId;\n  deactivateInProgress.set(true);\n  Meteor.call('deactivateAuction', auctionId, function (error, result) {\n    deactivateInProgress.set(false);\n\n    if (error) {\n      console.log(error);\n      var tmp = Session.get(\"showErrorDlg\");\n      if (!tmp) tmp = [];\n      tmp.push(\"Failed deactivating. Please try again, try checking your internet connectivity. Contact us if needed.\");\n      Session.set(\"showErrorDlg\", tmp);\n      return;\n    }\n\n    console.log(\"Success\");\n    closePopupEvent();\n    var prevRoute = Session.get('prevRoute');\n\n    if (prevRoute) {\n      FlowRouter.go(prevRoute.name, prevRoute.args);\n      Session.set('prevRoute', false);\n    } else {\n      FlowRouter.go(\"/account/myproperies/\", {\n        pageno: 1\n      });\n    }\n  });\n}\n\nfunction closePopupEvent() {\n  console.log('closePopupEvent');\n  if ($) if ($.fancybox) $.fancybox.close();\n}\n\nfunction getpropertyData() {\n  var id = FlowRouter.current().params.id;\n  var ret = Collections.Properties.find(id, {\n    transform: function (data) {\n      data.auction = Collections.Auctions.findOne(data.auctionId); // data.applicationsReceivedCount = Collections.Bids.find({auctionId:data.auctionId}).count();\n\n      data.applicationsReceivedCount = Counts.get(\"total-PropertyApplications\");\n      data.applicationsActiveCount = Counts.get(\"total-PropertyApplications\"); //Removing the diff between active and total received for now. date jan 9, 2019\n      // data.applicationsActiveCount = Collections.Bids.find({auctionId:data.auctionId,isArchived:false}).count();\n\n      data.chosenApplicationCount = Collections.Bids.find({\n        auctionId: data.auctionId,\n        isArchived: false,\n        chosen: true\n      }).count();\n      return data;\n    },\n    limit: 1\n  }).fetch();\n  Meteor.subscribe('avgOffer', ret[0].auctionId);\n  return ret[0];\n}\n\nfunction titleCase(str) {\n  if (!str) return;\n  return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\n\nfunction dropdownCheckbox() {\n  $('.dropdown-menu .checkbox').unbind().on('click', function (event) {\n    var $target = $(event.currentTarget),\n        val = $target.find('input').attr('value'),\n        $inp = $target.find('input'),\n        idx;\n    var userFilters = Session.get('userFilters');\n\n    if (val == 'all') {\n      setTimeout(function () {\n        $('.dropdown-menu input').not(\"[value='clearall']\").prop('checked', true);\n        dropdownCheckbox();\n      }, 10);\n\n      if (userFilters) {\n        for (var i = 0; i < userFilters.check.length; i++) {\n          userFilters.check[i].enabled = \"enabled\";\n        }\n\n        Session.set('userFilters', userFilters);\n      }\n\n      $(event.target).blur();\n      return false;\n    }\n\n    if (val == 'clearall') {\n      setTimeout(function () {\n        $('.dropdown-menu input').prop('checked', false);\n        dropdownCheckbox();\n      }, 10);\n\n      if (userFilters) {\n        for (var i = 0; i < userFilters.check.length; i++) {\n          userFilters.check[i].enabled = \"\";\n        }\n\n        Session.set('userFilters', userFilters);\n      }\n\n      $(event.target).blur();\n      return false;\n    }\n\n    if ($($inp).prop('checked')) {\n      $($inp).prop('checked', false);\n\n      if (userFilters.check) {\n        for (var i = 0; i < userFilters.check.length; i++) {\n          if (userFilters.check[i].val == val) userFilters.check[i].enabled = \"\";\n        }\n      }\n    } else {\n      $($inp).prop('checked', true);\n\n      if (userFilters.check) {\n        for (var i = 0; i < userFilters.check.length; i++) {\n          if (userFilters.check[i].val == val) userFilters.check[i].enabled = \"enabled\";\n        }\n      }\n    } // if ( ( idx = options.indexOf( val ) ) > -1 ) {\n    //     options.splice( idx, 1 );\n    //     setTimeout( function() { $inp.prop( 'checked', false ) }, 0);\n    //     if(userFilters.check){\n    //         for(var i=0;i<userFilters.check.length;i++){\n    //             if(userFilters.check[i].val == val)userFilters.check[i].enabled=\"\";\n    //         }\n    //     }\n    // } else {\n    //     options.push( val );\n    //     setTimeout( function() { $inp.prop( 'checked', true ) }, 0);\n    //     if(userFilters.check){\n    //         for(var i=0;i<userFilters.check.length;i++){\n    //             if(userFilters.check[i].val == val)userFilters.check[i].enabled=\"enabled\";\n    //         }\n    //     }\n    // }\n\n\n    if (userFilters) {\n      Session.set('userFilters', userFilters);\n    }\n\n    $(event.target).blur();\n    dropdownCheckbox(); // console.log( options );\n\n    return false;\n  });\n}\n\nfunction slugifyEmailAddress(text) {\n  if (!text) return '';\n  const a = 'àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ/_,:;';\n  const b = 'aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------';\n  const p = new RegExp(a.split('').join('|'), 'g');\n  return text.toString().toLowerCase().replace(/\\s+/g, '.') // Replace spaces with \".\"\n  .replace(p, c => b.charAt(a.indexOf(c))) // Replace special chars\n  .replace(/&/g, '-and-') // Replace & with ''\n  // .replace(/[^\\w\\-]+/g, '')       // Remove all non-word chars\n  .replace(/\\-\\-+/g, '-') // Replace multiple - with single ''\n  .replace(/^-+/, '') // Trim - from start of text\n  .replace(/-+$/, ''); // Trim - from end of text\n}","map":{"version":3,"sources":["imports/ui/templates/propertyApplications.js"],"names":["module","link","SimpleSchema","default","v","setFilters","userFilters","Session","get","check","k","length","val","enabled","$","prop","dropdownCheckbox","s1","offerRangeVal","document","getElementById","noUiSlider","set","range","e","applyFilters","slider","applyFilterValues","html","numDifferentiation","isNaN","parseInt","toFixed","toString","replace","startUISlider","data","create","start","connect","step","format","wNumb","decimals","on","setTimeout","startFilters","gDefaultFilters","propertyData","auctionId","auction","Collections","Auctions","findOne","min","price","max","fetchPrevFilters","userFiltersAuctionId","console","log","getPaginationData2D","totalResultsCount","resultsPerPage","dimensionNumber","currentPageNo","FlowRouter","current","params","pageno","originalPgSplit","validOriginalPgSplit","split","pages","prevPage","nextPage","pgMin","pgMax","maxPages","Math","ceil","tmp","href","cRoute","i","url","route","name","queryParams","push","prevPageNo","nextPageNo","numFormat","x","afterPoint","indexOf","substring","substr","floor","lastThree","otherNumbers","res","Template","propertyApplications","onCreated","deactivateInProgress","ReactiveVar","label","instance","isSubsLoaded","autorun","getParam","PAresperpage","EEresperpage","subscribe","id","viewName","subscriptionsReady","helpers","userLoggedIn","Meteor","user","avgOffer","PA_AvgOffer","find","fetch","offer","dataFull","selector","isArchived","Counts","clearMeta","title","address","area","county","DocHead","setTitle","titleCase","addMeta","content","type","err","dataChosen","chosen","globlaAuctionId1","globalAuctionData1","totalChosenCount","Bids","count","retChosen","transform","doc","_id","limit","sort","updatedAt","resultsChosen","dataEmailEnquiries","propertyId","skip","totalEnquiryCount","EmailEnquiries","paginationNeeded","resultsEnquiries","pagination","paginationNeede","dataNonChosen","yourBid","$gt","$lt","urlBase","totalNonChosenCount","resultsNonChosen","userStatic","users","userId","isItNeeded","countActiveFilters","newArr","selSatisfiedCount","ele","ref","profile","references","j","employerName","employerTakeHome","hasWorkRef","hasPassport","hasPPS","hasLandlordRef","hasFinancialRef","hasGovtID","hasResume","showFilters","initFilters","ret","getpropertyData","query","prevRoute","go","args","isAuctionClosed","timestamp","Date","dend","parse","endDate","timeDiff","assistanceAlreadyRequested","assistanceRequested","onRendered","jQuery","animate","scrollTop","body","documentElement","events","event","template","scrollTo","preventDefault","createdByAgent","fancybox","afterShow","attachEvents","afterClose","sluggedName","slugifyEmailAddress","email","lettingAuctionCode","toLowerCase","key","select","unbind","bind","successful","execCommand","msg","close","ga","toggle","bidList","choosingInProgress","unChoosingInProgress","canAfford","salary","classBidList","a","chosenBids","r","confirm","call","error","result","inviteForViewing","today","tomorrow","setDate","getDate","setMinutes","setSeconds","h","getHours","setHours","inviteDate","bid","d","am","df","getMonth","getFullYear","getMinutes","emailEnquiryList","inviteInProgress","inviteDateFormated","options","weekday","year","month","day","hour","minute","toLocaleTimeString","inviteMessage","status","closePopupEvent","datetimepicker","deactivateConfEvent","Properties","applicationsReceivedCount","applicationsActiveCount","chosenApplicationCount","str","charAt","toUpperCase","$target","currentTarget","attr","$inp","idx","not","target","blur","text","b","p","RegExp","join","c"],"mappings":"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","sourcesContent":["import \"./pagination.html\";\nimport \"./propertyApplications.html\";\nimport SimpleSchema from \"simpl-schema\";\n// SimpleSchema.extendOptions(['autoform']);\n// window.deactivateInProgress = '';\n\n\nfunction setFilters(){\n    var userFilters = Session.get('userFilters');\n    try {\n        if (userFilters.check) {\n            for (var k = 0; k < userFilters.check.length; k++) {\n                if (userFilters.check[k].val == 'all')continue;\n                if (userFilters.check[k].val == 'clearall')continue;\n                if (userFilters.check[k].enabled) {\n                    $(\".dropdown-menu input[value='\" + userFilters.check[k].val + \"']\").prop('checked', true);\n                }\n                dropdownCheckbox();\n            }\n        }\n        if (userFilters.s1) {\n            var offerRangeVal = document.getElementById('offerRangeInput');\n            offerRangeVal.noUiSlider.set(userFilters.s1.range);\n        }\n    }catch (e){}\n    dropdownCheckbox();\n}\nfunction applyFilters(){\n    // console.log('event applyFilters jquery')\n    var slider = document.getElementById('offerRangeInput');\n    var offerRangeVal = slider.noUiSlider.get();\n    var userFilters = Session.get('userFilters');\n    userFilters.s1.range = offerRangeVal;\n    Session.set('userFilters',userFilters);\n}\nfunction applyFilterValues(){\n    // console.log('event applyFiltersValues jquery')\n    var slider = document.getElementById('offerRangeInput');\n    var offerRangeVal = slider.noUiSlider.get();\n    $('.filterS1l').html(numDifferentiation(offerRangeVal[0]))\n    $('.filterS1h').html(numDifferentiation(offerRangeVal[1]))\n    // var userFilters = Session.get('userFilters');\n    // userFilters.s1.range = offerRangeVal;\n    // Session.set('userFilters',userFilters);\n    // $('.filterS2l').html(numDifferentiation(priceRange[0] ))\n    // $('.filterS2h').html(numDifferentiation(priceRange[1] ))\n\n}\nfunction numDifferentiation(val) {\n    if(isNaN(val))return 0;\n    val = parseInt(val);\n    if(val >= 1000000000) val = (val/1000000000).toFixed(0) + ' Billion';\n    else if(val >= 1000000) val = (val/1000000).toFixed(0) + ' Million';\n    else if(val >= 1000) val = val.toFixed(0) ;\n    else val = val.toFixed(0);\n    return val.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction startUISlider(data){\n    var slider = document.getElementById('offerRangeInput');\n\n    noUiSlider.create(slider, {\n\n        start: data.s1.start,\n\n        connect: true,\n\n        step: 1,\n\n        range: {\n\n            'min': data.s1.range[0],\n\n            'max': data.s1.range[1]\n\n        },\n\n        format: wNumb({\n\n            decimals: 0\n\n        })\n\n    });\n\n    slider.noUiSlider.on('update', function(){\n        applyFilterValues();\n    });\n    slider.noUiSlider.on('change', function(){\n        applyFilters();\n    });\n    setTimeout(function () {setFilters();},400)\n}\nfunction startFilters(){\n    try{\n    var gDefaultFilters = Session.get('gDefaultFilters');\n\n    var propertyData = Session.get('propertyData');\n    if(propertyData.auctionId){\n        var auction = Collections.Auctions.findOne(propertyData.auctionId)\n        var min = auction.price*0.7\n        var max = auction.price*1.5\n        gDefaultFilters.s1 = {\n            \"start\": [min, max],\n            \"range\": [min, max]\n        }\n        startUISlider({\n            \"s1\":gDefaultFilters.s1\n        });\n        $('.filterS1l').html(numDifferentiation(min))\n        $('.filterS1h').html(numDifferentiation(max))\n    }\n\n    var userFilters = Session.get('userFilters');\n    var fetchPrevFilters = true;\n\n    var userFiltersAuctionId = Session.get('userFiltersAuctionId');\n    if(!userFiltersAuctionId)fetchPrevFilters=false;\n    if(userFiltersAuctionId != propertyData.auctionId)fetchPrevFilters=false;\n\n    if(!userFilters)fetchPrevFilters=false;\n\n    if(fetchPrevFilters) Session.set('userFilters',userFilters);\n    else Session.set('userFilters',gDefaultFilters);\n\n    Session.set('userFiltersAuctionId',propertyData.auctionId);\n\n    dropdownCheckbox();\n    setTimeout(function () {dropdownCheckbox();},100)\n    setTimeout(function () {dropdownCheckbox();},1000)\n    }catch(e){\n        // console.log('Catch of startFilters')\n        console.log(e)\n    }\n}\nfunction getPaginationData2D(totalResultsCount,resultsPerPage,dimensionNumber){\n    // Page numbers are 2 dimensional, making it store page numbers of 2 pagination elements on the page.\n    //dimensionNumber tells you on which dimension is this method working on ; should start with 0, 1, 2 like an array numbers.\n    var currentPageNo = FlowRouter.current().params.pageno;\n    let originalPgSplit = null, validOriginalPgSplit = false;\n    if(currentPageNo){\n        originalPgSplit = currentPageNo.toString().split('-')\n        if(originalPgSplit.length==2){\n            if(!isNaN(originalPgSplit[dimensionNumber])){ currentPageNo = parseInt(originalPgSplit[dimensionNumber]); validOriginalPgSplit = true;}\n        }\n    }\n    if(!validOriginalPgSplit){//invalid originalPgSplit; reset it\n        originalPgSplit = [1,1]\n    }\n    if(!currentPageNo){currentPageNo = 1}\n    var pages = [], prevPage = {}, nextPage={};\n    var pgMin = currentPageNo-4, pgMax = currentPageNo+ 5, maxPages = Math.ceil(totalResultsCount/resultsPerPage);\n    if(pgMin<1)pgMin =1;\n    if(pgMax<1)pgMax =1;\n    if(maxPages<1)maxPages =1;\n    if(pgMin>maxPages)currentPageNo =maxPages;\n    let tmp={};\n    var href = '';\n\n    var cRoute = FlowRouter.current();\n\n    for (var i=pgMin; i<=maxPages;i++){\n        cRoute.params['pageno'] = (dimensionNumber==0 ? i+'-'+originalPgSplit[1] : originalPgSplit[0]+'-'+i ) ;\n        href = FlowRouter.url(cRoute.route.name,cRoute.params,cRoute.queryParams)\n        tmp = {\n            \"href\": href,\n            \"text\": i\n        }\n        if(i== currentPageNo) {\n            tmp['href'] = 'javascript:void(0);';\n            tmp['current'] = true;\n        }\n        pages.push(tmp)\n    }\n    var prevPageNo = currentPageNo- 1, nextPageNo=currentPageNo+ 1;\n    if(prevPageNo<1){\n        prevPage['href'] = 'javascript:void(0)';\n        prevPage['text'] = 'Previous';\n        prevPage['disabled'] = 'disabled';\n    }else{\n        cRoute.params['pageno'] = (dimensionNumber==0 ? prevPageNo+'-'+originalPgSplit[1] : originalPgSplit[0]+'-'+prevPageNo ) ;\n        prevPage['href'] = FlowRouter.url(cRoute.route.name,cRoute.params,cRoute.queryParams)\n        prevPage['text'] = 'Previous';\n    }\n    if(nextPageNo>maxPages)nextPageNo =maxPages;\n    if(nextPageNo == currentPageNo){\n        nextPage['href'] = 'javascript:void(0)';\n        nextPage['text'] = 'Next';\n        nextPage['disabled'] = 'disabled';\n    }else{\n        cRoute.params['pageno'] = (dimensionNumber==0 ? nextPageNo+'-'+originalPgSplit[1] : originalPgSplit[0]+'-'+nextPageNo ) ;\n        nextPage['href'] = FlowRouter.url(cRoute.route.name,cRoute.params,cRoute.queryParams)\n        nextPage['text'] = 'Next';\n    }\n    return {\n        \"prevPage\":prevPage,\n        \"pages\":pages,\n        \"nextPage\": nextPage\n    }\n}\n\n\nfunction numFormat(x) {\n    //var x=12345652457.557;\n    //console.log(x)\n    if(!x)return x;\n    x=x.toString();\n    var afterPoint = '';\n    if(x.indexOf('.') > 0)\n        afterPoint = x.substring(x.indexOf('.'),x.length);\n    afterPoint = afterPoint.substr(0,3);\n    x = Math.floor(x);\n    x=x.toString();\n    var lastThree = x.substring(x.length-3);\n    var otherNumbers = x.substring(0,x.length-3);\n    if(otherNumbers != '')\n        lastThree = ',' + lastThree;\n    var res = otherNumbers.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \",\") + lastThree + afterPoint;\n    return res;\n}\n\n\n\nTemplate.propertyApplications.onCreated(function(){\n    this.deactivateInProgress = new ReactiveVar( false );\n    Session.set('propertyData',false);\n\n    var gDefaultFilters = {}\n    gDefaultFilters.check = [\n        {val:'empName',label:'Employer name'},\n        {val:'salary',label:'Salary'},\n        {val:'workRef',label:'Work Reference'},\n        {val:'passport',label:'Passport'},\n        {val:'pps',label:'PPS'},\n        {val:'landlordRef',label:'Landlord Reference'},\n        {val:'financialRef',label:'Financial Reference'},\n        {val:'govtID',label:'Govt. ID'},\n        {val:'resume',label:'Resume'}\n    ];\n    gDefaultFilters.s1 = {\n        \"start\": [0, 1000],\n        \"range\": [0, 1000]\n    }\n    Session.set('gDefaultFilters',gDefaultFilters);\n\n    var instance = this;\n    instance.isSubsLoaded = new ReactiveVar(false);\n    instance.autorun(function(){\n\n        var pageno = FlowRouter.getParam('pageno');\n        var PAresperpage = 20\n        var EEresperpage = 100\n\n        instance.subscribe('Config');\n        var id = FlowRouter.getParam('id');\n        if(id){\n            instance.subscribe(\"PropertyApplications\",{viewName: 'PropertyApplications.view',pageno:pageno,PAresperpage:PAresperpage,EEresperpage:EEresperpage,id:id}) ;\n            instance.subscribe(\"total-PropertyApplications\",{viewName: 'PropertyApplications.view',pageno:pageno,PAresperpage:PAresperpage,EEresperpage:EEresperpage,id:id}) ;\n            instance.subscribe(\"total-EmailEnquiries\",{viewName: 'PropertyApplications.view',pageno:pageno,PAresperpage:PAresperpage,EEresperpage:EEresperpage,id:id}) ;\n        }\n\n        instance.subscribe('userData');\n\n        if(instance.subscriptionsReady()){\n            instance.isSubsLoaded.set(true)\n        }\n    })\n    // var userFilters = Session.get('userFilters');\n    // if(!userFilters)Session.set('gDefaultFilters',gDefaultFilters);\n\n})\nTemplate.propertyApplications.helpers({\n    isSubsLoaded:function(){\n        return Template.instance().subscriptionsReady();\n    },\n    userLoggedIn:function(){\n        if(Meteor.user())return true;\n        return false;\n    },\n    avgOffer : function () {\n        var tmp = Collections.PA_AvgOffer.find().fetch();\n        if(tmp.length) {\n            var offer = tmp[0]['avgOffer'];\n            if(offer<1)return 0;\n            return parseInt(offer);\n        }\n        else return false;\n    },\n    dataFull : function () {\n\n        var propertyData = Session.get('propertyData');\n\n        try {\n            var selector = {\n                auctionId: propertyData.auctionId,\n                isArchived: false\n            }\n\n            // var totalResultsCount = Collections.Bids.find(selector).count();\n            var totalResultsCount = Counts.get(\"total-PropertyApplications\");\n\n            clearMeta();\n            try{\n                var title = '';\n                if (totalResultsCount > 1) title = totalResultsCount + ' applications';\n                else if (totalResultsCount > 1) title = totalResultsCount + ' applications';\n                else title = 'Applications';\n                title += ' for ' + propertyData.address.address + ', ' + propertyData.address.area;\n\n                if (propertyData.address.county) title += ', ' + propertyData.address.county;\n\n\n                DocHead.setTitle(titleCase(title) + ' | SpotMyCrib Admin');\n                DocHead.addMeta({\n                    name: \"description\",\n                    content: \"View applications for property \" + propertyData.type + \", choose a winning tenant, see their social profiles and much more.\"\n                });\n            }catch(err){\n                DocHead.setTitle(' Property not found | SpotMyCrib Admin');\n                DocHead.addMeta({name: \"description\", content: \"\"});\n            }\n            return {\n                totalResultsCount: totalResultsCount\n            };\n        }catch (err){}\n    },\n    dataChosen : function () {\n        var propertyData = Session.get('propertyData');\n        if(!propertyData){\n            console.log(\"Empty project data\");\n            return false;}\n        try {\n            var selector = {\n                auctionId: propertyData.auctionId,\n                isArchived: false,\n                chosen:true\n            }\n\n            globlaAuctionId1 = propertyData.auctionId;\n            globalAuctionData1 = propertyData.auction\n\n            var totalChosenCount = Collections.Bids.find(selector).count();/// don't use the blow code, it doesn't have pagination.\n            // var totalChosenCount = Counts.get(\"total-PropertyApplications\");\n            var retChosen = Collections.Bids.find(selector, {\n                transform: function (doc) {\n\n                    doc.auction = Collections.Auctions.findOne({\n                        _id: doc.auctionId\n                    });\n                    // if (doc.auctionId != globlaAuctionId1 || !globalAuctionData1._id) {\n                    //     doc.auction = Collections.Auctions.findOne({\n                    //         _id: doc.auctionId\n                    //     });\n                    // } else {\n                    //     doc.auction = globalAuctionData1;\n                    // }\n\n                    // doc.user = Meteor.users.findOne({\n                    //     _id: doc.userId\n                    // });\n\n\n                    return doc;\n                },\n                limit: 100,//Hardcoded logic for now, may be put a max limit of 100 chosen\n                sort: {updatedAt: -1}\n            });\n\n            return {\n                resultsChosen: retChosen,\n                totalChosenCount: totalChosenCount\n            };\n        }catch (err){}\n    },\n    dataEmailEnquiries : function () {\n        var propertyData = Session.get('propertyData');\n        if(!propertyData){\n            console.log(\"Empty project data\");\n            return false;}\n        try {\n            var selector = {\n                propertyId: propertyData._id,\n                isArchived: false\n            }\n\n            /////PAGINATION\n            var resultsPerPage = 100\n            var currentPageNo = FlowRouter.current().params.pageno;\n            if(currentPageNo){\n                let tmp = currentPageNo.toString().split('-')\n                if(tmp.length==2){\n                    if(!isNaN(tmp[1])) currentPageNo = parseInt(tmp[1])\n                }\n            }\n            if(!currentPageNo){currentPageNo = 1}\n            var skip = (currentPageNo -1) * resultsPerPage;\n\n            // var totalEnquiryCount = Collections.EmailEnquiries.find(selector).count();\n            var totalEnquiryCount = Counts.get(\"total-EmailEnquiries\");\n            var retChosen = Collections.EmailEnquiries.find(selector, {\n                limit: resultsPerPage,\n                sort: { updatedAt : -1 }\n                // skip: skip//not needed as the server would do this.\n            });\n\n            let paginationNeeded=(totalEnquiryCount/resultsPerPage > 1.0? true : false);\n\n            return {\n                resultsEnquiries: retChosen,\n                totalEnquiryCount: totalEnquiryCount,\n                pagination: (paginationNeeded ? getPaginationData2D(totalEnquiryCount,resultsPerPage,1) : false ),\n                paginationNeede: paginationNeeded\n            };\n        }catch (err){}\n    },\n    dataNonChosen : function () {\n\n        var propertyData = Session.get('propertyData');\n        var userFilters = Session.get('userFilters');\n        if(!propertyData){\n            console.log(\"Empty project data\");\n            return false;}\n\n        var selector = {\n            auctionId: propertyData.auctionId,\n            isArchived: false,\n            chosen:false\n        }\n        if(userFilters){\n            if(userFilters.s1.range)selector.yourBid =  { $gt: parseInt(userFilters.s1.range[0]), $lt: parseInt(userFilters.s1.range[1]) }\n        }\n\n        globlaAuctionId1 = propertyData.auctionId;\n        globalAuctionData1 = propertyData.auction;\n        /////PAGINATION\n        var resultsPerPage = 20;\n        var currentPageNo = FlowRouter.current().params.pageno;\n        if(currentPageNo){\n            let tmp = currentPageNo.toString().split('-')\n            if(tmp.length==2){\n                if(!isNaN(tmp[0])) currentPageNo = parseInt(tmp[0])\n            }\n        }\n        if(!currentPageNo){currentPageNo = 1}\n        var skip = (currentPageNo -1) * resultsPerPage;\n        var urlBase = 'account/propertyapplications/'+FlowRouter.current().params.id+'/';\n\n\n\n        // var totalNonChosenCount = Collections.Bids.find(selector).count();\n        var totalNonChosenCount = Counts.get(\"total-PropertyApplications\");\n        var resultsNonChosen = Collections.Bids.find(selector, {\n            transform: function (doc) {\n\n                doc.userStatic =  Meteor.users.findOne({_id: doc.userId});\n\n                doc.auction = Collections.Auctions.findOne({\n                    _id: doc.auctionId\n                });\n                // if (doc.auctionId != globlaAuctionId1 || !globalAuctionData1._id) {\n                //     doc.auction = Collections.Auctions.findOne({\n                //         _id: doc.auctionId\n                //     });\n                // } else {\n                //     doc.auction = globalAuctionData1;\n                // }\n\n                return doc;\n            },\n            limit: resultsPerPage,\n            sort: { updatedAt : -1 }\n            // skip: skip//not needed as the server would do this.\n        }).fetch();\n\n        if(userFilters)\n        if(userFilters.check){\n            var isItNeeded=true;var countActiveFilters = 0;\n            for(var k=0;k<userFilters.check.length;k++){\n                if (userFilters.check[k].val == 'all' )continue;\n                if (userFilters.check[k].val == 'clearall' )continue;\n                if(userFilters.check[k].enabled)countActiveFilters++;\n            }\n            if(!countActiveFilters)isItNeeded=false;//if none sel do nothing.\n\n            if(isItNeeded) {\n                var newArr = [];\n                var selSatisfiedCount = 0;\n                for (var i = 0; i < resultsNonChosen.length; i++) {\n                    selSatisfiedCount = 0\n                    var ele = resultsNonChosen[i];\n                    var ref = ele.userStatic.profile.references;\n                    if (!ref)break;\n\n\n                    for (var j = 0; j < userFilters.check.length; j++) {\n                        if (!userFilters.check[j].enabled)continue;//if not enabled , then don' consider it\n                        if (userFilters.check[j].val == 'all' )continue;\n                        if (userFilters.check[j].val == 'clearall' )continue;\n                        if (userFilters.check[j].val == 'empName' && ref.employerName) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'salary' && ref.employerTakeHome) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'workRef' && ref.hasWorkRef) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'passport' && ref.hasPassport) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'pps' && ref.hasPPS) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'landlordRef' && ref.hasLandlordRef) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'financialRef' && ref.hasFinancialRef) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'govtID' && ref.hasGovtID) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        if (userFilters.check[j].val == 'resume' && ref.hasResume) {\n                            selSatisfiedCount++;\n                            continue;\n                        }\n                        // if(userFilters.check[j].val == 'empName' && !user.profile.references.employerName){skip=true;break;}\n                        // if(userFilters.check[j].val == 'salary' && !user.profile.references.employerTakeHome){skip=true;break;}\n                        // if(userFilters.check[j].val == 'workRef' && !user.profile.references.hasWorkRef){skip=true;break;}\n                        // if(userFilters.check[j].val == 'passport' && !user.profile.references.hasPassport){skip=true;break;}\n                        // if(userFilters.check[j].val == 'pps' && !user.profile.references.hasPPS){skip=true;break;}\n                        // if(userFilters.check[j].val == 'landlordRef' && !user.profile.references.hasLandlordRef){skip=true;break;}\n                        // if(userFilters.check[j].val == 'financialRef' && !user.profile.references.hasFinancialRef){skip=true;break;}\n                        // if(userFilters.check[j].val == 'govtID' && !user.profile.references.hasGovtID){skip=true;break;}\n                        // if(userFilters.check[j].val == 'resume' && !user.profile.references.hasResume){skip=true;break;}\n\n                    }\n                    if(selSatisfiedCount==countActiveFilters)newArr.push(ele);\n                    // if (!skip)\n                }\n                resultsNonChosen = newArr;\n            }\n        }\n\n        let paginationNeeded=(totalNonChosenCount/resultsPerPage > 1.0? true : false);\n\n        return {\n            resultsNonChosen: resultsNonChosen,\n            totalNonChosenCount: totalNonChosenCount,\n            pagination: (paginationNeeded ? getPaginationData2D(totalNonChosenCount,resultsPerPage,0) : false ),\n            paginationNeeded: paginationNeeded\n        };\n\n    },\n    showFilters: function(){\n        // return true;\n        var propertyData = Session.get('propertyData');\n        try {\n            var selector = {\n                auctionId: propertyData.auctionId,\n                isArchived: false\n            }\n            // var totalResultsCount = Collections.Bids.find(selector).count();\n            var totalResultsCount = Counts.get(\"total-PropertyApplications\");\n            if(totalResultsCount>5)return true;\n        }catch(e){}\n        return false;\n    },\n    initFilters:function(){\n        setTimeout(startFilters,500);\n    },\n    propertyData : function () {\n        var ret = getpropertyData();\n\n        //Now check if he has auctionId passed in query & prop has no auction ID. if yes, update your session\n        try{if(FlowRouter.current().params.query.auctionId && !ret.auctionId)ret.auctionId = FlowRouter.current().params.query.auctionId}catch(e){}\n\n        if(!ret.auctionId){\n            var prevRoute = Session.get('prevRoute');\n            if(prevRoute){\n                FlowRouter.go(prevRoute.name,prevRoute.args)\n                Session.set('prevRoute',false);\n            }else{\n                FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n            }\n        }\n\n        Session.set('propertyData',ret);\n\n        return ret;\n    },\n    // time: function(){\n    //\n    //     var propertyData = Session.get('propertyData');\n    //     var timestamp = TimeSync.serverTime(null, 30000);\n    //     if(!propertyData.auction.endDate || !timestamp)return;\n    //\n    //\n    //     var dend = Date.parse(propertyData.auction.endDate);\n    //     var timeDiff = dend - timestamp ;\n    //     if(timeDiff<0)return false;\n    //\n    //     var day = Math.floor(timeDiff / (1000 * 3600 * 24))\n    //     var hour = Math.floor(timeDiff / (1000 * 3600 ))\n    //     var min = Math.floor(timeDiff / (1000 * 60 ) )\n    //     hour = hour - (day * 24);\n    //     min = min - (day * 24* 60) - (hour * 60);\n    //     return {\"day\":day,\"hour\":hour,\"min\":min}\n    // },\n    isAuctionClosed:function(){\n        // var timestamp = TimeSync.serverTime(null, 30000);\n        var timestamp = new Date();\n        var propertyData = Session.get('propertyData');\n        var dend = Date.parse(propertyData.auction.endDate);\n        var timeDiff = dend - timestamp;\n        if(timeDiff<0){\n            return true;\n        }\n        return false;\n    },\n    assistanceAlreadyRequested: function(){\n        //Just to make this reactive\n        var user = Meteor.user();\n        if(user)\n            if(user.profile)\n                if(user.profile.assistanceRequested){\n                    return user.profile.assistanceRequested || Session.get('assistanceRequested');\n                }\n\n        return Session.get('assistanceRequested');\n\n    },\n    deactivateInProgress: function(){\n        deactivateInProgress = Template.instance().deactivateInProgress;\n        return Template.instance().deactivateInProgress.get() ;\n    },\n    userFilters:function(){\n        return Session.get('userFilters');\n    }\n})\n\nTemplate.propertyApplications.onRendered(function() {\n    try{\n        jQuery(\"html,body\").animate({scrollTop: 0}, 250);\n    }catch(e){\n        document.body.scrollTop = document.documentElement.scrollTop = 0;\n    }\n})\nTemplate.propertyApplications.events({\n    \"click .showEditPropertyForm\": function (event, template) {\n        var prevRoute = {name: FlowRouter.current().route.name,args:{id:FlowRouter.current().params.id, pageno:FlowRouter.current().params.pageno},scrollTo:'body' }\n        Session.set('prevRoute',prevRoute);\n        var propertyData = Session.get('propertyData');\n        FlowRouter.go('account/editproperty',{id:propertyData._id})\n\n    },\n    \"click .deactivatePropertyBtn\": function (event, template) {\n        event.preventDefault();\n        var propertyData = Session.get('propertyData');\n        if(!propertyData){\n            console.log(\"Empty project data\");\n            return false;}\n        var user = Meteor.user();\n        if(!user){console.log(\"Invalid user\");return;}\n        if(propertyData.createdByAgent != user._id){console.log(\"Invalid user\");return;}\n\n        $.fancybox({\n            'padding': 0,\n            'href': '#conf-dactivate-pop',\n            afterShow:function(template){\n                attachEvents();\n            },\n            afterClose:function(template){\n                console.log(template);\n            }\n        })\n    },\n    \"click .backBtn\": function(event, template){\n        var prevRoute = Session.get('prevRoute');\n        if(prevRoute){\n            FlowRouter.go(prevRoute.name,prevRoute.args)\n            Session.set('prevRoute',false);\n        }else{\n            FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n        }\n    },\n    \"click .showCopyDlg\": function (event, template) {\n        var propertyData = Session.get('propertyData');\n\n        let user = Meteor.user();\n        let sluggedName = slugifyEmailAddress(user.profile.name);\n        if(!sluggedName)sluggedName = 'rent'\n        let email = sluggedName+'-let-'+propertyData.auction.lettingAuctionCode.toLowerCase()+\"@spotmycrib.ie\";\n        $('#agentPropertyEmailField').val(email);\n\n        var url = FlowRouter.url('letting',{key:propertyData.auction.lettingAuctionCode})\n        $('#propertyLinkField').val(url);\n        $.fancybox({\n            'padding': 0,\n            'href': '#propertyLinkDlg',\n            afterShow:function(template){\n                $('#agentPropertyEmailField').select();\n                $('#propertyLinkDlg .copyEmailBtn').unbind().bind('click',function () {\n                    $('#agentPropertyEmailField').select();\n\n                    try {\n                        var successful = document.execCommand('copy');\n                        var msg = successful ? 'successful' : 'unsuccessful';\n                        // console.log('Copying text command was ' + msg);\n                        $.fancybox.close()\n                    } catch (err) {\n                        console.log('Oops, unable to copy');\n                    }\n                    ga('send', 'event', 'propertyApplicationsPage', 'copyShareEmail', 'copyShareEmail Btn Clicked');\n                })\n                $('#propertyLinkDlg .copyLinkBtn').unbind().bind('click',function () {\n                    $('#propertyLinkField').select();\n\n                    try {\n                        var successful = document.execCommand('copy');\n                        var msg = successful ? 'successful' : 'unsuccessful';\n                        // console.log('Copying text command was ' + msg);\n                        $.fancybox.close()\n                    } catch (err) {\n                        console.log('Oops, unable to copy');\n                    }\n                    ga('send', 'event', 'propertyApplicationsPage', 'copyShareLink', 'copyShareLink Btn Clicked');\n                })\n                $('#propertyLinkDlg .cancelBtn').unbind().bind('click',function () {\n                    $.fancybox.close()\n                })\n            },\n        });\n\n    },\n    \"click .jns-dropdown-btn\": function (event, template) {\n        $('.jns-dropdown-area').toggle();\n    },\n})\n\nTemplate.bidList.onCreated(function(){\n    this.choosingInProgress = new ReactiveVar( false );\n    this.unChoosingInProgress = new ReactiveVar( false );\n})\nTemplate.bidList.helpers({\n    user:function(){\n        // debugger;\n        var ret = Meteor.users.find({\n            _id: this.userId\n        }).fetch();\n        return ret[0];\n    },\n    canAfford: function(salary){//This works based on the bid (not rent)\n        if( !this.yourBid){return false;}\n        if(salary*0.4 >= this.yourBid ){\n            return true;\n        }\n        return false;\n    },\n    choosingInProgress: function(){\n        return Template.instance().choosingInProgress.get() ;\n    },\n    numDifferentiation: function(data){\n        return numDifferentiation(data);\n    },\n    classBidList:function () {\n        if(this.chosen)return 'active';\n\n        var propertyData = Session.get('propertyData');\n        try {\n            var a = Collections.Auctions.find({_id:propertyData.auction._id}).fetch();\n            propertyData.auction = a[0];\n            if (propertyData.auction.chosenBids.length)return 'archive';\n        }catch (e){}\n        return 'border-top';\n    }\n})\nTemplate.bidList.events({\n    \"click .chooseTenant\": function (event, template) {\n        template.choosingInProgress.set(true);\n        choosingInProgress = template.choosingInProgress\n\n        var r = confirm(\"Are you sure? This will send a confirmation mail to the applicant.\");\n        if (!r){ template.choosingInProgress.set(false);return;}\n\n        Meteor.call('chooseWinning', [this.auctionId, this._id], function(error, result){\n            choosingInProgress.set(false) ;\n            if(error){\n                console.log(error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(error.error);\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n            console.log(\"Success\");\n\n\n        });\n    },\n    \"click .unChooseTenant\": function (event, template) {\n        template.unChoosingInProgress.set(true);\n        unChoosingInProgress = template.unChoosingInProgress\n\n        var r = confirm(\"Are you sure? This will send a pending mail to the applicant.\");\n        if (!r){ template.unChoosingInProgress.set(false);return;}\n\n        Meteor.call('unChooseWinning', [this.auctionId, this._id], function(error, result){\n            unChoosingInProgress.set(false) ;\n            if(error){\n                console.log(error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(error.error);\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n            console.log(\"Success\");\n        });\n    },\n    \"click .inviteForViewingBtn\": function (event, template) {\n        var propertyData = Session.get('propertyData');\n        var ret = Meteor.users.find({\n            _id: this.userId\n        }).fetch();\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var today = new Date();\n        var tomorrow = new Date();\n        tomorrow.setDate(today.getDate()+1);tomorrow.setMinutes(0);tomorrow.setSeconds(0);\n        var h = tomorrow.getHours();\n        if(h<9)h=9;else if(h>20)h=20;\n        tomorrow.setHours(h);\n        var inviteDate = tomorrow;\n        try{if(inviteForViewing.inviteDate)inviteDate = inviteForViewing.inviteDate;}catch(e){}\n        Session.set('inviteForViewingData',{user:ret[0],bid:this,inviteDate:inviteDate})\n        $.fancybox({\n            'padding': 0,\n            'href': '#inviteForViewingDlg',\n            afterShow:function () {\n                var inviteForViewing = Session.get('inviteForViewingData');\n                var d = inviteForViewing.inviteDate;var am = ' AM';\n                var df = (d.getMonth()+1)+'/'+d.getDate()+'/'+d.getFullYear()+' '+d.getHours()+':'+d.getMinutes()\n                if(d.getHours()>12)am = ' PM';\n                df = df+am;\n                $('#inviteDate').val(df)\n\n            }\n        });\n    },\n});\nTemplate.emailEnquiryList.onCreated(function(){\n    this.choosingInProgress = new ReactiveVar( false );\n    this.unChoosingInProgress = new ReactiveVar( false );\n})\nTemplate.emailEnquiryList.helpers({\n    user:function(){\n        // debugger;\n        var ret = Meteor.users.find({\n            _id: this.userId\n        }).fetch();\n        return ret[0];\n    },\n    canAfford: function(salary){//This works based on the bid (not rent)\n        if( !this.yourBid){return false;}\n        if(salary*0.4 >= this.yourBid ){\n            return true;\n        }\n        return false;\n    },\n    choosingInProgress: function(){\n        return Template.instance().choosingInProgress.get() ;\n    },\n    numDifferentiation: function(data){\n        return numDifferentiation(data);\n    },\n    classBidList:function () {\n        if(this.chosen)return 'active';\n\n        var propertyData = Session.get('propertyData');\n        try {\n            var a = Collections.Auctions.find({_id:propertyData.auction._id}).fetch();\n            propertyData.auction = a[0];\n            if (propertyData.auction.chosenBids.length)return 'archive';\n        }catch (e){}\n        return 'border-top';\n    }\n})\nTemplate.emailEnquiryList.events({\n    \"click .inviteForViewingBtn\": function (event, template) {\n        var propertyData = Session.get('propertyData');\n        var ret = Meteor.users.find({\n            _id: this.userId\n        }).fetch();\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var today = new Date();\n        var tomorrow = new Date();\n        tomorrow.setDate(today.getDate()+1);tomorrow.setMinutes(0);tomorrow.setSeconds(0);\n        var h = tomorrow.getHours();\n        if(h<9)h=9;else if(h>20)h=20;\n        tomorrow.setHours(h);\n        var inviteDate = tomorrow;\n        try{if(inviteForViewing.inviteDate)inviteDate = inviteForViewing.inviteDate;}catch(e){}\n        Session.set('inviteForViewingData',{user:ret[0],bid:this,inviteDate:inviteDate})\n        $.fancybox({\n            'padding': 0,\n            'href': '#inviteForViewingDlg',\n            afterShow:function () {\n                var inviteForViewing = Session.get('inviteForViewingData');\n                var d = inviteForViewing.inviteDate;var am = ' AM';\n                var df = (d.getMonth()+1)+'/'+d.getDate()+'/'+d.getFullYear()+' '+d.getHours()+':'+d.getMinutes()\n                if(d.getHours()>12)am = ' PM';\n                df = df+am;\n                $('#inviteDate').val(df)\n\n            }\n        });\n    },\n});\n\ninviteInProgress='';\nTemplate.inviteForViewing.onCreated(function () {\n    this.inviteInProgress = new ReactiveVar( false );\n    inviteInProgress = this.inviteInProgress;\n})\nTemplate.inviteForViewing.helpers({\n    data:function () {\n        return Session.get('inviteForViewingData');\n    },\n    inviteInProgress:function () {\n        inviteInProgress = Template.instance().inviteInProgress ;\n        return Template.instance().inviteInProgress.get() ;\n    },\n    inviteDateFormated:function () {\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var options = {\n            weekday: \"long\", year: \"numeric\", month: \"short\",\n            day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\"\n        };\n        try{var d=inviteForViewing.inviteDate; return d.toLocaleTimeString(\"en-us\", options); }catch(e){}\n        return ;\n    },\n    propertyData:function () {\n        return  Session.get('propertyData');\n    },\n})\nTemplate.inviteForViewing.events({\n    'change .inviteDate':function (event, template) {\n        var d = new Date($('.inviteDate').val());\n        var inviteForViewing = Session.get('inviteForViewingData');\n        try{ inviteForViewing.inviteDate=d; Session.set('inviteForViewingData',inviteForViewing) }catch(e){}\n\n    },\n    'click .confirmInviteBtn':function () {\n\n        var inviteDate = $('.inviteDate').val()\n        var inviteMessage = $('.inviteMessage').val()\n        console.log(inviteDate)\n        var inviteForViewing = Session.get('inviteForViewingData');\n\n\n        inviteInProgress.set(true) ;\n        Meteor.call('sendInviteForViewingEmail',[inviteForViewing.bid._id,inviteDate],function(error, result){\n            inviteInProgress.set(false) ;\n            if(error){\n                console.log(error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(\"Failed applying. Please try again, try checking your internet connectivity. Contact us if needed.\");\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n            if(result.status=='Success'){\n                console.log(\"Success\");\n                closePopupEvent()\n            }\n        });\n\n    },\n    'click .closePopupBtn':function () {\n        closePopupEvent()\n    }\n})\nTemplate.inviteForViewing.onRendered(function () {\n    //Needs to be optimised, this is not the right place to put this code, might cause JS errors if Jquery isn' loaded yet.\n    try{\n        this.$('#inviteDate').datetimepicker();\n\n\n\n        this.$('#moveindate').datetimepicker();\n    }catch(err){\n        console.log('dp failed');\n    }\n})\nfunction attachEvents() {\n    $(\".deactivateConfirmBtn\").unbind().bind(\"click\",function () {\n        deactivateConfEvent();\n    })\n    $(\".closePopupBtn\").unbind().bind(\"click\",function () {\n        closePopupEvent();\n    })\n}\nfunction deactivateConfEvent() {\n    var data = Session.get(\"propertyData\");\n    var auctionId = data.auctionId;\n\n    deactivateInProgress.set(true) ;\n    Meteor.call('deactivateAuction',auctionId,function(error, result){\n        deactivateInProgress.set(false) ;\n        if(error){\n            console.log(error);\n            var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n            tmp.push(\"Failed deactivating. Please try again, try checking your internet connectivity. Contact us if needed.\");\n            Session.set(\"showErrorDlg\",tmp)\n            return;\n        }\n        console.log(\"Success\");\n\n        closePopupEvent();\n        var prevRoute = Session.get('prevRoute');\n        if(prevRoute){\n            FlowRouter.go(prevRoute.name,prevRoute.args)\n            Session.set('prevRoute',false);\n        }else{\n            FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n        }\n\n    });\n}\nfunction closePopupEvent() {\n    console.log('closePopupEvent');\n    if($)\n        if($.fancybox)\n            $.fancybox.close();\n}\nfunction getpropertyData(){\n    var id = FlowRouter.current().params.id;\n    var ret = Collections.Properties.find(id, {\n        transform: function(data){\n\n            data.auction = Collections.Auctions.findOne(data.auctionId);\n            // data.applicationsReceivedCount = Collections.Bids.find({auctionId:data.auctionId}).count();\n            data.applicationsReceivedCount = Counts.get(\"total-PropertyApplications\");\n            data.applicationsActiveCount = Counts.get(\"total-PropertyApplications\");//Removing the diff between active and total received for now. date jan 9, 2019\n            // data.applicationsActiveCount = Collections.Bids.find({auctionId:data.auctionId,isArchived:false}).count();\n            data.chosenApplicationCount = Collections.Bids.find({auctionId:data.auctionId,isArchived:false,chosen:true}).count();\n\n            return data;\n        },\n        limit: 1\n    }).fetch();\n\n    Meteor.subscribe('avgOffer', ret[0].auctionId);\n\n    return ret[0];\n}\nfunction titleCase(str){\n    if(!str)return;\n    return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\nfunction dropdownCheckbox(){\n\n    $( '.dropdown-menu .checkbox' ).unbind().on( 'click', function( event ) {\n\n        var $target = $( event.currentTarget ),\n            val = $target.find( 'input' ).attr( 'value' ),\n            $inp = $target.find( 'input' ),\n            idx;\n        var userFilters = Session.get('userFilters');\n\n        if(val == 'all'){\n            setTimeout( function() { $( '.dropdown-menu input' ).not(\"[value='clearall']\").prop( 'checked',true );dropdownCheckbox(); }, 10);\n            if(userFilters){\n                for(var i=0;i<userFilters.check.length;i++){\n                    userFilters.check[i].enabled=\"enabled\";\n                }\n                Session.set('userFilters',userFilters);\n            }\n            $( event.target ).blur();\n            return false;\n        }\n        if(val == 'clearall'){\n            setTimeout( function() { $( '.dropdown-menu input' ).prop( 'checked',false );dropdownCheckbox(); }, 10);\n            if(userFilters){\n                for(var i=0;i<userFilters.check.length;i++){\n                    userFilters.check[i].enabled=\"\";\n                }\n                Session.set('userFilters',userFilters);\n            }\n            $( event.target ).blur();\n            return false;\n        }\n        if($($inp).prop( 'checked')){\n            $($inp).prop( 'checked',false );\n            if(userFilters.check){\n                for(var i=0;i<userFilters.check.length;i++){\n                    if(userFilters.check[i].val == val)userFilters.check[i].enabled=\"\";\n                }\n            }\n        }else{\n            $($inp).prop( 'checked',true );\n            if(userFilters.check){\n                for(var i=0;i<userFilters.check.length;i++){\n                    if(userFilters.check[i].val == val)userFilters.check[i].enabled=\"enabled\";\n                }\n            }\n        }\n\n\n\n        // if ( ( idx = options.indexOf( val ) ) > -1 ) {\n        //     options.splice( idx, 1 );\n        //     setTimeout( function() { $inp.prop( 'checked', false ) }, 0);\n        //     if(userFilters.check){\n        //         for(var i=0;i<userFilters.check.length;i++){\n        //             if(userFilters.check[i].val == val)userFilters.check[i].enabled=\"\";\n        //         }\n        //     }\n        // } else {\n        //     options.push( val );\n        //     setTimeout( function() { $inp.prop( 'checked', true ) }, 0);\n        //     if(userFilters.check){\n        //         for(var i=0;i<userFilters.check.length;i++){\n        //             if(userFilters.check[i].val == val)userFilters.check[i].enabled=\"enabled\";\n        //         }\n        //     }\n        // }\n\n        if(userFilters){\n            Session.set('userFilters',userFilters);\n        }\n        $( event.target ).blur();\n        dropdownCheckbox();\n        // console.log( options );\n        return false;\n    });\n}\nfunction slugifyEmailAddress (text) {\n    if(!text)return '';\n    const a = 'àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ/_,:;'\n    const b = 'aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------'\n    const p = new RegExp(a.split('').join('|'), 'g')\n\n    return text.toString().toLowerCase()\n        .replace(/\\s+/g, '.')           // Replace spaces with \".\"\n        .replace(p, c =>\n            b.charAt(a.indexOf(c)))     // Replace special chars\n        .replace(/&/g, '-and-')         // Replace & with ''\n        // .replace(/[^\\w\\-]+/g, '')       // Remove all non-word chars\n        .replace(/\\-\\-+/g, '-')         // Replace multiple - with single ''\n        .replace(/^-+/, '')             // Trim - from start of text\n        .replace(/-+$/, '')             // Trim - from end of text\n}"]},"sourceType":"module","hash":"470ffa87e8bf27f0e92aff1fa41717c5a14ff663"}
