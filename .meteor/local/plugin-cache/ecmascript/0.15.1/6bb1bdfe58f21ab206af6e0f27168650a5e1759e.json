{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/momen/projects/spotmycrib-master/imports/ui/templates/profile.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"imports/ui/templates/profile.js","filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/profile.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/momen/projects/spotmycrib-master","root":"/home/momen/projects/spotmycrib-master","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/profile.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/templates/profile.js"}},"code":"module.link(\"./profile.html\");\n// import \"./accounts/helpers.js\";\n// import \"./accounts/validation.js\";\nvar _validFileExtensions = [\".jpg\", \".jpeg\", \".png\", \".pdf\", \".txt\", \".doc\", \".docx\", \".ODT\"];\n\nfunction filevalidation(arrInputs) {\n  for (var i = 0; i < arrInputs.length; i++) {\n    var oInput = arrInputs[i];\n    var sFileName = oInput.name;\n\n    if (sFileName.length > 0) {\n      var blnValid = false;\n\n      for (var j = 0; j < _validFileExtensions.length; j++) {\n        var sCurExtension = _validFileExtensions[j];\n\n        if (sFileName.substr(sFileName.length - sCurExtension.length, sCurExtension.length).toLowerCase() == sCurExtension.toLowerCase()) {\n          blnValid = true;\n          break;\n        }\n      }\n\n      if (!blnValid) {\n        // alert(\"Sorry, \" + sFileName + \" is invalid, allowed extensions are: \" + _validFileExtensions.join(\", \"));\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\nTemplate.profile.onCreated(function () {\n  var instance = this;\n  instance.isSubsLoaded = new ReactiveVar(false);\n  instance.autorun(function () {\n    instance.subscribe('userData');\n\n    if (instance.subscriptionsReady()) {\n      var data = Accounts.user();\n\n      try {\n        if (data.profile.isPublic && data.profile.username) {\n          console.log(''); // FlowRouter.redirect('tenant',{username:data.profile.username})\n        }\n      } catch (e) {\n        console.log(e);\n      }\n\n      instance.isSubsLoaded.set(true);\n    }\n  });\n});\nTemplate.profile.helpers({\n  isSubsLoaded: function () {\n    return Template.instance().subscriptionsReady();\n  },\n  userLoggedIn: function () {\n    if (Meteor.user()) return true;\n    return false;\n  }\n});\nTemplate.userProfile.onCreated(function () {\n  this.privacyTermsMore = new ReactiveVar(false);\n  this.hasPasswordSet = new ReactiveVar(false);\n  this.hasPasswordSetReqCompleted = new ReactiveVar(false);\n});\nTemplate.userProfile.helpers({\n  \"data\": function () {\n    var data = Accounts.user(); // console.log(data);\n\n    var city = ''; // profile.files.has\n    // if(data)\n    // if(data.profile)\n    // if(data.profile.addressBook)\n    // if(data.profile.addressBook.length){\n    //   city = data.profile.addressBook[0].city\n    // }\n\n    clearMeta();\n\n    try {\n      DocHead.setTitle(titleCase(data.profile.name) + '\\'s profile | SpotMyCrib');\n      DocHead.addMeta({\n        name: \"description\",\n        content: \"Upload and manage your references.\"\n      });\n    } catch (err) {\n      DocHead.setTitle(' User not found | SpotMyCrib');\n      DocHead.addMeta({\n        name: \"description\",\n        content: \"\"\n      });\n    }\n\n    return {\n      \"userData\": data,\n      \"userCity\": city,\n      \"userEmail\": data.profile.email,\n      \"userEmailVerified\": data.profile.emailVerified\n    };\n  },\n  backBtnNeeded: function () {\n    var prevRoute = Session.get('prevRoute');\n\n    try {\n      if (FlowRouter.current().route.name != prevRoute.name) return true;\n    } catch (e) {}\n\n    return false;\n  },\n  prevRoute: function () {\n    return Session.get('prevRoute');\n  },\n  isPublicProfileSelectYes: function () {\n    var user = Meteor.user();\n\n    try {\n      if (user.profile.isPublic) {\n        return 'selected';\n      }\n    } catch (e) {}\n\n    return '';\n  },\n  isPublicProfileSelectNo: function () {\n    var user = Meteor.user();\n\n    try {\n      if (!user.profile.isPublic) {\n        return 'selected';\n      }\n    } catch (e) {}\n\n    return '';\n  },\n  progress: function () {\n    var user = Meteor.user();\n    var score = 0;\n    var css = 'progress-bar-danger';\n    var issues = [];\n\n    if (user.profile.mobile) {\n      score += 15;\n    } else {\n      issues.push('Mobile number is required. Landlord needs to contact you.');\n    }\n\n    if (!user.services) user.services = {};\n\n    if (user.services.facebook) {\n      score += 15;\n    } else {\n      issues.push('Connect with your Facebook profile. Its shows your social presence.');\n    } // if(user.services.google){score += 10;}else{issues.push('Connect with your google profile. Its shows your social presence.')}//No weightage\n\n\n    if (user.services.twitter) {\n      score += 10;\n    } else {\n      issues.push('Connect with your Twitter profile. Its shows your social presence.');\n    }\n\n    if (user.services.linkedin) {\n      score += 15;\n    } else {\n      issues.push('Connect with your LinkedIn profile. Its shows your professional presence.');\n    }\n\n    if (user.profile.references.hasPassport) {\n      score += 10;\n    } else {\n      issues.push('Passport is required. Its your legal identity card.');\n    }\n\n    if (user.profile.references.employerName) {\n      score += 3;\n    } else {\n      issues.push('Name of your employer is recommended. It can highlight your profile to landlord.');\n    }\n\n    if (user.profile.references.employerTakeHome) {\n      score += 2;\n    } else {\n      issues.push('Monthly take home salary is recommended. It can act as your finantial reference.');\n    }\n\n    if (user.profile.references.hasWorkRef) {\n      score += 10;\n    } else {\n      issues.push('Work reference is required. It shows your professional side.');\n    }\n\n    if (user.profile.references.hasLandlordRef) {\n      score += 10;\n    } else {\n      issues.push('Landlord reference is required. ');\n    }\n\n    if (user.profile.references.hasPPS) {\n      score += 3;\n    } else {\n      issues.push('PPS is recommended. Its your legal identity card.');\n    } // if(user.profile.references.hasFinancialRef){score += 0;}else{issues.push('Financial reference if work reference is not given.')}\n\n\n    if (user.profile.references.hasGovtID) {\n      score += 4;\n    } else {\n      issues.push('Govt ID is recommended. Driving license or GNIB as your identity card.');\n    }\n\n    if (user.profile.references.hasResume) {\n      score += 3;\n    } else {\n      issues.push('Resume is recommended. It shows your professional side.');\n    }\n\n    if (score > 100) score = 100;\n    if (score > 50) css = 'progress-bar-warning';\n    if (score > 70) css = 'progress-bar-info';\n    if (score > 90) css = 'progress-bar-success';\n    return {\n      css: css,\n      percent: score + \"%\",\n      issues: issues\n    };\n  },\n  privacyTermsMore: function () {\n    return Template.instance().privacyTermsMore.get();\n  },\n  showFileTemplate: function () {\n    return Session.get('showFileTemplate');\n  },\n  showHideFileDlg: function () {\n    console.log(\"Event showHideFileDlg\");\n    var ses = Session.get('showFileDlg');\n\n    if (ses) {\n      if (ses.show) {\n        $.fancybox({\n          'padding': 0,\n          'href': '#fileupload-dlg',\n          width: '80%',\n          afterShow: function () {\n            Session.set('showFileTemplate', true);\n          },\n          afterClose: function () {\n            var ses = {\n              show: false,\n              cate: \"\"\n            };\n            Session.set('showFileDlg', ses); // Has the overall info and basic required info.\n\n            Session.set('showFileTemplate', false);\n          }\n        });\n        return true;\n      } else if (ses.show == false) {\n        try {\n          $.fancybox.close();\n        } catch (e) {}\n      }\n    }\n\n    return false;\n  },\n  hasPasswordSet: function () {\n    var localHasPasswordSet = Session.get('localHasPasswordSet');\n    if (localHasPasswordSet) return localHasPasswordSet;\n    return Template.instance().hasPasswordSet.get();\n  },\n  hasPasswordSetReqCompleted: function () {\n    return Template.instance().hasPasswordSetReqCompleted.get();\n  }\n});\nTemplate.userProfile.events({\n  \"change .togglePublicProfileSetting\": function (event, template) {\n    Meteor.call('togglePublicProfileSetting', function (err, res) {\n      if (err) {\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        var msg = 'Public profile setting change failed. Check your internet connection. ';\n        if (err.error) msg += err.error + '. ';\n        msg += \"Please try again. Contact us if needed.\";\n        tmp.push(msg);\n        Session.set(\"showErrorDlg\", tmp);\n      } else {\n        setTimeout(function () {\n          var data = Accounts.user();\n\n          try {\n            if (data.profile.isPublic && data.profile.username) {\n              FlowRouter.go('tenant', {\n                username: data.profile.username\n              });\n            } else {\n              FlowRouter.go('account/profile');\n            }\n          } catch (e) {\n            console.log(e);\n          }\n        }, 1000);\n      }\n    });\n  },\n  \"click .profileLinkCopyBtn\": function (event, template) {\n    console.log(\"Event profileLinkCopyBtn\");\n    $('#profileLinkField').select();\n\n    try {\n      var successful = document.execCommand('copy');\n      var msg = successful ? 'successful' : 'unsuccessful'; // console.log('Copying text command was ' + msg);\n\n      var tmp = Session.get(\"showErrorDlg\");\n      if (!tmp) tmp = [];\n      var msg = 'Your profile is copied to your clipboard. ';\n      tmp.push(msg);\n      Session.set(\"showErrorDlg\", tmp);\n    } catch (err) {\n      console.log('Oops, unable to copy');\n    }\n  },\n  \"click .requestRedgRefund\": function (event, template) {\n    console.log(\"Event requestRedgRefund\");\n    $.fancybox({\n      'padding': 0,\n      'href': '#requestRedgRefund-popup'\n    });\n  },\n  \"click .requestConfRefund\": function (event, template) {\n    console.log(\"Event requestConfRefund\");\n    $.fancybox({\n      'padding': 0,\n      'href': '#requestConfRefund-popup'\n    });\n  },\n  \"click .changePwdBtn\": function (event, template) {\n    console.log(\"Event changePwdBtn\");\n    $('#changepass-dlg .changePwdAlertMsgs .color-text').html('');\n    $('#changepass-dlg .help-block p').html('');\n    $(\"#changepass-dlg button[type=submit]\").attr(\"disabled\", false);\n    $.fancybox({\n      'padding': 0,\n      'href': '#changepass-dlg',\n      'afterClose': () => {\n        console.log(\"Event: Fancybox closed\"); //reset fields\n\n        $('.oldpwd').val(\"\");\n        $('.newpwd').val(\"\");\n      }\n    });\n  },\n  \"click .setPwdBtn\": function (event, template) {\n    console.log(\"Event setPwdBtn\");\n    $('#setpass-dlg .changePwdAlertMsgs .color-text').html('');\n    $('#setpass-dlg .help-block p').html('');\n    $(\"#setpass-dlg button[type=submit]\").attr(\"disabled\", false);\n    $.fancybox({\n      'padding': 0,\n      'href': '#setpass-dlg',\n      'afterClose': () => {\n        console.log(\"Event: Fancybox closed\"); //reset fields\n\n        $('.newpwd').val(\"\");\n        $('.newpwdconfirm').val(\"\");\n      }\n    });\n  },\n  \"click .changeMobileBtn\": function (event, template) {\n    console.log(\"Event changeMobileBtn\");\n    $.fancybox({\n      'padding': 0,\n      'href': '#changeMobile-div'\n    });\n  },\n  \"click .changeCityBtn\": function (event, template) {\n    console.log(\"Event changeCityBtn\");\n    $.fancybox({\n      'padding': 0,\n      'href': '#changeCity-div'\n    });\n  },\n  \"click .changeEmployerNameConfirmation\": function (event, template) {\n    console.log(\"Event changeEmployerNameConfirmation\");\n    var ele = $(event.target);\n    hideSaveBtn(ele);\n    Meteor.call('updateEmployerName', $('.changeEmployerNameValue').val(), function (error, result) {\n      if (error) {\n        console.log(error.error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        if (!error.error) error.error = 'An error occurred';\n        tmp.push(error.error);\n        Session.set(\"showErrorDlg\", tmp);\n        showSaveBtn(ele);\n        return;\n      }\n\n      if (result.status == 'Success') {}\n    });\n  },\n  \"click .changeEmployerTakeHomeConfirmation\": function (event, template) {\n    console.log(\"Event changeEmployerTakeHomeConfirmation\");\n    debugger;\n    var ele = $(event.target);\n    hideSaveBtn(ele);\n    var num = parseInt($('.changeEmployerTakeHomeValue').val());\n    Meteor.call('updateEmployerTakeHome', num, function (error, result) {\n      if (error) {\n        console.log(error.error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        if (!error.error) error.error = 'An error occurred';\n        tmp.push(error.error);\n        Session.set(\"showErrorDlg\", tmp);\n        showSaveBtn(ele);\n        return;\n      }\n\n      if (result.status == 'Success') {}\n    });\n  },\n  \"click .privacyTermsMore_btn\": function (event, template) {\n    if (template.privacyTermsMore.get()) template.privacyTermsMore.set(false);else template.privacyTermsMore.set(true);\n  },\n  //////// TODO: Events below are not working.\n  \"click .requestRedgRefundConf\": function (event, template) {\n    console.log(\"Event requestRedgRefundConf\");\n    var ret = Meteor.call('registrationAmountRefund', [], function (ret) {\n      if (ret.status == 'AlreadyRequested') {}\n\n      $.fancybox.close();\n    });\n  },\n  \"click .requestConfRefundConf\": function (event, template) {\n    console.log(\"Event requestConfRefundConf\");\n    var ret = Meteor.call('confirmationAmountRefund', [], function (ret) {\n      if (ret.status == 'AlreadyRequested') {}\n\n      $.fancybox.close();\n    });\n  },\n  \"click .noBtn\": function (event, template) {\n    console.log(\"Event noBtn\");\n    $.fancybox.close();\n  },\n  \"click .backBtn\": function (event, template) {\n    var prevRoute = Session.get('prevRoute'); // Session.set('prevRoute',{\n    //   name:\"letting\",\n    //     args:{key:\"DUN1\"}\n    // });\n\n    if (prevRoute) {\n      FlowRouter.go(prevRoute.name, prevRoute.args);\n      var prevRoute = {\n        name: FlowRouter.current().route.name,\n        args: {}\n      };\n      Session.set('prevRoute', prevRoute);\n    } else {\n      FlowRouter.go(\"home\");\n    }\n  },\n  \"click .linkWithGoogleBtn\": function (event, template) {\n    Meteor.linkWithGoogle({}, function (err) {\n      if (err) {\n        console.log(err);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        var msg = 'Link with Google failed. ';\n        if (err.error) msg += err.error + '. ';\n        msg += \"Please try again. Contact us if needed.\";\n        tmp.push(msg);\n        Session.set(\"showErrorDlg\", tmp);\n        throw new Meteor.Error(\"Google login failed\");\n      } else {}\n    });\n  },\n  \"click .linkWithTwitterBtn\": function (event, template) {\n    Meteor.linkWithTwitter({}, function (err) {\n      if (err) {\n        console.log(err);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        var msg = 'Link with Twitter failed. ';\n        if (err.error) msg += err.error + '. ';\n        msg += \"Please try again. Contact us if needed.\";\n        tmp.push(msg);\n        Session.set(\"showErrorDlg\", tmp);\n        throw new Meteor.Error(\"Twitter login failed\");\n      } else {}\n    });\n  },\n  \"click .linkWithFacebookBtn\": function (event, template) {\n    Meteor.linkWithFacebook({}, function (err) {\n      if (err) {\n        console.log(err);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        var msg = 'Link with Facebook failed. ';\n        if (err.error) msg += err.error + '. ';\n        msg += \"Please try again. Contact us if needed.\";\n        tmp.push(msg);\n        Session.set(\"showErrorDlg\", tmp);\n        throw new Meteor.Error(\"Facebook login failed\");\n      } else {}\n    });\n  },\n  \"click .linkWithLinkedInBtn\": function (event, template) {\n    Meteor.connectWithLinkedIn({}, function (err) {\n      if (err) {\n        console.log(arguments);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        var msg = 'Link with LinkedIn failed. ';\n        if (err.error) msg += err.error + '. ';\n        msg += \"Please try again. Contact us if needed.\";\n        tmp.push(msg);\n        Session.set(\"showErrorDlg\", tmp);\n        throw new Meteor.Error(\"LinkedIn login failed\");\n      } else {}\n    });\n  }\n});\nTemplate.userProfile.onRendered(function () {\n  var templateInstance = Template.instance();\n  Meteor.call('hasPasswordSet', function (err, result) {\n    if (!err) {\n      templateInstance.hasPasswordSet.set(result);\n      templateInstance.hasPasswordSetReqCompleted.set(true);\n    }\n  }); //////// TODO: Remove below JQuery events after making meteor events working.\n\n  $('.noBtn, .cancel, .close').click(function () {\n    console.log(\"Event noBtn jquery\");\n    $.fancybox.close();\n  });\n  $('.requestRedgRefundConf').click(function () {\n    console.log(\"Event requestRedgRefundConf jquery\");\n    var ret = Meteor.call('registrationAmountRefund', [], function (error, result) {\n      if (error) {\n        console.log(error.error);\n        return;\n      }\n\n      if (result.status == 'AlreadyRequested') {}\n\n      $.fancybox.close();\n    });\n  });\n  $('.requestConfRefundConf').click(function () {\n    console.log(\"Event requestConfRefundConf jquery\");\n    var ele = this;\n    hideSaveBtn(ele);\n    var ret = Meteor.call('confirmationAmountRefund', [], function (error, result) {\n      if (error) {\n        console.log(error.error);\n        showSaveBtn(ele);\n        return;\n      }\n    });\n  });\n  $('.changeMobileConfirmation').click(function () {\n    console.log(\"Event changeMobileConfirmation jquery\");\n    var ele = this;\n    hideSaveBtn(ele);\n    var mobile = $('.changeMobileValue').val();\n    validatedMobile = LoginFormValidation.mobile(mobile);\n\n    if (validatedMobile !== true) {\n      $('.mobileValidationErrors').show().html(validatedMobile.reason);\n      showSaveBtn(ele);\n      return;\n    }\n\n    Meteor.call('updateMobile', mobile, function (error, result) {\n      if (error) {\n        console.log(error.error);\n        showSaveBtn(ele);\n        return;\n      }\n\n      $('.mobileValidationErrors').hide(); // Session.set('showMobileVerification',true)\n    });\n  });\n  $('.changeEmployerNameConfirmation').click(function () {// console.log(\"Event changeEmployerNameConfirmation jquery\");\n    // var ele = this;\n    // hideSaveBtn(ele)\n    // Meteor.call('updateEmployerName',[$('.changeEmployerNameValue').val()],function(error, result){\n    //\n    //   if(error){\n    //     console.log(error.error);\n    //     showSaveBtn(ele)\n    //     return;\n    //   }\n    //   if(result.status=='Success'){\n    //\n    //   }\n    // });\n  });\n  $('.mobileValidationErrors').hide();\n  $('.eyebtn').click(function () {\n    if ($(\".show-pwd\").hasClass(\"shown\")) {\n      $(\".show-pwd\").attr(\"type\", \"password\");\n      $(\".show-pwd\").removeClass(\"shown\");\n    } else {\n      $(\".show-pwd\").attr(\"type\", \"text\");\n      $(\".show-pwd\").addClass(\"shown\");\n    }\n  });\n  $(document).ready(function () {\n    //$('.change-click').click(function(){\n    //\n    //  });\n    $('.cancel-clk').click(function () {\n      hideSaveBtn(this);\n      $('.mobileValidationErrors').hide();\n    });\n    $('.change-click').click(function () {\n      showSaveBtn(this);\n    }); //$('.request-clk').click(function(){\n    //  $('.hideen-div').fadeOut();\n    //});\n\n    $('.sendEmailVerification').click(function () {\n      console.log('event sendEmailVerification');\n      $('.sendEmailVerification').text('Verification mail sent');\n      setTimeout(function () {\n        $('.sendEmailVerification').text('Send verification link');\n      }, 10000);\n    });\n  });\n});\nTemplate.fileUploadDlgTemplate.onCreated(function () {\n  this.sesCate = new ReactiveVar(false);\n  this.p1 = new ReactiveVar(false);\n  this.p2 = new ReactiveVar(false);\n  var ses = Session.get('showFileDlg');\n\n  if (ses) {\n    this.sesCate.set(ses.cate);\n\n    if (ses.cate) {\n      var p1 = '';\n      var p2 = '';\n\n      switch (ses.cate) {\n        case \"Resume\":\n          p1 = \"hasResume\";\n          p2 = \"resume\";\n          break;\n\n        case \"Work Reference\":\n          p1 = \"hasWorkRef\";\n          p2 = \"workRef\";\n          break;\n\n        case \"Landlord Reference\":\n          p1 = \"hasLandlordRef\";\n          p2 = \"landlordRef\";\n          break;\n\n        case \"Financial Reference\":\n          p1 = \"hasFinancialRef\";\n          p2 = \"financialRef\";\n          break;\n\n        case \"Government ID\":\n          p1 = \"hasGovtID\";\n          p2 = \"govtID\";\n          break;\n\n        case \"Passport\":\n          p1 = \"hasPassport\";\n          p2 = \"passport\";\n          break;\n\n        case \"PPS\":\n          p1 = \"hasPPS\";\n          p2 = \"PPS\";\n          break;\n      } // p1 = \"profile.references.\"+p1\n      // p2 = \"profile.references.\" + p2\n\n\n      this.p1.set(p1);\n      this.p2.set(p2);\n    }\n  }\n\n  this.step = new ReactiveVar(1);\n  this.sFileName = new ReactiveVar(false);\n  this.uploading = new ReactiveVar(false);\n  this.fileObj = new ReactiveVar({});\n  this.fileObjPrevious = new ReactiveVar(false);\n});\nTemplate.fileUploadDlgTemplate.helpers({\n  dlgTitle: function () {\n    var title = '';\n    var p1 = Template.instance().p1.get();\n    var p2 = Template.instance().p2.get();\n    var uploading = Template.instance().uploading.get();\n    var user = Meteor.user();\n    if (user.profile.references[p1]) var existingFile = true;\n\n    if (existingFile) {\n      title = 'Update ';\n      if (!Template.instance().fileObjPrevious.get()) // only if its not yet set . Else other function will set it.\n        Template.instance().fileObjPrevious.set(user.profile.references[p2]);\n      console.log('fileObjPrevious');\n      console.log(Template.instance().fileObjPrevious.get());\n    } else if (uploading) title = 'Uploading ';else title = 'Upload ';\n\n    var sesCate = Template.instance().sesCate.get();\n    if (sesCate) title += sesCate;else title += 'References';\n    return title;\n  },\n  existingFile: function () {\n    var p2 = Template.instance().p2.get();\n    var user = Meteor.user();\n    if (user.profile.references[p2]) return user.profile.references[p2];\n    return false;\n  },\n  isStep: function (step) {\n    if (step == Template.instance().step.get()) return true;else return false;\n  },\n  isNotStep: function (step) {\n    if (step != Template.instance().step.get()) return true;else return false;\n  },\n  uploading: function () {\n    return Template.instance().uploading.get();\n  },\n  validFileExtensions: function () {\n    return _validFileExtensions;\n  }\n});\nTemplate.fileUploadDlgTemplate.events({\n  'click .showCamera': function (event, template) {\n    event.preventDefault();\n    template.$('#cropImage').cropper(\"destroy\");\n    template.$('#cropImage').attr(\"src\", '').hide();\n    template.$('#finalImage').attr(\"src\", '').hide();\n    $('.step2, #uploadImagePreviewArea').show();\n    $('.step3').hide();\n    var cameraOptions = {\n      width: 800,\n      height: 600\n    };\n    MeteorCamera.getPicture(cameraOptions, function (error, data) {\n      if (!error) {\n        template.$('#cropImage').attr('src', data);\n        template.step.set(2);\n        $('.step2').show();\n        $('.step3').hide();\n        template.sFileName.set('cameraPhoto.jpg'); //Now start the crop\n\n        if (data) {\n          $('.step1').hide();\n          template.$(\"#cropImage\").cropper({\n            aspectRatio: 4 / 3\n          });\n        }\n      }\n    });\n  },\n  'click .getCroppedImage': function (event, template) {\n    template.step.set(3);\n    $('.step2').hide();\n    $('.step3').show(); //Ratio 4:3 => 700 * 525\n\n    var finalImgData = template.$('#cropImage').cropper(\"getCroppedCanvas\", {\n      width: 700,\n      height: 525\n    }).toDataURL();\n    template.$('#finalImage').attr('src', finalImgData).show();\n    var head = 'data:image/png;base64,';\n    var imgFileSize = Math.round((finalImgData.length - head.length) * 3 / 4);\n    var sizeKB = imgFileSize / 1000;\n    var sizeMB = imgFileSize / 1000000;\n    console.log(\"imgFileSize\", imgFileSize, \"size\", sizeMB, \"MB\", \"-----\", sizeKB, \"KB\");\n    var mimeType = 'image/jpeg';\n    var imgQuality = 1;\n    if (sizeKB > 200) var imgQuality = 0.9;\n    if (sizeKB > 300) var imgQuality = 0.8;\n    if (sizeKB > 400) var imgQuality = 0.7;\n    const cate = template.sesCate.get();\n    var sFileName = template.sFileName.get();\n    if (!sFileName) sFileName = 'cameraPhoto.jpg'; // const inst = Template.instance();\n\n    var finalImgData = template.$('#cropImage').cropper(\"getCroppedCanvas\", {\n      width: 700,\n      height: 525\n    }).toBlob(function (blob) {\n      template.uploading.set(true);\n      template.fileObj.set({}); //Reset old status as this might be 2nd upload.\n\n      var ret = S3.upload({\n        file: new File([blob], sFileName),\n        path: \"profileFiles\"\n      }, function (e, r) {\n        if (e) {\n          $('.step1').show();\n          var tmp = Session.get(\"showErrorDlg\");\n          if (!tmp) tmp = [];\n          tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n\n          try {\n            if (e.error) tmp.push(e.error);\n          } catch (cat) {}\n\n          Session.set(\"showErrorDlg\", tmp);\n          throw new Meteor.Error('Upload failed ', e);\n          template.uploading.set(false);\n          return;\n        }\n\n        console.log(r);\n        template.fileObj.set(r);\n        var tmp = {\n          name: r.file.original_name,\n          relative_url: r.relative_url,\n          url: r.secure_url\n        };\n        console.log(tmp);\n        var fileObjPrevious = template.fileObjPrevious.get(); //move here due to bug\n\n        Meteor.call('updateReferenceFile', [cate, tmp], (err, res) => {\n          template.uploading.set(false); //Make it false even if it failed. Users should know that its not uploading anymore.\n\n          $('.step2').hide();\n          $('.step1').show();\n          $('.step3').show(); //Because its an image from cropped area\n\n          if (err) {\n            console.log(err);\n            var tmp = Session.get(\"showErrorDlg\");\n            if (!tmp) tmp = [];\n            tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n\n            try {\n              if (err.error) tmp.push(err.error);\n            } catch (cat) {}\n\n            Session.set(\"showErrorDlg\", tmp); //If updating in DB failed. Then delete in Amazon as well.\n\n            var fileObj = template.fileObj.get();\n            S3.delete(fileObj.relative_url, function (error, result) {});\n          } else {\n            //If upload is success, then delete the old file and re-set it.\n            // debugger;\n            // var fileObjPrevious = template.fileObjPrevious.get()//Don' get it here, as parallely another code is changing this val->lead to bug\n            if (fileObjPrevious) {\n              //only if it exists.\n              S3.delete(fileObjPrevious.relative_url, function (error, result) {});\n              template.fileObjPrevious.set(template.fileObj.get());\n            }\n          }\n        });\n      });\n    }, mimeType, imgQuality);\n  },\n  'click .zoomInBtn': function (event, template) {\n    template.$('#cropImage').cropper(\"zoom\", 0.1);\n  },\n  'click .zoomOutBtn': function (event, template) {\n    template.$('#cropImage').cropper(\"zoom\", -0.1);\n  },\n  'click .rotateLeftBtn': function (event, template) {\n    template.$('#cropImage').cropper(\"rotate\", -90);\n  },\n  'click .rotateRightBtn': function (event, template) {\n    template.$('#cropImage').cropper(\"rotate\", 90);\n  },\n  'click .resetBtn': function (event, template) {\n    template.$('#cropImage').cropper(\"reset\");\n  },\n  'click .goToStep1': function (event, template) {\n    $('.step1').show();\n    template.$('#cropImage').cropper(\"destroy\");\n    template.$('#cropImage').attr(\"src\", '').hide();\n    template.$('#finalImage').attr(\"src\", '').hide();\n    $('.step2').hide();\n    $('.step3').hide();\n  },\n  'click .closeDlg': function (event, template) {\n    var ses = {\n      show: false,\n      cate: \"\"\n    };\n    Session.set('showFileDlg', ses); // Has the overall info and basic required info.\n\n    Session.set('showFileTemplate', false);\n  },\n  'change .uploadBtn': function (event, template) {\n    var files = event.target.files;\n    if (!files) return;\n    if (files.length == 0) return;\n    Template.instance().step.set(2);\n    $('.step2, #uploadImagePreviewArea').show();\n    template.$('#cropImage').cropper(\"destroy\");\n    template.$('#cropImage').attr(\"src\", '').hide();\n    template.$('#finalImage').attr(\"src\", '').hide();\n    $('.step3').hide();\n\n    if (!filevalidation(files)) {\n      var tmp = Session.get(\"showErrorDlg\");\n      if (!tmp) tmp = [];\n      var msg = 'Upload rejected. Please upload only document or image files. Allowed extensions are ' + _validFileExtensions.join(', ') + '.';\n      tmp.push(msg);\n      Session.set(\"showErrorDlg\", tmp);\n      throw new Meteor.Error(\"Upload rejected. \");\n      return;\n    }\n\n    const cate = template.sesCate.get();\n    Template.instance().uploading.set(true); // const inst = Template.instance();\n\n    template.fileObj.set({}); //Reset old status as this might be 2nd upload.\n\n    if (files.length == 1) {\n      var target = event.target;\n      var sFileName = files[0].name;\n      template.sFileName.set(sFileName); // $(\"#uploadImagePreviewArea\").html(\"\");\n\n      var regex = /^([a-zA-Z0-9\\s_\\\\.\\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;\n\n      if (regex.test($(target).val().toLowerCase())) {\n        if (isIE() && isIE() <= 9) {\n          $(\"#uploadImagePreviewArea\").show();\n          $(\"#uploadImagePreviewArea\")[0].filters.item(\"DXImageTransform.Microsoft.AlphaImageLoader\").src = $(target).val();\n        } else {\n          if (typeof FileReader != \"undefined\") {\n            template.uploading.set(false);\n            $(\"#uploadImagePreviewArea, #cropImage\").show(); // $(\"#uploadImagePreviewArea\").append('<img class=\"img-responsive\" id=\"cropImage\"/>');\n\n            var reader = new FileReader();\n\n            reader.onload = function (e) {\n              $(\"#cropImage\").attr(\"src\", e.target.result); //File name is set few lines above this\n              //Now start the crop\n\n              var imgData = $(\"#cropImage\").attr('src');\n\n              if (imgData) {\n                $('.step1').hide();\n                template.$(\"#cropImage\").cropper({\n                  aspectRatio: 4 / 3\n                });\n              }\n            };\n\n            reader.readAsDataURL($(target)[0].files[0]);\n            return; //If previewer is available then let the cropper handle the upload.\n          } else {\n            console.log(\"This browser does not support FileReader.\");\n          }\n        }\n      } else {\n        console.log(\"File upload: Not an image file to show preview.\");\n      }\n    } // console.log('Not an image, so proceeding with traditional upload')\n\n\n    var ret = S3.upload({\n      files: files,\n      path: \"profileFiles\"\n    }, function (e, r) {\n      if (e) {\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n\n        try {\n          if (e.error) tmp.push(e.error);\n        } catch (cat) {}\n\n        Session.set(\"showErrorDlg\", tmp);\n        throw new Meteor.Error('Upload failed ', e);\n        template.uploading.set(false);\n        return;\n      }\n\n      console.log(r);\n      template.fileObj.set(r);\n      var tmp = {\n        name: r.file.original_name,\n        relative_url: r.relative_url,\n        url: r.secure_url\n      };\n      console.log(tmp);\n      var fileObjPrevious = template.fileObjPrevious.get(); //move here due to bug\n\n      Meteor.call('updateReferenceFile', [cate, tmp], (err, res) => {\n        template.uploading.set(false); //Make it false even if it failed. Users should know that its not uploading anymore.\n\n        $('.step2').hide();\n        $('.step3').hide(); //Because its not an image.\n\n        if (err) {\n          console.log(err);\n          var tmp = Session.get(\"showErrorDlg\");\n          if (!tmp) tmp = [];\n          tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n\n          try {\n            if (err.error) tmp.push(err.error);\n          } catch (cat) {}\n\n          Session.set(\"showErrorDlg\", tmp); //If updating in DB failed. Then delete in Amazon as well.\n\n          var fileObj = template.fileObj.get();\n          S3.delete(fileObj.relative_url, function (error, result) {});\n        } else {\n          //If upload is success, then delete the old file and re-set it.\n          // debugger;\n          // var fileObjPrevious = template.fileObjPrevious.get()//Don' get it here, as parallely another code is changing this val->lead to bug\n          if (fileObjPrevious) {\n            //only if it exists.\n            S3.delete(fileObjPrevious.relative_url, function (error, result) {});\n            template.fileObjPrevious.set(template.fileObj.get());\n          }\n        }\n      });\n    }); // for (var i = 0, ln = files.length; i < ln; i++) {\n    //     propertyImagesCollection.insert(files[i], function (err, fileObj) {\n    //         // Inserted new doc with ID fileObj._id, and kicked off the data upload using HTTP\n    //         console.log(fileObj);\n    //         var cursor = propertyImagesCollection.find(fileObj._id);\n    //\n    //         var liveQuery = cursor.observe({\n    //             changed: function(newImage, oldImage) {\n    //\n    //                 console.log(\"Inside live query \");\n    //                 console.log(newImage);\n    //                 if (newImage.isUploaded()) {\n    //                     liveQuery.stop();\n    //\n    //                     // Call your onUploaded callback here...\n    //                 }\n    //             }\n    //         });\n    //     });\n    // }\n  }\n});\nTemplate.fileUploadDlgTemplate.onRendered(function () {\n  $(\"#uploadImagePreviewArea, #cropImage, #finalImage\").hide();\n  $('#cropImage, #finalImage').attr('src', '');\n});\nTemplate.fileUploadArea.onCreated(function () {\n  this.uploading = new ReactiveVar(false); // this.fileObj = new ReactiveVar( {} );\n});\nTemplate.fileUploadArea.helpers({\n  uploading: function (isMyBidsPage) {\n    return Template.instance().uploading.get();\n  },\n  validFileExtensions: function () {\n    return _validFileExtensions;\n  }\n});\nTemplate.fileUploadArea.events({\n  'click .showUploadDlg': function (event, template) {\n    var ses = {\n      show: true,\n      cate: this.title\n    };\n    Session.set('showFileDlg', ses);\n    return false;\n  } // 'change .uploadBtn': function(event, template) {\n  //     var files = event.target.files;\n  //\n  //     if(!filevalidation(files)){\n  //         var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n  //         var msg = 'Upload rejected. Please upload only document or image files. Allowed extensions are '+_validFileExtensions.join(', ')+'.';\n  //         tmp.push(msg);\n  //         Session.set(\"showErrorDlg\",tmp)\n  //\n  //         throw new Meteor.Error(\"Upload rejected. \");\n  //         return;\n  //     }\n  //\n  //     const cate = event.target.getAttribute('cate');\n  //     Template.instance().uploading.set(true);\n  //     const inst = Template.instance();\n  //     inst.fileObj.set({});//Reset old status as this might be 2nd upload.\n  //     var ret = S3.upload({\n  //         files:files,\n  //         path:\"profileFiles\"\n  //     },function(e,r){\n  //         if(e){\n  //             var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n  //             tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n  //             try{if(e.error)tmp.push(e.error);}catch (cat){}\n  //             Session.set(\"showErrorDlg\",tmp)\n  //             throw new Meteor.Error('Upload failed ', e);return;\n  //         }\n  //         console.log(r);\n  //\n  //         inst.fileObj.set(r);\n  //\n  //         var tmp = {\n  //             name: r.file.original_name,\n  //             relative_url: r.relative_url,\n  //             url: r.secure_url\n  //         }\n  //\n  //         console.log(tmp);\n  //         Meteor.call('updateReferenceFile', [cate, tmp], (err, res) => {\n  //             inst.uploading.set(false);//Make it false even if it failed. Users should know that its not uploading anymore.\n  //             if (err) {\n  //                 console.log(err);\n  //\n  //                 var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n  //                 tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n  //                 try{if(err.error)tmp.push(err.error);}catch (cat){}\n  //                 Session.set(\"showErrorDlg\",tmp)\n  //\n  //                 //If updating in DB failed. Then delete in Amazon as well.\n  //                 var fileObj = inst.fileObj.get();\n  //                 S3.delete(fileObj.relative_url,function(error, result){})\n  //             } else {\n  //\n  //             }\n  //\n  //         });\n  //\n  //\n  //     });\n  //     // for (var i = 0, ln = files.length; i < ln; i++) {\n  //     //     propertyImagesCollection.insert(files[i], function (err, fileObj) {\n  //     //         // Inserted new doc with ID fileObj._id, and kicked off the data upload using HTTP\n  //     //         console.log(fileObj);\n  //     //         var cursor = propertyImagesCollection.find(fileObj._id);\n  //     //\n  //     //         var liveQuery = cursor.observe({\n  //     //             changed: function(newImage, oldImage) {\n  //     //\n  //     //                 console.log(\"Inside live query \");\n  //     //                 console.log(newImage);\n  //     //                 if (newImage.isUploaded()) {\n  //     //                     liveQuery.stop();\n  //     //\n  //     //                     // Call your onUploaded callback here...\n  //     //                 }\n  //     //             }\n  //     //         });\n  //     //     });\n  //     // }\n  // },\n\n});\n\nfunction showSaveBtn(ele) {\n  $(ele).parents('div.inp-hold').find('.overlay-text').fadeOut();\n  $(ele).fadeOut();\n  $(ele).parent('div.inp-hold').find('.save-btn').addClass('show-save');\n  $(ele).parent('div.inp-hold').find('div.cancel-div').css('display', 'block');\n  $(ele).parent('div.inp-hold').find('input').focus();\n}\n\nfunction hideSaveBtn(ele) {\n  $(ele).parents('div.inp-hold').find('.save-btn').removeClass('show-save');\n  $(ele).parents('div.inp-hold').find('div.cancel-div').css('display', 'none');\n  $(ele).parents('div.inp-hold').find('.change-click').fadeIn();\n  $(ele).parents('div.inp-hold').find('.overlay-text').fadeIn();\n}\n\nTemplate.loginFormSetPassword.onCreated(() => {\n  let template = Template.instance();\n  template.formMessages = new ReactiveVar({});\n  template.isLoading = new ReactiveVar(false);\n});\nTemplate.loginFormSetPassword.helpers(LoginFormSharedHelpers);\nTemplate.loginFormSetPassword.events({\n  /**\n   * Submit form for password update\n   * @param  {Event} event - jQuery Event\n   * @param  {Template} template - Blaze Template\n   * @return {void}\n   */\n  \"submit form\": function (event, template) {\n    event.preventDefault();\n    event.stopPropagation();\n    template.$(\"button[type=submit]\").attr(\"disabled\", true);\n    let password1Input = template.$(\".login-input--password1\");\n    let password2Input = template.$(\".login-input--password2\");\n    let password1 = password1Input.val().trim();\n    let password2 = password2Input.val().trim();\n    let templateInstance = Template.instance();\n    var errors = [];\n\n    if (password1 != password2) {\n      errors.push({\n        error: \"INVALID_PASSWORD\",\n        reason: \"Passwords doesn't match\"\n      }); // errors.password2 = [\n      //     {\n      //         error: \"INVALID_PASSWORD\",\n      //         reason: \"Passwords doesn't match\"\n      //     }\n      // ]\n      // templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);//We need it here because line 560 errors.password2 = validatedPassword2; will over write this message if we don't return here. Also array merge isn't an option as our UI is not ready to show multiple messages. It can only take 1 error at a time.\n      // templateInstance.formMessages.set({\n      //     errors: errors\n      // });\n      // return;\n    } // We only check if it exists, just in case we\"ve change the password strength and want the\n    // user to have an opportunity to update to a stronger password\n    // let validatedPassword1 = LoginFormValidation.password(password1);//Not needed as we are doing equal check\n\n\n    let validatedPassword2 = LoginFormValidation.password(password2, {\n      validationLevel: \"length\"\n    });\n    templateInstance.formMessages.set({});\n    templateInstance.isLoading.set(true); // if (validatedPassword1 !== true) {\n    //     errors.push(validatedPassword1);\n    // }\n\n    if (validatedPassword2 !== true) {\n      errors.push(validatedPassword2);\n    }\n\n    if (errors.length) {\n      templateInstance.$(\"button[type=submit]\").attr(\"disabled\", false);\n      templateInstance.formMessages.set({\n        errors: errors\n      }); // prevent signup\n\n      templateInstance.isLoading.set(false);\n      return;\n    }\n\n    Meteor.call('setUserPwd', [Meteor.userId(), password2], function (error, result) {\n      // templateInstance.isLoading.set(false);\n      if (error) {\n        templateInstance.$(\"button[type=submit]\").attr(\"disabled\", false); // Show some error message\n\n        templateInstance.formMessages.set({\n          errors: [error]\n        });\n      } else {\n        Session.set('localHasPasswordSet', true);\n        templateInstance.$(\".login-input--password1, .login-input--password2\").val('');\n        $('#setpass-dlg .changePwdAlertMsgs p, #setpass-dlg .help-block p').html(''); // // Close dropdown or navigate to page\n\n        templateInstance.formMessages.set({\n          info: [{\n            reason: 'Password successfully set'\n          }]\n        });\n        if ($) if ($.fancybox) {\n          $.fancybox.close();\n          templateInstance.formMessages.set({});\n        }\n      }\n    });\n  }\n});\nTemplate.loginFormChangePassword.onCreated(() => {\n  let template = Template.instance();\n  template.formMessages = new ReactiveVar({});\n  template.isLoading = new ReactiveVar(false);\n});\nTemplate.loginFormChangePassword.helpers(LoginFormSharedHelpers);\nTemplate.loginFormChangePassword.events({\n  /**\n   * Submit form for password update\n   * @param  {Event} event - jQuery Event\n   * @param  {Template} template - Blaze Template\n   * @return {void}\n   */\n  \"submit form\": function (event, template) {\n    event.preventDefault();\n    event.stopPropagation();\n    template.$(\"button[type=submit]\").attr(\"disabled\", true);\n    let oldPasswordInput = template.$(\".login-input--oldPassword\");\n    let passwordInput = template.$(\".login-input--password\");\n    let oldPassword = oldPasswordInput.val().trim();\n    let password = passwordInput.val().trim(); // We only check if it exists, just incase we\"ve change the password strength and want the\n    // user to have an oppurtinity to update to a stronger password\n\n    let validatedOldPassword = LoginFormValidation.password(oldPassword, {\n      validationLevel: \"exists\"\n    });\n    let validatedPassword = LoginFormValidation.password(password, {\n      validationLevel: \"length\"\n    });\n    let templateInstance = Template.instance();\n    templateInstance.isLoading.set(true);\n    var errors = [];\n    templateInstance.formMessages.set({});\n    templateInstance.isLoading.set(true);\n\n    if (oldPassword == password) {\n      errors.push({\n        error: \"INVALID_PASSWORD\",\n        reason: \"New password cannot be same as old password.\"\n      }); // errors.password2 = [\n      //     {\n      //         error: \"INVALID_PASSWORD\",\n      //         reason: \"Passwords doesn't match\"\n      //     }\n      // ]\n      // templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);//We need it here because line 560 errors.password2 = validatedPassword2; will over write this message if we don't return here. Also array merge isn't an option as our UI is not ready to show multiple messages. It can only take 1 error at a time.\n      // templateInstance.formMessages.set({\n      //     errors: errors\n      // });\n      // return;\n    }\n\n    if (validatedOldPassword !== true) {\n      errors.push(validatedOldPassword);\n    }\n\n    if (validatedPassword !== true) {\n      errors.push(validatedPassword);\n    }\n\n    if (errors.length) {\n      templateInstance.$(\"button[type=submit]\").attr(\"disabled\", false);\n      templateInstance.formMessages.set({\n        errors: errors\n      }); // prevent signup\n\n      templateInstance.isLoading.set(false);\n      return;\n    }\n\n    Accounts.changePassword(oldPassword, password, error => {\n      //console.log('Here in callback');\n      //templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);\n      templateInstance.isLoading.set(false);\n\n      if (error) {\n        templateInstance.$(\"button[type=submit]\").attr(\"disabled\", false); // Show some error message\n\n        templateInstance.formMessages.set({\n          errors: [error]\n        });\n      } else {\n        templateInstance.$(\".login-input--oldPassword, .login-input--password\").val('');\n        $('#changepass-dlg .changePwdAlertMsgs p, #changepass-dlg .help-block p').html(''); //$('.login-input--password, .login-input--oldPassword').val('');\n        // // Close dropdown or navigate to page\n\n        templateInstance.formMessages.set({\n          info: [{\n            reason: 'Password successfully changed'\n          }]\n        });\n        if ($) if ($.fancybox) {\n          $.fancybox.close();\n          templateInstance.formMessages.set({});\n        }\n      }\n    });\n  }\n});\n\nfunction titleCase(str) {\n  if (!str) return;\n  return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\n\nfunction isIE() {\n  var myNav = navigator.userAgent.toLowerCase();\n  return myNav.indexOf('msie') != -1 ? parseInt(myNav.split('msie')[1]) : false;\n}","map":{"version":3,"sources":["imports/ui/templates/profile.js"],"names":["module","link","_validFileExtensions","filevalidation","arrInputs","i","length","oInput","sFileName","name","blnValid","j","sCurExtension","substr","toLowerCase","Template","profile","onCreated","instance","isSubsLoaded","ReactiveVar","autorun","subscribe","subscriptionsReady","data","Accounts","user","isPublic","username","console","log","e","set","helpers","userLoggedIn","Meteor","userProfile","privacyTermsMore","hasPasswordSet","hasPasswordSetReqCompleted","city","clearMeta","DocHead","setTitle","titleCase","addMeta","content","err","email","emailVerified","backBtnNeeded","prevRoute","Session","get","FlowRouter","current","route","isPublicProfileSelectYes","isPublicProfileSelectNo","progress","score","css","issues","mobile","push","services","facebook","twitter","linkedin","references","hasPassport","employerName","employerTakeHome","hasWorkRef","hasLandlordRef","hasPPS","hasGovtID","hasResume","percent","showFileTemplate","showHideFileDlg","ses","show","$","fancybox","width","afterShow","afterClose","cate","close","localHasPasswordSet","events","event","template","call","res","tmp","msg","error","setTimeout","go","select","successful","document","execCommand","html","attr","val","ele","target","hideSaveBtn","result","showSaveBtn","status","num","parseInt","ret","args","linkWithGoogle","Error","linkWithTwitter","linkWithFacebook","connectWithLinkedIn","arguments","onRendered","templateInstance","click","validatedMobile","LoginFormValidation","reason","hide","hasClass","removeClass","addClass","ready","text","fileUploadDlgTemplate","sesCate","p1","p2","step","uploading","fileObj","fileObjPrevious","dlgTitle","title","existingFile","isStep","isNotStep","validFileExtensions","preventDefault","cropper","cameraOptions","height","MeteorCamera","getPicture","aspectRatio","finalImgData","toDataURL","head","imgFileSize","Math","round","sizeKB","sizeMB","mimeType","imgQuality","toBlob","blob","S3","upload","file","File","path","r","cat","original_name","relative_url","url","secure_url","delete","files","join","regex","test","isIE","filters","item","src","FileReader","reader","onload","imgData","readAsDataURL","fileUploadArea","isMyBidsPage","parents","find","fadeOut","parent","focus","fadeIn","loginFormSetPassword","formMessages","isLoading","LoginFormSharedHelpers","stopPropagation","password1Input","password2Input","password1","trim","password2","errors","validatedPassword2","password","validationLevel","userId","info","loginFormChangePassword","oldPasswordInput","passwordInput","oldPassword","validatedOldPassword","validatedPassword","changePassword","str","charAt","toUpperCase","substring","myNav","navigator","userAgent","indexOf","split"],"mappings":"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","sourcesContent":["import \"./profile.html\";\n// import \"./accounts/helpers.js\";\n// import \"./accounts/validation.js\";\nvar _validFileExtensions = [\".jpg\", \".jpeg\", \".png\", \".pdf\", \".txt\", \".doc\", \".docx\", \".ODT\"];\nfunction filevalidation(arrInputs){\n    for (var i = 0; i < arrInputs.length; i++) {\n        var oInput = arrInputs[i];\n        var sFileName = oInput.name;\n        if (sFileName.length > 0) {\n            var blnValid = false;\n            for (var j = 0; j < _validFileExtensions.length; j++) {\n                var sCurExtension = _validFileExtensions[j];\n                if (sFileName.substr(sFileName.length - sCurExtension.length, sCurExtension.length).toLowerCase() == sCurExtension.toLowerCase()) {\n                    blnValid = true;\n                    break;\n                }\n            }\n\n            if (!blnValid) {\n                // alert(\"Sorry, \" + sFileName + \" is invalid, allowed extensions are: \" + _validFileExtensions.join(\", \"));\n                return false;\n            }\n        }\n\n    }\n\n    return true;\n}\n\nTemplate.profile.onCreated(function(){\n    var instance = this;\n    instance.isSubsLoaded = new ReactiveVar(false);\n    instance.autorun(function(){\n\n        instance.subscribe('userData');\n\n        if(instance.subscriptionsReady()){\n            var data =  Accounts.user();\n            try{\n                if(data.profile.isPublic && data.profile.username){\n                    console.log('')\n                    // FlowRouter.redirect('tenant',{username:data.profile.username})\n                }\n            }catch(e){\n                console.log(e);\n            }\n            instance.isSubsLoaded.set(true)\n        }\n    })\n})\nTemplate.profile.helpers({\n    isSubsLoaded:function(){\n        return Template.instance().subscriptionsReady();\n    },\n    userLoggedIn:function(){\n        if(Meteor.user())return true;\n        return false;\n    }\n})\nTemplate.userProfile.onCreated(function(){\n    this.privacyTermsMore = new ReactiveVar( false );\n    this.hasPasswordSet = new ReactiveVar( false );\n    this.hasPasswordSetReqCompleted = new ReactiveVar( false );\n})\nTemplate.userProfile.helpers({\n    \"data\": function(){\n    var data =  Accounts.user();\n    // console.log(data);\n    var city = '';\n    // profile.files.has\n    // if(data)\n    // if(data.profile)\n    // if(data.profile.addressBook)\n    // if(data.profile.addressBook.length){\n    //   city = data.profile.addressBook[0].city\n    // }\n      clearMeta();\n        try {\n            DocHead.setTitle(titleCase(data.profile.name) + '\\'s profile | SpotMyCrib');\n            DocHead.addMeta({name: \"description\", content: \"Upload and manage your references.\"});\n        }catch(err){\n            DocHead.setTitle(' User not found | SpotMyCrib');\n            DocHead.addMeta({name: \"description\", content: \"\"});\n        }\n    return {\n      \"userData\": data,\n      \"userCity\":city,\n      \"userEmail\":data.profile.email,\n      \"userEmailVerified\":data.profile.emailVerified\n    };\n  },\n    backBtnNeeded:function () {\n        var prevRoute = Session.get('prevRoute');\n        try{if( FlowRouter.current().route.name != prevRoute.name )return true;}catch(e){}\n        return false;\n    },\n    prevRoute:function () {\n        return Session.get('prevRoute');\n    },\n    isPublicProfileSelectYes: function(){\n        var user = Meteor.user();\n        try{\n            if(user.profile.isPublic){\n                return 'selected';\n            }\n        }catch(e){}\n        return '';\n    },\n    isPublicProfileSelectNo: function() {\n        var user = Meteor.user();\n        try {\n            if (!user.profile.isPublic) {\n                return 'selected';\n            }\n        } catch (e) {\n        }\n        return '';\n    },\n    progress:function () {\n      var user = Meteor.user();\n      var score = 0;\n      var css = 'progress-bar-danger';\n      var issues = [];\nif(user.profile.mobile){score += 15;}else{issues.push('Mobile number is required. Landlord needs to contact you.')}\nif(!user.services)user.services={}\nif(user.services.facebook){score += 15;}else{issues.push('Connect with your Facebook profile. Its shows your social presence.')}\n// if(user.services.google){score += 10;}else{issues.push('Connect with your google profile. Its shows your social presence.')}//No weightage\nif(user.services.twitter){score += 10;}else{issues.push('Connect with your Twitter profile. Its shows your social presence.')}\nif(user.services.linkedin){score += 15;}else{issues.push('Connect with your LinkedIn profile. Its shows your professional presence.')}\nif(user.profile.references.hasPassport){score += 10;}else{issues.push('Passport is required. Its your legal identity card.')}\nif(user.profile.references.employerName){score += 3;}else{issues.push('Name of your employer is recommended. It can highlight your profile to landlord.')}\nif(user.profile.references.employerTakeHome){score += 2;}else{issues.push('Monthly take home salary is recommended. It can act as your finantial reference.')}\nif(user.profile.references.hasWorkRef){score += 10;}else{issues.push('Work reference is required. It shows your professional side.')}\nif(user.profile.references.hasLandlordRef){score += 10;}else{issues.push('Landlord reference is required. ')}\nif(user.profile.references.hasPPS){score += 3;}else{issues.push('PPS is recommended. Its your legal identity card.')}\n// if(user.profile.references.hasFinancialRef){score += 0;}else{issues.push('Financial reference if work reference is not given.')}\nif(user.profile.references.hasGovtID){score += 4;}else{issues.push('Govt ID is recommended. Driving license or GNIB as your identity card.')}\nif(user.profile.references.hasResume){score += 3;}else{issues.push('Resume is recommended. It shows your professional side.')}\n\n        if(score>100)score = 100;\n        if(score>50)css = 'progress-bar-warning';\n        if(score>70)css = 'progress-bar-info';\n        if(score>90)css = 'progress-bar-success';\n\n\n        return {\n            css:css,\n            percent:score+\"%\",\n            issues:issues\n        }\n    },\n    privacyTermsMore: function(){\n        return Template.instance().privacyTermsMore.get() ;\n    },\n    showFileTemplate:function () {\n        return Session.get('showFileTemplate');\n    },\n    showHideFileDlg: function () {\n        console.log(\"Event showHideFileDlg\");\n        var ses = Session.get('showFileDlg');\n\n        if(ses) {\n            if (ses.show) {\n                $.fancybox({\n                    'padding': 0,\n                    'href': '#fileupload-dlg',\n                    width: '80%',\n                    afterShow: function () {\n                        Session.set('showFileTemplate', true);\n                    },\n                    afterClose: function () {\n                        var ses = {show: false, cate: \"\"}\n                        Session.set('showFileDlg', ses);// Has the overall info and basic required info.\n                        Session.set('showFileTemplate', false);\n                    }\n                });\n                return true;\n            } else if (ses.show==false){\n                try {\n                    $.fancybox.close();\n                } catch (e) {\n                }\n            }\n        }\n        return false;\n    },\n    hasPasswordSet:function(){\n        var localHasPasswordSet = Session.get('localHasPasswordSet');\n        if(localHasPasswordSet)return localHasPasswordSet;\n        return Template.instance().hasPasswordSet.get();\n    },\n    hasPasswordSetReqCompleted:function(){\n        return Template.instance().hasPasswordSetReqCompleted.get();\n    }\n})\nTemplate.userProfile.events({\n    \"change .togglePublicProfileSetting\":function(event,template){\n        Meteor.call('togglePublicProfileSetting',function(err, res) {\n            if (err) {\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                var msg = 'Public profile setting change failed. Check your internet connection. ';\n                if(err.error)msg += err.error+'. ';\n                msg += \"Please try again. Contact us if needed.\";\n                tmp.push(msg);\n                Session.set(\"showErrorDlg\",tmp)\n            } else {\n                setTimeout(function(){\n                    var data =  Accounts.user();\n                    try{\n                        if(data.profile.isPublic && data.profile.username){\n                            FlowRouter.go('tenant',{username:data.profile.username})\n                        }else{\n                            FlowRouter.go('account/profile')\n                        }\n                    }catch(e){\n                        console.log(e);\n                    }\n                },1000)\n            }\n\n        });\n    },\n    \"click .profileLinkCopyBtn\":function(event, template){\n        console.log(\"Event profileLinkCopyBtn\");\n        $('#profileLinkField').select();\n\n        try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful';\n            // console.log('Copying text command was ' + msg);\n\n            var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n            var msg = 'Your profile is copied to your clipboard. ';\n            tmp.push(msg);\n            Session.set(\"showErrorDlg\",tmp)\n        } catch (err) {\n            console.log('Oops, unable to copy');\n        }\n    },\n    \"click .requestRedgRefund\":function(event, template){\n        console.log(\"Event requestRedgRefund\");\n        $.fancybox({\n            'padding': 0,\n            'href': '#requestRedgRefund-popup'\n        });\n    },\n    \"click .requestConfRefund\":function(event, template){\n        console.log(\"Event requestConfRefund\");\n        $.fancybox({\n            'padding': 0,\n            'href': '#requestConfRefund-popup'\n        });\n    },\n    \"click .changePwdBtn\":function(event, template){\n        console.log(\"Event changePwdBtn\");\n        $('#changepass-dlg .changePwdAlertMsgs .color-text').html('');\n        $('#changepass-dlg .help-block p').html('');\n\n\n        $(\"#changepass-dlg button[type=submit]\").attr(\"disabled\",false);\n        $.fancybox({\n            'padding'   : 0,\n            'href'      : '#changepass-dlg',\n            'afterClose': () => {\n                console.log(\"Event: Fancybox closed\");\n\n                //reset fields\n                $('.oldpwd').val(\"\");\n                $('.newpwd').val(\"\");\n            }\n        });\n    },\n    \"click .setPwdBtn\":function(event, template){\n        console.log(\"Event setPwdBtn\");\n        $('#setpass-dlg .changePwdAlertMsgs .color-text').html('');\n        $('#setpass-dlg .help-block p').html('');\n\n\n        $(\"#setpass-dlg button[type=submit]\").attr(\"disabled\",false);\n        $.fancybox({\n            'padding'   : 0,\n            'href'      : '#setpass-dlg',\n            'afterClose': () => {\n                console.log(\"Event: Fancybox closed\");\n\n                //reset fields\n                $('.newpwd').val(\"\");\n                $('.newpwdconfirm').val(\"\");\n            }\n        });\n    },\n    \"click .changeMobileBtn\":function(event, template){\n        console.log(\"Event changeMobileBtn\");\n\n        $.fancybox({\n            'padding': 0,\n            'href': '#changeMobile-div'\n        });\n    },\n    \"click .changeCityBtn\":function(event, template){\n        console.log(\"Event changeCityBtn\");\n        $.fancybox({\n            'padding': 0,\n            'href': '#changeCity-div'\n        });\n    },\n    \"click .changeEmployerNameConfirmation\":function(event, template){\n        console.log(\"Event changeEmployerNameConfirmation\");\n\n        var ele = $(event.target);\n        hideSaveBtn(ele)\n        Meteor.call('updateEmployerName',$('.changeEmployerNameValue').val(),function(error, result){\n\n            if(error){\n                console.log(error.error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                if(!error.error)error.error = 'An error occurred';\n                tmp.push(error.error);\n                Session.set(\"showErrorDlg\",tmp)\n                showSaveBtn(ele)\n                return;\n            }\n            if(result.status=='Success'){\n\n            }\n        });\n    },\n    \"click .changeEmployerTakeHomeConfirmation\":function(event, template){\n        console.log(\"Event changeEmployerTakeHomeConfirmation\");\n        debugger\n        var ele = $(event.target);\n        hideSaveBtn(ele)\n        var num = parseInt($('.changeEmployerTakeHomeValue').val());\n        Meteor.call('updateEmployerTakeHome',num,function(error, result){\n\n            if(error){\n                console.log(error.error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                if(!error.error)error.error = 'An error occurred';\n                tmp.push(error.error);\n                Session.set(\"showErrorDlg\",tmp)\n                showSaveBtn(ele)\n                return;\n            }\n            if(result.status=='Success'){\n\n            }\n        });\n    },\n    \"click .privacyTermsMore_btn\": function (event, template) {\n        if(template.privacyTermsMore.get() )template.privacyTermsMore.set(false);\n        else template.privacyTermsMore.set(true);\n    },\n    //////// TODO: Events below are not working.\n\n    \"click .requestRedgRefundConf\":function(event, template){\n        console.log(\"Event requestRedgRefundConf\");\n        var ret = Meteor.call('registrationAmountRefund',[],function(ret){\n            if(ret.status=='AlreadyRequested'){\n\n            }\n            $.fancybox.close();\n        });\n\n\n    },\n    \"click .requestConfRefundConf\":function(event, template){\n        console.log(\"Event requestConfRefundConf\");\n        var ret = Meteor.call('confirmationAmountRefund',[],function(ret){\n            if(ret.status=='AlreadyRequested'){\n\n            }\n            $.fancybox.close();\n        });\n\n    },\n    \"click .noBtn\":function(event, template){\n        console.log(\"Event noBtn\");\n        $.fancybox.close();\n\n    },\n    \"click .backBtn\": function(event, template){\n        var prevRoute = Session.get('prevRoute');\n        // Session.set('prevRoute',{\n        //   name:\"letting\",\n        //     args:{key:\"DUN1\"}\n        // });\n        if(prevRoute){\n            FlowRouter.go(prevRoute.name,prevRoute.args)\n            var prevRoute = {name: FlowRouter.current().route.name,args:{} }\n            Session.set('prevRoute',prevRoute);\n        }else{\n            FlowRouter.go(\"home\");\n        }\n\n    },\n    \"click .linkWithGoogleBtn\": function(event, template){\n        Meteor.linkWithGoogle({}, function(err){\n            if (err) {\n                console.log(err)\n\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                var msg = 'Link with Google failed. ';\n                if(err.error)msg += err.error+'. ';\n                msg += \"Please try again. Contact us if needed.\";\n                tmp.push(msg);\n                Session.set(\"showErrorDlg\",tmp)\n\n                throw new Meteor.Error(\"Google login failed\");\n            }else{\n\n            }\n        });\n    },\n    \"click .linkWithTwitterBtn\": function(event, template){\n        Meteor.linkWithTwitter({}, function(err){\n            if (err) {\n                console.log(err)\n\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                var msg = 'Link with Twitter failed. ';\n                if(err.error)msg += err.error+'. ';\n                msg += \"Please try again. Contact us if needed.\";\n                tmp.push(msg);\n                Session.set(\"showErrorDlg\",tmp)\n\n                throw new Meteor.Error(\"Twitter login failed\");\n            }else{\n\n            }\n        });\n    },\n    \"click .linkWithFacebookBtn\": function(event, template){\n        Meteor.linkWithFacebook({}, function(err){\n            if (err) {\n                console.log(err)\n\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                var msg = 'Link with Facebook failed. ';\n                if(err.error)msg += err.error+'. ';\n                msg += \"Please try again. Contact us if needed.\";\n                tmp.push(msg);\n                Session.set(\"showErrorDlg\",tmp)\n\n                throw new Meteor.Error(\"Facebook login failed\");\n            }else{\n\n            }\n        });\n    },\n    \"click .linkWithLinkedInBtn\": function(event, template){\n        Meteor.connectWithLinkedIn({}, function(err){\n            if (err) {\n                console.log(arguments)\n\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                var msg = 'Link with LinkedIn failed. ';\n                if(err.error)msg += err.error+'. ';\n                msg += \"Please try again. Contact us if needed.\";\n                tmp.push(msg);\n                Session.set(\"showErrorDlg\",tmp)\n\n                throw new Meteor.Error(\"LinkedIn login failed\");\n            }else{\n\n            }\n        });\n    }\n})\nTemplate.userProfile.onRendered(function(){\n\n    var templateInstance = Template.instance();\n    Meteor.call('hasPasswordSet',function (err,result) {\n        if(!err){\n            templateInstance.hasPasswordSet.set(result);\n            templateInstance.hasPasswordSetReqCompleted.set(true);\n        }\n    })\n\n    //////// TODO: Remove below JQuery events after making meteor events working.\n    $('.noBtn, .cancel, .close').click(function(){\n        console.log(\"Event noBtn jquery\");\n        $.fancybox.close();\n    })\n    $('.requestRedgRefundConf').click(function(){\n        console.log(\"Event requestRedgRefundConf jquery\");\n        var ret = Meteor.call('registrationAmountRefund',[],function(error, result){\n            if(error){\n                console.log(error.error);\n                return;\n            }\n            if(result.status=='AlreadyRequested'){\n\n            }\n            $.fancybox.close();\n        });\n\n    })\n    $('.requestConfRefundConf').click(function(){\n        console.log(\"Event requestConfRefundConf jquery\");\n        var ele = this;\n        hideSaveBtn(ele)\n        var ret = Meteor.call('confirmationAmountRefund',[],function(error, result){\n            if(error){\n                console.log(error.error);\n                showSaveBtn(ele)\n                return;\n            }\n        });\n\n    })\n    $('.changeMobileConfirmation').click(function(){\n        console.log(\"Event changeMobileConfirmation jquery\");\n        var ele = this;\n        hideSaveBtn(ele)\n        var mobile = $('.changeMobileValue').val();\n        validatedMobile = LoginFormValidation.mobile(mobile);\n        if (validatedMobile !== true) {\n            $('.mobileValidationErrors').show().html(validatedMobile.reason) ;showSaveBtn(ele);return;\n        }\n        Meteor.call('updateMobile',mobile,function(error, result){\n            if(error){\n                console.log(error.error);\n                showSaveBtn(ele)\n                return;\n            }\n            $('.mobileValidationErrors').hide();\n            // Session.set('showMobileVerification',true)\n        });\n\n    })\n    $('.changeEmployerNameConfirmation').click(function(){\n        // console.log(\"Event changeEmployerNameConfirmation jquery\");\n        // var ele = this;\n        // hideSaveBtn(ele)\n        // Meteor.call('updateEmployerName',[$('.changeEmployerNameValue').val()],function(error, result){\n        //\n        //   if(error){\n        //     console.log(error.error);\n        //     showSaveBtn(ele)\n        //     return;\n        //   }\n        //   if(result.status=='Success'){\n        //\n        //   }\n        // });\n    })\n\n\n\n\n    $('.mobileValidationErrors').hide();\n    $('.eyebtn').click(function () {\n        if ($(\".show-pwd\").hasClass(\"shown\"))\n        {\n            $(\".show-pwd\").attr(\"type\", \"password\");\n            $(\".show-pwd\").removeClass(\"shown\");\n\n        } else\n        {\n            $(\".show-pwd\").attr(\"type\", \"text\");\n            $(\".show-pwd\").addClass(\"shown\");\n        }\n\n\n    });\n\n    $(document).ready(function(){\n\n        //$('.change-click').click(function(){\n        //\n        //  });\n\n        $('.cancel-clk').click(function(){\n            hideSaveBtn(this);\n            $('.mobileValidationErrors').hide();\n        });\n        $('.change-click').click(function(){\n            showSaveBtn(this)\n        });\n        //$('.request-clk').click(function(){\n        //  $('.hideen-div').fadeOut();\n        //});\n        $('.sendEmailVerification').click(function(){\n            console.log('event sendEmailVerification');\n            $('.sendEmailVerification').text('Verification mail sent')\n            setTimeout(function(){\n                $('.sendEmailVerification').text('Send verification link')\n            },10000)\n        });\n\n    });\n\n\n})\n\nTemplate.fileUploadDlgTemplate.onCreated(function(){\n    this.sesCate = new ReactiveVar( false );\n    this.p1 = new ReactiveVar( false );\n    this.p2 = new ReactiveVar( false );\n    var ses = Session.get('showFileDlg');\n    if(ses){\n        this.sesCate.set(ses.cate);\n        if(ses.cate){\n            var p1='';\n            var p2='';\n            switch (ses.cate){\n                case \"Resume\": p1 = \"hasResume\"; p2 = \"resume\"; break;\n                case \"Work Reference\": p1 = \"hasWorkRef\"; p2 = \"workRef\"; break;\n                case \"Landlord Reference\": p1 = \"hasLandlordRef\"; p2 = \"landlordRef\"; break;\n                case \"Financial Reference\": p1 = \"hasFinancialRef\"; p2 = \"financialRef\"; break;\n                case \"Government ID\": p1 = \"hasGovtID\"; p2 = \"govtID\"; break;\n                case \"Passport\": p1 = \"hasPassport\"; p2 = \"passport\"; break;\n                case \"PPS\": p1 = \"hasPPS\"; p2 = \"PPS\"; break;\n            }\n\n            // p1 = \"profile.references.\"+p1\n            // p2 = \"profile.references.\" + p2\n            this.p1.set(p1);\n            this.p2.set(p2);\n        }\n    }\n\n    this.step = new ReactiveVar( 1 );\n    this.sFileName = new ReactiveVar( false );\n\n    this.uploading = new ReactiveVar( false );\n    this.fileObj = new ReactiveVar( {} );\n    this.fileObjPrevious = new ReactiveVar( false );\n})\nTemplate.fileUploadDlgTemplate.helpers({\n    dlgTitle: function () {\n        var title = '';\n        var p1 = Template.instance().p1.get();\n        var p2 = Template.instance().p2.get();\n        var uploading = Template.instance().uploading.get();\n        var user = Meteor.user();\n        if(user.profile.references[p1]) var existingFile = true;\n\n\n        if(existingFile){\n            title =  'Update ';\n            if(!Template.instance().fileObjPrevious.get()) // only if its not yet set . Else other function will set it.\n                Template.instance().fileObjPrevious.set(user.profile.references[p2]);\n            console.log('fileObjPrevious')\n            console.log(Template.instance().fileObjPrevious.get())\n        }\n        else if(uploading)title =  'Uploading ';\n        else title = 'Upload ';\n\n        var sesCate = Template.instance().sesCate.get();\n        if(sesCate)title += sesCate;\n        else title+='References';\n\n        return title;\n    },\n    existingFile:function () {\n        var p2 = Template.instance().p2.get();\n        var user = Meteor.user();\n        if(user.profile.references[p2]) return user.profile.references[p2];\n\n        return false;\n    },\n    isStep: function (step) {\n      if(step == Template.instance().step.get() )return true;\n      else return false;\n    },\n    isNotStep: function (step) {\n      if(step != Template.instance().step.get() )return true;\n      else return false;\n    },\n    uploading: function(){\n        return Template.instance().uploading.get() ;\n    },\n    validFileExtensions: function(){\n        return _validFileExtensions;\n    }\n})\n\nTemplate.fileUploadDlgTemplate.events({\n    'click .showCamera':function (event, template) {\n        event.preventDefault();\n\n        template.$('#cropImage').cropper(\"destroy\");\n        template.$('#cropImage').attr(\"src\",'').hide();\n        template.$('#finalImage').attr(\"src\",'').hide();\n        $('.step2, #uploadImagePreviewArea').show();\n        $('.step3').hide();\n\n\n        var cameraOptions = {\n            width: 800,\n            height: 600\n        };\n        MeteorCamera.getPicture(cameraOptions, function (error, data) {\n            if (!error) {\n                template.$('#cropImage').attr('src', data);\n                template.step.set(2)\n                $('.step2').show();\n                $('.step3').hide();\n\n                template.sFileName.set('cameraPhoto.jpg');\n                //Now start the crop\n                if (data) {\n                    $('.step1').hide();\n                    template.$(\"#cropImage\").cropper({\n                        aspectRatio: 4 / 3\n                    });\n                }\n\n            }\n        });\n    },\n    'click .getCroppedImage':function (event, template) {\n\n        template.step.set(3)\n        $('.step2').hide();\n        $('.step3').show();\n        //Ratio 4:3 => 700 * 525\n        var finalImgData = template.$('#cropImage').cropper(\"getCroppedCanvas\", { width: 700, height: 525 }).toDataURL();\n        template.$('#finalImage').attr('src', finalImgData).show();\n\n        var head = 'data:image/png;base64,';\n        var imgFileSize = Math.round((finalImgData.length - head.length)*3/4) ;\n        var sizeKB = imgFileSize/1000;\n        var sizeMB = imgFileSize/1000000;\n        console.log(\"imgFileSize\", imgFileSize, \"size\", sizeMB, \"MB\", \"-----\", sizeKB, \"KB\");\n\n        var mimeType = 'image/jpeg';\n        var imgQuality = 1;\n        if(sizeKB>200)var imgQuality = 0.9;\n        if(sizeKB>300)var imgQuality = 0.8;\n        if(sizeKB>400)var imgQuality = 0.7;\n\n        const cate = template.sesCate.get();\n        var sFileName = template.sFileName.get(); if(!sFileName)sFileName = 'cameraPhoto.jpg';\n        // const inst = Template.instance();\n        var finalImgData = template.$('#cropImage').cropper(\"getCroppedCanvas\", { width: 700, height: 525 }).toBlob(function(blob){\n            template.uploading.set(true);\n            template.fileObj.set({});//Reset old status as this might be 2nd upload.\n\n            var ret = S3.upload({\n                file:new File([blob], sFileName),\n                path:\"profileFiles\"\n            },function(e,r){\n\n                if(e){\n                    $('.step1').show();\n                    var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                    tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n                    try{if(e.error)tmp.push(e.error);}catch (cat){}\n                    Session.set(\"showErrorDlg\",tmp)\n                    throw new Meteor.Error('Upload failed ', e);\n                    template.uploading.set(false);\n                    return;\n                }\n                console.log(r);\n\n                template.fileObj.set(r);\n\n                var tmp = {\n                    name: r.file.original_name,\n                    relative_url: r.relative_url,\n                    url: r.secure_url\n                }\n\n                console.log(tmp);\n                var fileObjPrevious = template.fileObjPrevious.get()//move here due to bug\n                Meteor.call('updateReferenceFile', [cate, tmp], (err, res) => {\n                    template.uploading.set(false);//Make it false even if it failed. Users should know that its not uploading anymore.\n                    $('.step2').hide();\n                    $('.step1').show();\n                    $('.step3').show();//Because its an image from cropped area\n                    if (err) {\n                        console.log(err);\n\n                        var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                        tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n                        try{if(err.error)tmp.push(err.error);}catch (cat){}\n                        Session.set(\"showErrorDlg\",tmp)\n\n                        //If updating in DB failed. Then delete in Amazon as well.\n                        var fileObj = template.fileObj.get();\n                        S3.delete(fileObj.relative_url,function(error, result){})\n                    } else {//If upload is success, then delete the old file and re-set it.\n                        // debugger;\n                        // var fileObjPrevious = template.fileObjPrevious.get()//Don' get it here, as parallely another code is changing this val->lead to bug\n                        if(fileObjPrevious){//only if it exists.\n                            S3.delete(fileObjPrevious.relative_url,function(error, result){})\n                            template.fileObjPrevious.set(template.fileObj.get() );\n                        }\n                    }\n                });\n\n\n            });\n\n\n\n        },mimeType, imgQuality);\n\n    },\n    'click .zoomInBtn':function (event, template) {\n        template.$('#cropImage').cropper(\"zoom\", 0.1);\n    },\n    'click .zoomOutBtn':function (event, template) {\n        template.$('#cropImage').cropper(\"zoom\", -0.1);\n    },\n    'click .rotateLeftBtn':function (event, template) {\n        template.$('#cropImage').cropper(\"rotate\", -90);\n    },\n    'click .rotateRightBtn':function (event, template) {\n        template.$('#cropImage').cropper(\"rotate\", 90);\n    },\n    'click .resetBtn':function (event, template) {\n        template.$('#cropImage').cropper(\"reset\");\n    },\n    'click .goToStep1':function (event, template) {\n        $('.step1').show();\n        template.$('#cropImage').cropper(\"destroy\");\n        template.$('#cropImage').attr(\"src\",'').hide();\n        template.$('#finalImage').attr(\"src\",'').hide();\n        $('.step2').hide();\n        $('.step3').hide();\n    },\n    'click .closeDlg':function (event, template) {\n        var ses = {show: false, cate: \"\"}\n        Session.set('showFileDlg', ses);// Has the overall info and basic required info.\n        Session.set('showFileTemplate', false);\n    },\n    'change .uploadBtn': function(event, template) {\n        var files = event.target.files;\n        if(!files)return;\n        if(files.length == 0)return;\n\n        Template.instance().step.set(2)\n        $('.step2, #uploadImagePreviewArea').show();\n        template.$('#cropImage').cropper(\"destroy\");\n        template.$('#cropImage').attr(\"src\",'').hide();\n        template.$('#finalImage').attr(\"src\",'').hide();\n        $('.step3').hide();\n\n        if (!filevalidation(files)) {\n            var tmp = Session.get(\"showErrorDlg\");\n            if (!tmp) tmp = [];\n            var msg = 'Upload rejected. Please upload only document or image files. Allowed extensions are ' + _validFileExtensions.join(', ') + '.';\n            tmp.push(msg);\n            Session.set(\"showErrorDlg\", tmp)\n\n            throw new Meteor.Error(\"Upload rejected. \");\n            return;\n        }\n\n        const cate = template.sesCate.get();\n        Template.instance().uploading.set(true);\n        // const inst = Template.instance();\n        template.fileObj.set({});//Reset old status as this might be 2nd upload.\n\n\n        if (files.length == 1) {\n            var target = event.target;\n            var sFileName = files[0].name;\n            template.sFileName.set(sFileName);\n            // $(\"#uploadImagePreviewArea\").html(\"\");\n            var regex = /^([a-zA-Z0-9\\s_\\\\.\\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;\n            if (regex.test($(target).val().toLowerCase())) {\n                if (isIE() && isIE() <= 9) {\n                    $(\"#uploadImagePreviewArea\").show();\n                    $(\"#uploadImagePreviewArea\")[0].filters.item(\"DXImageTransform.Microsoft.AlphaImageLoader\").src = $(target).val();\n                }\n                else {\n                    if (typeof (FileReader) != \"undefined\") {\n                        template.uploading.set(false);\n                        $(\"#uploadImagePreviewArea, #cropImage\").show();\n                        // $(\"#uploadImagePreviewArea\").append('<img class=\"img-responsive\" id=\"cropImage\"/>');\n                        var reader = new FileReader();\n                        reader.onload = function (e) {\n                            $(\"#cropImage\").attr(\"src\", e.target.result);\n\n                            //File name is set few lines above this\n                            //Now start the crop\n                            var imgData = $(\"#cropImage\").attr('src');\n                            if (imgData) {\n                                $('.step1').hide();\n                                template.$(\"#cropImage\").cropper({\n                                    aspectRatio: 4 / 3\n                                });\n                            }\n\n\n                        }\n                        reader.readAsDataURL($(target)[0].files[0]);\n                        return;//If previewer is available then let the cropper handle the upload.\n                    } else {\n                        console.log(\"This browser does not support FileReader.\");\n                    }\n                }\n            } else {\n                console.log(\"File upload: Not an image file to show preview.\");\n            }\n        }\n\n        // console.log('Not an image, so proceeding with traditional upload')\n\n        var ret = S3.upload({\n            files:files,\n            path:\"profileFiles\"\n        },function(e,r){\n            if(e){\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n                try{if(e.error)tmp.push(e.error);}catch (cat){}\n                Session.set(\"showErrorDlg\",tmp)\n                throw new Meteor.Error('Upload failed ', e);\n                template.uploading.set(false);\n                return;\n            }\n            console.log(r);\n\n            template.fileObj.set(r);\n\n            var tmp = {\n                name: r.file.original_name,\n                relative_url: r.relative_url,\n                url: r.secure_url\n            }\n\n            console.log(tmp);\n            var fileObjPrevious = template.fileObjPrevious.get()//move here due to bug\n            Meteor.call('updateReferenceFile', [cate, tmp], (err, res) => {\n                template.uploading.set(false);//Make it false even if it failed. Users should know that its not uploading anymore.\n                $('.step2').hide();\n                $('.step3').hide();//Because its not an image.\n                if (err) {\n                    console.log(err);\n\n                    var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                    tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n                    try{if(err.error)tmp.push(err.error);}catch (cat){}\n                    Session.set(\"showErrorDlg\",tmp)\n\n                    //If updating in DB failed. Then delete in Amazon as well.\n                    var fileObj = template.fileObj.get();\n                    S3.delete(fileObj.relative_url,function(error, result){})\n                } else {//If upload is success, then delete the old file and re-set it.\n                    // debugger;\n                    // var fileObjPrevious = template.fileObjPrevious.get()//Don' get it here, as parallely another code is changing this val->lead to bug\n                    if(fileObjPrevious){//only if it exists.\n                        S3.delete(fileObjPrevious.relative_url,function(error, result){})\n                        template.fileObjPrevious.set(template.fileObj.get() );\n                    }\n                }\n\n            });\n\n\n        });\n        // for (var i = 0, ln = files.length; i < ln; i++) {\n        //     propertyImagesCollection.insert(files[i], function (err, fileObj) {\n        //         // Inserted new doc with ID fileObj._id, and kicked off the data upload using HTTP\n        //         console.log(fileObj);\n        //         var cursor = propertyImagesCollection.find(fileObj._id);\n        //\n        //         var liveQuery = cursor.observe({\n        //             changed: function(newImage, oldImage) {\n        //\n        //                 console.log(\"Inside live query \");\n        //                 console.log(newImage);\n        //                 if (newImage.isUploaded()) {\n        //                     liveQuery.stop();\n        //\n        //                     // Call your onUploaded callback here...\n        //                 }\n        //             }\n        //         });\n        //     });\n        // }\n    },\n})\nTemplate.fileUploadDlgTemplate.onRendered(function(){\n    $(\"#uploadImagePreviewArea, #cropImage, #finalImage\").hide();\n    $('#cropImage, #finalImage').attr('src','');\n})\nTemplate.fileUploadArea.onCreated(function(){\n    this.uploading = new ReactiveVar( false );\n    // this.fileObj = new ReactiveVar( {} );\n})\nTemplate.fileUploadArea.helpers({\n    uploading: function(isMyBidsPage){\n        return Template.instance().uploading.get() ;\n    },\n    validFileExtensions: function(){\n        return _validFileExtensions;\n    }\n})\nTemplate.fileUploadArea.events({\n    'click .showUploadDlg': function(event, template) {\n        var ses = {show:true,cate:this.title}\n        Session.set('showFileDlg',ses);\n        return false;\n    },\n    // 'change .uploadBtn': function(event, template) {\n    //     var files = event.target.files;\n    //\n    //     if(!filevalidation(files)){\n    //         var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n    //         var msg = 'Upload rejected. Please upload only document or image files. Allowed extensions are '+_validFileExtensions.join(', ')+'.';\n    //         tmp.push(msg);\n    //         Session.set(\"showErrorDlg\",tmp)\n    //\n    //         throw new Meteor.Error(\"Upload rejected. \");\n    //         return;\n    //     }\n    //\n    //     const cate = event.target.getAttribute('cate');\n    //     Template.instance().uploading.set(true);\n    //     const inst = Template.instance();\n    //     inst.fileObj.set({});//Reset old status as this might be 2nd upload.\n    //     var ret = S3.upload({\n    //         files:files,\n    //         path:\"profileFiles\"\n    //     },function(e,r){\n    //         if(e){\n    //             var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n    //             tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n    //             try{if(e.error)tmp.push(e.error);}catch (cat){}\n    //             Session.set(\"showErrorDlg\",tmp)\n    //             throw new Meteor.Error('Upload failed ', e);return;\n    //         }\n    //         console.log(r);\n    //\n    //         inst.fileObj.set(r);\n    //\n    //         var tmp = {\n    //             name: r.file.original_name,\n    //             relative_url: r.relative_url,\n    //             url: r.secure_url\n    //         }\n    //\n    //         console.log(tmp);\n    //         Meteor.call('updateReferenceFile', [cate, tmp], (err, res) => {\n    //             inst.uploading.set(false);//Make it false even if it failed. Users should know that its not uploading anymore.\n    //             if (err) {\n    //                 console.log(err);\n    //\n    //                 var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n    //                 tmp.push(\"Upload failed. Please check your internet connectivity and try again. Contact us if needed.\");\n    //                 try{if(err.error)tmp.push(err.error);}catch (cat){}\n    //                 Session.set(\"showErrorDlg\",tmp)\n    //\n    //                 //If updating in DB failed. Then delete in Amazon as well.\n    //                 var fileObj = inst.fileObj.get();\n    //                 S3.delete(fileObj.relative_url,function(error, result){})\n    //             } else {\n    //\n    //             }\n    //\n    //         });\n    //\n    //\n    //     });\n    //     // for (var i = 0, ln = files.length; i < ln; i++) {\n    //     //     propertyImagesCollection.insert(files[i], function (err, fileObj) {\n    //     //         // Inserted new doc with ID fileObj._id, and kicked off the data upload using HTTP\n    //     //         console.log(fileObj);\n    //     //         var cursor = propertyImagesCollection.find(fileObj._id);\n    //     //\n    //     //         var liveQuery = cursor.observe({\n    //     //             changed: function(newImage, oldImage) {\n    //     //\n    //     //                 console.log(\"Inside live query \");\n    //     //                 console.log(newImage);\n    //     //                 if (newImage.isUploaded()) {\n    //     //                     liveQuery.stop();\n    //     //\n    //     //                     // Call your onUploaded callback here...\n    //     //                 }\n    //     //             }\n    //     //         });\n    //     //     });\n    //     // }\n    // },\n})\n\n\n\n\nfunction showSaveBtn(ele){\n  $(ele).parents('div.inp-hold').find('.overlay-text').fadeOut();\n  $(ele).fadeOut();\n  $(ele).parent('div.inp-hold').find('.save-btn').addClass('show-save');\n  $(ele).parent('div.inp-hold').find('div.cancel-div').css('display','block');\n  $(ele).parent('div.inp-hold').find('input').focus();\n}\nfunction hideSaveBtn(ele){\n  $(ele).parents('div.inp-hold').find('.save-btn').removeClass('show-save');\n  $(ele).parents('div.inp-hold').find('div.cancel-div').css('display','none');\n  $(ele).parents('div.inp-hold').find('.change-click').fadeIn();\n  $(ele).parents('div.inp-hold').find('.overlay-text').fadeIn();\n}\n\n\nTemplate.loginFormSetPassword.onCreated(() => {\n    let template = Template.instance();\n    template.formMessages = new ReactiveVar({});\n    template.isLoading = new ReactiveVar(false);\n});\nTemplate.loginFormSetPassword.helpers(LoginFormSharedHelpers);\nTemplate.loginFormSetPassword.events({\n\n    /**\n     * Submit form for password update\n     * @param  {Event} event - jQuery Event\n     * @param  {Template} template - Blaze Template\n     * @return {void}\n     */\n    \"submit form\": function (event, template) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        template.$(\"button[type=submit]\").attr(\"disabled\",true);\n\n        let password1Input = template.$(\".login-input--password1\");\n        let password2Input = template.$(\".login-input--password2\");\n        let password1 = password1Input.val().trim();\n        let password2 = password2Input.val().trim();\n        let templateInstance = Template.instance();\n        var errors = []\n\n\n        if(password1!=password2){\n            errors.push({\n                error: \"INVALID_PASSWORD\",\n                reason: \"Passwords doesn't match\"\n            });\n            // errors.password2 = [\n            //     {\n            //         error: \"INVALID_PASSWORD\",\n            //         reason: \"Passwords doesn't match\"\n            //     }\n            // ]\n            // templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);//We need it here because line 560 errors.password2 = validatedPassword2; will over write this message if we don't return here. Also array merge isn't an option as our UI is not ready to show multiple messages. It can only take 1 error at a time.\n            // templateInstance.formMessages.set({\n            //     errors: errors\n            // });\n            // return;\n        }\n        // We only check if it exists, just in case we\"ve change the password strength and want the\n        // user to have an opportunity to update to a stronger password\n        // let validatedPassword1 = LoginFormValidation.password(password1);//Not needed as we are doing equal check\n        let validatedPassword2 = LoginFormValidation.password(password2, {validationLevel: \"length\"});\n\n\n        templateInstance.formMessages.set({});\n        templateInstance.isLoading.set(true);\n\n        // if (validatedPassword1 !== true) {\n        //     errors.push(validatedPassword1);\n        // }\n        if (validatedPassword2 !== true) {\n            errors.push(validatedPassword2);\n        }\n\n        if (errors.length) {\n            templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);\n            templateInstance.formMessages.set({\n                errors: errors\n            });\n            // prevent signup\n            templateInstance.isLoading.set(false)\n            return;\n        }\n\n        Meteor.call('setUserPwd',[Meteor.userId(),password2],function(error, result){\n            // templateInstance.isLoading.set(false);\n            if (error) {\n                templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);\n                // Show some error message\n                templateInstance.formMessages.set({\n                    errors: [error]\n                });\n            } else {\n                Session.set('localHasPasswordSet',true);\n                templateInstance.$(\".login-input--password1, .login-input--password2\").val('')\n                $('#setpass-dlg .changePwdAlertMsgs p, #setpass-dlg .help-block p').html('');\n\n                // // Close dropdown or navigate to page\n                templateInstance.formMessages.set({\n                    info: [{\n                        reason: 'Password successfully set'\n                    }]\n                });\n\n                if($)if($.fancybox){\n                    $.fancybox.close();\n                    templateInstance.formMessages.set({});\n                }\n            }\n        })\n    }\n});\n\nTemplate.loginFormChangePassword.onCreated(() => {\n    let template = Template.instance();\n    template.formMessages = new ReactiveVar({});\n    template.isLoading = new ReactiveVar(false);\n});\nTemplate.loginFormChangePassword.helpers(LoginFormSharedHelpers);\nTemplate.loginFormChangePassword.events({\n\n    /**\n     * Submit form for password update\n     * @param  {Event} event - jQuery Event\n     * @param  {Template} template - Blaze Template\n     * @return {void}\n     */\n    \"submit form\": function (event, template) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        template.$(\"button[type=submit]\").attr(\"disabled\",true);\n\n        let oldPasswordInput = template.$(\".login-input--oldPassword\");\n        let passwordInput = template.$(\".login-input--password\");\n\n        let oldPassword = oldPasswordInput.val().trim();\n        let password = passwordInput.val().trim();\n\n        // We only check if it exists, just incase we\"ve change the password strength and want the\n        // user to have an oppurtinity to update to a stronger password\n        let validatedOldPassword = LoginFormValidation.password(oldPassword, {validationLevel: \"exists\"});\n        let validatedPassword = LoginFormValidation.password(password, {validationLevel: \"length\"});\n\n        let templateInstance = Template.instance();\n        templateInstance.isLoading.set(true);\n        var errors = []\n\n        templateInstance.formMessages.set({});\n        templateInstance.isLoading.set(true)\n\n        if(oldPassword==password){\n            errors.push({\n                error: \"INVALID_PASSWORD\",\n                reason: \"New password cannot be same as old password.\"\n            });\n            // errors.password2 = [\n            //     {\n            //         error: \"INVALID_PASSWORD\",\n            //         reason: \"Passwords doesn't match\"\n            //     }\n            // ]\n            // templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);//We need it here because line 560 errors.password2 = validatedPassword2; will over write this message if we don't return here. Also array merge isn't an option as our UI is not ready to show multiple messages. It can only take 1 error at a time.\n            // templateInstance.formMessages.set({\n            //     errors: errors\n            // });\n            // return;\n        }\n        if (validatedOldPassword !== true) {\n            errors.push(validatedOldPassword);\n        }\n        if (validatedPassword !== true) {\n            errors.push(validatedPassword);\n        }\n\n        if (errors.length) {\n            templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);\n            templateInstance.formMessages.set({\n                errors: errors\n            });\n            // prevent signup\n            templateInstance.isLoading.set(false)\n            return;\n        }\n\n        Accounts.changePassword(oldPassword, password, (error) => {\n            //console.log('Here in callback');\n            //templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);\n            templateInstance.isLoading.set(false);\n            if (error) {\n                templateInstance.$(\"button[type=submit]\").attr(\"disabled\",false);\n                // Show some error message\n                templateInstance.formMessages.set({\n                    errors: [error]\n                });\n            } else {\n\n                templateInstance.$(\".login-input--oldPassword, .login-input--password\").val('')\n                $('#changepass-dlg .changePwdAlertMsgs p, #changepass-dlg .help-block p').html('');\n                //$('.login-input--password, .login-input--oldPassword').val('');\n\n                // // Close dropdown or navigate to page\n                templateInstance.formMessages.set({\n                    info: [{\n                        reason: 'Password successfully changed'\n                    }]\n                });\n\n                if($)if($.fancybox){\n                    $.fancybox.close();\n                    templateInstance.formMessages.set({});\n                }\n            }\n        });\n    }\n});\n\nfunction titleCase(str){\n    if(!str)return;\n    return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\nfunction isIE () {\n    var myNav = navigator.userAgent.toLowerCase();\n    return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : false;\n}"]},"sourceType":"module","hash":"6bb1bdfe58f21ab206af6e0f27168650a5e1759e"}
