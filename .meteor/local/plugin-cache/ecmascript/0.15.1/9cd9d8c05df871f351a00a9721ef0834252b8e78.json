{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/momen/projects/spotmycrib-master/packages/jns:flow-router-ssr/client/router.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/jns:flow-router-ssr/client/router.js","filename":"/home/momen/projects/spotmycrib-master/packages/jns:flow-router-ssr/client/router.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/momen/projects/spotmycrib-master","root":"/home/momen/projects/spotmycrib-master","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/momen/projects/spotmycrib-master/packages/jns:flow-router-ssr/client/router.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/jns:flow-router-ssr/client/router.js"}},"code":"var _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 0);\n\nvar _typeof;\n\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 1);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 2);\n\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 3);\nvar Qs;\nmodule.link(\"qs\", {\n  \"default\": function (v) {\n    Qs = v;\n  }\n}, 0);\nvar PathToRegexp;\nmodule.link(\"path-to-regexp\", {\n  \"default\": function (v) {\n    PathToRegexp = v;\n  }\n}, 1);\nvar ParseUrl;\nmodule.link(\"parseurl\", {\n  \"default\": function (v) {\n    ParseUrl = v;\n  }\n}, 2);\nvar logger = console;\n\nRouter = /*#__PURE__*/function (_SharedRouter) {\n  _inheritsLoose(Router, _SharedRouter);\n\n  function Router() {\n    var _this;\n\n    _this = _SharedRouter.call(this) || this; // holds the current context\n\n    _this._current = {}; // tracks the current path change\n\n    _this._onEveryPath = new Tracker.Dependency();\n    _this._params = new ReactiveDict();\n    _this._queryParams = new ReactiveDict(); // if _askedToWait is true. We don't automatically start the router\n    // in Meteor.startup callback. (see client/_init.js)\n    // Instead user need to call `.initialize()\n\n    _this._askedToWait = false;\n    _this._initialized = false;\n    _this._triggersEnter = [];\n    _this._triggersExit = []; // Meteor exposes to the client the path prefix that was defined using the\n    // ROOT_URL environement variable on the server using the global runtime\n    // configuration. See #315.\n\n    _this._basePath = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n    _this.env.replaceState = new Meteor.EnvironmentVariable();\n    _this.env.reload = new Meteor.EnvironmentVariable();\n    _this.env.inAction = new Meteor.EnvironmentVariable();\n    _this.env.inPopstate = new Meteor.EnvironmentVariable(); // this holds route pathDefs\n\n    _this._routeDefs = [];\n\n    _this._initTriggersAPI();\n\n    _this._initClickAnchorHandlers();\n\n    return _this;\n  }\n\n  var _proto = Router.prototype;\n\n  _proto.initialize = function () {\n    function initialize(options) {\n      options = options || {};\n\n      if (this._initialized) {\n        throw new Error('FlowRouter is already initialized');\n      }\n\n      this._initialized = true;\n      var path = location.pathname + location.search + (location.hash || '');\n\n      this._initiateHandlingBackButton();\n\n      this.go(path);\n    }\n\n    return initialize;\n  }();\n\n  _proto.wait = function () {\n    function wait() {\n      if (this._initialized) {\n        throw new Error(\"can't wait after FlowRouter has been initialized\");\n      }\n\n      this._askedToWait = true;\n    }\n\n    return wait;\n  }();\n\n  _proto.reload = function () {\n    function reload() {\n      var _this2 = this;\n\n      this.env.reload.withValue(true, function () {\n        _this2.go(_this2._current.path);\n      });\n    }\n\n    return reload;\n  }();\n\n  _proto.setParams = function () {\n    function setParams(newParams) {\n      if (!this._current.route) {\n        return false;\n      }\n\n      var pathDef = this._current.route.pathDef;\n      var existingParams = this._current.params;\n\n      var params = _objectSpread(_objectSpread({}, existingParams), newParams);\n\n      for (var k in meteorBabelHelpers.sanitizeForInObject(params)) {\n        if (params[k] === null || params[k] === undefined) {\n          delete params[k];\n        }\n      }\n\n      var queryParams = this._current.queryParams;\n      this.go(pathDef, params, queryParams);\n      return true;\n    }\n\n    return setParams;\n  }();\n\n  _proto.setQueryParams = function () {\n    function setQueryParams(newParams) {\n      if (!this._current.route) {\n        return false;\n      }\n\n      var queryParams = _objectSpread(_objectSpread({}, this._current.queryParams), newParams);\n\n      for (var k in meteorBabelHelpers.sanitizeForInObject(queryParams)) {\n        if (queryParams[k] === null || queryParams[k] === undefined) {\n          delete queryParams[k];\n        }\n      }\n\n      var pathDef = this._current.route.pathDef;\n      var params = this._current.params;\n      this.go(pathDef, params, queryParams);\n      return true;\n    }\n\n    return setQueryParams;\n  }();\n\n  _proto.withReplaceState = function () {\n    function withReplaceState(fn) {\n      return this.env.replaceState.withValue(true, fn);\n    }\n\n    return withReplaceState;\n  }();\n\n  _proto.watchPathChange = function () {\n    function watchPathChange() {\n      this._onEveryPath.depend();\n    }\n\n    return watchPathChange;\n  }();\n\n  _proto.getParam = function () {\n    function getParam(key) {\n      // We update this._params reactive store only after we Tracker.afterFlush\n      // event to make sure, older routes does not get the updated value even\n      // before the new UI is rendered.\n      //\n      // But, then it cause issues for the new route(in the action)\n      // where if picks up older data.\n      //\n      // That's why we directly get values from the context when called\n      // inside an action.\n      var value = this._params.get(key);\n\n      if (this.env.inAction.get()) {\n        return this._current.params[key];\n      }\n\n      return value;\n    }\n\n    return getParam;\n  }();\n\n  _proto.getQueryParam = function () {\n    function getQueryParam(key) {\n      // See above .getParam() for more information.\n      var value = this._queryParams.get(key);\n\n      if (this.env.inAction.get()) {\n        return this._current.queryParams[key];\n      }\n\n      return value;\n    }\n\n    return getQueryParam;\n  }();\n\n  _proto.getRouteName = function () {\n    function getRouteName() {\n      this.watchPathChange();\n      return this._current.route.name;\n    }\n\n    return getRouteName;\n  }();\n\n  _proto.route = function () {\n    function route(pathDef, options, group) {\n      var currentRoute = _SharedRouter.prototype.route.call(this, pathDef, options, group);\n\n      var keys = [];\n      var regexp = PathToRegexp(pathDef, keys);\n\n      this._routeDefs.push({\n        regexp: regexp,\n        keys: keys,\n        pathDef: pathDef,\n        route: currentRoute\n      });\n\n      return currentRoute;\n    }\n\n    return route;\n  }();\n\n  _proto.go = function () {\n    function go(pathDef, fields, queryParams) {\n      var _this3 = this;\n\n      var path = this.path(pathDef, fields, queryParams);\n\n      if (!path) {\n        logger.error('Path is required for FlowRouter.go()');\n        return;\n      }\n\n      var context = this._buildContext(path); // Implement idempotant routing\n\n\n      var insideAReload = this.env.reload.get();\n\n      if (this._current.path === path && !insideAReload) {\n        return;\n      }\n\n      var allQueryParams = this._decodeValues(Qs.parse(context.queryString)); // Remove basePath from the path\n\n\n      var pathname = context.pathname;\n\n      if (this._basePath) {\n        var cleanedBasePath = this._basePath.trim().replace(/^\\//, '').replace(/$\\//, '');\n\n        pathname = context.pathname.replace(\"/\" + cleanedBasePath, '');\n      }\n\n      var _loop = function (lc) {\n        var routeDef = _this3._routeDefs[lc];\n        var matched = routeDef.regexp.exec(pathname);\n\n        if (matched) {\n          var params = {};\n          routeDef.keys.forEach(function (_ref, index) {\n            var name = _ref.name;\n            var match = matched[index + 1];\n            params[name] = typeof match !== 'undefined' ? decodeURIComponent(match) : match;\n          });\n\n          var matchedContext = _objectSpread(_objectSpread({}, context), {}, {\n            params: params,\n            queryParams: allQueryParams,\n            route: routeDef.route\n          });\n\n          _this3._navigate(matchedContext);\n\n          return {\n            v: void 0\n          };\n        }\n      };\n\n      for (var lc = 0; lc < this._routeDefs.length; lc++) {\n        var _ret = _loop(lc);\n\n        if (_typeof(_ret) === \"object\") return _ret.v;\n      }\n\n      var notFoundRoute = this._getNotFoundRoute();\n\n      var notFoundContext = _objectSpread(_objectSpread({}, context), {}, {\n        route: notFoundRoute,\n        params: {},\n        queryParams: allQueryParams\n      });\n\n      this._navigate(notFoundContext);\n    }\n\n    return go;\n  }();\n\n  _proto._navigate = function () {\n    function _navigate(context) {\n      var triggersEnter = [].concat(_toConsumableArray(this._triggersEnter), _toConsumableArray(context.route._triggersEnter));\n\n      var redirectArgs = this._runTriggers(triggersEnter, context);\n\n      if (redirectArgs) {\n        return this.go.apply(this, _toConsumableArray(redirectArgs));\n      } // Set the current context\n\n\n      var oldContext = this._current;\n      this._current = context; // Run exit handlers\n\n      if (oldContext && oldContext.route) {\n        var triggersExit = [].concat(_toConsumableArray(this._triggersExit), _toConsumableArray(oldContext.route._triggersExit));\n\n        var exitRedirectArgs = this._runTriggers(triggersExit, oldContext);\n\n        if (exitRedirectArgs) {\n          return this.go.apply(this, _toConsumableArray(exitRedirectArgs));\n        }\n      } // If we are inside a popstate event,\n      // we should not change the history\n\n\n      if (!this.env.inPopstate.get()) {\n        var useReplaceState = this.env.replaceState.get();\n        var path = context.path,\n            params = context.params,\n            queryParams = context.queryParams;\n        var urlState = {\n          path: path,\n          params: params,\n          queryParams: queryParams\n        };\n\n        if (useReplaceState) {\n          history.replaceState(urlState, window.title, path);\n        } else {\n          history.pushState(urlState, window.title, path);\n        }\n      }\n\n      this._applyRoute();\n    }\n\n    return _navigate;\n  }();\n\n  _proto._applyRoute = function () {\n    function _applyRoute() {\n      var _this4 = this;\n\n      var currentContext = this._current;\n      var route = currentContext.route; // otherwise, computations inside action will trigger to re-run\n      // this computation. which we do not need.\n\n      Tracker.nonreactive(function () {\n        _this4.env.inAction.withValue(true, function () {\n          route.callAction(currentContext);\n        });\n\n        Tracker.afterFlush(function () {\n          _this4._onEveryPath.changed();\n\n          _this4._updateReactiveDict(_this4._params, currentContext.params);\n\n          _this4._updateReactiveDict(_this4._queryParams, currentContext.queryParams);\n        });\n      });\n    }\n\n    return _applyRoute;\n  }();\n\n  _proto._getNotFoundRoute = function () {\n    function _getNotFoundRoute() {\n      var notFoundOptions = this.notFound || {\n        action: function () {\n          var current = FlowRouter.current();\n          logger.error('There is no route for the path:', current.path);\n        }\n      };\n      return new Route(this, '*', notFoundOptions);\n    }\n\n    return _getNotFoundRoute;\n  }();\n\n  _proto._runTriggers = function () {\n    function _runTriggers(triggers, context) {\n      var redirectArgs;\n\n      var redirectFn = function (url, params, queryParams) {\n        if (/^http(s)?:\\/\\//.test(url)) {\n          var message = \"\\n          Redirects to URLs outside of the app are not supported\\n          in this version of Flow Router.\\n          Use 'window.location = yourUrl' instead.\\n        \";\n          throw new Error(message);\n        }\n\n        redirectArgs = [url, params, queryParams];\n      };\n\n      Triggers.runTriggers(triggers, context, redirectFn, function () {});\n      return redirectArgs;\n    }\n\n    return _runTriggers;\n  }();\n\n  _proto._decodeValues = function () {\n    function _decodeValues(obj) {\n      var newObj = {};\n      Object.keys(obj).forEach(function (key) {\n        var value = obj[key];\n        newObj[key] = typeof value !== 'undefined' ? decodeURIComponent(value) : value;\n      });\n      return newObj;\n    }\n\n    return _decodeValues;\n  }();\n\n  _proto._updateReactiveDict = function () {\n    function _updateReactiveDict(dict, newValues) {\n      var currentKeys = _.keys(newValues);\n\n      var oldKeys = _.keys(dict.keyDeps); // set new values\n\n\n      currentKeys.forEach(function (key) {\n        dict.set(key, newValues[key]);\n      }); // remove keys which does not exisits here\n\n      var removedKeys = _.difference(oldKeys, currentKeys);\n\n      removedKeys.forEach(function (key) {\n        dict.set(key, undefined);\n      });\n    }\n\n    return _updateReactiveDict;\n  }();\n\n  _proto._initTriggersAPI = function () {\n    function _initTriggersAPI() {\n      var _this5 = this;\n\n      this.triggers = {\n        enter: function (triggers, filter) {\n          triggers = Triggers.applyFilters(triggers, filter);\n\n          if (triggers.length) {\n            _this5._triggersEnter = _this5._triggersEnter.concat(triggers);\n          }\n        },\n        exit: function (triggers, filter) {\n          triggers = Triggers.applyFilters(triggers, filter);\n\n          if (triggers.length) {\n            _this5._triggersExit = _this5._triggersExit.concat(triggers);\n          }\n        }\n      };\n    }\n\n    return _initTriggersAPI;\n  }() // This is required for implementing a router class.\n  ;\n\n  _proto._getCurrentRouteContext = function () {\n    function _getCurrentRouteContext() {\n      return this._current;\n    }\n\n    return _getCurrentRouteContext;\n  }();\n\n  _proto._initClickAnchorHandlers = function () {\n    function _initClickAnchorHandlers() {\n      // This logic is taken from page.js\n      // See: https://github.com/visionmedia/page.js\n      var self = this;\n      var clickEvent = typeof document !== 'undefined' && document.ontouchstart ? 'touchstart' : 'click';\n      document.addEventListener(clickEvent, onclick, false);\n\n      function onclick(e) {\n        if (which(e) !== 1) {\n          return;\n        }\n\n        if (e.metaKey || e.ctrlKey || e.shiftKey) {\n          return;\n        }\n\n        if (e.defaultPrevented) {\n          return;\n        } // ensure link\n        // use shadow dom when available\n\n\n        var el = e.path ? e.path[0] : e.target;\n\n        while (el && el.nodeName !== 'A') {\n          el = el.parentNode;\n        }\n\n        if (!el || el.nodeName !== 'A') {\n          return;\n        } // Ignore if tag has\n        // 1. \"download\" attribute\n        // 2. rel=\"external\" attribute\n\n\n        if (el.hasAttribute('download') || el.getAttribute('rel') === 'external') {\n          return;\n        } // ensure non-hash for the same path\n\n\n        var link = el.getAttribute('href');\n\n        if (el.pathname === location.pathname && (el.hash || link === '#')) {\n          return;\n        } // Check for mailto: in the href\n\n\n        if (link && link.indexOf('mailto:') > -1) {\n          return;\n        } // check target\n\n\n        if (el.target) {\n          return;\n        } // x-origin\n\n\n        if (!sameOrigin(el.href)) {\n          return;\n        } // rebuild path\n\n\n        var path = el.pathname + el.search + (el.hash || ''); // strip leading \"/[drive letter]:\" on NW.js on Windows\n\n        if (typeof process !== 'undefined' && path.match(/^\\/[a-zA-Z]:\\//)) {\n          path = path.replace(/^\\/[a-zA-Z]:\\//, '/');\n        }\n\n        e.preventDefault();\n        self.go(path);\n      }\n\n      function which(e) {\n        e = e || window.event;\n        return e.which === null ? e.button : e.which;\n      }\n\n      function sameOrigin(href) {\n        var origin = location.protocol + \"//\" + location.hostname;\n\n        if (location.port) {\n          origin += \":\" + location.port;\n        }\n\n        return href && href.indexOf(origin) === 0;\n      }\n    }\n\n    return _initClickAnchorHandlers;\n  }();\n\n  _proto._initiateHandlingBackButton = function () {\n    function _initiateHandlingBackButton() {\n      var self = this;\n      window.addEventListener('popstate', onpopstate, false);\n\n      function onpopstate() {\n        // In some browsers they fire popstate event right after page has loaded.\n        // That's not the correct way for the popstate.\n        // Normally, we need to handle it.\n        // But, we don't want to do it since self.go() is already idempotent.\n        var path = location.pathname + location.search + (location.hash || '');\n        self.env.inPopstate.withValue(true, function () {\n          self.go(path);\n        });\n      }\n    }\n\n    return _initiateHandlingBackButton;\n  }();\n\n  _proto._buildContext = function () {\n    function _buildContext(path) {\n      var parsedUrl = ParseUrl({\n        url: path\n      });\n      var context = {\n        path: path,\n        pathname: parsedUrl.pathname,\n        hash: parsedUrl.hash ? parsedUrl.hash.substr(1) : null,\n        queryString: parsedUrl.search ? parsedUrl.search.substr(1) : null\n      };\n      return context;\n    }\n\n    return _buildContext;\n  }();\n\n  return Router;\n}(SharedRouter);","map":{"version":3,"sources":["packages/jns:flow-router-ssr/client/router.js"],"names":["_toConsumableArray","module","link","default","v","_typeof","_objectSpread","_inheritsLoose","Qs","PathToRegexp","ParseUrl","logger","console","Router","_current","_onEveryPath","Tracker","Dependency","_params","ReactiveDict","_queryParams","_askedToWait","_initialized","_triggersEnter","_triggersExit","_basePath","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","env","replaceState","Meteor","EnvironmentVariable","reload","inAction","inPopstate","_routeDefs","_initTriggersAPI","_initClickAnchorHandlers","initialize","options","Error","path","location","pathname","search","hash","_initiateHandlingBackButton","go","wait","withValue","setParams","newParams","route","pathDef","existingParams","params","k","undefined","queryParams","setQueryParams","withReplaceState","fn","watchPathChange","depend","getParam","key","value","get","getQueryParam","getRouteName","name","group","currentRoute","keys","regexp","push","fields","error","context","_buildContext","insideAReload","allQueryParams","_decodeValues","parse","queryString","cleanedBasePath","trim","replace","lc","routeDef","matched","exec","forEach","index","match","decodeURIComponent","matchedContext","_navigate","length","notFoundRoute","_getNotFoundRoute","notFoundContext","triggersEnter","redirectArgs","_runTriggers","oldContext","triggersExit","exitRedirectArgs","useReplaceState","urlState","history","window","title","pushState","_applyRoute","currentContext","nonreactive","callAction","afterFlush","changed","_updateReactiveDict","notFoundOptions","notFound","action","current","FlowRouter","Route","triggers","redirectFn","url","test","message","Triggers","runTriggers","obj","newObj","Object","dict","newValues","currentKeys","_","oldKeys","keyDeps","set","removedKeys","difference","enter","filter","applyFilters","concat","exit","_getCurrentRouteContext","self","clickEvent","document","ontouchstart","addEventListener","onclick","e","which","metaKey","ctrlKey","shiftKey","defaultPrevented","el","target","nodeName","parentNode","hasAttribute","getAttribute","indexOf","sameOrigin","href","process","preventDefault","event","button","origin","protocol","hostname","port","onpopstate","parsedUrl","substr","SharedRouter"],"mappings":"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","sourcesContent":["/* eslint new-cap: 0, no-loop-func: 0, prefer-arrow-callback: 0 */\nimport Qs from 'qs';\nimport PathToRegexp from 'path-to-regexp';\nimport ParseUrl from 'parseurl';\nconst logger = console;\n\nRouter = class extends SharedRouter {\n  constructor() {\n    super();\n\n    // holds the current context\n    this._current = {};\n\n    // tracks the current path change\n    this._onEveryPath = new Tracker.Dependency();\n    this._params = new ReactiveDict();\n    this._queryParams = new ReactiveDict();\n\n    // if _askedToWait is true. We don't automatically start the router\n    // in Meteor.startup callback. (see client/_init.js)\n    // Instead user need to call `.initialize()\n    this._askedToWait = false;\n    this._initialized = false;\n\n    this._triggersEnter = [];\n    this._triggersExit = [];\n\n    // Meteor exposes to the client the path prefix that was defined using the\n    // ROOT_URL environement variable on the server using the global runtime\n    // configuration. See #315.\n    this._basePath = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n\n    this.env.replaceState = new Meteor.EnvironmentVariable();\n    this.env.reload = new Meteor.EnvironmentVariable();\n    this.env.inAction = new Meteor.EnvironmentVariable();\n    this.env.inPopstate = new Meteor.EnvironmentVariable();\n\n    // this holds route pathDefs\n    this._routeDefs = [];\n\n    this._initTriggersAPI();\n    this._initClickAnchorHandlers();\n  }\n\n  initialize(options) {\n    options = options || {};\n\n    if (this._initialized) {\n      throw new Error('FlowRouter is already initialized');\n    }\n\n    this._initialized = true;\n    const path = location.pathname + location.search + (location.hash || '');\n    this._initiateHandlingBackButton();\n    this.go(path);\n  }\n\n  wait() {\n    if (this._initialized) {\n      throw new Error(\"can't wait after FlowRouter has been initialized\");\n    }\n\n    this._askedToWait = true;\n  }\n\n  reload() {\n    this.env.reload.withValue(true, () => {\n      this.go(this._current.path);\n    });\n  }\n\n  setParams(newParams) {\n    if (!this._current.route) {\n      return false;\n    }\n\n    const pathDef = this._current.route.pathDef;\n    const existingParams = this._current.params;\n\n    const params = {\n      ...existingParams,\n      ...newParams\n    };\n\n    for (const k in params) {\n      if (params[k] === null || params[k] === undefined) {\n        delete params[k];\n      }\n    }\n\n    const queryParams = this._current.queryParams;\n\n    this.go(pathDef, params, queryParams);\n    return true;\n  }\n\n  setQueryParams(newParams) {\n    if (!this._current.route) {\n      return false;\n    }\n\n    const queryParams = {\n      ...this._current.queryParams,\n      ...newParams\n    };\n\n    for (const k in queryParams) {\n      if (queryParams[k] === null || queryParams[k] === undefined) {\n        delete queryParams[k];\n      }\n    }\n\n    const pathDef = this._current.route.pathDef;\n    const params = this._current.params;\n    this.go(pathDef, params, queryParams);\n    return true;\n  }\n\n  withReplaceState(fn) {\n    return this.env.replaceState.withValue(true, fn);\n  }\n\n  watchPathChange() {\n    this._onEveryPath.depend();\n  }\n\n  getParam(key) {\n    // We update this._params reactive store only after we Tracker.afterFlush\n    // event to make sure, older routes does not get the updated value even\n    // before the new UI is rendered.\n    //\n    // But, then it cause issues for the new route(in the action)\n    // where if picks up older data.\n    //\n    // That's why we directly get values from the context when called\n    // inside an action.\n    const value = this._params.get(key);\n    if (this.env.inAction.get()) {\n      return this._current.params[key];\n    }\n\n    return value;\n  }\n\n  getQueryParam(key) {\n    // See above .getParam() for more information.\n    const value = this._queryParams.get(key);\n    if (this.env.inAction.get()) {\n      return this._current.queryParams[key];\n    }\n\n    return value;\n  }\n\n  getRouteName() {\n    this.watchPathChange();\n    return this._current.route.name;\n  }\n\n  route(pathDef, options, group) {\n    const currentRoute = super.route(pathDef, options, group);\n    const keys = [];\n    const regexp = PathToRegexp(pathDef, keys);\n    this._routeDefs.push({regexp, keys, pathDef, route: currentRoute});\n\n    return currentRoute;\n  }\n\n  go(pathDef, fields, queryParams) {\n    const path = this.path(pathDef, fields, queryParams);\n\n    if (!path) {\n      logger.error('Path is required for FlowRouter.go()');\n      return;\n    }\n\n    const context = this._buildContext(path);\n\n    // Implement idempotant routing\n    const insideAReload = this.env.reload.get();\n    if (this._current.path === path && !insideAReload) {\n      return;\n    }\n\n    const allQueryParams = this._decodeValues(Qs.parse(context.queryString));\n\n    // Remove basePath from the path\n    let pathname = context.pathname;\n    if (this._basePath) {\n      const cleanedBasePath = this._basePath\n        .trim()\n        .replace(/^\\//, '')\n        .replace(/$\\//, '');\n      pathname = context.pathname.replace(`/${cleanedBasePath}`, '');\n    }\n\n    for (let lc = 0; lc < this._routeDefs.length; lc++) {\n      const routeDef = this._routeDefs[lc];\n      const matched = routeDef.regexp.exec(pathname);\n      if (matched) {\n        const params = {};\n        routeDef.keys.forEach(({name}, index) => {\n          const match = matched[index + 1];\n          params[name] = typeof match !== 'undefined' ? decodeURIComponent(match) : match;\n        });\n\n        const matchedContext = {\n          ...context,\n          params,\n          queryParams: allQueryParams,\n          route: routeDef.route\n        };\n\n        this._navigate(matchedContext);\n        return;\n      }\n    }\n\n    const notFoundRoute = this._getNotFoundRoute();\n    const notFoundContext = {\n      ...context,\n      route: notFoundRoute,\n      params: {},\n      queryParams: allQueryParams\n    };\n    this._navigate(notFoundContext);\n  }\n\n  _navigate(context) {\n    const triggersEnter = [\n      ...this._triggersEnter,\n      ...context.route._triggersEnter\n    ];\n    const redirectArgs = this._runTriggers(triggersEnter, context);\n\n    if (redirectArgs) {\n      return this.go(...redirectArgs);\n    }\n\n    // Set the current context\n    const oldContext = this._current;\n    this._current = context;\n\n    // Run exit handlers\n    if (oldContext && oldContext.route) {\n      const triggersExit = [\n        ...this._triggersExit,\n        ...oldContext.route._triggersExit\n      ];\n      const exitRedirectArgs = this._runTriggers(triggersExit, oldContext);\n\n      if (exitRedirectArgs) {\n        return this.go(...exitRedirectArgs);\n      }\n    }\n\n    // If we are inside a popstate event,\n    // we should not change the history\n    if (!this.env.inPopstate.get()) {\n      const useReplaceState = this.env.replaceState.get();\n      const {path, params, queryParams} = context;\n      const urlState = {path, params, queryParams};\n      if (useReplaceState) {\n        history.replaceState(urlState, window.title, path);\n      } else {\n        history.pushState(urlState, window.title, path);\n      }\n    }\n\n    this._applyRoute();\n  }\n\n  _applyRoute() {\n    const currentContext = this._current;\n    const route = currentContext.route;\n\n    // otherwise, computations inside action will trigger to re-run\n    // this computation. which we do not need.\n    Tracker.nonreactive(() => {\n      this.env.inAction.withValue(true, () => {\n        route.callAction(currentContext);\n      });\n\n      Tracker.afterFlush(() => {\n        this._onEveryPath.changed();\n        this._updateReactiveDict(this._params, currentContext.params);\n        this._updateReactiveDict(this._queryParams, currentContext.queryParams);\n      });\n    });\n  }\n\n  _getNotFoundRoute() {\n    const notFoundOptions = this.notFound || {\n      action() {\n        const current = FlowRouter.current();\n        logger.error('There is no route for the path:', current.path);\n      }\n    };\n\n    return new Route(this, '*', notFoundOptions);\n  }\n\n  _runTriggers(triggers, context) {\n    let redirectArgs;\n    const redirectFn = (url, params, queryParams) => {\n      if (/^http(s)?:\\/\\//.test(url)) {\n        const message = `\n          Redirects to URLs outside of the app are not supported\n          in this version of Flow Router.\n          Use 'window.location = yourUrl' instead.\n        `;\n        throw new Error(message);\n      }\n      redirectArgs = [url, params, queryParams];\n    };\n\n    Triggers.runTriggers(\n      triggers,\n      context,\n      redirectFn,\n      () => {}\n    );\n\n    return redirectArgs;\n  }\n\n  _decodeValues(obj) {\n    const newObj = {};\n    Object.keys(obj).forEach(key => {\n      const value = obj[key];\n      newObj[key] = typeof value !== 'undefined' ? decodeURIComponent(value) : value;\n    });\n\n    return newObj;\n  }\n\n  _updateReactiveDict(dict, newValues) {\n    const currentKeys = _.keys(newValues);\n    const oldKeys = _.keys(dict.keyDeps);\n\n    // set new values\n    currentKeys.forEach((key) => {\n      dict.set(key, newValues[key]);\n    });\n\n    // remove keys which does not exisits here\n    const removedKeys = _.difference(oldKeys, currentKeys);\n    removedKeys.forEach((key) => {\n      dict.set(key, undefined);\n    });\n  }\n\n  _initTriggersAPI() {\n    this.triggers = {\n      enter: (triggers, filter) => {\n        triggers = Triggers.applyFilters(triggers, filter);\n        if (triggers.length) {\n          this._triggersEnter = this._triggersEnter.concat(triggers);\n        }\n      },\n\n      exit: (triggers, filter) => {\n        triggers = Triggers.applyFilters(triggers, filter);\n        if (triggers.length) {\n          this._triggersExit = this._triggersExit.concat(triggers);\n        }\n      }\n    };\n  }\n\n  // This is required for implementing a router class.\n  _getCurrentRouteContext() {\n    return this._current;\n  }\n\n  _initClickAnchorHandlers() {\n    // This logic is taken from page.js\n    // See: https://github.com/visionmedia/page.js\n    const self = this;\n    const clickEvent =\n      typeof document !== 'undefined' && document.ontouchstart ?\n      'touchstart' : 'click';\n    document.addEventListener(clickEvent, onclick, false);\n\n    function onclick(e) {\n      if (which(e) !== 1) {\n        return;\n      }\n\n      if (e.metaKey || e.ctrlKey || e.shiftKey) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      // ensure link\n      // use shadow dom when available\n      let el = e.path ? e.path[0] : e.target;\n      while (el && el.nodeName !== 'A' ) {\n        el = el.parentNode;\n      }\n\n      if (!el || el.nodeName !== 'A') {\n        return;\n      }\n\n      // Ignore if tag has\n      // 1. \"download\" attribute\n      // 2. rel=\"external\" attribute\n      if (el.hasAttribute('download') || el.getAttribute('rel') === 'external') {\n        return;\n      }\n\n      // ensure non-hash for the same path\n      const link = el.getAttribute('href');\n      if (el.pathname === location.pathname && (el.hash || link === '#')) {\n        return;\n      }\n\n      // Check for mailto: in the href\n      if (link && link.indexOf('mailto:') > -1) {\n        return;\n      }\n\n      // check target\n      if (el.target) {\n        return;\n      }\n\n      // x-origin\n      if (!sameOrigin(el.href)) {\n        return;\n      }\n\n      // rebuild path\n      let path = el.pathname + el.search + (el.hash || '');\n\n      // strip leading \"/[drive letter]:\" on NW.js on Windows\n      if (typeof process !== 'undefined' && path.match(/^\\/[a-zA-Z]:\\//)) {\n        path = path.replace(/^\\/[a-zA-Z]:\\//, '/');\n      }\n\n      e.preventDefault();\n      self.go(path);\n    }\n\n    function which(e) {\n      e = e || window.event;\n      return e.which === null ? e.button : e.which;\n    }\n\n    function sameOrigin(href) {\n      let origin = `${location.protocol}//${location.hostname}`;\n      if (location.port) {\n        origin += `:${location.port}`;\n      }\n\n      return href && href.indexOf(origin) === 0;\n    }\n  }\n\n  _initiateHandlingBackButton() {\n    const self = this;\n    window.addEventListener('popstate', onpopstate, false);\n\n    function onpopstate() {\n      // In some browsers they fire popstate event right after page has loaded.\n      // That's not the correct way for the popstate.\n      // Normally, we need to handle it.\n      // But, we don't want to do it since self.go() is already idempotent.\n      const path = location.pathname + location.search + (location.hash || '');\n      self.env.inPopstate.withValue(true, function() {\n        self.go(path);\n      });\n    }\n  }\n\n  _buildContext(path) {\n    const parsedUrl = ParseUrl({url: path});\n\n    const context = {\n      path,\n      pathname: parsedUrl.pathname,\n      hash: parsedUrl.hash ? parsedUrl.hash.substr(1) : null,\n      queryString: parsedUrl.search ? parsedUrl.search.substr(1) : null\n    };\n\n    return context;\n  }\n};\n"]},"sourceType":"module","hash":"9cd9d8c05df871f351a00a9721ef0834252b8e78"}
