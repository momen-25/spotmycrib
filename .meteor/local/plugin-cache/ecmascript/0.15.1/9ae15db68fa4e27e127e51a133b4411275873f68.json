{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/momen/projects/spotmycrib-master/imports/ui/templates/propertyManage.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"imports/ui/templates/propertyManage.js","filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/propertyManage.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/momen/projects/spotmycrib-master","root":"/home/momen/projects/spotmycrib-master","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/momen/projects/spotmycrib-master/imports/ui/templates/propertyManage.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/templates/propertyManage.js"}},"code":"module.link(\"./pagination.html\");\nmodule.link(\"./propertyManage.html\");\nvar globalFILTERS = {};\n\nfunction getPaginationData(totalResultsCount, currentPageNo, urlBase, resultsPerPage) {\n  var pages = [],\n      prevPage = {},\n      nextPage = {};\n  var pgMin = currentPageNo - 4,\n      pgMax = currentPageNo + 5,\n      maxPages = Math.ceil(totalResultsCount / resultsPerPage);\n  if (pgMin < 1) pgMin = 1;\n  if (pgMax < 1) pgMax = 1;\n  if (maxPages < 1) maxPages = 1;\n  if (pgMin > maxPages) currentPageNo = maxPages;\n  var tmp = {};\n\n  for (var i = pgMin; i <= maxPages; i++) {\n    var href = urlBase + i + \"/\";\n    tmp = {\n      \"href\": href,\n      \"text\": i\n    };\n\n    if (i == currentPageNo) {\n      tmp['href'] = 'javascript:void(0);';\n      tmp['current'] = true;\n    }\n\n    pages.push(tmp);\n  } // if(pgMin==maxPages){//Above loop won't work if only 1 page result\n  //     pages.push({\n  //         \"href\": 'javascript:void(0);',\n  //         \"text\": 1\n  //     })\n  // }\n\n\n  var prevPageNo = currentPageNo - 1,\n      nextPageNo = currentPageNo + 1;\n\n  if (prevPageNo < 1) {\n    prevPage['href'] = 'javascript:void(0)';\n    prevPage['text'] = 'Previous';\n    prevPage['disabled'] = 'disabled';\n  } else {\n    prevPage['href'] = urlBase + prevPageNo + \"/\";\n    prevPage['text'] = 'Previous';\n  }\n\n  if (nextPageNo > maxPages) nextPageNo = maxPages;\n\n  if (nextPageNo == currentPageNo) {\n    nextPage['href'] = 'javascript:void(0)';\n    nextPage['text'] = 'Next';\n    nextPage['disabled'] = 'disabled';\n  } else {\n    nextPage['href'] = urlBase + nextPageNo + \"/\";\n    nextPage['text'] = 'Next';\n  }\n\n  return {\n    \"prevPage\": prevPage,\n    \"pages\": pages,\n    \"nextPage\": nextPage\n  };\n}\n\nTemplate.registerHelper(\"objectToPairs\", function (object) {\n  return _.map(object, function (value, key) {\n    return {\n      key: key,\n      value: value\n    };\n  });\n});\nTemplate.registerHelper(\"hostname\", function () {\n  return Meteor.absoluteUrl();\n});\n\nfunction numDifferentiation(val) {\n  if (val >= 1000000000) val = (val / 1000000000).toFixed(2) + ' Billion';else if (val >= 1000000) val = (val / 1000000).toFixed(2) + ' Million';\n  return val.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction numFormat(x) {\n  //var x=12345652457.557;\n  //console.log(x)\n  if (!x) return x;\n  x = x.toString();\n  var afterPoint = '';\n  if (x.indexOf('.') > 0) afterPoint = x.substring(x.indexOf('.'), x.length);\n  afterPoint = afterPoint.substr(0, 3);\n  x = Math.floor(x);\n  x = x.toString();\n  var lastThree = x.substring(x.length - 3);\n  var otherNumbers = x.substring(0, x.length - 3);\n  if (otherNumbers != '') lastThree = ',' + lastThree;\n  var res = otherNumbers.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \",\") + lastThree + afterPoint;\n  return res;\n}\n\nTemplate.propertyManage.onCreated(function () {\n  Session.set('propertyData', false);\n  Session.set('PropertyManage', false);\n  this.pdExpanded = new ReactiveVar(true);\n  this.enablingPMS = new ReactiveVar(false);\n  var instance = this;\n  instance.isSubsLoaded = new ReactiveVar(false);\n  instance.autorun(function () {\n    instance.subscribe('Auctions');\n    instance.subscribe('Bids');\n    instance.subscribe('allUserData');\n    instance.subscribe('userData');\n    var id = FlowRouter.getParam('id');\n    instance.subscribe(\"Property\", {\n      viewName: 'property.view',\n      id: id\n    });\n    instance.subscribe(\"PropertyManage\", {\n      viewName: 'propertyManage.view',\n      id: id\n    });\n    instance.subscribe(\"ActivityHistory\", {\n      limit: 50,\n      id: id\n    });\n\n    if (instance.subscriptionsReady()) {\n      instance.isSubsLoaded.set(true);\n    }\n  });\n});\nTemplate.propertyManage.helpers({\n  isSubsLoaded: function () {\n    return Template.instance().subscriptionsReady();\n  },\n  userLoggedIn: function () {\n    if (Meteor.user()) return true;\n    return false;\n  },\n  data: function () {\n    var id = FlowRouter.current().params.id;\n    if (!id) return []; // debugger;\n\n    var ret = Collections.PropertyManage.find({\n      propertyId: id\n    });\n    var docs = ret.fetch();\n    if (docs.length) Session.set('PropertyManage', docs[0]); // if(ret.count()==0){\n    //     clearMeta();\n    //     DocHead.setTitle(' Property not found | SpotMyCrib Admin');\n    //     DocHead.addMeta({name: \"description\", content: \"\"});\n    // }\n    // Session.set(\"propertyManageData\",ret);\n\n    return docs[0];\n  },\n  propertyData: function () {\n    var PropertyManage = Session.get('PropertyManage');\n\n    if (PropertyManage.propertyId) {\n      var ret = Collections.Properties.find({\n        _id: PropertyManage.propertyId\n      }, {\n        limit: 1\n      });\n      var docs = ret.fetch();\n      var propertyData = docs[0];\n      if (docs.length) Session.set('propertyData', propertyData);\n      clearMeta();\n\n      try {\n        var title = propertyData.address.address + ', ' + propertyData.address.area;\n        if (propertyData.address.county) title += ', ' + propertyData.address.county;\n        title += ' Manage Property';\n        DocHead.setTitle(titleCase(title) + ' | SpotMyCrib Admin');\n        DocHead.addMeta({\n          name: \"description\",\n          content: \"Manage property \" + propertyData.type + \", view and manage lease, see activity history and much more.\"\n        });\n      } catch (err) {\n        DocHead.setTitle('Manage Property | SpotMyCrib Admin');\n        DocHead.addMeta({\n          name: \"description\",\n          content: \"\"\n        });\n      }\n\n      return docs[0];\n    } else {\n      clearMeta();\n      DocHead.setTitle('Manage Property | SpotMyCrib Admin');\n      DocHead.addMeta({\n        name: \"description\",\n        content: \"\"\n      });\n      return [];\n    }\n  },\n  hasPropFound: function () {\n    var id = FlowRouter.current().params.id;\n    var ret = Collections.Properties.find(id, {\n      limit: 1\n    }).fetch();\n    return ret.length;\n  },\n  pdExpanded: function () {\n    return Template.instance().pdExpanded.get();\n  },\n  enablingPMS: function () {\n    return Template.instance().enablingPMS.get();\n  },\n  // dataFull : function () {\n  //\n  //     var propertyData = Session.get('propertyData');\n  //\n  //     try {\n  //         var selector = {\n  //             auctionId: propertyData.auctionId,\n  //             isArchived: false\n  //         }\n  //\n  //         var totalResultsCount = Collections.Bids.find(selector).count();\n  //\n  //         clearMeta();\n  //         try{\n  //             var title = propertyData.address.address + ', ' + propertyData.address.area;\n  //             if (propertyData.address.county) title += ', ' + propertyData.address.county;\n  //             title += ' Manage Property';\n  //\n  //             DocHead.setTitle(titleCase(title) + ' | SpotMyCrib Admin');\n  //             DocHead.addMeta({\n  //                 name: \"description\",\n  //                 content: \"View applications for property \" + propertyData.type + \", choose a winning tenant, see their social profiles and much more.\"\n  //             });\n  //         }catch(err){\n  //             DocHead.setTitle('Manage Property | SpotMyCrib Admin');\n  //             DocHead.addMeta({name: \"description\", content: \"\"});\n  //         }\n  //         return {\n  //             totalResultsCount: totalResultsCount\n  //         };\n  //     }catch (err){}\n  // },\n  dataChosen: function () {\n    var PropertyManage = Session.get('PropertyManage');\n\n    if (PropertyManage.tenants.length) {\n      var tenIds = [];\n\n      for (var i = 0; i < PropertyManage.tenants.length; i++) {\n        if (PropertyManage.tenants[i].id) tenIds.push(PropertyManage.tenants[i].id);\n      }\n\n      var selector = {\n        _id: {\n          $in: tenIds\n        },\n        // isArchived: false,//this field isn't needed\n        chosen: true\n      };\n      var totalChosenCount = Collections.Bids.find(selector).count();\n      var retChosen = Collections.Bids.find(selector, {\n        sort: {\n          updatedAt: -1\n        }\n      });\n      return {\n        resultsChosen: retChosen,\n        totalChosenCount: totalChosenCount\n      };\n    } else return [];\n  },\n  // dataNonChosen : function () {\n  //\n  //     var propertyData = Session.get('propertyData');\n  //     if(!propertyData){\n  //         console.log(\"Empty project data\");\n  //         return false;}\n  //\n  //     var selector = {\n  //         auctionId: propertyData.auctionId,\n  //         isArchived: false,\n  //         chosen:false\n  //     }\n  //\n  //     globlaAuctionId1 = propertyData.auctionId;\n  //     globalAuctionData1 = propertyData.auction;\n  //     /////PAGINATION\n  //     var resultsPerPage = 100;\n  //     var currentPageNo = FlowRouter.current().params.pageno;\n  //     if(!currentPageNo){currentPageNo = 1}\n  //     var skip = (currentPageNo -1) * resultsPerPage;\n  //     var urlBase = 'account/propertyapplications/'+FlowRouter.current().params.id+'/';\n  //\n  //\n  //\n  //     var totalNonChosenCount = Collections.Bids.find(selector).count();\n  //     var resultsNonChosen = Collections.Bids.find(selector, {\n  //         transform: function (doc) {\n  //\n  //             if (doc.auctionId != globlaAuctionId1 || !globalAuctionData1._id) {\n  //                 doc.auction = Collections.Auctions.findOne({\n  //                     _id: doc.auctionId\n  //                 });\n  //             } else {\n  //                 doc.auction = globalAuctionData1;\n  //             }\n  //\n  //             return doc;\n  //         },\n  //         limit: resultsPerPage,\n  //         sort: { updatedAt : -1 },\n  //         skip: skip\n  //     });\n  //\n  //     return {\n  //         resultsNonChosen: resultsNonChosen,\n  //         totalNonChosenCount: totalNonChosenCount,\n  //         pagination: getPaginationData(totalNonChosenCount,currentPageNo,urlBase,resultsPerPage)\n  //     };\n  //\n  // },\n  showFilters: function () {\n    return false;\n  },\n  // propertyData : function () {\n  //     var ret = getpropertyData();\n  //     if(!ret.auctionId){\n  //         var prevRoute = Session.get('prevRoute');\n  //         if(prevRoute){\n  //             FlowRouter.go(prevRoute.name,prevRoute.args)\n  //             Session.set('prevRoute',false);\n  //         }else{\n  //             FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n  //         }\n  //     }\n  //\n  //     Session.set('propertyData',ret);\n  //\n  //     return ret;\n  // },\n  filters: function () {\n    var data = {}; //{\"Home Type\":[\"2 BHK\"],\"Floor\":[\"2 to 15\"],\"Price Range\":[\"67.45 to 97.45 \"]}\n\n    var FILTERS = Session.get('globalFILTERS');\n    var defaultFilters = Session.get('propertyData');\n    defaultFilters = defaultFilters.filter;\n\n    if (FILTERS['homeType']) {\n      if (FILTERS['homeType'].length) {\n        if (!isArraysEqual(defaultFilters.homeType, FILTERS['homeType'])) data['Home Type'] = FILTERS['homeType'];\n      }\n    }\n\n    if (FILTERS['facing']) {\n      if (FILTERS['facing'].length) {\n        if (!isArraysEqual(defaultFilters.facing, FILTERS['facing'])) data['Facing'] = FILTERS['facing'];\n      }\n    }\n\n    if (FILTERS['floor']) {\n      var hasLowerLimit = false,\n          hasUpperLimit = false;\n      var l1 = parseInt(FILTERS['floor'][0]);\n      if (l1 != 0 && l1 != defaultFilters.floor[0]) hasLowerLimit = true;\n      var l2 = parseInt(FILTERS['floor'][1]);\n      if (l2 != defaultFilters.floor[1]) hasUpperLimit = true;\n\n      if (hasLowerLimit && !hasUpperLimit) {\n        //Only LowerLimit\n        data['Floor'] = ['More than ' + l1];\n      } else if (!hasLowerLimit && hasUpperLimit) {\n        //Only UpperLimit\n        data['Floor'] = ['Below ' + l2];\n      } else if (hasLowerLimit && hasUpperLimit) {\n        //Both are there\n        data['Floor'] = ['Between ' + l1 + \" and \" + l2];\n      } else {} //Both are not there. So don't show filter.\n\n    }\n\n    if (FILTERS['priceRange']) {\n      var hasLowerLimit = false,\n          hasUpperLimit = false;\n      var l1 = parseInt(FILTERS['priceRange'][0]);\n      if (l1 != 0 && l1 != defaultFilters.priceRange[0]) hasLowerLimit = true;\n      var l2 = parseInt(FILTERS['priceRange'][1]);\n      if (l2 != defaultFilters.priceRange[1]) hasUpperLimit = true;\n\n      if (hasLowerLimit && !hasUpperLimit) {\n        //Only LowerLimit\n        data['Price Range'] = ['More than ' + numDifferentiation(l1)];\n      } else if (!hasLowerLimit && hasUpperLimit) {\n        //Only UpperLimit\n        data['Price Range'] = ['Below ' + numDifferentiation(l2)];\n      } else if (hasLowerLimit && hasUpperLimit) {\n        //Both are there\n        data['Price Range'] = ['Between ' + numDifferentiation(l1) + \" to \" + numDifferentiation(l2)];\n      } else {} //Both are not there. So don't show filter.\n\n    } //if( FILTERS['priceRange'] ){\n    //  data['Price Range'] =  [ numDifferentiation(FILTERS['priceRange'][0]) +\" to \"+ numDifferentiation(FILTERS['priceRange'][1]) ]\n    //}\n\n\n    applyClearFiltersEvent();\n    return {\n      data: data,\n      count: Object.keys(data).length\n    };\n  },\n  // time: function(){\n  //\n  //     var propertyData = Session.get('propertyData');\n  //     var timestamp = TimeSync.serverTime(null, 30000);\n  //     if(!propertyData.auction.endDate || !timestamp)return;\n  //\n  //\n  //     var dend = Date.parse(propertyData.auction.endDate);\n  //     var timeDiff = dend - timestamp ;\n  //     if(timeDiff<0)return false;\n  //\n  //     var day = Math.floor(timeDiff / (1000 * 3600 * 24))\n  //     var hour = Math.floor(timeDiff / (1000 * 3600 ))\n  //     var min = Math.floor(timeDiff / (1000 * 60 ) )\n  //     hour = hour - (day * 24);\n  //     min = min - (day * 24* 60) - (hour * 60);\n  //     return {\"day\":day,\"hour\":hour,\"min\":min}\n  // },\n  isAuctionClosed: function () {\n    // var timestamp = TimeSync.serverTime(null, 30000);\n    var timestamp = new Date();\n    var propertyData = Session.get('propertyData');\n    var dend = Date.parse(propertyData.auction.endDate);\n    var timeDiff = dend - timestamp;\n\n    if (timeDiff < 0) {\n      return true;\n    }\n\n    return false;\n  },\n  numDifferentiation: function (data) {\n    return numDifferentiation(data);\n  },\n  assistanceAlreadyRequested: function () {\n    //Just to make this reactive\n    var user = Meteor.user();\n    if (user) if (user.profile) if (user.profile.assistanceRequested) {\n      return user.profile.assistanceRequested || Session.get('assistanceRequested');\n    }\n    return Session.get('assistanceRequested');\n  }\n});\nTemplate.propertyManage.onRendered(function () {});\nTemplate.propertyManage.events({\n  \"click .clearFilters\": function (event, template) {\n    //FlowRouter.query.clear();\n    console.log('in .clearFilters meteor event');\n    var defaultFilters = Session.get('propertyData');\n    defaultFilters = defaultFilters.filter;\n    $('.filterUnitFacing, .filterUnitType').val('any');\n    resetUISlider(defaultFilters);\n    setFilters(defaultFilters);\n    $.fancybox.close();\n    applyClearFiltersEvent();\n  },\n  \"click .showEditPropertyForm\": function (event, template) {\n    var prevRoute = {\n      name: FlowRouter.current().route.name,\n      args: {\n        id: FlowRouter.current().params.id,\n        pageno: FlowRouter.current().params.pageno\n      },\n      scrollTo: 'body'\n    };\n    Session.set('prevRoute', prevRoute);\n    var propertyData = Session.get('propertyData');\n    FlowRouter.go('account/editproperty', {\n      id: propertyData._id\n    });\n  },\n  \"click .backBtn\": function (event, template) {\n    var prevRoute = Session.get('prevRoute');\n\n    if (prevRoute) {\n      FlowRouter.go(prevRoute.name, prevRoute.args);\n      Session.set('prevRoute', false);\n    } else {\n      // FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n      history.back(); //PPl can come to this page from many other pages.\n    }\n  },\n  \"click .pdExpandedBtn\": function (event, template) {\n    if (template.pdExpanded.get()) template.pdExpanded.set(false);else template.pdExpanded.set(true);\n  },\n  \"click .enablePMS\": function (event, template) {\n    // console.log('enablePMS clicked');\n    enablingPMS = template.enablingPMS;\n    enablingPMS.set(true);\n    Meteor.call('addManageProperty', FlowRouter.current().params.id, function (error, result) {\n      enablingPMS.set(false);\n\n      if (error) {\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(\"Failed enabling this property. Please try again, try checking your internet connectivity. Contact us if needed.\");\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      if (result.status == 'Success') {\n        console.log(\"Success\");\n      }\n    });\n  }\n});\nTemplate.PM_bidList.onCreated(function () {\n  this.choosingInProgress = new ReactiveVar(false);\n  this.unChoosingInProgress = new ReactiveVar(false);\n});\nTemplate.PM_bidList.helpers({\n  user: function () {\n    // debugger;\n    var ret = Meteor.users.find({\n      _id: this.userId\n    }).fetch();\n    return ret[0];\n  },\n  canAfford: function (salary) {\n    //This works based on the bid (not rent)\n    if (!this.yourBid) {\n      return false;\n    }\n\n    if (salary * 0.4 >= this.yourBid) {\n      return true;\n    }\n\n    return false;\n  },\n  choosingInProgress: function () {\n    return Template.instance().choosingInProgress.get();\n  },\n  numDifferentiation: function (data) {\n    return numDifferentiation(data);\n  },\n  classBidList: function () {\n    if (this.chosen) return 'active';\n    var propertyData = Session.get('propertyData');\n\n    try {\n      var a = Collections.Auctions.find({\n        _id: propertyData.auction._id\n      }).fetch();\n      propertyData.auction = a[0];\n      if (propertyData.auction.chosenBids.length) return 'archive';\n    } catch (e) {}\n\n    return 'border-top';\n  }\n});\nTemplate.PM_bidList.events({\n  \"click .chooseTenant\": function (event, template) {\n    template.choosingInProgress.set(true);\n    choosingInProgress = template.choosingInProgress;\n    var r = confirm(\"Are you sure? This will send a confirmation mail to the applicant.\");\n\n    if (!r) {\n      template.choosingInProgress.set(false);\n      return;\n    }\n\n    Meteor.call('chooseWinning', [this.auctionId, this._id], function (error, result) {\n      choosingInProgress.set(false);\n\n      if (error) {\n        console.log(error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(error.error);\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      console.log(\"Success\");\n    });\n  },\n  \"click .unChooseTenant\": function (event, template) {\n    template.unChoosingInProgress.set(true);\n    unChoosingInProgress = template.unChoosingInProgress;\n    var r = confirm(\"Are you sure? This will send a pending mail to the applicant.\");\n\n    if (!r) {\n      template.unChoosingInProgress.set(false);\n      return;\n    }\n\n    Meteor.call('unChooseWinning', [this.auctionId, this._id], function (error, result) {\n      unChoosingInProgress.set(false);\n\n      if (error) {\n        console.log(error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(error.error);\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      console.log(\"Success\");\n    });\n  },\n  \"click .inviteForViewingBtn\": function (event, template) {\n    var propertyData = Session.get('propertyData');\n    var ret = Meteor.users.find({\n      _id: this.userId\n    }).fetch();\n    var inviteForViewing = Session.get('inviteForViewingData');\n    var today = new Date();\n    var tomorrow = new Date();\n    tomorrow.setDate(today.getDate() + 1);\n    tomorrow.setMinutes(0);\n    tomorrow.setSeconds(0);\n    var h = tomorrow.getHours();\n    if (h < 9) h = 9;else if (h > 20) h = 20;\n    tomorrow.setHours(h);\n    var inviteDate = tomorrow;\n\n    try {\n      if (inviteForViewing.inviteDate) inviteDate = inviteForViewing.inviteDate;\n    } catch (e) {}\n\n    Session.set('inviteForViewingData', {\n      user: ret[0],\n      bid: this,\n      inviteDate: inviteDate\n    });\n    $.fancybox({\n      'padding': 0,\n      'href': '#inviteForViewingDlg',\n      afterShow: function () {\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var d = inviteForViewing.inviteDate;\n        var am = ' AM';\n        var df = d.getMonth() + 1 + '/' + d.getDate() + '/' + d.getFullYear() + ' ' + d.getHours() + ':' + d.getMinutes();\n        if (d.getHours() > 12) am = ' PM';\n        df = df + am;\n        $('#inviteDate').val(df);\n      }\n    });\n  }\n});\nTemplate.PM_propertyList.onCreated(function () {\n  this.expanded = new ReactiveVar(true);\n  this.showAddAuctionForm = new ReactiveVar(false);\n});\nTemplate.PM_propertyList.helpers({\n  expanded: function () {\n    return Template.instance().expanded.get();\n  },\n  auction: function () {\n    if (this._id) {\n      var ret = Collections.Auctions.find({\n        propertyId: this._id\n      }, {\n        limit: 1\n      });\n      var docs = ret.fetch();\n      return docs[0];\n    } else return [];\n  },\n  showAddAuctionForm: function () {\n    // debugger;\n    if (Session.get('hideAddAuctionForm') && Session.get('auctionId') == this.auctionId) {\n      Template.instance().showAddAuctionForm.set(false);\n      Session.set('auctionId', \"\");\n      Session.set('hideAddAuctionForm', false);\n    }\n\n    return Template.instance().showAddAuctionForm.get();\n  },\n  numDifferentiation: function (data) {\n    return numDifferentiation(data);\n  },\n  lettingprintviewData: function () {\n    if (!this.auction) return {\n      key: \"\"\n    };\n    return {\n      key: this.auction.lettingAuctionCode\n    };\n  },\n  chosenTenantCount: function () {\n    var PropertyManage = Session.get('PropertyManage');\n\n    if (PropertyManage.tenants) {\n      return PropertyManage.tenants.length;\n    } else {\n      return 0;\n    }\n  },\n  PropertyManage: function () {\n    return Session.get('PropertyManage');\n  }\n});\nTemplate.PM_propertyList.events({\n  \"click .prev_activations\": function (event, template) {\n    scrollTo('#activity_history_area', 0, 300);\n  },\n  \"click .viewTenants\": function (event, template) {\n    scrollTo('#viewTenantsArea', 0, 300);\n  },\n  \"click .showEditPropertyForm\": function (event, template) {\n    var prevRoute = {\n      name: FlowRouter.current().route.name,\n      args: {\n        pageno: FlowRouter.current().params.pageno\n      }\n    };\n    Session.set('prevRoute', prevRoute);\n    FlowRouter.go('account/editproperty', {\n      id: this._id\n    });\n  },\n  \"click .hideAddAuctionForm\": function (event, template) {\n    if (template.showAddAuctionForm.get()) template.showAddAuctionForm.set(false);\n    propId = this._id;\n    scrollTo('#property_' + propId, 0, 700);\n  },\n  \"click .viewApplications\": function (event, template) {\n    var prevRoute = {\n      name: FlowRouter.current().route.name,\n      args: {\n        pageno: FlowRouter.current().params.pageno\n      }\n    };\n    Session.set('prevRoute', prevRoute);\n    FlowRouter.go(\"account/propertyApplications\", {\n      id: this._id\n    });\n  },\n  \"click .showCopyDlg\": function (event, template) {\n    let user = Meteor.user();\n    let sluggedName = slugifyEmailAddress(user.profile.name);\n    if (!sluggedName) sluggedName = 'rent';\n    let email = sluggedName + '-let-' + this.auction.lettingAuctionCode.toLowerCase() + \"@spotmycrib.ie\";\n    $('#agentPropertyEmailField').val(email);\n    var url = FlowRouter.url('letting', {\n      key: this.auction.lettingAuctionCode\n    });\n    $('#propertyLinkField').val(url);\n    $.fancybox({\n      'padding': 0,\n      'href': '#propertyLinkDlg',\n      afterShow: function (template) {\n        $('#agentPropertyEmailField').select();\n        $('#propertyLinkDlg .copyEmailBtn').unbind().bind('click', function () {\n          $('#agentPropertyEmailField').select();\n\n          try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful'; // console.log('Copying text command was ' + msg);\n\n            $.fancybox.close();\n          } catch (err) {\n            console.log('Oops, unable to copy');\n          }\n\n          ga('send', 'event', 'managePropertyPage', 'copyShareEmail', 'copyShareEmail Btn Clicked');\n        });\n        $('#propertyLinkDlg .copyLinkBtn').unbind().bind('click', function () {\n          $('#propertyLinkField').select();\n\n          try {\n            var successful = document.execCommand('copy');\n            var msg = successful ? 'successful' : 'unsuccessful'; // console.log('Copying text command was ' + msg);\n\n            $.fancybox.close();\n          } catch (err) {\n            console.log('Oops, unable to copy');\n          }\n\n          ga('send', 'event', 'managePropertyPage', 'copyShareLink', 'copyShareLink Btn Clicked');\n        });\n        $('#propertyLinkDlg .cancelBtn').unbind().bind('click', function () {\n          $.fancybox.close();\n        });\n      }\n    });\n  }\n});\ninviteInProgress = '';\nTemplate.addTenantDlg.onCreated(function () {\n  console.log('invite for viewing created');\n  this.inviteInProgress = new ReactiveVar(false);\n  inviteInProgress = this.inviteInProgress;\n});\nTemplate.addTenantDlg.helpers({\n  data: function () {\n    return Session.get('inviteForViewingData');\n  },\n  inviteInProgress: function () {\n    inviteInProgress = Template.instance().inviteInProgress;\n    return Template.instance().inviteInProgress.get();\n  },\n  inviteDateFormated: function () {\n    var inviteForViewing = Session.get('inviteForViewingData');\n    var options = {\n      weekday: \"long\",\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\"\n    };\n\n    try {\n      var d = inviteForViewing.inviteDate;\n      return d.toLocaleTimeString(\"en-us\", options);\n    } catch (e) {}\n\n    return;\n  },\n  propertyData: function () {\n    return Session.get('propertyData');\n  }\n});\nTemplate.addTenantDlg.events({\n  'change .inviteDate': function (event, template) {\n    var d = new Date($('.inviteDate').val());\n    var inviteForViewing = Session.get('inviteForViewingData');\n\n    try {\n      inviteForViewing.inviteDate = d;\n      Session.set('inviteForViewingData', inviteForViewing);\n    } catch (e) {}\n  },\n  'click .confirmInviteBtn': function () {\n    var inviteDate = $('.inviteDate').val();\n    var inviteMessage = $('.inviteMessage').val();\n    console.log(inviteDate);\n    var inviteForViewing = Session.get('inviteForViewingData');\n    inviteInProgress.set(true);\n    Meteor.call('sendInviteForViewingEmail', [inviteForViewing.bid._id, inviteDate], function (error, result) {\n      inviteInProgress.set(false);\n\n      if (error) {\n        console.log(error);\n        var tmp = Session.get(\"showErrorDlg\");\n        if (!tmp) tmp = [];\n        tmp.push(\"Failed applying. Please try again, try checking your internet connectivity. Contact us if needed.\");\n        Session.set(\"showErrorDlg\", tmp);\n        return;\n      }\n\n      if (result.status == 'Success') {\n        console.log(\"Success\");\n        closePopupEvent();\n      }\n    });\n  },\n  'click .closePopupBtn': function () {\n    closePopupEvent();\n  }\n});\nTemplate.addTenantDlg.onRendered(function () {\n  console.log('inviteForViewing rendered'); //Needs to be optimised, this is not the right place to put this code, might cause JS errors if Jquery isn' loaded yet.\n\n  try {\n    this.$('#inviteDate').datetimepicker();\n    this.$('#moveindate').datetimepicker();\n  } catch (err) {\n    console.log('dp failed');\n  }\n});\nTemplate.activity_history.onCreated(function () {\n  this.loadingMoreText = new ReactiveVar(true);\n  var resultsPerPage = Session.get('resultsPerPage');\n  if (!resultsPerPage) Session.set('resultsPerPage', 50);\n});\nTemplate.activity_history.helpers({\n  data: function () {\n    var user = Meteor.user();\n\n    if (!user) {\n      Template.instance().loadingMoreText.set(false);\n      return {\n        results: [],\n        totalResultsCount: 0\n      };\n    }\n\n    var id = FlowRouter.current().params.id;\n\n    if (!id) {\n      Template.instance().loadingMoreText.set(false);\n      return {\n        results: [],\n        totalResultsCount: 0\n      };\n    }\n\n    var selector = {\n      propertyId: id\n    }; //let limit = 10;\n    // debugger;\n    // var FILTERS = Session.get('prop_activation_filters')\n    // var defaultFilters = getDefaultFilters();\n    // var arr = [];\n    // if(  FILTERS['homeType'] ){\n    //     if(FILTERS['homeType'].length) {\n    //         if(FILTERS['homeType'].length != defaultFilters.homeType.length)\n    //             selector['homeType'] = FILTERS['homeType'][0]\n    //         /*\n    //          // var arr = [];\n    //          for (var i = 0; i < FILTERS['homeType'].length; i++) {\n    //          arr.push({\"homeType\": FILTERS['homeType'][i]})\n    //          console.log(\"homeType\"+ FILTERS['homeType'][i])\n    //          }*/\n    //         // selector['$or'] = arr;//BUG: this or will over write or of facing; or of homeType will collide with this and\n    //         // while logic won't work\n    //\n    //     }\n    // }\n    // if(  FILTERS['facing'] ){\n    //     if(FILTERS['facing'].length) {\n    //         if(FILTERS['facing'].length != defaultFilters.facing.length)\n    //             selector['facing'] = FILTERS['facing'][0]\n    //         /*\n    //          var arr = [];\n    //          for (var i = 0; i < FILTERS['facing'].length; i++) {\n    //          arr.push({\"facing\": FILTERS['facing'][i]})\n    //          }\n    //          // selector['$or'] = arr;//BUG: this or will over write or of homeType; or of homeType will collide with this and\n    //          // while logic won't work\n    //          */\n    //     }\n    // }\n    // if(arr.length){\n    //     selector['$or'] = arr;\n    // }\n    // if( FILTERS['floor'] ){\n    //     var val_l = FILTERS['floor'][0];\n    //     var val_h = FILTERS['floor'][1];\n    //\n    //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n    //\n    //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n    //         selector['floorLevel'] =  { $gte: parseInt(val_l) }\n    //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n    //         selector['floorLevel'] =  { $lte: parseInt(val_h) }\n    //     }else{//Both are valid\n    //         selector['floorLevel'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n    //     }\n    // }\n    // if( FILTERS['priceRange'] ){\n    //     var val_l = FILTERS['priceRange'][0];\n    //     var val_h = FILTERS['priceRange'][1];\n    //\n    //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n    //\n    //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n    //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l) }\n    //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n    //         selector['priceBreakUp.totalAllInclusive'] =  { $lt: parseInt(val_h) }\n    //     }else{//Both are valid\n    //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n    //     }\n    // }\n    /////PAGINATION\n    // var resultsPerPage = 20;\n    // var currentPageNo = FlowRouter.current().params.pageno;\n    // if(!currentPageNo){currentPageNo = 1}\n    // var skip = (currentPageNo -1) * resultsPerPage;\n    // var urlBase = 'account/myproperies/';\n\n    var totalResultsCount = Collections.ActivityHistory.find(selector).count();\n    var ret = Collections.ActivityHistory.find(selector, {\n      limit: Session.get('resultsPerPage'),\n      sort: {\n        createdAt: -1\n      } // skip: skip\n\n    });\n    Template.instance().loadingMoreText.set(false);\n    return {\n      results: ret,\n      totalResultsCount: totalResultsCount\n    };\n  },\n  loadingMoreText: function () {\n    return Template.instance().loadingMoreText.get();\n  },\n  decideTemplate: function (type) {}\n});\nTemplate.activity_history.events({\n  'click .load_more': function (event, template) {\n    Template.instance().loadingMoreText.set(true);\n    var resultsPerPage = Session.get('resultsPerPage');\n    resultsPerPage *= 2;\n    Session.set('resultsPerPage', resultsPerPage);\n    var id = FlowRouter.current().params.id;\n    Meteor.subscribe(\"ActivityHistory\", {\n      limit: resultsPerPage,\n      id: id\n    });\n  }\n});\nTemplate.activity_history.onRendered(function () {\n  Template.instance().loadingMoreText.set(false);\n});\n\nfunction attachEvents() {\n  $(\".deactivateConfirmBtn\").unbind().bind(\"click\", function () {\n    deactivateConfEvent();\n  });\n  $(\".closePopupBtn\").unbind().bind(\"click\", function () {\n    closePopupEvent();\n  });\n}\n\nfunction deactivateConfEvent() {\n  var data = Session.get(\"propertyData\");\n  var auctionId = data.auctionId;\n  deactivateInProgress.set(true);\n  Meteor.call('deactivateAuction', auctionId, function (error, result) {\n    deactivateInProgress.set(false);\n\n    if (error) {\n      console.log(error);\n      var tmp = Session.get(\"showErrorDlg\");\n      if (!tmp) tmp = [];\n      tmp.push(\"Failed deactivating. Please try again, try checking your internet connectivity. Contact us if needed.\");\n      Session.set(\"showErrorDlg\", tmp);\n      return;\n    }\n\n    console.log(\"Success\");\n    closePopupEvent();\n    var prevRoute = Session.get('prevRoute');\n\n    if (prevRoute) {\n      FlowRouter.go(prevRoute.name, prevRoute.args);\n      Session.set('prevRoute', false);\n    } else {\n      FlowRouter.go(\"/account/myproperies/\", {\n        pageno: 1\n      });\n    }\n  });\n}\n\nfunction closePopupEvent() {\n  console.log('closePopupEvent');\n  if ($) if ($.fancybox) $.fancybox.close();\n}\n\nfunction titleCase(str) {\n  if (!str) return;\n  return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\n\nfunction slugifyEmailAddress(text) {\n  if (!text) return '';\n  const a = 'àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ/_,:;';\n  const b = 'aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------';\n  const p = new RegExp(a.split('').join('|'), 'g');\n  return text.toString().toLowerCase().replace(/\\s+/g, '.') // Replace spaces with \".\"\n  .replace(p, c => b.charAt(a.indexOf(c))) // Replace special chars\n  .replace(/&/g, '-and-') // Replace & with ''\n  // .replace(/[^\\w\\-]+/g, '')       // Remove all non-word chars\n  .replace(/\\-\\-+/g, '-') // Replace multiple - with single ''\n  .replace(/^-+/, '') // Trim - from start of text\n  .replace(/-+$/, ''); // Trim - from end of text\n}","map":{"version":3,"sources":["imports/ui/templates/propertyManage.js"],"names":["module","link","globalFILTERS","getPaginationData","totalResultsCount","currentPageNo","urlBase","resultsPerPage","pages","prevPage","nextPage","pgMin","pgMax","maxPages","Math","ceil","tmp","i","href","push","prevPageNo","nextPageNo","Template","registerHelper","object","_","map","value","key","Meteor","absoluteUrl","numDifferentiation","val","toFixed","toString","replace","numFormat","x","afterPoint","indexOf","substring","length","substr","floor","lastThree","otherNumbers","res","propertyManage","onCreated","Session","set","pdExpanded","ReactiveVar","enablingPMS","instance","isSubsLoaded","autorun","subscribe","id","FlowRouter","getParam","viewName","limit","subscriptionsReady","helpers","userLoggedIn","user","data","current","params","ret","Collections","PropertyManage","find","propertyId","docs","fetch","propertyData","get","Properties","_id","clearMeta","title","address","area","county","DocHead","setTitle","titleCase","addMeta","name","content","type","err","hasPropFound","dataChosen","tenants","tenIds","selector","$in","chosen","totalChosenCount","Bids","count","retChosen","sort","updatedAt","resultsChosen","showFilters","filters","FILTERS","defaultFilters","filter","isArraysEqual","homeType","facing","hasLowerLimit","hasUpperLimit","l1","parseInt","l2","priceRange","applyClearFiltersEvent","Object","keys","isAuctionClosed","timestamp","Date","dend","parse","auction","endDate","timeDiff","assistanceAlreadyRequested","profile","assistanceRequested","onRendered","events","event","template","console","log","$","resetUISlider","setFilters","fancybox","close","prevRoute","route","args","pageno","scrollTo","go","history","back","call","error","result","status","PM_bidList","choosingInProgress","unChoosingInProgress","users","userId","canAfford","salary","yourBid","classBidList","a","Auctions","chosenBids","e","r","confirm","auctionId","inviteForViewing","today","tomorrow","setDate","getDate","setMinutes","setSeconds","h","getHours","setHours","inviteDate","bid","afterShow","d","am","df","getMonth","getFullYear","getMinutes","PM_propertyList","expanded","showAddAuctionForm","lettingprintviewData","lettingAuctionCode","chosenTenantCount","propId","sluggedName","slugifyEmailAddress","email","toLowerCase","url","select","unbind","bind","successful","document","execCommand","msg","ga","inviteInProgress","addTenantDlg","inviteDateFormated","options","weekday","year","month","day","hour","minute","toLocaleTimeString","inviteMessage","closePopupEvent","datetimepicker","activity_history","loadingMoreText","results","ActivityHistory","createdAt","decideTemplate","attachEvents","deactivateConfEvent","deactivateInProgress","str","charAt","toUpperCase","text","b","p","RegExp","split","join","c"],"mappings":"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","sourcesContent":["import \"./pagination.html\";\nimport \"./propertyManage.html\";\n\nvar globalFILTERS = {};\n\nfunction getPaginationData(totalResultsCount,currentPageNo,urlBase, resultsPerPage){\n    var pages = [], prevPage = {}, nextPage={};\n    var pgMin = currentPageNo-4, pgMax = currentPageNo+ 5, maxPages = Math.ceil(totalResultsCount/resultsPerPage)\n    if(pgMin<1)pgMin =1;\n    if(pgMax<1)pgMax =1;\n    if(maxPages<1)maxPages =1;\n    if(pgMin>maxPages)currentPageNo =maxPages;\n    var tmp={};\n    for (var i=pgMin; i<=maxPages;i++){\n        var href = urlBase+i+\"/\";\n        tmp = {\n            \"href\": href,\n            \"text\": i\n        }\n        if(i== currentPageNo) {\n            tmp['href'] = 'javascript:void(0);';\n            tmp['current'] = true;\n        }\n        pages.push(tmp)\n    }\n    // if(pgMin==maxPages){//Above loop won't work if only 1 page result\n    //     pages.push({\n    //         \"href\": 'javascript:void(0);',\n    //         \"text\": 1\n    //     })\n    // }\n    var prevPageNo = currentPageNo- 1, nextPageNo=currentPageNo+ 1;\n    if(prevPageNo<1){\n        prevPage['href'] = 'javascript:void(0)';\n        prevPage['text'] = 'Previous';\n        prevPage['disabled'] = 'disabled';\n    }else{\n        prevPage['href'] = urlBase+prevPageNo+\"/\";\n        prevPage['text'] = 'Previous';\n    }\n    if(nextPageNo>maxPages)nextPageNo =maxPages;\n    if(nextPageNo == currentPageNo){\n        nextPage['href'] = 'javascript:void(0)';\n        nextPage['text'] = 'Next';\n        nextPage['disabled'] = 'disabled';\n    }else{\n        nextPage['href'] = urlBase+nextPageNo+\"/\";\n        nextPage['text'] = 'Next';\n    }\n    return {\n        \"prevPage\":prevPage,\n        \"pages\":pages,\n        \"nextPage\": nextPage\n    }\n}\n\n\nTemplate.registerHelper(\"objectToPairs\",function(object){\n    return _.map(object, function(value, key) {\n        return {\n            key: key,\n            value: value\n        };\n    });\n});\nTemplate.registerHelper(\"hostname\",function(){\n    return Meteor.absoluteUrl();\n});\nfunction numDifferentiation(val) {\n    if(val >= 1000000000) val = (val/1000000000).toFixed(2) + ' Billion';\n    else if(val >= 1000000) val = (val/1000000).toFixed(2) + ' Million';\n    return val.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\nfunction numFormat(x) {\n    //var x=12345652457.557;\n    //console.log(x)\n    if(!x)return x;\n    x=x.toString();\n    var afterPoint = '';\n    if(x.indexOf('.') > 0)\n        afterPoint = x.substring(x.indexOf('.'),x.length);\n    afterPoint = afterPoint.substr(0,3);\n    x = Math.floor(x);\n    x=x.toString();\n    var lastThree = x.substring(x.length-3);\n    var otherNumbers = x.substring(0,x.length-3);\n    if(otherNumbers != '')\n        lastThree = ',' + lastThree;\n    var res = otherNumbers.replace(/\\B(?=(\\d{2})+(?!\\d))/g, \",\") + lastThree + afterPoint;\n    return res;\n}\n\n\n\nTemplate.propertyManage.onCreated(function(){\n    Session.set('propertyData',false);\n    Session.set('PropertyManage',false);\n    this.pdExpanded = new ReactiveVar( true );\n    this.enablingPMS = new ReactiveVar( false );\n\n    var instance = this;\n    instance.isSubsLoaded = new ReactiveVar(false);\n    instance.autorun(function(){\n\n        instance.subscribe('Auctions');\n        instance.subscribe('Bids');\n        instance.subscribe('allUserData');\n        instance.subscribe('userData');\n        var id = FlowRouter.getParam('id');\n        instance.subscribe(\"Property\",{viewName: 'property.view',id:id}) ;\n        instance.subscribe(\"PropertyManage\",{viewName: 'propertyManage.view',id:id}) ;\n        instance.subscribe(\"ActivityHistory\",{limit: 50,id:id})  ;\n\n        if(instance.subscriptionsReady()){\n            instance.isSubsLoaded.set(true)\n        }\n    })\n})\nTemplate.propertyManage.helpers({\n    isSubsLoaded:function(){\n        return Template.instance().subscriptionsReady();\n    },\n    userLoggedIn:function(){\n        if(Meteor.user())return true;\n        return false;\n    },\n    data: function(){\n        var id = FlowRouter.current().params.id;\n        if(!id)return [];\n        // debugger;\n        var ret = Collections.PropertyManage.find({propertyId:id});\n        var docs = ret.fetch()\n        if(docs.length)Session.set('PropertyManage',docs[0]);\n        // if(ret.count()==0){\n        //     clearMeta();\n        //     DocHead.setTitle(' Property not found | SpotMyCrib Admin');\n        //     DocHead.addMeta({name: \"description\", content: \"\"});\n        // }\n        // Session.set(\"propertyManageData\",ret);\n        return docs[0];\n    },\n    propertyData: function(){\n        var PropertyManage = Session.get('PropertyManage');\n        if(PropertyManage.propertyId) {\n            var ret = Collections.Properties.find({_id:PropertyManage.propertyId}, {limit: 1})\n            var docs = ret.fetch()\n            var propertyData = docs[0];\n            if(docs.length)Session.set('propertyData',propertyData);\n\n            clearMeta();\n            try{\n                var title = propertyData.address.address + ', ' + propertyData.address.area;\n                if (propertyData.address.county) title += ', ' + propertyData.address.county;\n                title += ' Manage Property';\n\n                DocHead.setTitle(titleCase(title) + ' | SpotMyCrib Admin');\n                DocHead.addMeta({\n                    name: \"description\",\n                    content: \"Manage property \" + propertyData.type + \", view and manage lease, see activity history and much more.\"\n                });\n            }catch(err){\n                DocHead.setTitle('Manage Property | SpotMyCrib Admin');\n                DocHead.addMeta({name: \"description\", content: \"\"});\n            }\n\n            return docs[0];\n        }\n        else {\n            clearMeta();\n            DocHead.setTitle('Manage Property | SpotMyCrib Admin');\n            DocHead.addMeta({name: \"description\", content: \"\"});\n            return [];\n        }\n    },\n    hasPropFound: function(){\n        var id = FlowRouter.current().params.id;\n        var ret = Collections.Properties.find(id, {\n            limit: 1\n        }).fetch();\n        return ret.length;\n    },\n    pdExpanded: function(){\n        return Template.instance().pdExpanded.get() ;\n    },\n    enablingPMS: function(){\n        return Template.instance().enablingPMS.get() ;\n    },\n    // dataFull : function () {\n    //\n    //     var propertyData = Session.get('propertyData');\n    //\n    //     try {\n    //         var selector = {\n    //             auctionId: propertyData.auctionId,\n    //             isArchived: false\n    //         }\n    //\n    //         var totalResultsCount = Collections.Bids.find(selector).count();\n    //\n    //         clearMeta();\n    //         try{\n    //             var title = propertyData.address.address + ', ' + propertyData.address.area;\n    //             if (propertyData.address.county) title += ', ' + propertyData.address.county;\n    //             title += ' Manage Property';\n    //\n    //             DocHead.setTitle(titleCase(title) + ' | SpotMyCrib Admin');\n    //             DocHead.addMeta({\n    //                 name: \"description\",\n    //                 content: \"View applications for property \" + propertyData.type + \", choose a winning tenant, see their social profiles and much more.\"\n    //             });\n    //         }catch(err){\n    //             DocHead.setTitle('Manage Property | SpotMyCrib Admin');\n    //             DocHead.addMeta({name: \"description\", content: \"\"});\n    //         }\n    //         return {\n    //             totalResultsCount: totalResultsCount\n    //         };\n    //     }catch (err){}\n    // },\n    dataChosen : function () {\n\n        var PropertyManage = Session.get('PropertyManage');\n        if(PropertyManage.tenants.length) {\n            var tenIds = [];\n            for(var i=0;i<PropertyManage.tenants.length;i++){\n                if(PropertyManage.tenants[i].id)\n                    tenIds.push(PropertyManage.tenants[i].id)\n            }\n            var selector = {\n                _id: {$in: tenIds},\n                // isArchived: false,//this field isn't needed\n                chosen:true\n            }\n\n            var totalChosenCount = Collections.Bids.find(selector).count();\n            var retChosen = Collections.Bids.find(selector, {\n                sort: {updatedAt: -1}\n            });\n\n            return {\n                resultsChosen: retChosen,\n                totalChosenCount: totalChosenCount\n            };\n        }\n        else return [];\n    },\n    // dataNonChosen : function () {\n    //\n    //     var propertyData = Session.get('propertyData');\n    //     if(!propertyData){\n    //         console.log(\"Empty project data\");\n    //         return false;}\n    //\n    //     var selector = {\n    //         auctionId: propertyData.auctionId,\n    //         isArchived: false,\n    //         chosen:false\n    //     }\n    //\n    //     globlaAuctionId1 = propertyData.auctionId;\n    //     globalAuctionData1 = propertyData.auction;\n    //     /////PAGINATION\n    //     var resultsPerPage = 100;\n    //     var currentPageNo = FlowRouter.current().params.pageno;\n    //     if(!currentPageNo){currentPageNo = 1}\n    //     var skip = (currentPageNo -1) * resultsPerPage;\n    //     var urlBase = 'account/propertyapplications/'+FlowRouter.current().params.id+'/';\n    //\n    //\n    //\n    //     var totalNonChosenCount = Collections.Bids.find(selector).count();\n    //     var resultsNonChosen = Collections.Bids.find(selector, {\n    //         transform: function (doc) {\n    //\n    //             if (doc.auctionId != globlaAuctionId1 || !globalAuctionData1._id) {\n    //                 doc.auction = Collections.Auctions.findOne({\n    //                     _id: doc.auctionId\n    //                 });\n    //             } else {\n    //                 doc.auction = globalAuctionData1;\n    //             }\n    //\n    //             return doc;\n    //         },\n    //         limit: resultsPerPage,\n    //         sort: { updatedAt : -1 },\n    //         skip: skip\n    //     });\n    //\n    //     return {\n    //         resultsNonChosen: resultsNonChosen,\n    //         totalNonChosenCount: totalNonChosenCount,\n    //         pagination: getPaginationData(totalNonChosenCount,currentPageNo,urlBase,resultsPerPage)\n    //     };\n    //\n    // },\n    showFilters: function(){\n        return false;\n    },\n    // propertyData : function () {\n    //     var ret = getpropertyData();\n    //     if(!ret.auctionId){\n    //         var prevRoute = Session.get('prevRoute');\n    //         if(prevRoute){\n    //             FlowRouter.go(prevRoute.name,prevRoute.args)\n    //             Session.set('prevRoute',false);\n    //         }else{\n    //             FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n    //         }\n    //     }\n    //\n    //     Session.set('propertyData',ret);\n    //\n    //     return ret;\n    // },\n    filters:function(){\n        var data = {}//{\"Home Type\":[\"2 BHK\"],\"Floor\":[\"2 to 15\"],\"Price Range\":[\"67.45 to 97.45 \"]}\n        var FILTERS = Session.get('globalFILTERS')\n        var defaultFilters = Session.get('propertyData');defaultFilters = defaultFilters.filter;\n        if( FILTERS['homeType']  ){\n            if(FILTERS['homeType'].length) {\n                if( !isArraysEqual( defaultFilters.homeType , FILTERS['homeType']) )\n                    data['Home Type'] = FILTERS['homeType'];\n            }\n        }\n        if( FILTERS['facing']  ){\n            if(FILTERS['facing'].length) {\n                if( !isArraysEqual( defaultFilters.facing , FILTERS['facing']) )\n                    data['Facing'] = FILTERS['facing'];\n            }\n        }\n        if(  FILTERS['floor'] ){\n            var hasLowerLimit = false, hasUpperLimit = false;\n            var l1 = parseInt(FILTERS['floor'][0]);\n            if(l1 !=0 && l1 != defaultFilters.floor[0])hasLowerLimit = true;\n\n            var l2 = parseInt(FILTERS['floor'][1]);\n            if( l2 != defaultFilters.floor[1])hasUpperLimit = true;\n\n            if(hasLowerLimit && !hasUpperLimit){//Only LowerLimit\n                data['Floor'] = [ 'More than '+l1 ]\n            }else if(!hasLowerLimit && hasUpperLimit){//Only UpperLimit\n                data['Floor'] = [ 'Below '+l2 ]\n            }else if(hasLowerLimit && hasUpperLimit){//Both are there\n                data['Floor'] = [ 'Between '+l1+\" and \"+l2 ]\n            }else{}//Both are not there. So don't show filter.\n\n        }\n\n        if(  FILTERS['priceRange'] ){\n            var hasLowerLimit = false, hasUpperLimit = false;\n            var l1 = parseInt(FILTERS['priceRange'][0]);\n            if(l1 !=0 && l1 != defaultFilters.priceRange[0])hasLowerLimit = true;\n\n            var l2 = parseInt(FILTERS['priceRange'][1]);\n            if( l2 != defaultFilters.priceRange[1])hasUpperLimit = true;\n\n            if(hasLowerLimit && !hasUpperLimit){//Only LowerLimit\n                data['Price Range'] = [ 'More than '+numDifferentiation(l1) ]\n            }else if(!hasLowerLimit && hasUpperLimit){//Only UpperLimit\n                data['Price Range'] = [ 'Below '+numDifferentiation(l2) ]\n            }else if(hasLowerLimit && hasUpperLimit){//Both are there\n                data['Price Range'] = [ 'Between '+numDifferentiation(l1)+\" to \"+numDifferentiation(l2) ]\n            }else{}//Both are not there. So don't show filter.\n\n        }\n        //if( FILTERS['priceRange'] ){\n        //  data['Price Range'] =  [ numDifferentiation(FILTERS['priceRange'][0]) +\" to \"+ numDifferentiation(FILTERS['priceRange'][1]) ]\n        //}\n        applyClearFiltersEvent();\n\n        return {\n            data:data,\n            count: Object.keys(data).length\n        };\n    },\n    // time: function(){\n    //\n    //     var propertyData = Session.get('propertyData');\n    //     var timestamp = TimeSync.serverTime(null, 30000);\n    //     if(!propertyData.auction.endDate || !timestamp)return;\n    //\n    //\n    //     var dend = Date.parse(propertyData.auction.endDate);\n    //     var timeDiff = dend - timestamp ;\n    //     if(timeDiff<0)return false;\n    //\n    //     var day = Math.floor(timeDiff / (1000 * 3600 * 24))\n    //     var hour = Math.floor(timeDiff / (1000 * 3600 ))\n    //     var min = Math.floor(timeDiff / (1000 * 60 ) )\n    //     hour = hour - (day * 24);\n    //     min = min - (day * 24* 60) - (hour * 60);\n    //     return {\"day\":day,\"hour\":hour,\"min\":min}\n    // },\n    isAuctionClosed:function(){\n        // var timestamp = TimeSync.serverTime(null, 30000);\n        var timestamp = new Date();\n        var propertyData = Session.get('propertyData');\n        var dend = Date.parse(propertyData.auction.endDate);\n        var timeDiff = dend - timestamp;\n        if(timeDiff<0){\n            return true;\n        }\n        return false;\n    },\n    numDifferentiation: function(data){\n        return numDifferentiation(data);\n    },\n    assistanceAlreadyRequested: function(){\n        //Just to make this reactive\n        var user = Meteor.user();\n        if(user)\n            if(user.profile)\n                if(user.profile.assistanceRequested){\n                    return user.profile.assistanceRequested || Session.get('assistanceRequested');\n                }\n\n        return Session.get('assistanceRequested');\n\n    },\n})\nTemplate.propertyManage.onRendered(function() {\n})\nTemplate.propertyManage.events({\n    \"click .clearFilters\": function (event, template) {\n        //FlowRouter.query.clear();\n\n        console.log('in .clearFilters meteor event')\n        var defaultFilters = Session.get('propertyData');defaultFilters = defaultFilters.filter;\n        $('.filterUnitFacing, .filterUnitType').val('any');\n        resetUISlider(defaultFilters);\n        setFilters(defaultFilters);\n        $.fancybox.close();\n        applyClearFiltersEvent();\n    },\n    \"click .showEditPropertyForm\": function (event, template) {\n        var prevRoute = {name: FlowRouter.current().route.name,args:{id:FlowRouter.current().params.id, pageno:FlowRouter.current().params.pageno},scrollTo:'body' }\n        Session.set('prevRoute',prevRoute);\n        var propertyData = Session.get('propertyData');\n        FlowRouter.go('account/editproperty',{id:propertyData._id})\n\n    },\n    \"click .backBtn\": function(event, template){\n        var prevRoute = Session.get('prevRoute');\n        if(prevRoute){\n            FlowRouter.go(prevRoute.name,prevRoute.args)\n            Session.set('prevRoute',false);\n        }else{\n            // FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n            history.back();//PPl can come to this page from many other pages.\n        }\n    },\n    \"click .pdExpandedBtn\": function (event, template) {\n        if(template.pdExpanded.get() )template.pdExpanded.set(false);\n        else template.pdExpanded.set(true);\n    },\n    \"click .enablePMS\":function (event, template) {\n        // console.log('enablePMS clicked');\n        enablingPMS = template.enablingPMS;\n        enablingPMS.set(true) ;\n        Meteor.call('addManageProperty',FlowRouter.current().params.id,function(error, result){\n            enablingPMS.set(false) ;\n            if(error){\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(\"Failed enabling this property. Please try again, try checking your internet connectivity. Contact us if needed.\");\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n            if(result.status=='Success'){\n                console.log(\"Success\");\n            }\n        });\n    }\n})\nTemplate.PM_bidList.onCreated(function(){\n    this.choosingInProgress = new ReactiveVar( false );\n    this.unChoosingInProgress = new ReactiveVar( false );\n})\nTemplate.PM_bidList.helpers({\n    user:function(){\n        // debugger;\n        var ret = Meteor.users.find({\n            _id: this.userId\n        }).fetch();\n        return ret[0];\n    },\n    canAfford: function(salary){//This works based on the bid (not rent)\n        if( !this.yourBid){return false;}\n        if(salary*0.4 >= this.yourBid ){\n            return true;\n        }\n        return false;\n    },\n    choosingInProgress: function(){\n        return Template.instance().choosingInProgress.get() ;\n    },\n    numDifferentiation: function(data){\n        return numDifferentiation(data);\n    },\n    classBidList:function () {\n        if(this.chosen)return 'active';\n\n        var propertyData = Session.get('propertyData');\n        try {\n            var a = Collections.Auctions.find({_id:propertyData.auction._id}).fetch();\n            propertyData.auction = a[0];\n            if (propertyData.auction.chosenBids.length)return 'archive';\n        }catch (e){}\n        return 'border-top';\n    }\n})\nTemplate.PM_bidList.events({\n    \"click .chooseTenant\": function (event, template) {\n        template.choosingInProgress.set(true);\n        choosingInProgress = template.choosingInProgress\n\n        var r = confirm(\"Are you sure? This will send a confirmation mail to the applicant.\");\n        if (!r){ template.choosingInProgress.set(false);return;}\n\n        Meteor.call('chooseWinning', [this.auctionId, this._id], function(error, result){\n            choosingInProgress.set(false) ;\n            if(error){\n                console.log(error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(error.error);\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n            console.log(\"Success\");\n\n\n        });\n    },\n    \"click .unChooseTenant\": function (event, template) {\n        template.unChoosingInProgress.set(true);\n        unChoosingInProgress = template.unChoosingInProgress\n\n        var r = confirm(\"Are you sure? This will send a pending mail to the applicant.\");\n        if (!r){ template.unChoosingInProgress.set(false);return;}\n\n        Meteor.call('unChooseWinning', [this.auctionId, this._id], function(error, result){\n            unChoosingInProgress.set(false) ;\n            if(error){\n                console.log(error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(error.error);\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n            console.log(\"Success\");\n        });\n    },\n    \"click .inviteForViewingBtn\": function (event, template) {\n        var propertyData = Session.get('propertyData');\n        var ret = Meteor.users.find({\n            _id: this.userId\n        }).fetch();\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var today = new Date();\n        var tomorrow = new Date();\n        tomorrow.setDate(today.getDate()+1);tomorrow.setMinutes(0);tomorrow.setSeconds(0);\n        var h = tomorrow.getHours();\n        if(h<9)h=9;else if(h>20)h=20;\n        tomorrow.setHours(h);\n        var inviteDate = tomorrow;\n        try{if(inviteForViewing.inviteDate)inviteDate = inviteForViewing.inviteDate;}catch(e){}\n        Session.set('inviteForViewingData',{user:ret[0],bid:this,inviteDate:inviteDate})\n        $.fancybox({\n            'padding': 0,\n            'href': '#inviteForViewingDlg',\n            afterShow:function () {\n                var inviteForViewing = Session.get('inviteForViewingData');\n                var d = inviteForViewing.inviteDate;var am = ' AM';\n                var df = (d.getMonth()+1)+'/'+d.getDate()+'/'+d.getFullYear()+' '+d.getHours()+':'+d.getMinutes()\n                if(d.getHours()>12)am = ' PM';\n                df = df+am;\n                $('#inviteDate').val(df)\n\n            }\n        });\n    },\n});\nTemplate.PM_propertyList.onCreated(function(){\n    this.expanded = new ReactiveVar( true );\n    this.showAddAuctionForm = new ReactiveVar( false );\n\n})\nTemplate.PM_propertyList.helpers({\n    expanded: function(){\n        return Template.instance().expanded.get() ;\n    },\n    auction: function () {\n        if(this._id) {\n            var ret = Collections.Auctions.find({propertyId:this._id}, {limit: 1})\n            var docs = ret.fetch()\n            return docs[0];\n        }\n        else return [];\n    },\n    showAddAuctionForm: function () {\n        // debugger;\n        if(Session.get('hideAddAuctionForm') && Session.get('auctionId')==this.auctionId){\n            Template.instance().showAddAuctionForm.set(false);\n            Session.set('auctionId',\"\")\n            Session.set('hideAddAuctionForm',false)\n        }\n\n        return Template.instance().showAddAuctionForm.get();\n    },\n    numDifferentiation: function(data){\n        return numDifferentiation(data);\n    },\n    lettingprintviewData:function () {\n        if(!this.auction)return {key:\"\"}\n        return {key:this.auction.lettingAuctionCode}\n    },\n    chosenTenantCount:function(){\n        var PropertyManage = Session.get('PropertyManage');\n        if(PropertyManage.tenants) {\n            return PropertyManage.tenants.length;\n        }\n        else {\n            return 0;\n        }\n    },\n    PropertyManage:function(){\n        return Session.get('PropertyManage');\n    }\n})\nTemplate.PM_propertyList.events({\n    \"click .prev_activations\": function (event, template) {\n        scrollTo('#activity_history_area',0,300)\n    },\n    \"click .viewTenants\": function (event, template) {\n        scrollTo('#viewTenantsArea',0,300)\n    },\n    \"click .showEditPropertyForm\": function (event, template) {\n        var prevRoute = {name: FlowRouter.current().route.name,args:{pageno:FlowRouter.current().params.pageno} }\n        Session.set('prevRoute',prevRoute);\n\n        FlowRouter.go('account/editproperty',{id:this._id})\n\n    },\n    \"click .hideAddAuctionForm\": function (event, template) {\n        if(template.showAddAuctionForm.get() )template.showAddAuctionForm.set(false);\n        propId = this._id;\n        scrollTo('#property_'+propId,0,700)\n\n    },\n    \"click .viewApplications\": function (event, template) {\n        var prevRoute = {name: FlowRouter.current().route.name,args:{pageno:FlowRouter.current().params.pageno} }\n        Session.set('prevRoute',prevRoute);\n\n        FlowRouter.go(\"account/propertyApplications\",{id:this._id});\n    },\n    \"click .showCopyDlg\": function (event, template) {\n        let user = Meteor.user();\n        let sluggedName = slugifyEmailAddress(user.profile.name);\n        if(!sluggedName)sluggedName = 'rent'\n        let email = sluggedName+'-let-'+this.auction.lettingAuctionCode.toLowerCase()+\"@spotmycrib.ie\";\n        $('#agentPropertyEmailField').val(email);\n\n        var url = FlowRouter.url('letting',{key:this.auction.lettingAuctionCode})\n        $('#propertyLinkField').val(url);\n        $.fancybox({\n            'padding': 0,\n            'href': '#propertyLinkDlg',\n            afterShow:function(template){\n                $('#agentPropertyEmailField').select();\n                $('#propertyLinkDlg .copyEmailBtn').unbind().bind('click',function () {\n                    $('#agentPropertyEmailField').select();\n\n                    try {\n                        var successful = document.execCommand('copy');\n                        var msg = successful ? 'successful' : 'unsuccessful';\n                        // console.log('Copying text command was ' + msg);\n                        $.fancybox.close()\n                    } catch (err) {\n                        console.log('Oops, unable to copy');\n                    }\n                    ga('send', 'event', 'managePropertyPage', 'copyShareEmail', 'copyShareEmail Btn Clicked');\n                })\n                $('#propertyLinkDlg .copyLinkBtn').unbind().bind('click',function () {\n                    $('#propertyLinkField').select();\n\n                    try {\n                        var successful = document.execCommand('copy');\n                        var msg = successful ? 'successful' : 'unsuccessful';\n                        // console.log('Copying text command was ' + msg);\n                        $.fancybox.close()\n                    } catch (err) {\n                        console.log('Oops, unable to copy');\n                    }\n                    ga('send', 'event', 'managePropertyPage', 'copyShareLink', 'copyShareLink Btn Clicked');\n                })\n                $('#propertyLinkDlg .cancelBtn').unbind().bind('click',function () {\n                    $.fancybox.close()\n                })\n            },\n        });\n\n    },\n});\n\ninviteInProgress='';\nTemplate.addTenantDlg.onCreated(function () {\n    console.log('invite for viewing created');\n    this.inviteInProgress = new ReactiveVar( false );\n    inviteInProgress = this.inviteInProgress;\n})\nTemplate.addTenantDlg.helpers({\n    data:function () {\n        return Session.get('inviteForViewingData');\n    },\n    inviteInProgress:function () {\n        inviteInProgress = Template.instance().inviteInProgress ;\n        return Template.instance().inviteInProgress.get() ;\n    },\n    inviteDateFormated:function () {\n        var inviteForViewing = Session.get('inviteForViewingData');\n        var options = {\n            weekday: \"long\", year: \"numeric\", month: \"short\",\n            day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\"\n        };\n        try{var d=inviteForViewing.inviteDate; return d.toLocaleTimeString(\"en-us\", options); }catch(e){}\n        return ;\n    },\n    propertyData:function () {\n        return  Session.get('propertyData');\n    }\n})\nTemplate.addTenantDlg.events({\n    'change .inviteDate':function (event, template) {\n        var d = new Date($('.inviteDate').val());\n        var inviteForViewing = Session.get('inviteForViewingData');\n        try{ inviteForViewing.inviteDate=d; Session.set('inviteForViewingData',inviteForViewing) }catch(e){}\n\n    },\n    'click .confirmInviteBtn':function () {\n\n        var inviteDate = $('.inviteDate').val()\n        var inviteMessage = $('.inviteMessage').val()\n        console.log(inviteDate)\n        var inviteForViewing = Session.get('inviteForViewingData');\n\n\n        inviteInProgress.set(true) ;\n        Meteor.call('sendInviteForViewingEmail',[inviteForViewing.bid._id,inviteDate],function(error, result){\n            inviteInProgress.set(false) ;\n            if(error){\n                console.log(error);\n                var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n                tmp.push(\"Failed applying. Please try again, try checking your internet connectivity. Contact us if needed.\");\n                Session.set(\"showErrorDlg\",tmp)\n                return;\n            }\n            if(result.status=='Success'){\n                console.log(\"Success\");\n                closePopupEvent()\n            }\n        });\n\n    },\n    'click .closePopupBtn':function () {\n        closePopupEvent()\n    }\n})\nTemplate.addTenantDlg.onRendered(function () {\n    console.log('inviteForViewing rendered')\n    //Needs to be optimised, this is not the right place to put this code, might cause JS errors if Jquery isn' loaded yet.\n    try{\n        this.$('#inviteDate').datetimepicker();\n\n\n\n        this.$('#moveindate').datetimepicker();\n    }catch(err){\n        console.log('dp failed');\n    }\n})\nTemplate.activity_history.onCreated(function () {\n    this.loadingMoreText = new ReactiveVar( true );\n    var resultsPerPage = Session.get('resultsPerPage');\n    if(!resultsPerPage)Session.set('resultsPerPage',50)\n})\nTemplate.activity_history.helpers({\n    data : function () {\n        var user = Meteor.user();\n        if (!user) {\n            Template.instance().loadingMoreText.set(false);\n            return {\n                results: [],\n                totalResultsCount: 0\n            }\n        }\n\n        var id = FlowRouter.current().params.id;\n        if(!id) {\n            Template.instance().loadingMoreText.set(false);\n\n            return {\n                results: [],\n                totalResultsCount: 0\n            }\n        }\n        var selector = {propertyId:id};//let limit = 10;\n        // debugger;\n\n        // var FILTERS = Session.get('prop_activation_filters')\n        // var defaultFilters = getDefaultFilters();\n\n        // var arr = [];\n        // if(  FILTERS['homeType'] ){\n        //     if(FILTERS['homeType'].length) {\n        //         if(FILTERS['homeType'].length != defaultFilters.homeType.length)\n        //             selector['homeType'] = FILTERS['homeType'][0]\n        //         /*\n        //          // var arr = [];\n        //          for (var i = 0; i < FILTERS['homeType'].length; i++) {\n        //          arr.push({\"homeType\": FILTERS['homeType'][i]})\n        //          console.log(\"homeType\"+ FILTERS['homeType'][i])\n        //          }*/\n        //         // selector['$or'] = arr;//BUG: this or will over write or of facing; or of homeType will collide with this and\n        //         // while logic won't work\n        //\n        //     }\n        // }\n        // if(  FILTERS['facing'] ){\n        //     if(FILTERS['facing'].length) {\n        //         if(FILTERS['facing'].length != defaultFilters.facing.length)\n        //             selector['facing'] = FILTERS['facing'][0]\n        //         /*\n        //          var arr = [];\n        //          for (var i = 0; i < FILTERS['facing'].length; i++) {\n        //          arr.push({\"facing\": FILTERS['facing'][i]})\n        //          }\n        //          // selector['$or'] = arr;//BUG: this or will over write or of homeType; or of homeType will collide with this and\n        //          // while logic won't work\n        //          */\n        //     }\n        // }\n        // if(arr.length){\n        //     selector['$or'] = arr;\n        // }\n        // if( FILTERS['floor'] ){\n        //     var val_l = FILTERS['floor'][0];\n        //     var val_h = FILTERS['floor'][1];\n        //\n        //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n        //\n        //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n        //         selector['floorLevel'] =  { $gte: parseInt(val_l) }\n        //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n        //         selector['floorLevel'] =  { $lte: parseInt(val_h) }\n        //     }else{//Both are valid\n        //         selector['floorLevel'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n        //     }\n        // }\n        // if( FILTERS['priceRange'] ){\n        //     var val_l = FILTERS['priceRange'][0];\n        //     var val_h = FILTERS['priceRange'][1];\n        //\n        //     if(isNaN(val_l) && isNaN(val_h)){//Both are not valid numbers\n        //\n        //     }else if(!isNaN(val_l) && isNaN(val_h)){//Low is valid and no upper\n        //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l) }\n        //     }else if(isNaN(val_l) && !isNaN(val_h)){//Upper is valid and no lower\n        //         selector['priceBreakUp.totalAllInclusive'] =  { $lt: parseInt(val_h) }\n        //     }else{//Both are valid\n        //         selector['priceBreakUp.totalAllInclusive'] =  { $gte: parseInt(val_l), $lte: parseInt(val_h) }\n        //     }\n        // }\n\n        /////PAGINATION\n        // var resultsPerPage = 20;\n        // var currentPageNo = FlowRouter.current().params.pageno;\n        // if(!currentPageNo){currentPageNo = 1}\n        // var skip = (currentPageNo -1) * resultsPerPage;\n        // var urlBase = 'account/myproperies/';\n\n\n        var totalResultsCount = Collections.ActivityHistory.find(selector).count()\n\n        var ret = Collections.ActivityHistory.find(selector, {\n            limit: Session.get('resultsPerPage'),\n            sort: { createdAt : -1 }\n            // skip: skip\n        });\n        Template.instance().loadingMoreText.set(false);\n        return {\n            results: ret,\n            totalResultsCount:totalResultsCount\n        };\n    },\n    loadingMoreText: function(){\n        return Template.instance().loadingMoreText.get() ;\n    },\n    decideTemplate:function (type) {\n\n    }\n})\nTemplate.activity_history.events({\n    'click .load_more':function (event, template) {\n        Template.instance().loadingMoreText.set(true);\n        var resultsPerPage = Session.get('resultsPerPage');\n        resultsPerPage*=2;\n        Session.set('resultsPerPage',resultsPerPage)\n        var id = FlowRouter.current().params.id\n        Meteor.subscribe(\"ActivityHistory\",{limit: resultsPerPage,id:id})\n    }\n})\nTemplate.activity_history.onRendered(function () {\n    Template.instance().loadingMoreText.set(false);\n})\nfunction attachEvents() {\n    $(\".deactivateConfirmBtn\").unbind().bind(\"click\",function () {\n        deactivateConfEvent();\n    })\n    $(\".closePopupBtn\").unbind().bind(\"click\",function () {\n        closePopupEvent();\n    })\n}\nfunction deactivateConfEvent() {\n    var data = Session.get(\"propertyData\");\n    var auctionId = data.auctionId;\n\n    deactivateInProgress.set(true) ;\n    Meteor.call('deactivateAuction',auctionId,function(error, result){\n        deactivateInProgress.set(false) ;\n        if(error){\n            console.log(error);\n            var tmp =  Session.get(\"showErrorDlg\");if(!tmp)tmp=[];\n            tmp.push(\"Failed deactivating. Please try again, try checking your internet connectivity. Contact us if needed.\");\n            Session.set(\"showErrorDlg\",tmp)\n            return;\n        }\n        console.log(\"Success\");\n\n        closePopupEvent();\n        var prevRoute = Session.get('prevRoute');\n        if(prevRoute){\n            FlowRouter.go(prevRoute.name,prevRoute.args)\n            Session.set('prevRoute',false);\n        }else{\n            FlowRouter.go(\"/account/myproperies/\",{pageno:1});\n        }\n\n    });\n}\nfunction closePopupEvent() {\n    console.log('closePopupEvent');\n    if($)\n        if($.fancybox)\n            $.fancybox.close();\n}\nfunction titleCase(str){\n    if(!str)return;\n    return str.charAt(0).toUpperCase() + str.toLowerCase().substring(1);\n}\nfunction slugifyEmailAddress (text) {\n    if(!text)return '';\n    const a = 'àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ/_,:;'\n    const b = 'aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------'\n    const p = new RegExp(a.split('').join('|'), 'g')\n\n    return text.toString().toLowerCase()\n        .replace(/\\s+/g, '.')           // Replace spaces with \".\"\n        .replace(p, c =>\n            b.charAt(a.indexOf(c)))     // Replace special chars\n        .replace(/&/g, '-and-')         // Replace & with ''\n        // .replace(/[^\\w\\-]+/g, '')       // Remove all non-word chars\n        .replace(/\\-\\-+/g, '-')         // Replace multiple - with single ''\n        .replace(/^-+/, '')             // Trim - from start of text\n        .replace(/-+$/, '')             // Trim - from end of text\n}"]},"sourceType":"module","hash":"9ae15db68fa4e27e127e51a133b4411275873f68"}
