{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nvar Future;\n\nFuture = Npm.require('fibers/future');\n\nMeteor.methods({\n  _s3_delete: function(path) {\n    var auth_function, delete_context, future, ref;\n    this.unblock();\n    check(path, String);\n    future = new Future();\n    if ((ref = S3.rules) != null ? ref[\"delete\"] : void 0) {\n      delete_context = _.extend(this, {\n        s3_delete_path: path\n      });\n      auth_function = _.bind(S3.rules[\"delete\"], delete_context);\n      if (!auth_function()) {\n        throw new Meteor.Error(\"Unauthorized\", \"Delete not allowed\");\n      }\n    }\n    S3.knox.deleteFile(path, function(e, r) {\n      if (e) {\n        return future[\"return\"](e);\n      } else {\n        return future[\"return\"](true);\n      }\n    });\n    return future.wait();\n  }\n});\n","sourceMap":{"version":3,"file":"/server/delete_object.coffee.js","sourceRoot":"","sources":["/packages/lepozepo_s3/server/delete_object.coffee"],"names":[],"mappings":";AAAA,IAAA,MAAA;;AAAA,MAAA,GAAS,GAAG,CAAC,OAAJ,CAAY,eAAZ,CAAT,CAAA;;AAAA,MAEM,CAAC,OAAP,CACC;AAAA,EAAA,UAAA,EAAY,SAAC,IAAD,GAAA;AACX,QAAA,0CAAA;AAAA,IAAA,IAAC,CAAA,OAAD,CAAA,CAAA,CAAA;AAAA,IACA,KAAA,CAAM,IAAN,EAAW,MAAX,CADA,CAAA;AAAA,IAGA,MAAA,GAAa,IAAA,MAAA,CAAA,CAHb,CAAA;AAKA,IAAA,kCAAW,CAAE,QAAF,UAAX;AACC,MAAA,cAAA,GAAiB,CAAC,CAAC,MAAF,CAAS,IAAT,EAChB;AAAA,QAAA,cAAA,EAAe,IAAf;OADgB,CAAjB,CAAA;AAAA,MAGA,aAAA,GAAgB,CAAC,CAAC,IAAF,CAAO,EAAE,CAAC,KAAK,CAAC,QAAD,CAAf,EAAuB,cAAvB,CAHhB,CAAA;AAIA,MAAA,IAAG,CAAA,aAAI,CAAA,CAAP;AACC,cAAU,IAAA,MAAM,CAAC,KAAP,CAAa,cAAb,EAA6B,oBAA7B,CAAV,CADD;OALD;KALA;AAAA,IAaA,EAAE,CAAC,IAAI,CAAC,UAAR,CAAmB,IAAnB,EAAyB,SAAC,CAAD,EAAG,CAAH,GAAA;AACxB,MAAA,IAAG,CAAH;eACC,MAAM,CAAC,QAAD,CAAN,CAAc,CAAd,EADD;OAAA,MAAA;eAGC,MAAM,CAAC,QAAD,CAAN,CAAc,IAAd,EAHD;OADwB;IAAA,CAAzB,CAbA,CAAA;WAmBA,MAAM,CAAC,IAAP,CAAA,EApBW;EAAA,CAAZ;CADD,CAFA,CAAA","sourcesContent":["Future = Npm.require 'fibers/future'\n\nMeteor.methods\n\t_s3_delete: (path) ->\n\t\t@unblock()\n\t\tcheck path,String\n\n\t\tfuture = new Future()\n\n\t\tif S3.rules?.delete\n\t\t\tdelete_context = _.extend this,\n\t\t\t\ts3_delete_path:path\n\n\t\t\tauth_function = _.bind S3.rules.delete,delete_context\n\t\t\tif not auth_function()\n\t\t\t\tthrow new Meteor.Error \"Unauthorized\", \"Delete not allowed\"\n\n\t\tS3.knox.deleteFile path, (e,r) ->\n\t\t\tif e\n\t\t\t\tfuture.return e\n\t\t\telse\n\t\t\t\tfuture.return true\n\n\t\tfuture.wait()\n"]}}